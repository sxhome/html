<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TCP/IP详解学习笔记   这位仁兄写得太好了 - 冯赞锋 - 博客园</title>
<link type="text/css" rel="stylesheet" href="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/bundle-fighting.css">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/fengzanfeng/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/fengzanfeng/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/fengzanfeng/wlwmanifest.xml">
<script src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'fengzanfeng', cb_enable_mathjax=false;</script>
<script src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/blog-common.js" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<!--done-->
<center>
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="http://www.cnblogs.com/fengzanfeng/"><img id="blogLogo" src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/logo.gif" alt=""></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/fengzanfeng/">无</a></h1>
<h2></h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<!--done-->
			<ul id="navList">
				<li><a id="MyLinks1_HomeLink" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
				<li><a href="http://q.cnblogs.com/" target="_blank">博问</a></li>
                <li><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a></li>
				<li><a id="MyLinks1_MyHomeLink" class="menu" href="http://www.cnblogs.com/fengzanfeng/">首页</a></li>
				<li><a id="MyLinks1_NewPostLink" class="menu" rel="nofollow" href="http://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
				<li><a id="MyLinks1_ContactLink" accesskey="9" class="menu" rel="nofollow" href="http://msg.cnblogs.com/send/%E5%86%AF%E8%B5%9E%E9%94%8B">联系</a></li>
				<li><a id="MyLinks1_Admin" class="menu" rel="nofollow" href="http://i.cnblogs.com/">管理</a></li>
				<li><a id="MyLinks1_Syndication" class="menu" href="http://www.cnblogs.com/fengzanfeng/rss">订阅</a>
				<a id="MyLinks1_XMLLink" class="aHeaderXML" href="http://www.cnblogs.com/fengzanfeng/rss"><img src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/xml.gif" alt="订阅"></a></li>
			</ul>


		<div class="blogStats">
			
			
<!--done-->
随笔- 0&nbsp;
文章- 20&nbsp;
评论- 8&nbsp;

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div class="clear"></div>
	<div id="topicList">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/fengzanfeng/articles/1339347.html">TCP/IP详解学习笔记   这位仁兄写得太好了</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><h3>TCP/IP详解学习笔记&nbsp;&nbsp; 这位仁兄写得太好了.<br>
<br>
<br>
<a href="http://blog.csdn.net/goodboy1881/category/204448.aspx">http://blog.csdn.net/goodboy1881/category/204448.aspx</a><br>
<br>
<br>
<font color="#770000">TCP/IP详解学习笔记(13)-TCP坚持定时器，TCP保活定时器<br>
<br>
<br>
TCP/IP详解学习笔记(12)-TCP的超时与重传<br>
<br>
TCP/IP详解学习笔记(11)-TCP交互数据流，成块数据流</font></h3>
<p>&nbsp;</p>
<p>&nbsp; </p>
<p align="center"><strong><span style="font-size: 16pt">TCP/IP</span></strong><strong><span style="font-size: 16pt; font-family: 宋体">详解学习笔记</span></strong><strong><span style="font-size: 16pt">(1)-</span></strong><strong><span style="font-size: 16pt; font-family: 宋体">基本概念</span></strong><strong></strong></p>
<p>&nbsp;</p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">为什么会有</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP/IP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">协议</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在
世界上各地，各种各样的电脑运行着各自不同的操作系统为大家服务，这些电脑在表达同一种信息的时候所使用的方法是千差万别。就好像圣经中上帝打乱了各地人
的口音，让他们无法合作一样。计算机使用者意识到，计算机只是单兵作战并不会发挥太大的作用。只有把它们联合起来，电脑才会发挥出它最大的潜力。于是人们
就想方设法的用电线把电脑连接到了一起。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">但是简单的连到一起是远远不够的，就好像语言不同的两个人互相见了面，完全不能交流信息。因而他们需要定义一些共通的东西来进行交流，</span><span style="color: black; font-family: Verdana">TCP/IP</span><span style="color: black; font-family: 宋体">就是为此而生。</span><span style="color: black; font-family: Verdana">TCP/IP</span><span style="color: black; font-family: 宋体">不是一个协议，而是一个协议族的统称。里面包括了</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">协议，</span><span style="color: black; font-family: Verdana">IMCP</span><span style="color: black; font-family: 宋体">协议，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议，以及我们更加熟悉的</span><span style="color: black; font-family: Verdana">http</span><span style="color: black; font-family: 宋体">、</span><span style="color: black; font-family: Verdana">ftp</span><span style="color: black; font-family: 宋体">、</span><span style="color: black; font-family: Verdana">pop3</span><span style="color: black; font-family: 宋体">协议等等。电脑有了这些，就好像学会了外语一样，就可以和其他的计算机终端做自由的交流了。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP/IP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">协议分层</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">提到协议分层，我们很容易联想到</span><span style="color: black; font-family: Verdana">ISO-OSI</span><span style="color: black; font-family: 宋体">的七层协议经典架构，但是</span><span style="color: black; font-family: Verdana">TCP/IP</span><span style="color: black; font-family: 宋体">协议族的结构则稍有不同。如图所示</span> </p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP/IP</span><span style="color: black; font-family: 宋体">协议族按照层次由上到下，层层包装。最上面的就是应用层了，这里面有</span><span style="color: black; font-family: Verdana">http</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">ftp,</span><span style="color: black; font-family: 宋体">等等我们熟悉的协议。而第二层则是传输层，著名的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">协议就在这个层次（不要告诉我你没用过</span><span style="color: black; font-family: Verdana">udp</span><span style="color: black; font-family: 宋体">玩星际）。第三层是网络层，</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">协议就在这里，它负责对数据加上</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址和其他的数据（后面会讲到）以确定传输的目标。第四层是叫数据链路层，这个层次为待传送的数据加入一个以太网协议头，并进行</span><span style="color: black; font-family: Verdana">CRC</span><span style="color: black; font-family: 宋体">编码，为最后的数据传输做准备。再往下则是硬件层次了，负责网络的传输，这个层次的定义包括网线的制式，网卡的定义等等（这些我们就不用关心了，我们也不做网卡），所以有些书并不把这个层次放在</span><span style="color: black; font-family: Verdana">tcp/ip</span><span style="color: black; font-family: 宋体">协议族里面，因为它几乎和</span><span style="color: black; font-family: Verdana">tcp/ip</span><span style="color: black; font-family: 宋体">协议的编写者没有任何的关系。发送协议的主机从上自下将数据按照协议封装，而接收数据的主机则按照协议从得到的数据包解开，最后拿到需要的数据。这种结构非常有栈的味道，所以某些文章也把</span><span style="color: black; font-family: Verdana">tcp/ip</span><span style="color: black; font-family: 宋体">协议族称为</span><span style="color: black; font-family: Verdana">tcp/ip</span><span style="color: black; font-family: 宋体">协议栈。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">一些基本的常识</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在学习协议之前，我们应该具备一些基本知识。</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">互联网地址</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">(ip</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">地址</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">) </span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt 32.25pt; word-break: break-all; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">网络上每一个节点都必须有一个独立的</span><span style="color: black; font-family: Verdana">Internet</span><span style="color: black; font-family: 宋体">地址（也叫做</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址）。现在，通常使用的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址是一个</span><span style="color: black; font-family: Verdana">32bit</span><span style="color: black; font-family: 宋体">的数字，也就是我们常说的</span><span style="color: black; font-family: Verdana">IPv4</span><span style="color: black; font-family: 宋体">标准，这</span><span style="color: black; font-family: Verdana">32bit</span><span style="color: black; font-family: 宋体">的数字分成四组，也就是常见的</span><span style="color: black; font-family: Verdana">255.255.255.255</span><span style="color: black; font-family: 宋体">的样式。</span><span style="color: black; font-family: Verdana">IPv4</span><span style="color: black; font-family: 宋体">标准上，地址被分为五类，我们常用的是</span><span style="color: black; font-family: Verdana">B</span><span style="color: black; font-family: 宋体">类地址。具体的分类请参考其他文档。需要注意的是</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址是网络号</span><span style="color: black; font-family: Verdana">+</span><span style="color: black; font-family: 宋体">主机号的组合，这非常重要。</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">域名系统</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt 32.25pt; word-break: break-all; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">域名系统是一个分布的数据库，它提供将主机名（就是网址啦）转换成</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址的服务。</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">RFC</span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt 32.25pt; word-break: break-all; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">RFC</span><span style="color: black; font-family: 宋体">是什么？</span><span style="color: black; font-family: Verdana">RFC</span><span style="color: black; font-family: 宋体">就是</span><span style="color: black; font-family: Verdana">tcp/ip</span><span style="color: black; font-family: 宋体">协议的标准文档，在</span><span style="color: black; font-family: Verdana"><a href="http://www.ietf.org/iesg/1rfc_index.txt"><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">这里</span></a></span><span style="color: black; font-family: 宋体">我们可以看到</span><span style="color: black; font-family: Verdana">RFC</span><span style="color: black; font-family: 宋体">那长长的定义列表，现在它一共有</span><span style="color: black; font-family: Verdana">4000</span><span style="color: black; font-family: 宋体">多个协议的定义，当然，我们所要学习的，也就是那么十几个协议而已。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">端口号</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">(port)</span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt 32.25pt; word-break: break-all; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">注意，这个号码是用在</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">上的一个逻辑号码，并不是一个硬件端口，我们平时说把某某端口封掉了，也只是在</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">层次把带有这个号码的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">包给过滤掉了而已。</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">应用编程接口</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 0pt 32.25pt; word-break: break-all; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">现在常用的编程接口有</span><span style="color: black; font-family: Verdana">socket</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">TLI</span><span style="color: black; font-family: 宋体">。而前面的有时候也叫做</span><span style="color: black; font-family: Verdana">“Berkeley socket”</span><span style="color: black; font-family: 宋体">，可见</span><span style="color: black; font-family: Verdana">Berkeley</span><span style="color: black; font-family: 宋体">对于网络的发展有多大的贡献。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: black; font-family: Verdana"><a href="http://blog.csdn.net/goodboy1881/archive/2006/04/16/665061.aspx"><span style="color: #770000; text-decoration: none; text-underline: none">TCP/IP</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">详解学习笔记</span><span style="color: #770000; text-decoration: none; text-underline: none">(2)-</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">数据链路层</span></a></span></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">数据链路层有三个目的：</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">模块发送和</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">接收</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ARP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">模块发送</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ARP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">请求和接收</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ARP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">应答。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RARP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">发送</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RARP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">请</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">求和接收</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RARP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">应答</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">大家都听说过。至于</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">RARP</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">叫做地址解析协议，是用</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址换</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址的一种协议，而</span><span style="color: black; font-family: Verdana">RARP</span><span style="color: black; font-family: 宋体">则叫做逆地址解析协议，在</span><span style="color: black; font-family: Verdana">tcp/ip</span><span style="color: black; font-family: 宋体">协议的后面章节会介绍它们（在局域网里面用</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">协议可以很容易的搞瘫痪网络哦）</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">数据链路层的协议还是很多的，有我们最常用的以太网（就是平时我们用的网卡）协议，也有不太常见的令牌环，还有</span><span style="color: black; font-family: Verdana">FDDI</span><span style="color: black; font-family: 宋体">，当然，还有国内现在相当普及的</span><span style="color: black; font-family: Verdana">PPP</span><span style="color: black; font-family: 宋体">协议（就是</span><span style="color: black; font-family: Verdana">adsl</span><span style="color: black; font-family: 宋体">宽带），以及一个</span><span style="color: black; font-family: Verdana">loopback</span><span style="color: black; font-family: 宋体">协议。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">联系</span><span style="color: black; font-family: Verdana">linux</span><span style="color: black; font-family: 宋体">里面的</span><span style="color: black; font-family: Verdana">ifconfig -a</span><span style="color: black; font-family: 宋体">命令，这个命令通常会得到如下的结果</span></p>
<p style="background: black; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: white; font-family: Verdana">eth0 Link encap:Ethernet HWaddr 00:01:4A:03:5B:ED<br>
inet addr:192.168.11.2 Bcast:192.168.11.255 Mask:255.255.255.0<br>
inet6 addr: fe80::201:4aff:fe03:5bed/64 Scope:Link<br>
UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br>
RX packets:2819 errors:0 dropped:0 overruns:0 frame:0<br>
TX packets:76 errors:0 dropped:0 overruns:0 carrier:0<br>
collisions:0 txqueuelen:1000<br>
RX bytes:241609 (235.9 KiB) TX bytes:9596 (9.3 KiB)</span></p>
<p style="background: black; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: white; font-family: Verdana">lo Link encap:Local Loopback<br>
inet addr:127.0.0.1 Mask:255.0.0.0<br>
inet6 addr: ::1/128 Scope:Host<br>
UP LOOPBACK RUNNING MTU:16436 Metric:1<br>
RX packets:2713 errors:0 dropped:0 overruns:0 frame:0<br>
TX packets:2713 errors:0 dropped:0 overruns:0 carrier:0<br>
collisions:0 txqueuelen:0<br>
RX bytes:3516032 (3.3 MiB) TX bytes:3516032 (3.3 MiB)</span></p>
<p style="background: black; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left">&nbsp;</p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">其中，</span><span style="color: black; font-family: Verdana">eth0</span><span style="color: black; font-family: 宋体">就是以太网接口，而</span><span style="color: black; font-family: Verdana">lo</span><span style="color: black; font-family: 宋体">则是</span><span style="color: black; font-family: Verdana">loopback</span><span style="color: black; font-family: 宋体">接口。这也说明这个主机在网络链路层上至少支持</span><span style="color: black; font-family: Verdana">loopback</span><span style="color: black; font-family: 宋体">协议和以太网协议。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">以太网（</span><span style="color: black; font-family: Verdana">Ether-net</span><span style="color: black; font-family: 宋体">）的定是指数字设备公司（</span><span style="color: black; font-family: Verdana"> Digital Equipment Corp.</span><span style="color: black; font-family: 宋体">）、英特尔公司（</span><span style="color: black; font-family: Verdana">Intel Corp.</span><span style="color: black; font-family: 宋体">）和</span><span style="color: black; font-family: Verdana">Xerox</span><span style="color: black; font-family: 宋体">公司在</span><span style="color: black; font-family: Verdana">1982</span><span style="color: black; font-family: 宋体">年联合公布的一个标准，这个标准里面使用了一种称作</span><span style="color: black; font-family: Verdana">CSMA/CD</span><span style="color: black; font-family: 宋体">的接入方法。而</span><span style="color: black; font-family: Verdana">IEEE802</span><span style="color: black; font-family: 宋体">提供的标准集</span><span style="color: black; font-family: Verdana">802.3(</span><span style="color: black; font-family: 宋体">还有一部分定义到了</span><span style="color: black; font-family: Verdana">802.2</span><span style="color: black; font-family: 宋体">中</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">也提供了一个</span><span style="color: black; font-family: Verdana">CSMA/CD</span><span style="color: black; font-family: 宋体">的标准。这两个标准稍有不同，</span><span style="color: black; font-family: Verdana">TCP/IP</span><span style="color: black; font-family: 宋体">协议对这种情况的处理方式如下</span><span style="color: black; font-family: Verdana">:</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">以太网的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报封装在</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RFC894</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">中定义，而</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IEEE802</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">网络的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报封装在</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RFC1042</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">中定义。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">一台主机一定要能发送和接收</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RFC894</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">定义的数据报。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">一台主机可以接收</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RFC894</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">和</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RFC1042</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的封装格式的混合数据报。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">一台主机也许能够发送</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RFC1042</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报。。如果主机能同时发送两种类型的分组数</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">据，那么发送的分组必须是可以设置的，而且默认条件下必须是</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RFC 894</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">分组。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">可见，</span><span style="color: black; font-family: Verdana">RFC1042</span><span style="color: black; font-family: 宋体">在</span><span style="color: black; font-family: Verdana">TCP/IP</span><span style="color: black; font-family: 宋体">里面处于一个配角的地位。这两种不同的数据报格式请参考教材。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">ppp(</span><span style="color: black; font-family: 宋体">点对点协议</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">是从</span><span style="color: black; font-family: Verdana">SLIP</span><span style="color: black; font-family: 宋体">的替代品。他们都提供了一种低速接入的解决方案。而每一种数据链路层协议，都有一个</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">（最大传输单元）定义，在这个定义下面，如果</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">数据报过大，则要进行分片</span><span style="color: black; font-family: Verdana">(fragmentation)</span><span style="color: black; font-family: 宋体">，使得每片都小于</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">，注意</span><span style="color: black; font-family: Verdana">PPP</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">并不是一个物理定义，而是指一个逻辑定义（个人认为就是用程序控制）。可以用</span><span style="color: black; font-family: Verdana">netstat</span><span style="color: black; font-family: 宋体">来打印出</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">的结果，比如键入</span><span style="color: black; font-family: Verdana">netstat -in</span></p>
<p style="background: black; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: white; font-family: Verdana">Kernel Interface table<br>
Iface&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MTU Met&nbsp;&nbsp;&nbsp; 
RX-OK RX-ERR RX-DRP RX-OVR&nbsp;&nbsp;&nbsp; TX-OK TX-ERR TX-DRP TX-OVR 
Flg<br>
eth0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1500&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp; 1774&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 587&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 BMRU<br>
lo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16436&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp; 2667&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp; 2667&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 LRU</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">就可以观察到</span><span style="color: black; font-family: Verdana">eth0</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">是</span><span style="color: black; font-family: Verdana">1500</span><span style="color: black; font-family: 宋体">。而</span><span style="color: black; font-family: Verdana">lo</span><span style="color: black; font-family: 宋体">（环回接口）的</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">则是</span><span style="color: black; font-family: Verdana">16436</span><span style="color: black; font-family: 宋体">。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">最后说说那个环回接口（</span><span style="color: black; font-family: Verdana">loopback</span><span style="color: black; font-family: 宋体">）。平时我们用</span><span style="color: black; font-family: Verdana">127.0.0.1</span><span style="color: black; font-family: 宋体">来尝试自己的机器服务器好使不好使。走的就是这个</span><span style="color: black; font-family: Verdana">loopback</span><span style="color: black; font-family: 宋体">接口。对于环回接口，有如下三点值得注意</span><span style="color: black; font-family: Verdana">:</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">传给环回地址（一般是</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">127.0.0.1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">）的任何数据均作为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">I P</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">输入。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">传给广播地址或多播地址的数据报复制一份传给环回接口，然后送到以太网上。这是</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">因为广播传送和多播传送的定义包含主机本身。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">任何传给该主机</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">地址的数据均送到环回接口。</span> </p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这一章还是很简单的，一般作为了解知识也就足够了，没必要抠的那么详细。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center">TCP/IP<span style="font-family: 宋体">详解之</span>IP<span style="font-family: 宋体">协议</span>ARP<span style="font-family: 宋体">协议和</span>RARP<span style="font-family: 宋体">协议</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt">　　把这三个协议放到一起学习是因为这三个协议处于同一层，</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">协议用来找到目标主机的</span><span style="font-size: 9pt; font-family: Arial">Ethernet</span><span style="font-size: 9pt">网卡</span><span style="font-size: 9pt; font-family: Arial">Mac</span><span style="font-size: 9pt">地址，</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">则承载要发送的消息。数据链路层可以从</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">得到数据的传送信息，而从</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">得到要传输的数据信息。</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">1.IP</span><span style="font-size: 9pt">协议</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">协议是</span><span style="font-size: 9pt; font-family: Arial">TCP/IP</span><span style="font-size: 9pt">协议的核心，所有的</span><span style="font-size: 9pt; font-family: Arial">TCP</span><span style="font-size: 9pt">，</span><span style="font-size: 9pt; font-family: Arial">UDP</span><span style="font-size: 9pt">，</span><span style="font-size: 9pt; font-family: Arial">IMCP</span><span style="font-size: 9pt">，</span><span style="font-size: 9pt; font-family: Arial">IGCP</span><span style="font-size: 9pt">的数据都以</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">数据格式传输。要注意的是，</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">不是可靠的协议，这是说，</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">协议没有提供一种数据未传达以后的处理机制</span><span style="font-size: 9pt; font-family: Arial">--</span><span style="font-size: 9pt">这被认为是上层协议</span><span style="font-size: 9pt; font-family: Arial">--TCP</span><span style="font-size: 9pt">或</span><span style="font-size: 9pt; font-family: Arial">UDP</span><span style="font-size: 9pt">要做的事情。所以这也就出现了</span><span style="font-size: 9pt; font-family: Arial">TCP</span><span style="font-size: 9pt">是一个可靠的协议，而</span><span style="font-size: 9pt; font-family: Arial">UDP</span><span style="font-size: 9pt">就没有那么可靠的区别。这是后话，暂且不提</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">1.1.IP</span><span style="font-size: 9pt">协议头</span></p>
<p><span style="font-size: 9pt">　　如图所示</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial"><a href="http://edu.yesky.com/imagelist/2007/057/37pe0l9u5kta.jpg" target="_blank"> </a></span></p>
<p><span style="font-size: 9pt">　　挨个解释它是教科书的活计，我感兴趣的只是那八位的</span><span style="font-size: 9pt; font-family: Arial">TTL</span><span style="font-size: 9pt">字段，还记得这个字段是做什么的么</span><span style="font-size: 9pt; font-family: Arial">?</span><span style="font-size: 9pt">这个字段规定该数据包在穿过多少个路由之后才会被抛弃</span><span style="font-size: 9pt; font-family: Arial">(</span><span style="font-size: 9pt">这里就体现出来</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">协议包的不可靠性，它不保证数据被送达</span><span style="font-size: 9pt; font-family: Arial">)</span><span style="font-size: 9pt">，某个</span><span style="font-size: 9pt; font-family: Arial">ip</span><span style="font-size: 9pt">数据包每穿过一个路由器，该数据包的</span><span style="font-size: 9pt; font-family: Arial">TTL</span><span style="font-size: 9pt">数值就会减少</span><span style="font-size: 9pt; font-family: Arial">1</span><span style="font-size: 9pt">，当该数据包的</span><span style="font-size: 9pt; font-family: Arial">TTL</span><span style="font-size: 9pt">成为零，它就会被自动抛弃。这个字段的最大值也就是</span><span style="font-size: 9pt; font-family: Arial">255</span><span style="font-size: 9pt">，也就是说一个协议包也就在路由器里面穿行</span><span style="font-size: 9pt; font-family: Arial">255</span><span style="font-size: 9pt">次就会被抛弃了，根据系统的不同，这个数字也不一样，一般是</span><span style="font-size: 9pt; font-family: Arial">32</span><span style="font-size: 9pt">或者是</span><span style="font-size: 9pt; font-family: Arial">64</span><span style="font-size: 9pt">，</span><span style="font-size: 9pt; font-family: Arial">Tracerouter</span><span style="font-size: 9pt">这个工具就是用这个原理工作的，</span><span style="font-size: 9pt; font-family: Arial">tranceroute</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt; font-family: Arial">-m</span><span style="font-size: 9pt">选项要求最大值是</span><span style="font-size: 9pt; font-family: Arial">255</span><span style="font-size: 9pt">，也就是因为这个</span><span style="font-size: 9pt; font-family: Arial">TTL</span><span style="font-size: 9pt">在</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">协议里面只有</span><span style="font-size: 9pt; font-family: Arial">8bit</span><span style="font-size: 9pt">。</span></p>
<p><span style="font-size: 9pt">　　现在的</span><span style="font-size: 9pt; font-family: Arial">ip</span><span style="font-size: 9pt">版本号是</span><span style="font-size: 9pt; font-family: Arial">4</span><span style="font-size: 9pt">，所以也称作</span><span style="font-size: 9pt; font-family: Arial">IPv4</span><span style="font-size: 9pt">。现在还有</span><span style="font-size: 9pt; font-family: Arial">IPv6</span><span style="font-size: 9pt">，而且运用也越来越广泛了。</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">1.2.IP</span><span style="font-size: 9pt">路由选择</span></p>
<p><span style="font-size: 9pt">　　当一个</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">数据包准备好了的时候，</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">数据包</span><span style="font-size: 9pt; font-family: Arial">(</span><span style="font-size: 9pt">或者说是路由器</span><span style="font-size: 9pt; font-family: Arial">)</span><span style="font-size: 9pt">是如何将数据包送到目的地的呢</span><span style="font-size: 9pt; font-family: Arial">?</span><span style="font-size: 9pt">它是怎么选择一个合适的路径来</span><span style="font-size: 9pt; font-family: Arial">"</span><span style="font-size: 9pt">送货</span><span style="font-size: 9pt; font-family: Arial">"</span><span style="font-size: 9pt">的呢</span><span style="font-size: 9pt; font-family: Arial">?</span></p>
<p><span style="font-size: 9pt">　　最特殊的情况是目的主机和主机直连，那么主机根本不用寻找路由，直接把数据传递过去就可以了。至于是怎么直接传递的，这就要靠</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">协议了，后面会讲到。</span></p>
<p><span style="font-size: 9pt">　　稍微一般一点的情况是，主机通过若干个路由器</span><span style="font-size: 9pt; font-family: Arial">(router)</span><span style="font-size: 9pt">和目的主机连接。那么路由器就要通过</span><span style="font-size: 9pt; font-family: Arial">ip</span><span style="font-size: 9pt">包的信息来为</span><span style="font-size: 9pt; font-family: Arial">ip</span><span style="font-size: 9pt">包寻找到一个合适的目标来进行传递，比如合适的主机，或者合适的路由。路由器或者主机将会用如下的方式来处理某一个</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">数据包</span></p>
<p><span style="font-size: 9pt">　　如果</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">数据包的</span><span style="font-size: 9pt; font-family: Arial">TTL(</span><span style="font-size: 9pt">生命周期</span><span style="font-size: 9pt; font-family: Arial">)</span><span style="font-size: 9pt">以到，则该</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">数据包就被抛弃。</span></p>
<p><span style="font-size: 9pt">　　搜索路由表，优先搜索匹配主机，如果能找到和</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">地址完全一致的目标主机，则将该包发向目标主机</span></p>
<p><span style="font-size: 9pt">　　搜索路由表，如果匹配主机失败，则匹配同子网的路由器，这需要</span><span style="font-size: 9pt; font-family: Arial">“</span><span style="font-size: 9pt">子网掩码</span><span style="font-size: 9pt; font-family: Arial">(1.3.)”</span><span style="font-size: 9pt">的协助。如果找到路由器，则将该包发向路由器。</span></p>
<p><span style="font-size: 9pt">　　搜索路由表，如果匹配同子网路由器失败，则匹配同网号</span><span style="font-size: 9pt; font-family: Arial">(</span><span style="font-size: 9pt">第一章有讲解</span><span style="font-size: 9pt; font-family: Arial">)</span><span style="font-size: 9pt">路由器，如果找到路由器，则将该包发向路由器。</span></p>
<p><span style="font-size: 9pt">　　搜索陆游表，如果以上都失败了，就搜索默认路由，如果默认路由存在，则发包</span></p>
<p><span style="font-size: 9pt">　　如果都失败了，就丢掉这个包。</span></p>
<p><span style="font-size: 9pt">　　这再一次证明了，</span><span style="font-size: 9pt; font-family: Arial">ip</span><span style="font-size: 9pt">包是不可靠的。因为它不保证送达。</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">1.3.</span><span style="font-size: 9pt">子网寻址</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">地址的定义是网络号</span><span style="font-size: 9pt; font-family: Arial">+</span><span style="font-size: 9pt">主机号。但是现在所有的主机都要求子网编址，也就是说，把主机号在细分成子网号</span><span style="font-size: 9pt; font-family: Arial">+</span><span style="font-size: 9pt">主机号。最终一个</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">地址就成为</span> <span style="font-size: 9pt">网络号码</span><span style="font-size: 9pt; font-family: Arial">+</span><span style="font-size: 9pt">子网号</span><span style="font-size: 9pt; font-family: Arial">+</span><span style="font-size: 9pt">主机号。例如一个</span><span style="font-size: 9pt; font-family: Arial">B</span><span style="font-size: 9pt">类地址：</span><span style="font-size: 9pt; font-family: Arial">210.30.109.134</span><span style="font-size: 9pt">。一般情况下，这个</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">地址的红色部分就是网络号，而蓝色部分就是子网号，绿色部分就是主机号。至于有多少位代表子网号这个问题上，这没有一个硬性的规定，取而代之的则是子网掩码，校园网相信大多数人都用过，在校园网的设定里面有一个</span><span style="font-size: 9pt; font-family: Arial">255.255.255.0</span><span style="font-size: 9pt">的东西，这就是子网掩码。子网掩码是由</span><span style="font-size: 9pt; font-family: Arial">32bit</span><span style="font-size: 9pt">的二进制数字序列</span><span style="font-size: 9pt; font-family: Arial">,</span><span style="font-size: 9pt">形式为是一连串的</span><span style="font-size: 9pt; font-family: Arial">1</span><span style="font-size: 9pt">和一连串的</span><span style="font-size: 9pt; font-family: Arial">0</span><span style="font-size: 9pt">，例如：</span><span style="font-size: 9pt; font-family: Arial">255.255.255.0(</span><span style="font-size: 9pt">二进制就是</span><span style="font-size: 9pt; font-family: Arial">11111111.11111111.11111111.00000000)</span><span style="font-size: 9pt">对于刚才的那个</span><span style="font-size: 9pt; font-family: Arial">B</span><span style="font-size: 9pt">类地址，因为</span><span style="font-size: 9pt; font-family: Arial">210.30</span><span style="font-size: 9pt">是网络号，那么后面的</span><span style="font-size: 9pt; font-family: Arial">109.134</span><span style="font-size: 9pt">就是子网号和主机号的组合，又因为子网掩码只有后八</span><span style="font-size: 9pt; font-family: Arial">bit</span><span style="font-size: 9pt">为</span><span style="font-size: 9pt; font-family: Arial">0</span><span style="font-size: 9pt">，所以主机号就是</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">地址的后八个</span><span style="font-size: 9pt; font-family: Arial">bit</span><span style="font-size: 9pt">，就是</span><span style="font-size: 9pt; font-family: Arial">134</span><span style="font-size: 9pt">，而剩下的就是子网号码</span><span style="font-size: 9pt; font-family: Arial">--109</span><span style="font-size: 9pt">。</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">2. ARP</span><span style="font-size: 9pt">协议</span></p>
<p><span style="font-size: 9pt">　　还记得数据链路层的以太网的协议中，每一个数据包都有一个</span><span style="font-size: 9pt; font-family: Arial">MAC</span><span style="font-size: 9pt">地址头么</span><span style="font-size: 9pt; font-family: Arial">?</span><span style="font-size: 9pt">我们知道每一块以太网卡都有一个</span><span style="font-size: 9pt; font-family: Arial">MAC</span><span style="font-size: 9pt">地址，这个地址是唯一的，那么</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">包是如何知道这个</span><span style="font-size: 9pt; font-family: Arial">MAC</span><span style="font-size: 9pt">地址的</span><span style="font-size: 9pt; font-family: Arial">?</span><span style="font-size: 9pt">这就是</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">协议的工作。</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">ARP(</span><span style="font-size: 9pt">地址解析</span><span style="font-size: 9pt; font-family: Arial">)</span><span style="font-size: 9pt">协议是一种解析协议，本来主机是完全不知道这个</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">对应的是哪个主机的哪个接口，当主机要发送一个</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">包的时候，会首先查一下自己的</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">高速缓存</span><span style="font-size: 9pt; font-family: Arial">(</span><span style="font-size: 9pt">就是一个</span><span style="font-size: 9pt; font-family: Arial">IP-MAC</span><span style="font-size: 9pt">地址对应表缓存</span><span style="font-size: 9pt; font-family: Arial">)</span><span style="font-size: 9pt">，如果查询的</span><span style="font-size: 9pt; font-family: Arial">IP-MAC</span><span style="font-size: 9pt">值对不存在，那么主机就向网络发送一个</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">协议广播包，这个广播包里面就有待查询的</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">地址，而直接收到这份广播的包的所有主机都会查询自己的</span><span style="font-size: 9pt; font-family: Arial">IP</span><span style="font-size: 9pt">地址，如果收到广播包的某一个主机发现自己符合条件，那么就准备好一个包含自己的</span><span style="font-size: 9pt; font-family: Arial">MAC</span><span style="font-size: 9pt">地址的</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">包传送给发送</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">广播的主机，而广播主机拿到</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">包后会更新自己的</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">缓存</span><span style="font-size: 9pt; font-family: Arial">(</span><span style="font-size: 9pt">就是存放</span><span style="font-size: 9pt; font-family: Arial">IP-MAC</span><span style="font-size: 9pt">对应表的地方</span><span style="font-size: 9pt; font-family: Arial">)</span><span style="font-size: 9pt">。发送广播的主机就会用新的</span><span style="font-size: 9pt; font-family: Arial">ARP</span><span style="font-size: 9pt">缓存数据准备好数据链路层的的数据包发送工作。</span></p>
<p><span style="font-size: 9pt">　　一个典型的</span><span style="font-size: 9pt; font-family: Arial">arp</span><span style="font-size: 9pt">缓存信息如下，在任意一个系统里面用</span><span style="font-size: 9pt; font-family: Arial">“arp -a”</span><span style="font-size: 9pt">命令</span><span style="font-size: 9pt; font-family: Arial">:</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">Interface: 192.168.11.3 --- 0x2</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">Internet Address Physical Address Type</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">192.168.11.1 00-0d-0b-43-a0-2e dynamic</span></p>
<p><span style="font-size: 9pt">　　</span><span style="font-size: 9pt; font-family: Arial">192.168.11.2 00-01-4a-03-5b-ed dynamic</span></p>
<p><span style="font-size: 9pt">　　都会得到这样的结果。</span></p>
<p><span style="font-size: 9pt">　　这样的高速缓存是有时限的，一般是</span><span style="font-size: 9pt; font-family: Arial">20</span><span style="font-size: 9pt">分钟</span><span style="font-size: 9pt; font-family: Arial">(</span><span style="font-size: 9pt">伯克利系统的衍生系统</span><span style="font-size: 9pt; font-family: Arial">)</span><span style="font-size: 9pt">。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: black; font-family: Verdana"><a href="http://blog.csdn.net/goodboy1881/archive/2006/04/20/670761.aspx"><span style="color: #770000; text-decoration: none; text-underline: none">TCP/IP</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">详解学习笔记</span><span style="color: #770000; text-decoration: none; text-underline: none">(4)-ICMP</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">协议，</span><span style="color: #770000; text-decoration: none; text-underline: none">ping</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">和</span><span style="color: #770000; text-decoration: none; text-underline: none">Traceroute</span></a></span></strong></p>
<p>&nbsp;</p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.IMCP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">协议介绍</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">前面讲到了，</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">协议并不是一个可靠的协议，它不保证数据被送达，那么，自然的，保证数据送达的工作应该由其他的模块来完成。其中一个重要的模块就是</span><span style="color: black; font-family: Verdana">ICMP(</span><span style="color: black; font-family: 宋体">网络控制报文</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">协议。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">当传送</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">数据包发生错误－－比如主机不可达，路由不可达等等，</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">协议将会把错误信息封包，然后传送回给主机。给主机一个处理错误的机会，这</span> <span style="color: black; font-family: 宋体">也就是为什么说建立在</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">层以上的协议是可能做到安全的原因。</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">数据包由</span><span style="color: black; font-family: Verdana">8bit</span><span style="color: black; font-family: 宋体">的错误类型和</span><span style="color: black; font-family: Verdana">8bit</span><span style="color: black; font-family: 宋体">的代码和</span><span style="color: black; font-family: Verdana">16bit</span><span style="color: black; font-family: 宋体">的校验和组成。而前</span><span style="color: black; font-family: Verdana"> 16bit</span><span style="color: black; font-family: 宋体">就组成了</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">所要传递的信息。书上的图</span><span style="color: black; font-family: Verdana">6</span><span style="color: black; font-family: 宋体">－</span><span style="color: black; font-family: Verdana">3</span><span style="color: black; font-family: 宋体">清楚的给出了错误类型和代码的组合代表的意思。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">尽管在大多数情况下，错误的包传送应该给出</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">报文，但是在特殊情况下，是不产生</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">错误报文的。如下</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ICMP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">差错报文不会产生</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ICMP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">差错报文（出</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IMCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">查询报文）（防止</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IMCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的无限产生和传送）</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">目的地址是广播地址或多播地址的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">作为链路层广播的数据报。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">不是</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">分片的第一片。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">5.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">源地址不是单个主机的数据报。这就是说，源地址不能为零地址、环回地址、广播地</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">址或多播地址。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">虽然里面的一些规定现在还不是很明白，但是所有的这一切规定，都是为了防止产生</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">报文的无限传播而定义的。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">协议大致分为两类，一种是查询报文，一种是差错报文。其中查询报文有以下几种用途</span><span style="color: black; font-family: Verdana">:</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ping</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">查询（不要告诉我你不知道</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ping</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">程序）</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">子网掩码查询（用于无盘工作站在初始化自身的时候初始化子网掩码）</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">时间戳查询（可以用来同步时间）</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">而差错报文则产生在数据传送发生错误的时候。就不赘述了。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.ICMP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的应用</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">--ping</span></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">可以说是</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">的最著名的应用，当我们某一个网站上不去的时候。通常会</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">一下这个网站。</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">会回显出一些有用的信息。一般的信息如下</span><span style="color: black; font-family: Verdana">:</span></p>
<p style="background: black; word-break: break-all; line-height: 150%" align="left"><span style="font-size: 9pt; color: white; line-height: 150%; font-family: Verdana">Reply from 10.4.24.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 10.4.24.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 10.4.24.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 10.4.24.1: bytes=32 time&lt;1ms TTL=255<br>
<br>
Ping statistics for 10.4.24.1:<br>
&nbsp;&nbsp;&nbsp; Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),<br>
Approximate round trip times in milli-seconds:<br>
&nbsp;&nbsp;&nbsp; Minimum = 0ms, Maximum = 0ms, Average = 0ms</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">这个单词源自声纳定位，而这个程序的作用也确实如此，它利用</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">协议包来侦测另一个主机是否可达。原理是用类型码为</span><span style="color: black; font-family: Verdana">0</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">发请</span> <span style="color: black; font-family: 宋体">求，受到请求的主机则用类型码为</span><span style="color: black; font-family: Verdana">8</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">回应。</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">程序来计算间隔时间，并计算有多少个包被送达。用户就可以判断网络大致的情况。我们可以看到，</span><span style="color: black; font-family: Verdana"> ping</span><span style="color: black; font-family: 宋体">给出来了传送的时间和</span><span style="color: black; font-family: Verdana">TTL</span><span style="color: black; font-family: 宋体">的数据。我给的例子不太好，因为走的路由少，有兴趣地可以</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">一下国外的网站比如</span><span style="color: black; font-family: Verdana">sf.net</span><span style="color: black; font-family: 宋体">，就可以观察到一些</span> <span style="color: black; font-family: 宋体">丢包的现象，而程序运行的时间也会更加的长。</span><span style="color: black; font-family: Verdana"><br>
ping</span><span style="color: black; font-family: 宋体">还给我们一个看主机到目的主机的路由的机会。这是因为，</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">请求数据报在每经过一个路由器的时候，路由器都会把自己的</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">放到该数</span> <span style="color: black; font-family: 宋体">据报中。而目的主机则会把这个</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">列表复制到回应</span><span style="color: black; font-family: Verdana">icmp</span><span style="color: black; font-family: 宋体">数据包中发回给主机。但是，无论如何，</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">头所能纪录的路由列表是非常的有限。如果要观察路由，</span> <span style="color: black; font-family: 宋体">我们还是需要使用更好的工具，就是要讲到的</span><span style="color: black; font-family: Verdana">Traceroute(windows</span><span style="color: black; font-family: 宋体">下面的名字叫做</span><span style="color: black; font-family: Verdana">tracert)</span><span style="color: black; font-family: 宋体">。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.ICMP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的应用</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">--Traceroute</span></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">Traceroute</span><span style="color: black; font-family: 宋体">是用来侦测主机到目的主机之间所经路由情况的重要工具，也是最便利的工具。前面说到，尽管</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">工具也可以进行侦测，但是，因为</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">头的限制，</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">不能完全的记录下所经过的路由器。所以</span><span style="color: black; font-family: Verdana">Traceroute</span><span style="color: black; font-family: 宋体">正好就填补了这个缺憾。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">Traceroute</span><span style="color: black; font-family: 宋体">的原理是非常非常的有意思，它受到目的主机的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">后，首先给目的主机发送一个</span><span style="color: black; font-family: Verdana">TTL=1</span><span style="color: black; font-family: 宋体">（还记得</span><span style="color: black; font-family: Verdana">TTL</span><span style="color: black; font-family: 宋体">是什么吗？）的</span><span style="color: black; font-family: Verdana">UDP(</span><span style="color: black; font-family: 宋体">后面就</span> <span style="color: black; font-family: 宋体">知道</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">是什么了</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">数据包，而经过的第一个路由器收到这个数据包以后，就自动把</span><span style="color: black; font-family: Verdana">TTL</span><span style="color: black; font-family: 宋体">减</span><span style="color: black; font-family: Verdana">1</span><span style="color: black; font-family: 宋体">，而</span><span style="color: black; font-family: Verdana">TTL</span><span style="color: black; font-family: 宋体">变为</span><span style="color: black; font-family: Verdana">0</span><span style="color: black; font-family: 宋体">以后，路由器就把这个包给抛弃了，并同时产生</span> <span style="color: black; font-family: 宋体">一个主机不可达的</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">数据报给主机。主机收到这个数据报以后再发一个</span><span style="color: black; font-family: Verdana">TTL=2</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">数据报给目的主机，然后刺激第二个路由器给主机发</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">数据</span> <span style="color: black; font-family: 宋体">报。如此往复直到到达目的主机。这样，</span><span style="color: black; font-family: Verdana">traceroute</span><span style="color: black; font-family: 宋体">就拿到了所有的路由器</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">。从而避开了</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">头只能记录有限路由</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">的问题。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">有人要问，我怎么知道</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">到没到达目的主机呢？这就涉及一个技巧的问题，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">协议有一个端口号定义，而普通的网络程序只监控少数的几个号码较</span> <span style="color: black; font-family: 宋体">小的端口，比如说</span><span style="color: black; font-family: Verdana">80,</span><span style="color: black; font-family: 宋体">比如说</span><span style="color: black; font-family: Verdana">23,</span><span style="color: black; font-family: 宋体">等等。而</span><span style="color: black; font-family: Verdana">traceroute</span><span style="color: black; font-family: 宋体">发送的是端口号</span><span style="color: black; font-family: Verdana">&gt;30000(</span><span style="color: black; font-family: 宋体">真变态</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">报，所以到达目的主机的时候，目的</span> <span style="color: black; font-family: 宋体">主机只能发送一个端口不可达的</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">数据报给主机。主机接到这个报告以后就知道，主机到了，所以，说</span><span style="color: black; font-family: Verdana">Traceroute</span><span style="color: black; font-family: 宋体">是一个骗子一点也不为过</span><span style="color: black; font-family: Verdana">:)</span></p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">Traceroute</span><span style="color: black; font-family: 宋体">程序里面提供了一些很有用的选项，甚至包含了</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">选路的选项，请察看</span><span style="color: black; font-family: Verdana">man</span><span style="color: black; font-family: 宋体">文档来了解这些，这里就不赘述了。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">TCP/IP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">详解学习笔记</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">(5)-IP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">选路，动态选路，和一些细节</span></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">静态</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">选路</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.1.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">一个简单的路由表</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">选路是</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">层最重要的一个功能之一。前面的部分已经简单的讲过路由器是通过何种规则来根据</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">数据包的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址来选择路由。这里就不重复了。首先来看看一个简单的系统路由表。</span></p>
<p style="background: black; word-break: break-all; line-height: 150%" align="left"><span style="font-size: 9pt; color: white; line-height: 150%; font-family: Verdana">Destination&nbsp;&nbsp;&nbsp;&nbsp;
 Gateway&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Genmask&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Flags Metric 
Ref&nbsp;&nbsp;&nbsp; Use Iface<br>
192.168.11.0&nbsp;&nbsp;&nbsp; 
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 255.255.255.0&nbsp;&nbsp; U&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 eth0<br>
169.254.0.0&nbsp;&nbsp;&nbsp;&nbsp; 
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 255.255.0.0&nbsp;&nbsp;&nbsp;&nbsp; U&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 eth0<br>
default&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
192.168.11.1&nbsp;&nbsp;&nbsp; 
0.0.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
UG&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 eth0</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">对于一个给定的路由器，可以打印出五种不同的</span><span style="color: black; font-family: Verdana">flag</span><span style="color: black; font-family: 宋体">。</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">U</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">表明该路由可用。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">G</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">表明该路由是到一个网关。如果没有这个标志，说明和</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Destination</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">是直连的，而相应的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Gateway</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">应该直接给出</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Destination</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的地址。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">H</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">表明该路由是到一个主机，如果没有该标志，说明</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Destination</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">是一个网络，换句话说</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Destination</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">就应该写成一个网络号和子网号的组合，而不包括主机号</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">(</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">主机号码处为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">0)</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，例如</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> 192.168.11.0 </span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">D</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">表明该路由是为重定向报文创建的</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">5.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">M</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">该路由已经被重定向报文修改</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">U</span><span style="color: black; font-family: 宋体">没啥可说的，</span><span style="color: black; font-family: Verdana">G</span><span style="color: black; font-family: 宋体">说明这是一个网关，如果你要发数据给</span><span style="color: black; font-family: Verdana">Destination</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">头应该写</span><span style="color: black; font-family: Verdana">Destination</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址，而数据链路层的</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址就应该是</span><span style="color: black; font-family: Verdana">GateWay</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">Mac</span><span style="color: black; font-family: 宋体">地址了；反之，如果没有</span><span style="color: black; font-family: Verdana">G</span><span style="color: black; font-family: 宋体">标志，那么数据链路层和</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">层的地址应该是对应的。</span><span style="color: black; font-family: Verdana">H</span><span style="color: black; font-family: 宋体">说明了</span><span style="color: black; font-family: Verdana">Destination</span><span style="color: black; font-family: 宋体">的性质，如果是</span><span style="color: black; font-family: Verdana">H</span><span style="color: black; font-family: 宋体">的，则说明该地址是一个完整的地址，既有网络号又有主机号，那么再匹配的时候就既要匹配网络号，又要匹配主机号；反之，</span><span style="color: black; font-family: Verdana">Destination</span><span style="color: black; font-family: 宋体">就代表一个网络，在匹配的时候只要匹配一下网络号就可以了。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这样，</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">选路的方式就可以更加具体化了。如下</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">首先用</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">地址来匹配那些带</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">H</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">标志的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">DestinationIP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">地址。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">如果</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">失败就匹配那些网络地址。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">如果</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">失败就发送到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Default</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">网关</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">顺便提一下那个</span><span style="color: black; font-family: Verdana">GenMask</span><span style="color: black; font-family: 宋体">（还记得子网掩码么），它指定了目的地址的子网号，例如第一条的子网就是</span><span style="color: black; font-family: Verdana">11</span><span style="color: black; font-family: 宋体">。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.2.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">其他有关路由表的知识</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">一般，我们在配置好一个网络接口的时候，一个路由就被直接创建好了。当然我们也可以手动添加路由。用</span><span style="color: black; font-family: Verdana">route add</span><span style="color: black; font-family: 宋体">命令就可以了。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">而当一个</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">包在某一个路由器的时候发现没有路由可走，那么该路由器就会给源主机发送</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">主机不可达</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">或者</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">网络不可达</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">包来报错。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">注意，一般的操作系统默认是没有路由功能的，这需要自己配置。这些历史原因就不细说了，</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.3.ICMP</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">的</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">IP</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">重定向报文和路由发现报文</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">当</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">包在某一个地方转向的时候，都回给发送</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">报的源主机一个</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">重定向报文，而源主机就可以利用这个信息来更新自己的路由表，这样，随着网络通信的逐渐增多，路由表也就越来越完备，数据转发的速度也会越来越快。我们需要注意的是：</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">重定向报文只能由路由器发出。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">重定向报文为主机所用，而不是为路由器所用。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在主机引导的时候，一般会发送在网内广播一个路由请求的</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">报文，而多个路由器则会回应一个路由通告报文。而且，路由其本身不定期的在网络内发布路由通告报文，这样，根据这些报文，每一个主机都会有机会建立自己的路由表而实现网络通信。路由器在一份通告报文中可以通告多个地址，并且给出每一个地址的优先等级，这个优先等级是该</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">作为默认路由的等级，至于怎么算的就不深究了。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">路由器一般会在</span><span style="color: black; font-family: Verdana">450-600</span><span style="color: black; font-family: 宋体">秒的时间间隔内发布一次通告，而一个给定的通告报文的寿命是</span><span style="color: black; font-family: Verdana">30</span><span style="color: black; font-family: 宋体">分钟。而主机在引导的时候会每三秒发送一次请求报文，一旦接受到一个有效的通告报文，就停止发送请求报文。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在</span><span style="color: black; font-family: Verdana">TCP/IP</span><span style="color: black; font-family: 宋体">详解编写的时候，只有</span><span style="color: black; font-family: Verdana">Solaris2.x</span><span style="color: black; font-family: 宋体">支持这两种报文，大多数系统还不支持这两种报文。（后面还会讲到一些有用的路由报文）</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">动态选路协议</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">前面的选路方法叫做静态选路，简要地说就是在配置接口的时候，以默认的方式生成路由表项。并通过</span><span style="color: black; font-family: Verdana">route</span><span style="color: black; font-family: 宋体">来增加表项，或者通过</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">报文来更新表项（通常在默认方式出错的情况下）。</span> <span style="color: black; font-family: 宋体">而如果上诉三种方法都不能满足，那么我们就使用动态选路。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">动
态选路协议是用于动态选路的重要组成部分，但是他们只是使用在路由器之间，相邻路由器之间互相通信。系统（路有选择程序）选择比较合适的路有放到核心路由
表中，然后系统就可以根据这个核心路有表找到最合适的网路。也就是说，动态选路是在系统核心网络外部进行的，它只是用一些选路的策略影响路由表，而不会影
响到最后通过路由表选择路由的那一部分。选路协议有一大类常用的叫做内部网关协议</span><span style="color: black; font-family: Verdana">(IGP)</span><span style="color: black; font-family: 宋体">，而在</span><span style="color: black; font-family: Verdana">IGP</span><span style="color: black; font-family: 宋体">中，</span><span style="color: black; font-family: Verdana">RIP</span><span style="color: black; font-family: 宋体">就是其中最重要的协议。一种新的</span><span style="color: black; font-family: Verdana">IGP</span><span style="color: black; font-family: 宋体">协议叫做</span><strong><span style="color: black; font-family: 宋体">开放最短路经优先</span></strong><strong><span style="color: black; font-family: Verdana">(OSPF)</span></strong><strong><span style="color: black; font-family: 宋体">协议</span></strong><span style="color: black; font-family: 宋体">，其意在取代</span><span style="color: black; font-family: Verdana">RIP</span><span style="color: black; font-family: 宋体">。另一种最早用在网路骨干网上的</span><span style="color: black; font-family: Verdana">IGP</span><span style="color: black; font-family: 宋体">协议</span><span style="color: black; font-family: Verdana">--HELLO</span><span style="color: black; font-family: 宋体">，现在已经不用了。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">如今，任何支持动态选路的路由器都必须同时支持</span><span style="color: black; font-family: Verdana">OSPF</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">RIP</span><span style="color: black; font-family: 宋体">，还可以选择性的支持其他的</span><span style="color: black; font-family: Verdana">IGP</span><span style="color: black; font-family: 宋体">协议。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.1.Unix</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">选路程序</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">Unix</span><span style="color: black; font-family: 宋体">系统上面通常都有路由守护程序－－</span><span style="color: black; font-family: Verdana">routed</span><span style="color: black; font-family: 宋体">。还有一个叫做</span><strong><span style="color: black; font-family: Verdana">gate</span></strong><span style="color: black; font-family: 宋体">。</span><span style="color: black; font-family: Verdana">gate</span><span style="color: black; font-family: 宋体">所支持的协议要比</span><span style="color: black; font-family: Verdana">routed</span><span style="color: black; font-family: 宋体">多，</span><span style="color: black; font-family: Verdana">routed</span><span style="color: black; font-family: 宋体">只是支持</span><span style="color: black; font-family: Verdana">RIPv1</span><span style="color: black; font-family: 宋体">版本。而</span><span style="color: black; font-family: Verdana">gate</span><span style="color: black; font-family: 宋体">则支持</span><span style="color: black; font-family: Verdana">RIPv1</span><span style="color: black; font-family: 宋体">、</span><span style="color: black; font-family: Verdana">v2</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">BGPv1 </span><span style="color: black; font-family: 宋体">等等。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.1.RIP</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">：选路信息协议</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">它的定义可以在</span><span style="color: black; font-family: Verdana">RFC1058</span><span style="color: black; font-family: 宋体">内找到，这种协议使用</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">作为载体（也就是</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">的上层协议）。我们最关心的就是</span><span style="color: black; font-family: Verdana">RIP</span><span style="color: black; font-family: 宋体">其中的一个段，叫做度量的段，这是一个以</span><span style="color: black; font-family: Verdana">hop</span><span style="color: black; font-family: 宋体">作为计数器（就是以走过多少路由为计数器）的段（</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">协议里面也有一个</span><span style="color: black; font-family: Verdana">TTL</span><span style="color: black; font-family: 宋体">不是么）。这个度量段将最终影响到路由表的建立。参考图</span><span style="color: black; font-family: Verdana">:</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">一般说来</span><span style="color: black; font-family: Verdana">routed</span><span style="color: black; font-family: 宋体">要承担如下的工作：</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">给每一个已知的路由器发送</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">rip</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">请求报文，要求其他路由器给出完整的路由表。这种报文的命令字段为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，地址字段为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">0</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，度量地段为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">16</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">（相当于无穷大）。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">接受请求，如果接收到刚才的那个请求，就把自己的完整的路由表交给请求者。如果没有，就处理</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">请求表项，把表项中自己有的部分添上跳数，没有的部分添上</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">16</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">。然后发给请求者。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">接受回应。更新自己的路由表。使用</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">hop</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数小的规则。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">定期更新路由表，一般是</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">30s(</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">真频繁</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">)</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">给相邻的路有启发一次自己的路由表。这种形式可以使广播形式的。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这个协议看起来会工作的很好，但是，这里面其实有很多隐藏的忧患，比如说</span><span style="color: black; font-family: Verdana">RIP</span><span style="color: black; font-family: 宋体">没有子网的概念，比如说环路的危险。而且</span><span style="color: black; font-family: Verdana">hop</span><span style="color: black; font-family: 宋体">数的上限也限制了网络的大小。</span></p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">因此，出现了很多</span><span style="color: black; font-family: Verdana">RIPv1</span><span style="color: black; font-family: 宋体">的替代品，比如说</span><span style="color: black; font-family: Verdana">RIPv2,</span><span style="color: black; font-family: 宋体">比如说</span><span style="color: black; font-family: Verdana">OSPF</span><span style="color: black; font-family: 宋体">。他们都是通过某种策略来影响路由表，所以就不说了。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">TCP/IP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">详解学习笔记</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">(6)-UDP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">协议</span></strong></p>
<p>&nbsp;</p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.UDP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">简要介绍</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">是传输层协议，和</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议处于一个分层中，但是与</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议不同，</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">协议并不提供超时重传，出错重传等功能，也就是说其是不可靠的协议。</span> </p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.UDP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">协议头</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.1.UDP</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">端口号</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">由于很多软件需要用到</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">协议，所以</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">协议必须通过某个标志用以区分不同的程序所需要的数据包。端口号的功能就在于此，例如某一个</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">程序</span><span style="color: black; font-family: Verdana">A</span><span style="color: black; font-family: 宋体">在系统中注册了</span><span style="color: black; font-family: Verdana">3000</span><span style="color: black; font-family: 宋体">端口，那么，以后从外面传进来的目的端口号为</span><span style="color: black; font-family: Verdana">3000</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">包都会交给该程序。端口号理论上可以有</span><span style="color: black; font-family: Verdana">2^16</span><span style="color: black; font-family: 宋体">这么多。因为它的长度是</span><span style="color: black; font-family: Verdana">16</span><span style="color: black; font-family: 宋体">个</span><span style="color: black; font-family: Verdana">bit</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.2.UDP</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">检验和</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这是一个可选的选项，并不是所有的系统都对</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">数据包加以检验和数据</span><span style="color: black; font-family: Verdana">(</span><span style="color: black; font-family: 宋体">相对</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议的必须来说</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">，但是</span><span style="color: black; font-family: Verdana">RFC</span><span style="color: black; font-family: 宋体">中标准要求，发送端应该计算检验和。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">检验和覆盖</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">协议头和数据，这和</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">的检验和是不同的，</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">协议的检验和只是覆盖</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">数据头，并不覆盖所有的数据。</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">都包含一个伪首部，这是为了计算检验和而摄制的。伪首部甚至还包含</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址这样的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">协议里面都有的信息，目的是让</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">两次检查数据是否已经正确到达目的地。如果发送端没有打开检验和选项，而接收端计算检验和有差错，那么</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">数据将会被悄悄的丢掉（不保证送达），而不产生任何差错报文。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.3.UDP</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">长度</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">可以很长很长，可以有</span><span style="color: black; font-family: Verdana">65535</span><span style="color: black; font-family: 宋体">字节那么长。但是一般网络在传送的时候，一次一般传送不了那么长的协议（涉及到</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">的问题），就只好对数据分片，当然，这些是对</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">等上级协议透明的，</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">不需要关心</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">协议层对数据如何分片，下一个章节将会稍微讨论一些分片的策略。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.IP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">分片</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">在从上层接到数据以后，要根据</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址来判断从那个接口发送数据（通过选路），并进行</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">的查询，如果数据大小超过</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">就进行数据分片。数据的分片是对上层和下层透明，而数据也只是到达目的地还会被重新组装，不过不用担心，</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">层提供了足够的信息进行数据的再组装。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">头里面，</span><span style="color: black; font-family: Verdana">16bit</span><span style="color: black; font-family: 宋体">识别号唯一记录了一个</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">包的</span><span style="color: black; font-family: Verdana">ID,</span><span style="color: black; font-family: 宋体">具有同一个</span><span style="color: black; font-family: Verdana">ID</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">片将会被重新组装；而</span><span style="color: black; font-family: Verdana">13</span><span style="color: black; font-family: 宋体">位片偏移则记录了某</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">片相对整个包的位置；而这两个表示中间的</span><span style="color: black; font-family: Verdana">3bit</span><span style="color: black; font-family: 宋体">标志则标示着该分片后面是否还有新的分片。这三个标示就组成了</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">分片的所有信息，接受方就可以利用这些信息对</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">数据进行重新组织（就算是后面的分片比前面的分片先到，这些信息也是足够了）。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">因为分片技术在网络上被经常的使用，所以伪造</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">分片包进行流氓攻击的软件和人也就层出不穷。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">可以用</span><span style="color: black; font-family: Verdana">Trancdroute</span><span style="color: black; font-family: 宋体">程序来进行简单的</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">侦测。请参看教材。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.UDP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">和</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ARP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">之间的交互式用</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这是不常被人注意到的一个细节，这是针对一些系统地实现来说的。当</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">缓存还是空的时候。</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">在被发送之前一定要发送一个</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">请求来获得目的主机的</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址，如果这个</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">的数据包足够大，大到</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">层一定要对其进行分片的时候，想象中，该</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">数据包的第一个分片会发出一个</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">查询请求，所有的分片都辉等到这个查询完成以后再发送。事实上是这样吗？</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">结果是，某些系统会让每一个分片都发送一个</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">查询，所有的分片都在等待，但是接受到第一个回应的时候，主机却只发送了最后一个数据片而抛弃了其他，这实在是让人匪夷所思。这样，因为分片的数据不能被及时组装，接受主机将会在一段时间内将永远无法组装的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">数据包抛弃，并且发送组装超时的</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">报文（其实很多系统不产生这个差错），以保证接受主机自己的接收端缓存不被那些永远得不到组装的分片充满。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.ICMP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">源站抑制差错</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">当目标主机的处理速度赶不上数据接收的速度，因为接受主机的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">层缓存会被占满，所以主机就会发出一个</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">我受不了</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">的一个</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">报文。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">5.UDP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">服务器设计</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">协议的某些特性将会影响我们的服务器程序设计，大致总结如下：</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">关于客户</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">和地址：服务器必须有根据客户</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">地址和端口号判断数据包是否合法的能力（这似乎要求每一个服务器都要具备）</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">关于目的地址：服务器必须要有过滤广播地址的能力。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">关于数据输入：通常服务器系统的每一个端口号都会和一块输入缓冲区对应，进来的输入根据先来后到的原则等待服务器的处理，所以难免会出现缓冲区溢出的问题，这种情况下，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">UDP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据包可能会被丢弃，而应用服务器程序本身并不知道这个问题。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">服务器应该限制本地</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">地址，就是说它应该可以把自己绑定到某一个网络接口的某一个端口上。</span> </p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: black; font-family: Verdana"><a href="http://blog.csdn.net/goodboy1881/archive/2006/05/13/726860.aspx"><span style="color: #770000; text-decoration: none; text-underline: none">TCP/IP</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">详解学习笔记</span><span style="color: #770000; text-decoration: none; text-underline: none">(7)-</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">广播和多播，</span><span style="color: #770000; text-decoration: none; text-underline: none">IGMP</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">协议</span></a></span></strong></p>
<p>&nbsp;</p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">单播，多播，广播的介绍</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.1.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">单播</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">(unicast)</span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">单播是说，对特定的主机进行数据传送。例如给某一个主机发送</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">数据包。这时候，数据链路层给出的数据头里面是非常具体的目的地址，对于以太网来</span> <span style="color: black; font-family: 宋体">说，就是网卡的</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址（不是</span><span style="color: black; font-family: Verdana">FF-FF-FF-FF-FF-FF</span><span style="color: black; font-family: 宋体">这样的地址）。现在的具有路由功能的主机应该可以将单播数据定向转发，而目的主机的网</span> <span style="color: black; font-family: 宋体">络接口则可以过滤掉和自己</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址不一致的数据。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.2.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">广播</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">(unicast)</span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">广播是主机针对某一个网络上的所有主机发送数据包。这个网络可能是网络，可能是子网，还可能是所有的子网。如果是网络，例如</span><span style="color: black; font-family: Verdana">A</span><span style="color: black; font-family: 宋体">类网址的广播就是</span><span style="color: black; font-family: Verdana"> netid.255.255.255</span><span style="color: black; font-family: 宋体">，如果是子网，则是</span><span style="color: black; font-family: Verdana">netid.netid.subnetid.255</span><span style="color: black; font-family: 宋体">；如果是所有的子网（</span><span style="color: black; font-family: Verdana">B</span><span style="color: black; font-family: 宋体">类</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">）则是则是</span><span style="color: black; font-family: Verdana"> netid.netid.255.255</span><span style="color: black; font-family: 宋体">。广播所用的</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址</span><span style="color: black; font-family: Verdana">FF-FF-FF-FF-FF-FF</span><span style="color: black; font-family: 宋体">。网络内所有的主机都会收到这个广播数据，网卡只要把</span><span style="color: black; font-family: Verdana"> MAC</span><span style="color: black; font-family: 宋体">地址为</span><span style="color: black; font-family: Verdana">FF-FF-FF-FF-FF-FF</span><span style="color: black; font-family: 宋体">的数据交给内核就可以了。一般说来</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">，或者路由协议</span><span style="color: black; font-family: Verdana">RIP</span><span style="color: black; font-family: 宋体">应该是以广播的形式播发的。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.3.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">多播</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">(multicast)</span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">可以说广播是多播的特例，多播就是给一组特定的主机（多播组）发送数据，这样，数据的播发范围会小一些</span><span style="color: black; font-family: Verdana">(</span><span style="color: black; font-family: 宋体">实际上播发的范围一点也没有变小</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">，多播的</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址是最高字节的低位为一，例</span> <span style="color: black; font-family: 宋体">如</span><span style="color: black; font-family: Verdana">01-00-00-00-00-00</span><span style="color: black; font-family: 宋体">。多播组的地址是</span><span style="color: black; font-family: Verdana">D</span><span style="color: black; font-family: 宋体">类</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">，规定是</span><span style="color: black; font-family: Verdana">224.0.0.0-239.255.255.255</span><span style="color: black; font-family: 宋体">。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">虽然多播比较特殊，但是究其原理，多播的数据还是要通过数据链路层进行</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址绑定然后进行发送。所以一个以太网卡在绑定了一个多播</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址之后，必</span> <span style="color: black; font-family: 宋体">定还要绑定一个多播的</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址，才能使得其可以像单播那样工作。这个多播的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">和多播</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址有一个对应的算法，在书的</span><span style="color: black; font-family: Verdana">p133</span><span style="color: black; font-family: 宋体">到</span><span style="color: black; font-family: Verdana">p134</span><span style="color: black; font-family: 宋体">之间。可以看到</span> <span style="color: black; font-family: 宋体">这个对应不是一一对应的，主机还是要对多播数据进行过滤。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">个人的看法：广播和多播的性质是一样的，路由器会把数据放到局域网里面，然后网卡对这些数据进行过滤，只拿到自己打算要的数据，比如自己感兴趣的多</span> <span style="color: black; font-family: 宋体">播数据，自己感兴趣的组播数据。当一个主机运行了一个处理某一个多播</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">的进程的时候，这个进程会给网卡绑定一个虚拟的多播</span><span style="color: black; font-family: Verdana">mac</span><span style="color: black; font-family: 宋体">地址，并做出来一个多播</span><span style="color: black; font-family: Verdana"> ip</span><span style="color: black; font-family: 宋体">。这样，网卡就会让带有这个多播</span><span style="color: black; font-family: Verdana">mac</span><span style="color: black; font-family: 宋体">地址的数据进来，从而实现通信，而那些没有监听这些数据的主机就会把这些数据过滤掉，换句话说，多播，是让主机</span> <span style="color: black; font-family: 宋体">的内核轻松了，而网卡，对不起，您就累点吧。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">一些文章也印证了这种想法，最明显的就是</span><span style="color: black; font-family: Verdana"><a href="http://news.softhouse.com.cn/news/show/440.html"><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">局域网监听的原理、实现与防范</span></a></span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">一些验证性实验</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这些实验并不是很复杂，我们只是要</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">一下一般的</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">和一个广播地址。首先我</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">一下自己所在的子网的某一台主机</span><span style="color: black; font-family: Verdana">:</span></p>
<p style="background: black; word-break: break-all; line-height: 150%" align="left"><span style="font-size: 9pt; color: white; line-height: 150%; font-family: Verdana">Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time=1ms TTL=255</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">可以看到，机器返回的是一台主机的回应结果，进而推测，如果我</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">一个广播地址呢？结果如下</span></p>
<p style="background: black; word-break: break-all; line-height: 150%" align="left"><span style="font-size: 9pt; color: white; line-height: 150%; font-family: Verdana">Reply from 192.168.11.9: bytes=32 time=1ms TTL=255<br>
Reply from 192.168.11.174: bytes=32 time&lt;1ms TTL=64<br>
Reply from 192.168.11.174: bytes=32 time&lt;1ms TTL=64<br>
Reply from 192.168.11.174: bytes=32 time&lt;1ms TTL=64<br>
Reply from 192.168.11.218: bytes=32 time&lt;1ms TTL=64<br>
Reply from 192.168.11.174: bytes=32 time&lt;1ms TTL=64</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">可以看到，</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">返回了一些随机的</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">的结果，这些</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">都是与主机在同一子网内的</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">。我们可以看到，广播实际上是给处于子网内的所有</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">发信。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">再来一个多播的例子，但是要实现这个多播并不容易，因为我不知道网络内有多少个多播组，就只好利用几个特殊的多播地址来验证了。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">对于多播地址，有几个特殊的多播地址被占用，他们是</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">224.0.0.1--</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">该子网内所有的系统组。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">224.0.0.2--</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">该子网内所有的路由器。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">224.0.1.1--</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">网络实现协议</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">NTP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">专用</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">224.0.0.9--RIPv2</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">专用</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP </span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">所以只要</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">这几个</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">，就应该能得到一些结果，比如说我</span><span style="color: black; font-family: Verdana">ping 224.0.0.2</span><span style="color: black; font-family: 宋体">。</span></p>
<p style="background: black; word-break: break-all; line-height: 150%" align="left"><span style="font-size: 9pt; color: white; line-height: 150%; font-family: Verdana">Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255<br>
Reply from 192.168.11.1: bytes=32 time&lt;1ms TTL=255</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">我们可以看到，这回</span><span style="color: black; font-family: Verdana">ping</span><span style="color: black; font-family: 宋体">只返回了一个</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">的回应。而这个就是我的网关的地址，这也验证了</span><span style="color: black; font-family: Verdana">224.0.0.2</span><span style="color: black; font-family: 宋体">是所有路由器的多播</span><span style="color: black; font-family: Verdana">(</span><span style="color: black; font-family: 宋体">组播</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">地址</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.IGMP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">协议</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">IGMP</span><span style="color: black; font-family: 宋体">的
作用在于，让其他所有需要知道自己处于哪个多播组的主机和路由器知道自己的状态。一般多播路由器根本不需要知道某一个多播组里面有多少个主机，而只要知道
自己的子网内还有没有处于某个多播组的主机就可以了。只要某一个多播组还有一台主机，多播路由器就会把数据传输出去，这样，接受方就会通过网卡过滤功能来
得到自己想要的数据。为了知道多播组的信息，多播路由器需要定时的发送</span><span style="color: black; font-family: Verdana">IGMP</span><span style="color: black; font-family: 宋体">查询，</span><span style="color: black; font-family: Verdana">IGMP</span><span style="color: black; font-family: 宋体">的格式可以看书，各个多播组里面的主机要根据查询来回复自己的状态。路由器来决定有几个多播组，自己要对某一个多播组发送什么样的数据。</span></p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这种查询回应数据报的</span><span style="color: black; font-family: Verdana">TTL</span><span style="color: black; font-family: 宋体">一般是</span><span style="color: black; font-family: Verdana">1</span><span style="color: black; font-family: 宋体">，而且就算是出错也不产生</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">差错（没必要）。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">TCP/IP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">详解学习笔记</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">(9)-TCP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">协议概述</span></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">终于看到了</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议，这是</span><span style="color: black; font-family: Verdana">TCP/IP</span><span style="color: black; font-family: 宋体">详解里面最重要也是最精彩的部分，要花大力气来读。前面的</span><span style="color: black; font-family: Verdana">TFTP</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">BOOTP</span><span style="color: black; font-family: 宋体">都是一些简单的协议，就不写笔记了，写起来也没啥东西。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">处在同一层</span><span style="color: black; font-family: Verdana">---</span><span style="color: black; font-family: 宋体">运输层，但是</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">最不同的地方是，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">提供了一种可靠的数据传输服务，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">是面向连接的，也就是说，利用</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">通信的两台主机首先要经历一个</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">拨打电话</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">的过程，等到通信准备结束才开始传输数据，最后结束通话。所以</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">要比</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">可靠的多，</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">是把数据直接发出去，而不管对方是不是在收信，就算是</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">无法送达，也不会产生</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">差错报文，这一经时重申了很多遍了。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">把</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">保证可靠性的简单工作原理摘抄如下</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">应用数据被分割成</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">认为最适合发送的数据块。这和</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">UDP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">完全不同，应用程序产生的</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报长度将保持不变。由</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">传递给</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的信息单位称为报文段或段（</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> segment</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">）（参见图</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1 - 7</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">）。在</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1 8.4</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">节我们将看到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">如何确定报文段的长度。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">当</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">及时收到一个确认，将重发这个报文段。在第</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">21</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">章我们将了解</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">协议中自适应的超时</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">及重传策略。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">当</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">收到发自</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">连接另一端的数据，它将发送一个确认。这个确认不是立即发送，通常将推迟几分之一秒，这将在</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1 9.3</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">节讨论。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传输</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">过程中的任何变化。如果收到段的检验和有差错，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> T P</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">将丢弃这个报文段和不确认收到此报文段（希望发端超时并重发）。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">既然</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">报文段作为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报来传输，而</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报的到达可能会失序，因此</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">报文段</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的到达也可能会失序。如果必要，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">将对收到的数据进行重新排序，将收到的数据以正确的顺序交给应用层。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">还能提供流量控制。</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">连接的每一方都有固定大小的缓冲空间。</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的接收端只允许另一端发送接收端缓冲区所能接纳的数据。这将防止较快主机致使较慢主机的缓冲区溢出。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">从这段话中可以看到，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">中保持可靠性的方式就是超时重发，这是有道理的，虽然</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">也可以用各种各样的</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">报文来处理这些，但是这也不是可靠的，</span><strong><span style="color: black; font-family: 宋体">最可靠的方式就是只要不得到确认，就重新发送数据报，直到得到对方的确认为止。</span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的首部和</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">首部一样，都有发送端口号和接收端口号。但是显然，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的首部信息要比</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">的多，可以看到，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议提供了发送和确认所需要的所有必要的信息。这在</span><span style="color: black; font-family: Verdana">P171-173</span><span style="color: black; font-family: 宋体">有详细地介绍。可以想象一个</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据的发送应该是如下的一个过程。</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">双方建立连接</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">发送方给接受方</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报，然后等待对方的确认</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报，如果没有，就重新发，如果有，就发送下一个数据报。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">接受方等待发送方的数据报，如果得到数据报并检验无误，就发送</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK(</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">确认</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">)</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报，并等待下一个</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报的到来。直到接收到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">FIN(</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">发送完成数据报</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">) </span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 10pt; color: black; line-height: 150%; font-family: Symbol">·<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">中止连接</span> </p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">可以想见，为了建立一个</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">连接，系统可能会建立一个新的进程（最差也是一个线程），来进行数据的传送</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: black; font-family: Verdana"><a href="http://blog.csdn.net/goodboy1881/archive/2006/05/18/743816.aspx"><span style="color: #770000; text-decoration: none; text-underline: none">TCP/IP</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">详解学习笔记</span><span style="color: #770000; text-decoration: none; text-underline: none">(8)-DNS</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">域名系统</span></a></span></strong></p>
<p>&nbsp;</p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">前面已经提到了访问一台机器要靠</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址和</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址，其中，</span><span style="color: black; font-family: Verdana">MAC</span><span style="color: black; font-family: 宋体">地址可以通过</span><span style="color: black; font-family: Verdana">ARP</span><span style="color: black; font-family: 宋体">协议得到，所以这对用户是透明的，但是</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址就不行，无论如何用户都需要用一个指定的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">来访问一台计算机，而</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">地址又非常不好记，于是就出现了</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">系统</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.DNS</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">系统介绍</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">的全称是</span><span style="color: black; font-family: Verdana">Domain Name System</span><span style="color: black; font-family: 宋体">。它负责把</span><span style="color: black; font-family: Verdana">FQDN(</span><span style="color: black; font-family: 宋体">就是以</span><span style="color: black; font-family: Verdana">"."</span><span style="color: black; font-family: 宋体">分隔结尾的名字</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">翻译成一个</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">。最初的</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">系统使用的是一个巨大的</span><span style="color: black; font-family: Verdana">hosts.txt</span><span style="color: black; font-family: 宋体">文件（很吃惊，用</span> <span style="color: black; font-family: 宋体">这个就好使了？），可是一段时间以后，开发这就不得不用数据库来代替</span><span style="color: black; font-family: Verdana">hosts.txt</span><span style="color: black; font-family: 宋体">文件，最终发展到了现在的分布式数据库。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">从书中的</span><span style="color: black; font-family: Verdana">143</span><span style="color: black; font-family: 宋体">页可以看到，</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">系统是一个巨大的树，最上方有一个无名树根，下一层是</span><span style="color: black; font-family: Verdana">arpa,com,edu,gov,int,mil</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">us, cn</span><span style="color: black; font-family: 宋体">。等等，其中</span><span style="color: black; font-family: Verdana">arpa</span><span style="color: black; font-family: 宋体">，是域名反解析树的顶端；而</span><span style="color: black; font-family: Verdana">com</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">edu</span><span style="color: black; font-family: 宋体">，等域名本来只用在美国（这就是技术特权啊），但是现在几乎全世界通用；而</span><span style="color: black; font-family: Verdana">us</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana"> cn</span><span style="color: black; font-family: 宋体">，等叫做国家域。这个树里面的域名并不是统一管理的，网络信息中心（</span><span style="color: black; font-family: Verdana">NIS</span><span style="color: black; font-family: 宋体">）负责分配顶级域合委派其他制定地区域的授权机构。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">一个独立管理的</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">子树叫做</span><strong><span style="color: black; font-family: Verdana">zone</span></strong><span style="color: black; font-family: 宋体">，最常见的区域就是二级域名，比如说</span><span style="color: black; font-family: Verdana">.com.cn</span><span style="color: black; font-family: 宋体">。我们还可以把这个二级域名给划分成更小的区域，比如说</span><span style="color: black; font-family: Verdana">sina.com.cn</span><span style="color: black; font-family: 宋体">。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">系统是一个分布式的数据库，当一个数据库发现自己并没有某查询所需要的数据的时候，它将把查询转发出去，而转发的目的地通常是根服务器，根服</span> <span style="color: black; font-family: 宋体">务器从上至下层层转发查询，直到找到目标为止。</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">还有一个特点就是使用高速缓存，</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">把查询过的数据缓存在某处，以便于下次查询时使用。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.DNS</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">协议</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">报文定义了一个既可以查询也可以响应的报文格式。具体格式可以看</span><span style="color: black; font-family: Verdana">P145</span><span style="color: black; font-family: 宋体">页。对各个字段简单解释如下</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">最前面的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">16</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">bit</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">唯一的标示了问题号码，用于查询端区别自己的查询。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">紧接着的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">16</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">bit</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">又可以做进一步的细分，标示了报文的性质和一些细节，比如说是查询报文还是响应报文，需要递归查询与否（一般服务器都支持递归查询，而且不需要任何设置，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">BIND</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">就是这样）</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">查询问题后面有查询类型，包括</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">A</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">NS</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">CNAME</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">PTR</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">HINFO</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">MX</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，如果熟悉</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">BIND</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的话，就知道在</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">zong</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的配置文件里面，每一条记录都记载了各自的类型，比如</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">A</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">就是</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">地址，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">NS</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">就是名字服务器。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">响应报文可以回复多个</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，也就是说，域名可以和多个</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">地址对应，并且有很多</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">CNAME</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">。</span> </p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">反向查询</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">正向查询指的是通过域名得到</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">的查询，而反向查询就是通过</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">得到域名。例如用</span><strong><span style="color: black; font-family: Verdana">host</span></strong><span style="color: black; font-family: 宋体">命令，</span><strong><span style="color: black; font-family: Verdana">host ip</span></strong><span style="color: black; font-family: 宋体">就可以得到服务器的域名，</span><strong><span style="color: black; font-family: Verdana">host domainName</span></strong> <span style="color: black; font-family: 宋体">就得到</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">稍微知道一点数据结构的人都能意识到，在正向查询的域里面做反向查询，其做法只有遍历整个数据集合</span><span style="color: black; font-family: Verdana">----</span><span style="color: black; font-family: 宋体">对于</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">来说，那就是遍历整个数据库，</span> <span style="color: black; font-family: 宋体">这将带来巨大的负担，所以</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">采取了另一种方法，使用另一棵子树来维护</span><span style="color: black; font-family: Verdana">IP-</span><span style="color: black; font-family: 宋体">〉域名的对应表。这个子树的根节点是</span><span style="color: black; font-family: Verdana">in-addr.arpa,</span><span style="color: black; font-family: 宋体">而一个</span><span style="color: black; font-family: Verdana">IP </span><span style="color: black; font-family: 宋体">例如</span><span style="color: black; font-family: Verdana">192.168.11.2)</span><span style="color: black; font-family: 宋体">所具有的</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">地址就是</span><span style="color: black; font-family: Verdana"> 2.11.168.192.in-addr.arpa</span><span style="color: black; font-family: 宋体">（</span><span style="color: black; font-family: Verdana">ip</span><span style="color: black; font-family: 宋体">倒置）。在</span><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">系统里面，一个反向地址对应一个</span><span style="color: black; font-family: Verdana">PTR</span><span style="color: black; font-family: 宋体">纪录（对应</span><span style="color: black; font-family: Verdana">A</span><span style="color: black; font-family: 宋体">纪录），所以反向查询又叫</span> <span style="color: black; font-family: 宋体">做指针</span><span style="color: black; font-family: Verdana">(PTR)</span><span style="color: black; font-family: 宋体">查询。</span> </p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">其他问题的讨论</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">4.1.DNS</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">服务器高速缓存</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">BIND9</span><span style="color: black; font-family: 宋体">默认是作为一个高速缓存服务器，其将所有的查询都转交到根服务器去，然后得到结果并放在本地的缓冲区，以加快查询速度。如果有兴趣可以安装一个</span><span style="color: black; font-family: Verdana">BIND9</span><span style="color: black; font-family: 宋体">来尝试一下。而自己定义的</span><span style="color: black; font-family: Verdana">zone</span><span style="color: black; font-family: 宋体">则可以规定其在缓存中的时间，一般是</span><span style="color: black; font-family: Verdana">1</span><span style="color: black; font-family: 宋体">天（就是配置文件中的</span><span style="color: black; font-family: Verdana">1D</span><span style="color: black; font-family: 宋体">）。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">4.2.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">用</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">UDP</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">还是</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">TCP</span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">DNS</span><span style="color: black; font-family: 宋体">服务器支持</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">两种协议的查询方式，而且端口都是</span><span style="color: black; font-family: Verdana">53</span><span style="color: black; font-family: 宋体">。而大多数的查询都是</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">查询的，一般需要</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">查询的有两种情况：</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">当查询数据多大以至于产生了数据截断</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">(TC</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">标志为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1)</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，这时，需要利用</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的分片能力来进行数据传输（看</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的相关章节）。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">当主（</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">master</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">）服务器和辅（</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">slave</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">）服务器之间通信，辅服务器要拿到主服务器的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">zone</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">信息的时候。</span> </p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">完</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: black; font-family: Verdana"><a href="http://blog.csdn.net/goodboy1881/archive/2006/05/18/744534.aspx"><span style="color: #770000; text-decoration: none; text-underline: none">TCP/IP</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">详解学习笔记</span><span style="color: #770000; text-decoration: none; text-underline: none">(10)-TCP</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">连接的建立与中止</span></a></span></strong></p>
<p>&nbsp;</p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">是一个面向连接的协议，所以在连接双方发送数据之前，都需要首先建立一条连接。这和前面讲到的协议完全不同。前面讲的所有协议都只是发送数据而已，大多数都不关心发送的数据是不是送到，</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">尤其明显，从编程的角度来说，</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">编程也要简单的多</span><span style="color: black; font-family: Verdana">----UDP</span><span style="color: black; font-family: 宋体">都不用考虑数据分片。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">书中用</span><span style="color: black; font-family: Verdana">telnet</span><span style="color: black; font-family: 宋体">登陆退出来解释</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议连接的建立和中止的过程，可以看到，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">连接的建立可以简单的称为</span><strong><span style="color: black; font-family: 宋体">三次握手</span></strong><span style="color: black; font-family: 宋体">，而连接的中止则可以叫做</span><strong><span style="color: black; font-family: 宋体">四次握手</span></strong><span style="color: black; font-family: 宋体">。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">连接的建立</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在建立连接的时候，客户端首先向服务器申请打开某一个端口</span><span style="color: black; font-family: Verdana">(</span><span style="color: black; font-family: 宋体">用</span><span style="color: black; font-family: Verdana">SYN</span><span style="color: black; font-family: 宋体">段等于</span><span style="color: black; font-family: Verdana">1</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">报文</span><span style="color: black; font-family: Verdana">)</span><span style="color: black; font-family: 宋体">，然后服务器端发回一个</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">报文通知客户端请求报文收到，客户端收到确认报文以后再次发出确认报文确认刚才服务器端发出的确认报文（绕口么），至此，连接的建立完成。这就叫做三次握手。如果打算让双方都做好准备的话，一定要发送三次报文，而且只需要三次报文就可以了。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">可以想见，如果再加上</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的超时重传机制，那么</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">就完全可以保证一个数据包被送到目的地。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">结束连接</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">有一个特别的概念叫做</span><span style="color: black; font-family: Verdana">half-close</span><span style="color: black; font-family: 宋体">，这个概念是说，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的连接是全双工（可以同时发送和接收）连接，因此在关闭连接的时候，必须关闭传和送两个方向上的连接。客户机给服务器一个</span><span style="color: black; font-family: Verdana">FIN</span><span style="color: black; font-family: 宋体">为</span><span style="color: black; font-family: Verdana">1</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">报文，然后服务器返回给客户端一个确认</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">报文，并且发送一个</span><span style="color: black; font-family: Verdana">FIN</span><span style="color: black; font-family: 宋体">报文，当客户机回复</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">报文后（四次握手），连接就结束了。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">最大报文长度</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在建立连接的时候，通信的双方要互相确认对方的最大报文长度</span><span style="color: black; font-family: Verdana">(MSS)</span><span style="color: black; font-family: 宋体">，以便通信。一般这个</span><span style="color: black; font-family: Verdana">SYN</span><span style="color: black; font-family: 宋体">长度是</span><span style="color: black; font-family: Verdana">MTU</span><span style="color: black; font-family: 宋体">减去固定</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">首部和</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">首部长度。对于一个以太网，一般可以达到</span><span style="color: black; font-family: Verdana">1460</span><span style="color: black; font-family: 宋体">字节。当然如果对于非本地的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">，这个</span><span style="color: black; font-family: Verdana">MSS</span><span style="color: black; font-family: 宋体">可能就只有</span><span style="color: black; font-family: Verdana">536</span><span style="color: black; font-family: 宋体">字节，而且，如果中间的传输网络的</span><span style="color: black; font-family: Verdana">MSS</span><span style="color: black; font-family: 宋体">更佳的小的话，这个值还会变得更小。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.TCP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的状态迁移图</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">书</span><span style="color: black; font-family: Verdana">P182</span><span style="color: black; font-family: 宋体">页给出了</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的状态图，这是一个看起来比较复杂的状态迁移图，因为它包含了两个部分</span><span style="color: black; font-family: Verdana">---</span><span style="color: black; font-family: 宋体">服务器的状态迁移和客户端的状态迁移，如果从某一个角度出发来看这个图，就会清晰许多，这里面的服务器和客户端都不是绝对的，发送数据的就是客户端，接受数据的就是服务器。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">4.1.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">客户端应用程序的状态迁移图</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">客户端的状态可以用如下的流程来表示：</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">CLOSED-&gt;SYN_SENT-&gt;ESTABLISHED-&gt;FIN_WAIT_1-&gt;FIN_WAIT_2-&gt;TIME_WAIT-&gt;CLOSED</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">以上流程是在程序正常的情况下应该有的流程，从书中的图中可以看到，在建立连接时，当客户端收到</span><span style="color: black; font-family: Verdana">SYN</span><span style="color: black; font-family: 宋体">报文的</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">以后，客户端就打开了数据交互地连接。而结束连接则通常是客户端主动结束的，客户端结束应用程序以后，需要经历</span><span style="color: black; font-family: Verdana">FIN_WAIT_1</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">FIN_WAIT_2</span><span style="color: black; font-family: 宋体">等状态，这些状态的迁移就是前面提到的结束连接的四次握手。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">4.2.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">服务器的状态迁移图</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">服务器的状态可以用如下的流程来表示：</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">CLOSED-&gt;LISTEN-&gt;SYN</span><span style="color: black; font-family: 宋体">收到</span><span style="color: black; font-family: Verdana">-&gt;ESTABLISHED-&gt;CLOSE_WAIT-&gt;LAST_ACK-&gt;CLOSED</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在建立连接的时候，服务器端是在第三次握手之后才进入数据交互状态，而关闭连接则是在关闭连接的第二次握手以后（注意不是第四次）。而关闭以后还要等待客户端给出最后的</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">包才能进入初始的状态。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">4.3.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">其他状态迁移</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">书中的图还有一些其他的状态迁移，这些状态迁移针对服务器和客户端两方面的总结如下</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">LISTEN-&gt;SYN_SENT</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，对于这个解释就很简单了，服务器有时候也要打开连接的嘛。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">SYN_SENT-&gt;SYN</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">收到，服务器和客户端在</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">SYN_SENT</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">状态下如果收到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">SYN</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报，则都需要发送</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">SYN</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报并把自己的状态调整到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">SYN</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">收到状态，准备进入</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ESTABLISHED </span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">SYN_SENT-&gt;CLOSED</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，在发送超时的情况下，会返回到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">CLOSED</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">状态。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">SYN_</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">收到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">-&gt;LISTEN</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，如果受到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RST</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">包，会返回到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">LISTEN</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">状态。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">5.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">SYN_</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">收到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">-&gt;FIN_WAIT_1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，这个迁移是说，可以不用到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ESTABLISHED</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">状态，而可以直接跳转到</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">FIN_WAIT_1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">状态并等待关闭。</span> </p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">4.4.2MSL</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">等待状态</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">书中给的图里面，有一个</span><span style="color: black; font-family: Verdana">TIME_WAIT</span><span style="color: black; font-family: 宋体">等待状态，这个状态又叫做</span><span style="color: black; font-family: Verdana">2MSL</span><span style="color: black; font-family: 宋体">状态，说的是在</span><span style="color: black; font-family: Verdana">TIME_WAIT2</span><span style="color: black; font-family: 宋体">发送了最后一个</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">数据报以后，要进入</span><span style="color: black; font-family: Verdana">TIME_WAIT</span><span style="color: black; font-family: 宋体">状态，这个状态是防止最后一次握手的数据报没有传送到对方那里而准备的（注意这不是四次握手，这是第四次握手的保险状态）。这个状态在很大程度上保证了双方都可以正常结束，但是，问题也来了。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">由于插口的</span><span style="color: black; font-family: Verdana">2MSL</span><span style="color: black; font-family: 宋体">状态（插口是</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">和端口对的意思，</span><span style="color: black; font-family: Verdana">socket</span><span style="color: black; font-family: 宋体">），使得应用程序在</span><span style="color: black; font-family: Verdana">2MSL</span><span style="color: black; font-family: 宋体">时间内是无法再次使用同一个插口的，对于客户程序还好一些，但是对于服务程序，例如</span><span style="color: black; font-family: Verdana">httpd</span><span style="color: black; font-family: 宋体">，它总是要使用同一个端口来进行服务，而在</span><span style="color: black; font-family: Verdana">2MSL</span><span style="color: black; font-family: 宋体">时间内，启动</span><span style="color: black; font-family: Verdana">httpd</span><span style="color: black; font-family: 宋体">就会出现错误（插口被使用）。为了避免这个错误，服务器给出了一个平静时间的概念，这是说在</span><span style="color: black; font-family: Verdana">2MSL</span><span style="color: black; font-family: 宋体">时间内，虽然可以重新启动服务器，但是这个服务器还是要</span><strong><span style="color: black; font-family: 宋体">平静</span></strong><span style="color: black; font-family: 宋体">的等待</span><span style="color: black; font-family: Verdana">2MSL</span><span style="color: black; font-family: 宋体">时间的过去才能进行下一次连接。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">4.5.FIN_WAIT_2</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">状态</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这就是著名的半关闭的状态了，这是在关闭连接时，客户端和服务器两次握手之后的状态。在这个状态下，应用程序还有接受数据的能力，但是已经无法发送数据，但是也有一种可能是，客户端一直处于</span><span style="color: black; font-family: Verdana">FIN_WAIT_2</span><span style="color: black; font-family: 宋体">状态，而服务器则一直处于</span><span style="color: black; font-family: Verdana">WAIT_CLOSE</span><span style="color: black; font-family: 宋体">状态，而直到应用层来决定关闭这个状态。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">5.RST</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，同时打开和同时关闭</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">RST</span><span style="color: black; font-family: 宋体">是另一种关闭连接的方式，应用程序应该可以判断</span><span style="color: black; font-family: Verdana">RST</span><span style="color: black; font-family: 宋体">包的真实性，即是否为异常中止。而同时打开和同时关闭则是两种特殊的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">状态，发生的概率很小。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">6.TCP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">服务器设计</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">前面曾经讲述过</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">的服务器设计，可以发现</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">的服务器完全不需要所谓的并发机制，它只要建立一个数据输入队列就可以。但是</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">不同，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">服务器对于每一个连接都需要建立一个独立的进程（或者是轻量级的，线程），来保证对话的独立性。所以</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">服务器是并发的。而且</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">还需要配备一个呼入连接请求队列（</span><span style="color: black; font-family: Verdana">UDP</span><span style="color: black; font-family: 宋体">服务器也同样不需要），来为每一个连接请求建立对话进程，这也就是为什么各种</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">服务器都有一个最大连接数的原因。而根据源主机的</span><span style="color: black; font-family: Verdana">IP</span><span style="color: black; font-family: 宋体">和端口号码，服务器可以很轻松的区别出不同的会话，来进行数据的分发。</span></p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">掌握本章的状态迁移图才是学习本章的关键。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">TCP/IP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">详解学习笔记</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">(11)-TCP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">交互数据流，成块数据流</span></strong></p>
<p>&nbsp;</p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">目前建立在</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议上的网络协议特别多，有</span><span style="color: black; font-family: Verdana">telnet</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">ssh</span><span style="color: black; font-family: 宋体">，有</span><span style="color: black; font-family: Verdana">ftp</span><span style="color: black; font-family: 宋体">，有</span><span style="color: black; font-family: Verdana">http</span><span style="color: black; font-family: 宋体">等等。这些协议又可以根据数据吞吐量来大致分成两大类：</span><span style="color: black; font-family: Verdana">(1)</span><span style="color: black; font-family: 宋体">交互数据类型，例如</span><span style="color: black; font-family: Verdana">telnet</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">ssh</span><span style="color: black; font-family: 宋体">，这种类型的协议在大多数情况下只是做小流量的数据交换，比如说按一下键盘，回显一些文字等等。</span><span style="color: black; font-family: Verdana">(2)</span><span style="color: black; font-family: 宋体">数据成块类型，例如</span><span style="color: black; font-family: Verdana">ftp</span><span style="color: black; font-family: 宋体">，这种类型的协议要求</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">能尽量的运载数据，把数据的吞吐量做到最大，并尽可能的提高效率。针对这两种情况，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">给出了两种不同的策略来进行数据传输。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.TCP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的交互数据流</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">对于交互性要求比较高的应用，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">给出两个策略来提高发送效率和减低网络负担：（</span><span style="color: black; font-family: Verdana">1</span><span style="color: black; font-family: 宋体">）捎带</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">。</span><span style="color: black; font-family: Verdana">(2)Nagle</span><span style="color: black; font-family: 宋体">算法（一次尽量多的发数据）。通常，在网络速度很快的情况下，比如用</span><span style="color: black; font-family: Verdana">lo</span><span style="color: black; font-family: 宋体">接口进行</span><span style="color: black; font-family: Verdana">telnet</span><span style="color: black; font-family: 宋体">通信，当按下字母键并要求回显的时候，客户端和服务器将经历</span> <span style="color: blue; font-family: 宋体">发送按键数据</span><span style="color: blue; font-family: Verdana">-&gt;</span><span style="color: blue; font-family: 宋体">服务器发送按键数据的</span><span style="color: blue; font-family: Verdana">ack -&gt; </span><span style="color: blue; font-family: 宋体">服务器端发送回显数据</span><span style="color: blue; font-family: Verdana">-&gt;</span><span style="color: blue; font-family: 宋体">客户端发送回显数据的</span><span style="color: blue; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">的过程，而其中的数据流量将是</span><span style="color: black; font-family: Verdana">40bit + 41bit+41bit+40bit = 162bit</span><span style="color: black; font-family: 宋体">，如果在广域网里面，这种小分组的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">流量将会造成很大的网络负担。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.1.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">捎带</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">ACK</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">的发送方式</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这个策略是说，当主机收到远程主机的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报之后，通常不马上发送</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">数据报，而是等上一个短暂的时间，如果这段时间里面主机还有发送到远程主机的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报，那么就把这个</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">数据报</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">捎带</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">着发送出去，把本来两个</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报整合成一个发送。一般的，这个时间是</span><span style="color: black; font-family: Verdana">200ms</span><span style="color: black; font-family: 宋体">。可以明显地看到这个策略可以把</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报的利用率提高很多。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.2.Nagle</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">算法</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">上过</span><span style="color: black; font-family: Verdana">bbs</span><span style="color: black; font-family: 宋体">的人应该都会有感受，就是在网络慢的时候发贴，有时键入一串字符串以后，经过一段时间，客户端</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">发疯</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">一样突然回显出很多内容，就好像数据一下子传过来了一样，这就是</span><span style="color: black; font-family: Verdana">Nagle</span><span style="color: black; font-family: 宋体">算法的作用。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">Nagle</span><span style="color: black; font-family: 宋体">算法是说，当主机</span><span style="color: black; font-family: Verdana">A</span><span style="color: black; font-family: 宋体">给主机</span><span style="color: black; font-family: Verdana">B</span><span style="color: black; font-family: 宋体">发送了一个</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报并进入等待主机</span><span style="color: black; font-family: Verdana">B</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">数据报的状态时，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的输出缓冲区里面只能有一个</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报，并且，这个数据报不断地收集后来的数据，整合成一个大的数据报，等到</span><span style="color: black; font-family: Verdana">B</span><span style="color: black; font-family: 宋体">主机的</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">包一到，就把这些数据</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">一股脑</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">的发送出去。虽然这样的描述有些不准确，但还算形象和易于理解，我们同样可以体会到这个策略对于低减网络负担的好处。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在编写插口程序的时候，可以通过</span><span style="color: black; font-family: Verdana">TCP_NODELAY</span><span style="color: black; font-family: 宋体">来关闭这个算法。并且，使用这个算法看情况的，比如基于</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">X</span><span style="color: black; font-family: 宋体">窗口协议，如果处理鼠标事件时还是用这个算法，那么</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">延迟</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">可就非常大了。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.TCP</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的成块数据流</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">对于</span><span style="color: black; font-family: Verdana">FTP</span><span style="color: black; font-family: 宋体">这样对于数据吞吐量有较高要求的要求，将总是希望每次尽量多的发送数据到对方主机，就算是有点</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">延迟</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">也无所谓。</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">也提供了一整套的策略来支持这样的需求。</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议中有</span><span style="color: black; font-family: Verdana">16</span><span style="color: black; font-family: 宋体">个</span><span style="color: black; font-family: Verdana">bit</span><span style="color: black; font-family: 宋体">表示</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">窗口</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">的大小，这是这些策略的核心。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.1.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">传输数据时</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">ACK</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">的问题</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在解释滑动窗口前，需要看看</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">的应答策略，一般来说，发送端发送一个</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报，那么接收端就应该发送一个</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">数据报。但是事实上却不是这样，发送端将会连续发送数据尽量填满接受方的缓冲区，而接受方对这些数据只要发送一个</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">报文来回应就可以了，这就是</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">的累积特性，这个特性大大减少了发送端和接收端的负担。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.2.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">滑动窗口</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">滑动窗口本质上是描述接受方的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报缓冲区大小的数据，发送方根据这个数据来计算自己最多能发送多长的数据。如果发送方收到接受方的窗口大小为</span><span style="color: black; font-family: Verdana">0</span><span style="color: black; font-family: 宋体">的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报，那么发送方将停止发送数据，等到接受方发送窗口大小不为</span><span style="color: black; font-family: Verdana">0</span><span style="color: black; font-family: 宋体">的数据报的到来。书中的</span><span style="color: black; font-family: Verdana">P211</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">P212</span><span style="color: black; font-family: 宋体">很好的解释了这一点。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">关于滑动窗口协议，书上还介绍了三个术语，分别是：</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">窗口合拢：当窗口从左边向右边靠近的时候，这种现象发生在数据被发送和确认的时候。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">窗口张开：当窗口的右边沿向右边移动的时候，这种现象发生在接受端处理了数据以后。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">窗口收缩：当窗口的右边沿向左边移动的时候，这种现象不常发生。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">就是用这个窗口，慢慢的从数据的左边移动到右边，把处于窗口范围内的数据发送出去（但不用发送所有，只是处于窗口内的数据可以发送。）。这就是窗口的意义。图</span><span style="color: black; font-family: Verdana">20-6</span><span style="color: black; font-family: 宋体">解释了这一点。窗口的大小是可以通过</span><span style="color: black; font-family: Verdana">socket</span><span style="color: black; font-family: 宋体">来制定的，</span><span style="color: black; font-family: Verdana">4096</span><span style="color: black; font-family: 宋体">并不是最理想的窗口大小，而</span><span style="color: black; font-family: Verdana">16384</span><span style="color: black; font-family: 宋体">则可以使吞吐量大大的增加。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.3.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">数据拥塞</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">上面的策略用于局域网内传输还可以，但是用在广域网中就可能会出现问题，最大的问题就是当传输时出现了瓶颈（比如说一定要经过一个</span><span style="color: black; font-family: Verdana">slip</span><span style="color: black; font-family: 宋体">低速链路）所产生的大量数据堵塞问题（拥塞），为了解决这个问题，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">发送方需要确认连接双方的线路的数据最大吞吐量是多少。这，就是所谓的拥塞窗口。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">拥塞窗口的原理很简单，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">发送方首先发送一个数据报，然后等待对方的回应，得到回应后就把这个窗口的大小加倍，然后连续发送两个数据报，等到对方回应以后，再把这个窗口加倍（先是</span><span style="color: black; font-family: Verdana">2</span><span style="color: black; font-family: 宋体">的
指数倍，到一定程度后就变成现行增长，这就是所谓的慢启动），发送更多的数据报，直到出现超时错误，这样，发送端就了解到了通信双方的线路承载能力，也就
确定了拥塞窗口的大小，发送方就用这个拥塞窗口的大小发送数据。要观察这个现象是非常容易的，我们一般在下载数据的时候，速度都是慢慢</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">冲起来的</span><span style="color: black; font-family: Verdana">”</span></p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">以上就是</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据传输的大致流程，虽然并不细致，但是足以描述</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的工作原理，重点是</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的流量控制原理，滑动窗口，拥塞窗口，</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">累计确认等知识点。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">TCP/IP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">详解学习笔记</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">(12)-TCP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">的超时与重传</span></strong></p>
<p>&nbsp;</p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">超时重传是</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">协议保证数据可靠性的另一个重要机制，其原理是在发送某一个数据以后就开启一个计时器，在一定时间内如果没有得到发送的数据报的</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">报文，那么就重新发送数据，直到发送成功为止。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">超时</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">超时时间的计算是超时的核心部分，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">要求这个算法能大致估计出当前的网络状况，虽然这确实很困难。要求精确的原因有两个：</span><span style="color: black; font-family: Verdana">(1)</span><span style="color: black; font-family: 宋体">定时长久会造成网络利用率不高。</span><span style="color: black; font-family: Verdana">(2)</span><span style="color: black; font-family: 宋体">定时太短会造成多次重传，使得网络阻塞。所以，书中给出了一套</span><strong><span style="color: black; font-family: 宋体">经验</span></strong><span style="color: black; font-family: 宋体">公式，和其他的保证计时器准确的措施。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.1.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">递推公式概说</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">最早的</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">曾经用了一个非常简单的公式来估计当前网络的状况，如下</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">R&lt;-aR+(1-a)M</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RTP=Rb</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">其中</span><span style="color: black; font-family: Verdana">a</span><span style="color: black; font-family: 宋体">是一个经验系数为</span><span style="color: black; font-family: Verdana">0.1</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">b</span><span style="color: black; font-family: 宋体">通常为</span><span style="color: black; font-family: Verdana">2</span><span style="color: black; font-family: 宋体">。注意，这是经验，没有推导过程，这个数值是可以被修改的。这个公式是说用旧的</span><span style="color: black; font-family: Verdana">RTT(R)</span><span style="color: black; font-family: 宋体">和新的</span><span style="color: black; font-family: Verdana">RTT(M)</span><span style="color: black; font-family: 宋体">综合到一起来考虑新的</span><span style="color: black; font-family: Verdana">RTT(R)</span><span style="color: black; font-family: 宋体">的大小。但是，我们又看到，这种估计在网络变化很大的情况下完全不能做出</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">灵敏的反应</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">（</span><span style="color: black; font-family: Verdana">Jacoboson</span><span style="color: black; font-family: 宋体">说的，不是偶说的，呵呵），于是就有下面的修正公式：</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Err=M-A</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">A&lt;-A+gErr</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">D&lt;-D+h(|Err|-D)</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">RTO=A+4D</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">具体的解释请看书的</span><span style="color: black; font-family: Verdana">228</span><span style="color: black; font-family: 宋体">页，
这个递推公式甚至把方差这种统计概念也使用了进来，使得偏差更加的小。而且，必须要指出的是，这两组公式更新，都是在数据成功传输的情况下才进行，在发生
数据重新传输的情况下，并不使用上面的公式进行网络估计，理由很简单，因为程序已经不在正常状态下了，估计出来的数据也是没有意义的。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.2.RTO</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">的初始化</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">RTO</span><span style="color: black; font-family: 宋体">的初始化是由公式决定的，例如最初的公式，初始的值应该是</span><span style="color: black; font-family: Verdana">1</span><span style="color: black; font-family: 宋体">。而修正公式，初始</span><span style="color: black; font-family: Verdana">RTO</span><span style="color: black; font-family: 宋体">应该是</span><span style="color: black; font-family: Verdana">A+4D</span><span style="color: black; font-family: 宋体">。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.3.RTO</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">的更新</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">当数据正常传输的情况下，我们就会用上面的公式来更新各个数据，并重开定时器，来保证下一个数据被顺利传输。要注意的是：</span><strong><span style="color: black; font-family: 宋体">重传的情况下，</span></strong><strong><span style="color: black; font-family: Verdana">RTO</span></strong><strong><span style="color: black; font-family: 宋体">不用上面的公式计算，而采用一种叫做</span></strong><strong><span style="color: black; font-family: Verdana">“</span></strong><strong><span style="color: black; font-family: 宋体">指数退避</span></strong><strong><span style="color: black; font-family: Verdana">”</span></strong><strong><span style="color: black; font-family: 宋体">的方式。</span></strong><span style="color: black; font-family: 宋体">例如：当</span><span style="color: black; font-family: Verdana">RTO</span><span style="color: black; font-family: 宋体">为</span><span style="color: black; font-family: Verdana">1S</span><span style="color: black; font-family: 宋体">的情况下，发生了数据重传，我们就用</span><span style="color: black; font-family: Verdana">RTO=2S</span><span style="color: black; font-family: 宋体">的定时器来重新传输数据，下一次用</span><span style="color: black; font-family: Verdana">4S</span><span style="color: black; font-family: 宋体">。一直增加到</span><span style="color: black; font-family: Verdana">64S</span><span style="color: black; font-family: 宋体">为止。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.4.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">估计器的初始化</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">在这里，</span><span style="color: black; font-family: Verdana">SYN</span><span style="color: black; font-family: 宋体">用的估计器初始化似乎和传输用的估计器不一样（我也没有把握）造我的理解，在修正公式中，</span><span style="color: black; font-family: Verdana">SYN</span><span style="color: black; font-family: 宋体">的情况下，</span><span style="color: black; font-family: Verdana">A</span><span style="color: black; font-family: 宋体">初始化为</span><span style="color: black; font-family: Verdana">0,D</span><span style="color: black; font-family: 宋体">初始化为</span><span style="color: black; font-family: Verdana">3S</span><span style="color: black; font-family: 宋体">。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">而在得到传输第一个数据的</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">的时候，应该按照下面的公式进行初始化：</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">A=M+0.5</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="center"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">D=A/2</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.5.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">估计器的更新</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">和上面的讨论差不多，就是在正常情况下，用上面的公式计算，在重传的情况下，</span><strong><span style="color: black; font-family: 宋体">不更新估计器的各种参数。</span></strong><span style="color: black; font-family: 宋体">原因还是因为估计不准确。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.6.Karn</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">算法</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这不算是一个算法，这应该是一个策略，说的就是更新</span><span style="color: black; font-family: Verdana">RTO</span><span style="color: black; font-family: 宋体">和估计器的值的时机选择问题，</span><span style="color: black; font-family: Verdana">1.3.</span><span style="color: black; font-family: 宋体">和</span><span style="color: black; font-family: Verdana">1.5.</span><span style="color: black; font-family: 宋体">所说得更新时机就是</span><span style="color: black; font-family: Verdana">Karn</span><span style="color: black; font-family: 宋体">算法。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">1.7.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">计时器的使用</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">两句话</span><span style="color: black; font-family: Verdana">:</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">一个连接中，有且仅有一个测量定时器被使用。也就是说，如果</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">连续发出</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">组数据，只有一组数据会被测量。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">数据报不会被测量，原因很简单，没有</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">回应可以供结束定时器测量。</span> </p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">重传</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">有了超时就要有重传，但是就算是重传也是有策略的，而不是将数据简单的发送。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.1.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">重传时发送数据的大小</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">前面曾经提到过，数据在传输的时候不能只使用一个窗口协议，我们还需要有一个拥塞窗口来控制数据的流量，使得数据不会一下子都跑到网路中引起</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">拥塞</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">。也曾经提到过，拥塞窗口最初使用指数增长的速度来增加自身的窗口，直到发生超时重传，再进行一次微调。但是没有提到，如何进行微调，拥塞避免算法和慢启动门限就是为此而生。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">所谓的慢启动门限就是说，当拥塞窗口超过这个门限的时候，就使用拥塞避免算法，而在门限以内就采用慢启动算法。所以这个标准才叫做</span><strong><span style="color: black; font-family: 宋体">门限</span></strong><span style="color: black; font-family: 宋体">，通常，拥塞窗口记做</span><span style="color: black; font-family: Verdana">cwnd</span><span style="color: black; font-family: 宋体">，慢启动门限记做</span><span style="color: black; font-family: Verdana">ssthresh</span><span style="color: black; font-family: 宋体">。下面我们来看看拥塞避免和慢启动是怎么一起工作的</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">算法概要</span><span style="color: black; font-family: Verdana">(</span><span style="color: black; font-family: 宋体">直接从书中拷贝</span><span style="color: black; font-family: Verdana">)</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">对一个给定的连接，初始化</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个报文段，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ssthresh</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">65535</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个字节。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">输出例程的输出不能超过</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">和接收方通告窗口的大小。拥塞避免是发送方使用</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的流量控制，而通告窗口则是接收方进行的流量控制。前者是发送方感受到的网络拥塞的估</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">计，而后者则与接收方在该连接上的可用缓存大小有关。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">当拥塞发生时（超时或收到重复确认），</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ssthresh</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">被设置为当前窗口大小的一半（</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">cwnd </span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">和接收方通告窗口大小的最小值，但最少为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个报文段）。此外，如果是超时引起了拥塞，则</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">被设置为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个报文段（这就是慢启动）。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">4.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">当新的数据被对方确认时，就增加</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，但增加的方法依赖于我们是否正在进行慢启</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">动或拥塞避免。如果</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">小于或等于</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ssthresh</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，则正在进行慢启动，否则正在进行拥塞避免。</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">慢启动一直持续到我们回到当拥塞发生时所处位置的半时候才停止（因为我们记录了在步骤</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2 </span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">中给我们制造麻烦的窗口大小的一半），然后转为执行拥塞避免。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">补充上面的拥塞避免公式在</span><span style="color: black; font-family: Verdana">P238</span><span style="color: black; font-family: 宋体">页。这整个的流程让我联想到开车换档的过程。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.2.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">快速重传和快速恢复算法</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">这是数据丢包的情况下给出的一种修补机制。一般来说，重传发生在超时之后，但是如果发送端接受到</span><span style="color: black; font-family: Verdana">3</span><span style="color: black; font-family: 宋体">个以上的重复</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">的情况下，就应该意识到，数据丢了，需要重新传递。这个机制是不需要等到重传定时器溢出的，所以叫做</span><strong><span style="color: black; font-family: 宋体">快速重传</span></strong><span style="color: black; font-family: 宋体">，而重新传递以后，因为走的不是</span><strong><span style="color: black; font-family: 宋体">慢启动</span></strong><span style="color: black; font-family: 宋体">而是</span><strong><span style="color: black; font-family: 宋体">拥塞避免算法</span></strong><span style="color: black; font-family: 宋体">，所以这又叫做</span><strong><span style="color: black; font-family: 宋体">快速恢复算法</span></strong><span style="color: black; font-family: 宋体">。流程如下：</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">当收到第</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个重复的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">时，将</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ssthresh</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">设置为当前拥塞窗口</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的一半。重传丢失的</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">报文段。设置</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ssthresh</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">加上</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">倍的报文段大小。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">每次收到另一个重复的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">时，</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">增加</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个报文段大小并发送</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个分组（如果新的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">允许发送）。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">当下一个确认新数据的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">到达时，设置</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">cwnd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ssthresh</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">（在第</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">步中设置的值）。这个</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">应该是在进行重传后的一个往返时间内对步骤</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">中重传的确认。另外，这个</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">也应该</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">是对丢失的分组和收到的第</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">个重复的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">之间的所有中间报文段的确认。这一步采用的是拥</span> <span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">塞避免，因为当分组丢失时我们将当前的速率减半。</span> </p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.3.ICMP</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">会引起重新传递么？</span></strong><strong></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">答案是：</span><strong><span style="color: black; font-family: 宋体">不会</span></strong><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">会坚持用自己的定时器，但是</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">会保留下</span><span style="color: black; font-family: Verdana">ICMP</span><span style="color: black; font-family: 宋体">的错误并且通知用户。</span></p>
<p style="background: #eeeedd; word-break: break-all; line-height: 150%" align="left"><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: Verdana">2.4.</span></strong><strong><span style="font-size: 12pt; color: black; line-height: 150%; font-family: 宋体">重新分组</span></strong><strong></strong></p>
<p style="margin-top: 12pt; background: #eeeedd; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">为了提高自己的效率，允许再重新传输的时候，只要传输包含重传数据报文的报文就可以，而不用只重传需要传输的报文。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p align="center"><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">TCP/IP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">详解学习笔记</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">(13)-TCP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">坚持定时器，</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: Verdana">TCP</span></strong><strong><span style="font-size: 11.5pt; color: #770000; font-family: 宋体">保活定时器</span></strong></p>
<p>&nbsp;</p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">一共有四个主要的定时器，前面已经讲到了一个－－超时定时器－－是</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">里面最复杂的一个，另外的三个是：</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">坚持定时器</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">保活定时器</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">3.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2MSL</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">定时器</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">其中坚持定时器用于防止通告窗口为</span><span style="color: black; font-family: Verdana">0</span><span style="color: black; font-family: 宋体">以后双方互相等待死锁的情况；而保活定时器则用于处理半开放连接</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">坚持定时器</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">坚持定时器的原理是简单的，当</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">服务器收到了客户端的</span><span style="color: black; font-family: Verdana">0</span><span style="color: black; font-family: 宋体">滑动窗口报文的时候，就启动一个定时器来计时，并在定时器溢出的时候向向客户端查询窗口是否已经增大，如果得到非零的窗口就重新开始发送数据，如果得到</span><span style="color: black; font-family: Verdana">0</span><span style="color: black; font-family: 宋体">窗口就再开一个新的定时器准备下一次查询。通过观察可以得知，</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的坚持定时器使用</span><span style="color: black; font-family: Verdana">1</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">2</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">4</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">8</span><span style="color: black; font-family: 宋体">，</span><span style="color: black; font-family: Verdana">16……64</span><span style="color: black; font-family: 宋体">秒这样的普通指数退避序列来作为每一次的溢出时间。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><strong><span style="color: black; font-family: 宋体">糊涂窗口综合症</span></strong></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的窗口协议，会引起一种通常叫做糊涂窗口综合症的问题，具体表现为，当客户端通告一个小的非零窗口时，服务器立刻发送小数据给客户端并充满其缓冲区，一来二去就会让网络中充满小</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">数据报，从而影响网络利用率。对于发送方和接收端的这种糊涂行为。</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">给出了一些建议（或者是规定）。</span></p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">1.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">接收方不通告小窗口。通常的算法是接收方不通告一个比当前窗口大的窗口（可以为</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">0</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">），</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"><br>
</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">除非窗口可以增加一个报文段大小（也就是将要接收的</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">MSS</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">）或者可以增加接收方缓存空间</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"><br>
</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">的一半，不论实际有多少。</span> </p>
<p style="background: #eeeedd; margin-left: 32.25pt; word-break: break-all; text-indent: -18pt; line-height: 150%; text-align: left" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.<span style="font: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">发送方避免出现糊涂窗口综合症的措施是只有以下条件之一满足时才发送数据：</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> ( a )</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">可</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"><br>
</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">以发送一个满长度的报文段；</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> ( b )</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">可以发送至少是接收方通告窗口大小一半的报文段；</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> ( c )</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">可以</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"><br>
</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">发送任何数据并且不希望接收</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ACK</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">（也就是说，我们没有还未被确认的数据）或者该连接上</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"><br>
</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">不能使用</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Nagle</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">算法。</span> </p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: Verdana">ok</span><span style="color: black; font-family: 宋体">，现在我们回忆一下，可以发现</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">的很多规定都是为了在一次传送中发送尽量多的数据，例如捎带</span><span style="color: black; font-family: Verdana">ACK</span><span style="color: black; font-family: 宋体">数据报文的策略，</span><span style="color: black; font-family: Verdana">Nagle</span><span style="color: black; font-family: 宋体">算法，重传时发送包含原数据报文的策略，等等。</span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2.</span></strong><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">保活定时器</span></strong><strong></strong></p>
</div>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">保活定时器更加的简单，还记得</span><span style="color: black; font-family: Verdana">FTP</span><span style="color: black; font-family: 宋体">或者</span><span style="color: black; font-family: Verdana">Http</span><span style="color: black; font-family: 宋体">服务器都有</span><span style="color: black; font-family: Verdana">Sesstion Time</span><span style="color: black; font-family: 宋体">机制么？因为</span><span style="color: black; font-family: Verdana">TCP</span><span style="color: black; font-family: 宋体">是面向连接的，所以就会出现只连接不传送数据的</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">半开放连接</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">，服务器当然要检测到这种连接并且在某些情况下释放这种连接，这就是保活定时器的作用。其时限根据服务器的实现不同而不通。另外要提到的是，当其中一端如果崩溃并重新启动的情况下，如果收到该端</span><span style="color: black; font-family: Verdana">“</span><span style="color: black; font-family: 宋体">前生</span><span style="color: black; font-family: Verdana">”</span><span style="color: black; font-family: 宋体">的保活探察，则要发送一个</span><span style="color: black; font-family: Verdana">RST</span><span style="color: black; font-family: 宋体">数据报文帮助另一端结束连接。</span></p>
<p style="background: #eeeedd; margin: 12pt 0cm 6pt; word-break: break-all; text-indent: 24pt; line-height: 16.5pt" align="left"><span style="color: black; font-family: 宋体">发表于</span><span style="color: black; font-family: Verdana"> @ <a title="permalink" href="http://blog.csdn.net/goodboy1881/archive/2006/05/28/758034.aspx"><span style="color: #770000; text-decoration: none; text-underline: none">2006</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">年</span><span style="color: #770000; text-decoration: none; text-underline: none">05</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">月</span><span style="color: #770000; text-decoration: none; text-underline: none">28</span><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">日</span><span style="color: #770000; text-decoration: none; text-underline: none"> 00:34:00</span></a>|<a title="评论" href="http://blog.csdn.net/goodboy1881/archive/2006/05/28/758034.aspx#FeedBack"><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">评论</span><span style="color: #770000; text-decoration: none; text-underline: none">(2 </span><span style="color: #770000; text-decoration: none; text-underline: none"><script type="text/javascript">
AddFeedbackCountStack("758034")
</script></span><span style="color: #770000; text-decoration: none; text-underline: none">)</span></a>|<a title="编辑" href="http://writeblog.csdn.net/PostEdit.aspx?entryId=758034"><span style="color: #770000; font-family: 宋体; text-decoration: none; text-underline: none">编辑</span></a></span></p>
<div style="border-right: #cccccc 1pt dotted; padding-right: 7pt; border-top: #cccccc 1pt dotted; padding-left: 7pt; background: #fffffd; padding-bottom: 7pt; border-left: #cccccc 1pt dotted; padding-top: 7pt; border-bottom: #cccccc 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; margin-top: 4.5pt; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"><a href="http://blog.csdn.net/goodboy1881/archive/2006/05/29/762079.aspx"><span style="color: black; font-family: 宋体; text-decoration: none; text-underline: none">新一篇</span><span style="color: black; text-decoration: none; text-underline: none">:&nbsp; TCP/IP</span><span style="color: black; font-family: 宋体; text-decoration: none; text-underline: none">详解学习笔记</span><span style="color: black; text-decoration: none; text-underline: none">(14)-TCP</span><span style="color: black; font-family: 宋体; text-decoration: none; text-underline: none">连接的未来和性能</span><span style="color: black; text-decoration: none; text-underline: none">(</span><span style="color: black; font-family: 宋体; text-decoration: none; text-underline: none">未写完</span><span style="color: black; text-decoration: none; text-underline: none">)</span></a>&nbsp;|&nbsp;<a href="http://blog.csdn.net/goodboy1881/archive/2006/05/25/755248.aspx"><span style="color: black; font-family: 宋体; text-decoration: none; text-underline: none">旧一篇</span><span style="color: black; text-decoration: none; text-underline: none">:&nbsp; TCP/IP</span><span style="color: black; font-family: 宋体; text-decoration: none; text-underline: none">详解学习笔记</span><span style="color: black; text-decoration: none; text-underline: none">(12)-TCP</span><span style="color: black; font-family: 宋体; text-decoration: none; text-underline: none">的超时与重传</span></a></span></strong></p>
</div>
<div style="border-right: #770000 1pt dotted; padding-right: 12pt; border-top: #770000 1pt dotted; padding-left: 12pt; background: #fffffd; padding-bottom: 6pt; border-left: #770000 1pt dotted; padding-top: 6pt; border-bottom: #770000 1pt dotted">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; padding-left: 0cm; background: #fffffd; padding-bottom: 0cm; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><strong><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">评论</span></strong><strong></strong></p>
</div>
<div style="border-right: medium none; padding-right: 0cm; border-top: #336699 1pt solid; padding-left: 0cm; background: #fbf9f9; padding-bottom: 0cm; border-left: medium none; padding-top: 2pt; border-bottom: medium none">
<p style="border-right: medium none; padding-right: 0cm; border-top: medium none; padding-left: 0cm; background: #fbf9f9; padding-bottom: 0cm; margin: 3.75pt 0cm 4.5pt; border-left: medium none; word-break: break-all; line-height: 150%; padding-top: 0cm; border-bottom: medium none" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"><a title="permalink: 回复： TCP/IP详解学习笔记(13)-TCP坚持定时器，TCP保活定时器" href="http://blog.csdn.net/goodboy1881/archive/2006/05/28/758034.aspx#448346"><span style="color: #770000">#</span></a><a name="448346"></a><a href="http://blog.csdn.net/goodboy1881" target="_blank"><span style="color: #770000; font-family: 宋体">积木</span></a>&nbsp;</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">发表于</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">2006-05-29 11:12:00&nbsp;&nbsp;IP: 10.4.27.* </span></p>
</div>
<p style="background: #eeeedd; margin-left: 57pt; word-break: break-all; line-height: 150%" align="left"><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">我学习</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">TCP/IP</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，手边一台</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">linux</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，一边学习一边实践最后写</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">blog</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">。学习一种应用层协议就架设一种服务器。</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> <br>
</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">比如说学习</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">DNS</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">就架设</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">bind9</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">，学习</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">ftp</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">就架设</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">vsftpd</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">。来加深对理论的理解。</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana"> <br>
</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">学好理论以后，下一步就学习</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">socket</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: 宋体">吧。我也准备开始看了，就看</span><span style="font-size: 9pt; color: black; line-height: 150%; font-family: Verdana">Unix Network Programming .</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info"><div id="green_channel">
<a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(1339347,cb_blogId,1);green_channel_success(this,'谢谢推荐！');">好文要顶</a>
<a id="green_channel_follow" onclick="c_follow();" href="javascript:void(0);">关注我</a>
<a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a><a id="green_channel_contact" href="http://msg.cnblogs.com/send/%E5%86%AF%E8%B5%9E%E9%94%8B" target="_blank">联系我</a>
<a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/icon_weibo_24.png" alt=""></a>
<a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
<div id="author_profile_info" class="author_profile_info">
<a href="http://home.cnblogs.com/u/fengzanfeng/" target="_blank"><img src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/sample_face.gif" class="author_avatar" alt=""></a>
<div id="author_profile_detail" class="author_profile_info">
<a href="http://home.cnblogs.com/u/fengzanfeng/">冯赞锋</a><br>
<a href="http://home.cnblogs.com/u/fengzanfeng/followees">关注 - 0</a><br>
<a href="http://home.cnblogs.com/u/fengzanfeng/followers">粉丝 - 38</a>
</div>
</div>
<div class="clear"></div>
<div id="author_profile_honor"></div>
<div id="author_profile_follow">
    <a href="javascript:void(0);" onclick="c_follow();return false;">+加关注</a>
</div>
</div>
<div id="div_digg">										
    <div class="diggit" onclick="votePost(1339347,'Digg')">
        <span class="diggnum" id="digg_count">10</span>
    </div>
	<div class="buryit" onclick="votePost(1339347,'Bury')"> 
		<span class="burynum" id="bury_count">0</span>
	</div>
	<div class="clear"></div>	
	<div class="diggword" id="digg_tips">
    (请您对文章做出评价)
    </div>	
</div>
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2008-11-23 13:28</span> <a href="http://www.cnblogs.com/fengzanfeng/">冯赞锋</a> 阅读(<span id="post_view_count">88709</span>) 评论(<span id="post_comment_count">6</span>) &nbsp;<a href="http://i.cnblogs.com/EditArticles.aspx?postid=1339347" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(1339347);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,isLogined=false,cb_blogId=48096,cb_entryId=1339347,cb_blogApp=currentBlogApp,cb_blogUserGuid='9302470b-63cf-dd11-9e4d-001cf0cd104b',cb_entryCreatedDate='2008/11/23 13:28:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"></div>
<!--done-->
<br>
<div class="feedback_area_title">发表评论</div>
<div class="feedbackNoItems"></div>
	

		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="#2629235" class="layer">#1楼</a><a name="2629235" id="comment_anchor_2629235"></a> <span class="comment_date">2013-03-06 21:58</span> | <a id="a_comment_author_2629235" href="http://www.cnblogs.com/heyonggang/" target="_blank">夏雪冬日</a> <a href="http://msg.cnblogs.com/send/%E5%A4%8F%E9%9B%AA%E5%86%AC%E6%97%A5" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2629235" class="blog_comment_body">赞一个！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2629235,'Digg',this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2629235,'Bury',this)">反对(0)</a></div><span id="comment_2629235_avatar" style="display:none;">http://pic.cnblogs.com/face/u478153.jpg?id=28172557</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="#2992866" class="layer">#2楼</a><a name="2992866" id="comment_anchor_2992866"></a> <span class="comment_date">2014-07-23 10:31</span> | <a id="a_comment_author_2992866" href="http://www.cnblogs.com/smallsun/" target="_blank">太阳小子</a> <a href="http://msg.cnblogs.com/send/%E5%A4%AA%E9%98%B3%E5%B0%8F%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2992866" class="blog_comment_body">很好，很仔细。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2992866,'Digg',this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2992866,'Bury',this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="#3098577" class="layer">#3楼</a><a name="3098577" id="comment_anchor_3098577"></a> <span class="comment_date">2015-01-02 22:00</span> | <a id="a_comment_author_3098577" href="http://www.cnblogs.com/simpman/" target="_blank">simpman</a> <a href="http://msg.cnblogs.com/send/simpman" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3098577" class="blog_comment_body">先顶为敬</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3098577,'Digg',this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3098577,'Bury',this)">反对(0)</a></div><span id="comment_3098577_avatar" style="display:none;">http://pic.cnblogs.com/face/467192/20130524091552.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="#3276925" class="layer">#4楼</a><a name="3276925" id="comment_anchor_3276925"></a> <span class="comment_date">2015-09-29 21:14</span> | <a id="a_comment_author_3276925" href="http://www.cnblogs.com/2231179438qq/" target="_blank">NowLetsGo~~</a> <a href="http://msg.cnblogs.com/send/NowLetsGo%7E%7E" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3276925" class="blog_comment_body">看这篇幅就错不了</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3276925,'Digg',this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3276925,'Bury',this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="#3282727" class="layer">#5楼</a><a name="3282727" id="comment_anchor_3282727"></a> <span class="comment_date">2015-10-12 10:18</span> | <a id="a_comment_author_3282727" href="http://www.cnblogs.com/rainbow-z/" target="_blank">舒凉</a> <a href="http://msg.cnblogs.com/send/%E8%88%92%E5%87%89" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3282727" class="blog_comment_body">很详细</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3282727,'Digg',this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3282727,'Bury',this)">反对(0)</a></div><span id="comment_3282727_avatar" style="display:none;">http://pic.cnblogs.com/face/821184/20151011200222.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="#3290877" class="layer">#6楼</a><a name="3290877" id="comment_anchor_3290877"></a><span id="comment-maxId" style="display:none;">3290877</span><span id="comment-maxDate" style="display:none;">2015/10/23 16:27:41</span> <span class="comment_date">2015-10-23 16:27</span> | <a id="a_comment_author_3290877" href="http://home.cnblogs.com/u/697210/" target="_blank">HelloWorld!!!</a> <a href="http://msg.cnblogs.com/send/HelloWorld%21%21%21" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3290877" class="blog_comment_body">讲的很详细，谢谢！<br>随便问一下，楼主看的哪本书？</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3290877,'Digg',this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3290877,'Bury',this)">反对(0)</a></div>
			</div>
		</div>
	<div id="comments_pager_bottom"></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login('commentform');">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="site_nav_under"><a href="http://www.ucancode.com/index.htm" target="_blank">【推荐】50万行VC++源码: 大型组态工控、电力仿真CAD与GIS源码库</a><br><a href="https://www.jpush.cn/" target="_blank">【推荐】极光推送30多万开发者的选择，SDK接入量超过30亿了，你还没注册？</a><br><a href="http://click.aliyun.com/m/3037/" target="_blank">【精品】高性能阿里云服务器+SSD云盘，支撑I/O密集型核心业务、极高数据可靠性</a><br></div>
<div id="opt_under_post"></div>
<script type="text/javascript">
    fixPostBodyFormat();
</script>
<div id="google_ad_c1" class="c_ad_block"><a href="http://www.gcpowertools.com.cn/order/specialoffers.htm?utm_source=cnblogs&amp;utm_medium=blogpage&amp;utm_term=bottom&amp;utm_content=promotion&amp;utm_campaign=community" target="_blank"><img src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/24442-20151216201412771-432811263.png" alt="葡萄城促销" title="葡萄城促销" height="250" width="300"></a></div>
<div id="under_post_news"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="http://news.cnblogs.com/n/535978/" target="_blank">作为员工，如何识别初创企业健康状况</a><br> ·  <a href="http://news.cnblogs.com/n/535979/" target="_blank">如何招到靠谱的产品经理？</a><br> ·  <a href="http://news.cnblogs.com/n/535977/" target="_blank">创业跟风者的15项特征</a><br> ·  <a href="http://news.cnblogs.com/n/535976/" target="_blank">在网上没人知道你是一条狗的时候，你会怎么做？</a><br> ·  <a href="http://news.cnblogs.com/n/535975/" target="_blank">看完豆瓣读书这份年度榜单，才知道今年错过了多少好书</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="google_ad_c2" class="c_ad_block"><a href="http://jiuye.jikexueyuan.com/train/android?hmsr=cnb_jiuye_android_1217" target="_blank"><img src="TCP_IP%E8%AF%A6%E8%A7%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20%E8%BF%99%E4%BD%8D%E4%BB%81%E5%85%84%E5%86%99%E5%BE%97%E5%A4%AA%E5%A5%BD%E4%BA%86%20-%20%E5%86%AF%E8%B5%9E%E9%94%8B%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/24442-20151221165216515-1388032690.jpg" alt="jiuye_android_1217" title="jiuye_android_1217" height="60" width="468"></a></div>
<div id="under_post_kb"><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="http://kb.cnblogs.com/page/535581/" target="_blank">Git协作流程</a><br> ·  <a href="http://kb.cnblogs.com/page/535355/" target="_blank">企业计算的终结</a><br> ·  <a href="http://kb.cnblogs.com/page/535278/" target="_blank">软件开发的核心</a><br> ·  <a href="http://kb.cnblogs.com/page/534420/" target="_blank">Linux概念架构的理解</a><br> ·  <a href="http://kb.cnblogs.com/page/527814/" target="_blank">从涂鸦到发布——理解API的设计过程</a><br></div>» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
$(function () {
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
});
</script>
</div>

	</div><!--end: topicList 文章列表容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"><div id="profile_block">昵称：<a href="http://home.cnblogs.com/u/fengzanfeng/">冯赞锋</a><br>园龄：<a href="http://home.cnblogs.com/u/fengzanfeng/" title="入园时间：2008-11-22">7年1个月</a><br>粉丝：<a href="http://home.cnblogs.com/u/fengzanfeng/followers/">38</a><br>关注：<a href="http://home.cnblogs.com/u/fengzanfeng/followees/">0</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="cnblogs.UserManager.FollowBlogger('9302470b-63cf-dd11-9e4d-001cf0cd104b')">+加关注</a></div></div></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" title="日历" cellpadding="0" cellspacing="0">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar('2015/11/01');return false;">&lt;</a></td><td align="center">2015年12月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar('2016/01/01');return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" abbr="日" scope="col" align="center">日</th><th class="CalDayHeader" abbr="一" scope="col" align="center">一</th><th class="CalDayHeader" abbr="二" scope="col" align="center">二</th><th class="CalDayHeader" abbr="三" scope="col" align="center">三</th><th class="CalDayHeader" abbr="四" scope="col" align="center">四</th><th class="CalDayHeader" abbr="五" scope="col" align="center">五</th><th class="CalDayHeader" abbr="六" scope="col" align="center">六</th></tr><tr><td class="CalOtherMonthDay" align="center">29</td><td class="CalOtherMonthDay" align="center">30</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td class="CalWeekendDay" align="center">5</td></tr><tr><td class="CalWeekendDay" align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">10</td><td align="center">11</td><td class="CalWeekendDay" align="center">12</td></tr><tr><td class="CalWeekendDay" align="center">13</td><td align="center">14</td><td align="center">15</td><td align="center">16</td><td align="center">17</td><td align="center">18</td><td class="CalWeekendDay" align="center">19</td></tr><tr><td class="CalWeekendDay" align="center">20</td><td align="center">21</td><td align="center">22</td><td align="center">23</td><td align="center">24</td><td align="center">25</td><td class="CalWeekendDay" align="center">26</td></tr><tr><td class="CalWeekendDay" align="center">27</td><td align="center">28</td><td align="center">29</td><td class="CalTodayDay" align="center">30</td><td align="center">31</td><td class="CalOtherMonthDay" align="center">1</td><td class="CalOtherMonthDay" align="center">2</td></tr><tr><td class="CalOtherMonthDay" align="center">3</td><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td><td class="CalOtherMonthDay" align="center">7</td><td class="CalOtherMonthDay" align="center">8</td><td class="CalOtherMonthDay" align="center">9</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk" type="text">&nbsp;<input onclick="zzk_go()" value="找找看" id="btnZzk" class="btn_my_zzk" type="button"></div>
<div id="widget_my_google" class="div_my_zzk"><input name="google_q" id="google_q" onkeydown="return google_go_enter(event)" class="input_my_zzk" type="text">&nbsp;<input onclick="google_go()" value="谷歌搜索" class="btn_my_zzk" type="button"></div>
</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<div class="catListLink">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="http://www.cnblogs.com/fengzanfeng/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="http://www.cnblogs.com/fengzanfeng/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="http://www.cnblogs.com/fengzanfeng/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="http://www.cnblogs.com/fengzanfeng/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="http://www.cnblogs.com/fengzanfeng/tag/" title="我的博客的标签列表">我的标签</a></li>
<li><a id="itemListLink" onclick="this.blur();WarpClass('itemListLink', 'itemListLin_con');return false;" href="#">更多链接</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">
<ul>

</ul>
</div>
</div></div><div id="sidebar_toptags" class="sidebar-block"></div><div id="sidebar_categories">
<div class="catListPostCategory">
<h3 class="catListTitle">随笔分类</h3>

<ul>

<li><a id="CatList_LinkList_0_Link_0" href="http://www.cnblogs.com/fengzanfeng/category/164765.html">ASP.NET技巧</a> </li>

<li><a id="CatList_LinkList_0_Link_1" href="http://www.cnblogs.com/fengzanfeng/category/164763.html">C#语言基本</a> </li>

<li><a id="CatList_LinkList_0_Link_2" href="http://www.cnblogs.com/fengzanfeng/category/164762.html">C/C++语言基础</a> </li>

<li><a id="CatList_LinkList_0_Link_3" href="http://www.cnblogs.com/fengzanfeng/category/164770.html">JAVA</a> </li>

<li><a id="CatList_LinkList_0_Link_4" href="http://www.cnblogs.com/fengzanfeng/category/164764.html">TCP/IP学习笔记</a> </li>

<li><a id="CatList_LinkList_0_Link_5" href="http://www.cnblogs.com/fengzanfeng/category/164769.html">UNIX/LINUX</a> </li>

<li><a id="CatList_LinkList_0_Link_6" href="http://www.cnblogs.com/fengzanfeng/category/164768.html">VC++</a> </li>

<li><a id="CatList_LinkList_0_Link_7" href="http://www.cnblogs.com/fengzanfeng/category/164767.html">WinForm</a> </li>

<li><a id="CatList_LinkList_0_Link_8" href="http://www.cnblogs.com/fengzanfeng/category/164766.html">人生旅途</a> </li>

</ul>

</div>

<div class="catListArticleCategory">
<h3 class="catListTitle">文章分类</h3>

<ul>

<li><a id="CatList_LinkList_1_Link_0" href="http://www.cnblogs.com/fengzanfeng/category/164782.html">ASP.NET</a> </li>

<li><a id="CatList_LinkList_1_Link_1" href="http://www.cnblogs.com/fengzanfeng/category/164776.html">C#语言基础(1)</a> </li>

<li><a id="CatList_LinkList_1_Link_2" href="http://www.cnblogs.com/fengzanfeng/category/164771.html">C/C++语言基础(2)</a> </li>

<li><a id="CatList_LinkList_1_Link_3" href="http://www.cnblogs.com/fengzanfeng/category/164783.html">JAVA</a> </li>

<li><a id="CatList_LinkList_1_Link_4" href="http://www.cnblogs.com/fengzanfeng/category/164786.html">JavaScript</a> </li>

<li><a id="CatList_LinkList_1_Link_5" href="http://www.cnblogs.com/fengzanfeng/category/164787.html">SQL语言(1)</a> </li>

<li><a id="CatList_LinkList_1_Link_6" href="http://www.cnblogs.com/fengzanfeng/category/164781.html">TCP/IP学习笔记(1)</a> </li>

<li><a id="CatList_LinkList_1_Link_7" href="http://www.cnblogs.com/fengzanfeng/category/164778.html">UNIX/LINUX(3)</a> </li>

<li><a id="CatList_LinkList_1_Link_8" href="http://www.cnblogs.com/fengzanfeng/category/164780.html">VC++(4)</a> </li>

<li><a id="CatList_LinkList_1_Link_9" href="http://www.cnblogs.com/fengzanfeng/category/164784.html">Windows批处理</a> </li>

<li><a id="CatList_LinkList_1_Link_10" href="http://www.cnblogs.com/fengzanfeng/category/164777.html">WinForm(5)</a> </li>

<li><a id="CatList_LinkList_1_Link_11" href="http://www.cnblogs.com/fengzanfeng/category/164861.html">大学课程(1)</a> </li>

<li><a id="CatList_LinkList_1_Link_12" href="http://www.cnblogs.com/fengzanfeng/category/164779.html">人生旅途(1)</a> </li>

<li><a id="CatList_LinkList_1_Link_13" href="http://www.cnblogs.com/fengzanfeng/category/164785.html">正则表达式</a> </li>

</ul>

</div>

<div class="catListImageCategory">
<h3 class="catListTitle">相册</h3>

<ul>

<li><a id="CatList_LinkList_2_Link_0" href="http://www.cnblogs.com/fengzanfeng/gallery/164885.html" rel="nofollow">大学生活</a> </li>

</ul>

</div>

</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<div class="catListComment">
<h3 class="catListTitle">最新评论</h3>

	<div id="RecentCommentsBlock"><ul>
    <li class="recent_comment_title"><a href="http://www.cnblogs.com/fengzanfeng/articles/1339347.html#3290877">1. Re:TCP/IP详解学习笔记   这位仁兄写得太好了</a></li>
    <li class="recent_comment_body">讲的很详细，谢谢！<br>随便问一下，楼主看的哪本书？</li>
    <li class="recent_comment_author">--HelloWorld!!!</li>
    <li class="recent_comment_title"><a href="http://www.cnblogs.com/fengzanfeng/articles/1339347.html#3282727">2. Re:TCP/IP详解学习笔记   这位仁兄写得太好了</a></li>
    <li class="recent_comment_body">很详细</li>
    <li class="recent_comment_author">--舒凉</li>
    <li class="recent_comment_title"><a href="http://www.cnblogs.com/fengzanfeng/articles/1339347.html#3276925">3. Re:TCP/IP详解学习笔记   这位仁兄写得太好了</a></li>
    <li class="recent_comment_body">看这篇幅就错不了</li>
    <li class="recent_comment_author">--NowLetsGo~~</li>
    <li class="recent_comment_title"><a href="http://www.cnblogs.com/fengzanfeng/articles/1339347.html#3098577">4. Re:TCP/IP详解学习笔记   这位仁兄写得太好了</a></li>
    <li class="recent_comment_body">先顶为敬</li>
    <li class="recent_comment_author">--simpman</li>
</ul>
</div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div style="display: none;" id="topview_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">阅读排行榜</h3>
	<div id="TopViewPostsBlock"></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div style="display: none;" id="topfeedback_posts_wrap">
<div class="catListFeedback">
<h3 class="catListTitle">评论排行榜</h3>
	<div id="TopFeedbackPostsBlock"></div>
</div>
</div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div style="display: none;" id="topdigg_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">推荐排行榜</h3>
<div id="TopDiggPostsBlock"></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
		<div class="clear"></div>
	</div><!--end: sideBar 侧边栏容器 -->
</div><!--end: home 自定义的最大容器 -->
		<div class="clear"></div>
<div id="footer">
	
<!--done-->
Copyright ©2015 冯赞锋
</div><!--end: footer -->
</center>


</body></html>