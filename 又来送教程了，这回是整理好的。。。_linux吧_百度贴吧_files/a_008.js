_.Module.define({path:"tbmall/component/HeadPreview",requires:["common/widget/UserHead","tbmall/component/util","props/component/Guide","tbmall/component/UseController","ihome/widget/UserVisitCard"],sub:{initial:function(){this.initUI(),this.initFlashCallbacks(),this.guide=this.use("props/component/Guide"),this.visitCard=this.use("ihome/widget/UserVisitCard"),this.useC=this.use("tbmall/component/UseController"),this.util=this.use("tbmall/component/util")},options:{pngCount:{1090001:3,1090002:5,1090003:5,1090004:4,1090005:5,1090006:5,1090007:5,1090008:4,1090009:5,1090010:5,1090011:5,1090012:4,1090013:5},propIdForProp:{101:"bub",104:"font",108:"card",116:"card",117:"card",118:"card",114:"card",103:"printer"},stylesForAllPreview:{110:"frame",109:"frame"}},_centerElement:function(e){var t=e.height(),i=e.width();e.css({width:i,height:t,top:"50%",left:"50%","margin-left":-(i/2),"margin-top":-(t/2)})},_getData:function(e){$.json.encode($(e).closest("li.item").data("field"));return $(e).closest("li.item").getData()},doPreview:function(e){{var t=this,i=$.json.encode($(e).closest("li.item").data("field")),a=t._getData(e),r=a.props_category,s=a.props_id;t.options.stylesForAllPreview[r]}switch(r){case"107":t.$loading.remove(),t.guide.showMagicGuide(s);break;case"109":t._buildPreviewUI(t.getHtmlFor109(a.props_id)),t.guide.$guideWrap.css({"margin-left":"-175px","margin-top":"-150px"}),t.hasFrame&&t.guide.$guideWrap.css({width:350,height:205,backgroundPosition:"105px 40px"});break;case"110":t._buildPreviewUI(t.getHtmlFor110(a.props_id));break;case"113":if(!PageData.user.is_login)return _.Module.use("common/widget/LoginDialog"),void 0;t._buildPreviewUI(t.getHtmlForOther(a.props_id)),t.guide.$guideWrap.css({"margin-left":"-200px"}),t.visitCard.getVisitCardContent({un:PageData.user.user_name,id:PageData.user.portrait,wrap:t.guide.$guideContent.find(".card_preview"),bg_id:a.props_id,callBack:function(){t.guide.$guideContent.find(".card_userinfo_img").one("load",function(){t._centerElement(t.guide.$guideWrap)})}});break;default:t._buildPreviewUI(t.getHtmlForOther(a.props_id))}t._buildChargeInfo(i,a),this.initToBuy(),this.initUse()},_buildChargeInfo:function(e,t){var i=this,a=("0"==t.props_type?t.free_user_level:2,i.util.getFreeInfo(t)),r=i.initBuyInfo(e);i.guide.$guideContent.append(r),"107"!=t.props_category&&i.guide.$guideContent.append(a)},_buildPreviewUI:function(e){var t=this;this.guide.initPreviewUI(),this.guide.$guideContent.html(e);var i=$(e).find(".j_resource_loading");i.length>0&&this.guide.$guideWrap.hide(),i.length>0&&i.one("load",function(){t._centerElement(t.guide.$guideWrap),t.guide.$guideWrap.show()})},initUI:function(){this.$portraitWrap=$('<div id="portrait_wrap" class="portrait_wrap"></div>'),this.$portraitFlash=$('<div class="portrait_flash"></div>'),this.$loading=$('<img class="portrait_loading" src="/tb/static-tbmall/img/loading.gif"/>'),this.$portraitWrap.append(this.$portraitFlash).append(this.$loading)},getHtmlForOther:function(e){var t=this,i=e.slice(0,3),a="",r="png",s={1170001:"-1~2",1170002:"0~3",1170003:"2~5",1170004:"5~8",1170005:"10~15"},o={108:'<p class="prop_intro">\u8FDE\u7EED\u7B7E\u5230\u795E\u5668\u3002\u9EBB\u9EBB\u518D\u4E5F\u4E0D\u7528\u62C5\u5FC3\u6211\u6F0F\u7B7E\u4E86\uFF01</p>',117:'<p class="prop_intro">\u4E3A\u697C\u4E3B\u633D\u5C0A\uFF0C\u88AB\u633D\u5C0A\u7528\u6237\u7ECF\u9A8C\u503C\u589E\u52A0('+(s[e]||"")+")\u3002</p>",116:'<p class="prop_intro">\u7ED9\u5973\u795E\u544A\u767D\uFF0C\u53EB\u57FA\u53CB\u56DE\u5BB6\u5403\u996D\uFF0C\u8BA9\u4F60\u7684\u53D1\u8A00\u63B7\u5730\u6709\u58F0\uFF01</p>',118:'<p class="prop_intro">\u4F1A\u5458\u5427\u4E3B\u4E13\u5C5E\u91D1\u8272\u7F6E\u9876\uFF0C\u4E0D\u53EF\u9690\u85CF\uFF0C\u5C0A\u8D35\u8EAB\u4EFD\uFF0C\u7ACB\u523B\u5F70\u663E\u3002</p>'};("1040003"===e||"1040011"===e||"1080002"===e)&&(r="gif");var n=["http://tb1.bdstatic.com/tb/cms/tbmall/",t.options.propIdForProp[i],"/pc/"+e,"."+r].join("");return a+="113"===i?['<div class="card_preview">','<img class="card_loading" src="/tb/static-tbmall/img/loading.gif"/>','</div><div class="card_mask">'].join(""):['<div class="preview">','<img class="j_resource_loading" src="'+n+'" alt="\u56FE\u7247\u9884\u89C8" />'].join(""),a+=o[i]||"",a+="</div>"},_initUserHead:function(){this.userHead||(this.userHead=this.use("common/widget/UserHead"))},getHtmlFor109:function(e){var t=this,i="portrait="+PageData.user.portrait+"&props_id="+e+"&png_count="+t.options.pngCount[e],a="/tb/static-tbmall/swf/GIFMaker.swf?t=14010902",r='<embed width="150" height="150" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+i+'" allowfullscreen="true" wmode="transparent" allowscriptaccess="always" quality="high" bgcolor="#FFFFFF" src="'+a+'" type="application/x-shockwave-flash">';this.$portraitFlash.html(r),t._initUserHead();var s=this.userHead.getHeadFrameStyle(PageData.user,"150");s.hasFrame&&t.$portraitFlash.css({position:"static"});var o=t.$portraitWrap[0].outerHTML;return s.hasFrame&&(o='<div style="'+s.stylestr+'" class="head_preview_wrap">'+o+"</div>",t.hasFrame=!0),o},getHtmlFor110:function(e){this._initUserHead();var t=this.userHead,i=t.getImgFormat(e),a=["background-image: url(/tb/static-common/img/props/150/"+e+"."+i+")","background-repeat: no-repeat","background-position: center 0"],r=a.join(";");return'<a style="'+r+'" class="head_preview_wrap"><img class="j_resource_loading" src="'+t.getHeadUrl(PageData.user||{})+'"/></a>'},initFlashCallbacks:function(){window.finishMerge=function(){$("#portrait_wrap .portrait_loading").remove()}},initBuyInfo:function(e){var t=this,i=$.json.decode(e),a=PageData.user.is_login?t._buyInfoTpl(i):['<a class="ui_btn ui_btn_sub_s j_buy_button1">',"<span><em>\u5151&nbsp;&nbsp;\u6362</em></span>","</a>"].join(""),r="0"===i.props_type?t.util.convertToDay(i.time_interval):"1\u4E2A";return['<div class="j_buy_wrapper" data-field = '+e+">",'<p class="cost_info">',i.scores,"T\u8C46/",r,"</p>",a,"</div>"].join("")},_buyInfoTpl:function(e){var t=this.util.getBuyInfo(e);return t},initToBuy:function(){var e=this;$(".guide_wrap").delegate(".j_buy_button1","click",function(t){t.preventDefault();var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.use("tbmall/component/BuyController",$(this),i)})},initUse:function(){var e=this;$(".guide_wrap").delegate(".j_use","click",function(t){var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.useC.doUse($(this),i),t.preventDefault()}),$(".guide_wrap").delegate(".j_cancle_use","click",function(t){var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.useC.cancelUse($(this),i),t.preventDefault()}),$(".guide_wrap").delegate(".j_get_button1","click",function(t){e.guide.closeGuide(),e.use("tbmall/widget/getProp",$(this)),t.preventDefault()}),$(".guide_wrap").delegate(".j_tbmall_join_vip_btn","click",function(t){e.requireInstance("common/widget/JoinVipDialog",[]).getMemberDialog();var i=$(this).closest(".guide_content").find("div.j_buy_wrapper").getData();e._statClick(i),t.preventDefault()})},_statClick:function(e){switch(parseInt(e.props_category)){case 110:this._postTrack("\u5934\u50CF\u8FB9\u6846",e.props_id);break;case 109:this._postTrack("\u52A8\u6001\u5934\u50CF",e.props_id);break;case 113:this._postTrack("\u540D\u7247\u80CC\u666F",e.props_id);break;case 104:this._postTrack("\u70AB\u5F69\u5B57\u4F53",e.props_id);break;case 101:this._postTrack("\u53D1\u5E16\u6C14\u6CE1",e.props_id);break;case 103:this._postTrack("\u56FE\u7247\u6C34\u5370",e.props_id);break;case 108:this._postTrack("\u8865\u7B7E\u795E\u5668",e.props_id);break;case 117:this._postTrack("\u633D\u5C0A\u5361",e.props_id);break;case 107:this._postTrack("\u9B54\u6CD5\u5F39",e.props_id);break;case 118:this._postTrack("\u7F6E\u9876\u5361",e.props_id)}},_postTrack:function(e,t){$.stats.track(e,"\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"\u5F00\u901A\u7684\u70B9\u51FB\u91CF3",obj_id:t})}}});_.Module.define({path:"tbmall/component/BuyController",requires:["tbmall/component/captcha_payment","tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/widget/ContSignCard","tbmall/component/util","tbmall/component/HeadPreview","tbmall/component/UseController","tbmall/widget/paykey_dialog","tbmall/widget/TbeanSafe"],sub:{buy_number:0,set_pass_tpl:'<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>',buy_tpl0:'<div class="buy_tpl clearfix"> <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div></div> <div class="buy_tpl_right"><div class="price_tip">\u60A8\u9700\u8981<span class="strong_txt">#{price}</span>T\u8C46\u5151\u6362\u9053\u5177</div> #{TbeanCharge}<a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>\u786E\u8BA4\u5151\u6362</em></span></a><div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div></div></div> ',buy_tpl1:['<div class="buy_tpl buy_count_tpl clearfix">',' <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div>','</div> <div class="buy_tpl_right">','<p class="count_tip">\u60A8\u8981\u5151\u6362\u7684\u6570\u91CF</p>','<div class="count_wrap clearfix"><span class="count_number">\u6570\u91CF\uFF1A</span>','<span class="counter"><button class="j_minus minus"></button><input type="text" class="j_count" value="1"/><button class="j_plus plus"></button></span><span>\u4E2A</span>',"</div>",'<div class="count_tip count_sub_tip">\u9700\u8981T\u8C46\uFF1A<span class="t_dou_needed strong_txt">#{price}</span>\u4E2A  \u60A8\u76EE\u524DT\u8C46\uFF1A<span class="cur_t_dou">#{cur_t_dou}</span>\u4E2A</div>',"#{TbeanCharge}",'<div class="buy_and_tip"><a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>\u786E\u8BA4\u5151\u6362</em></span></a><span class="error_tip"></span></div>','<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>'," </div></div> "].join(""),initial:function(e,t){this.data=t;$.stats.track(this.data.props_id,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u70B9\u51FB\u5151\u6362"),this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util"),this.headPreview=this.use("tbmall/component/HeadPreview"),this.useController=this.use("tbmall/component/UseController"),this.isAvailable()&&this.doBuy(e),$(e).data("clicked",!1)},isAvailable:function(){var e=this.data,t=this,a=PageData.scores,s=null!=a.scores_money?parseInt(a.scores_money):0,n=null!=a.scores_other?parseInt(a.scores_other):0,i=s+n,o=Math.min(parseInt(a.scores_fetch),parseInt(t.data.fetch_scores_limit||0)),c=parseInt(i+o);return PageData.user.is_login?PageData.user.no_un?(TbCom.process("User","BuildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u53EF\u4EE5\u5728T\u8C46\u5546\u57CE\u8D2D\u7269\u5662~"),!1):c<parseInt(e.scores)?(t.dialog.dialog("<p class='dialog_content'>T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u5151\u6362\u9053\u5177\u9700\u8981<span class='charge_bean_interaction_orange_tip' >"+e.scores+"</span>T\u8C46</p><div class='charge_bean_interaction_dialog_btn_wrap'><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_charge_btn' id='j_tcharge_dialog_tbmall'>\u83B7\u53D6T\u8C46</a><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_close_dialog'>\u53D6\u6D88</a></div>"),$("#j_tcharge_dialog_tbmall").on("click",function(){var t={consumption_path:"12",desc:"\u5151\u6362\u9053\u5177",current_need_tdou:parseInt(e.scores,10)-i,is_direct_cashier:!0,is_iframe:!0};_.Module.use("common/widget/tcharge_dialog",t)}),!1):!0:(TbCom.process("User","buildLoginFrame"),!1)},bindCountEvent:function(e){var t=this,a=t._buyDialog,s=a.element.find(".j_count");a.element.on("click",".j_minus",function(){var a=parseInt(s.val())||1;a=Math.max(1,a-1),a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a);var n=Math.min(PageData.scores.scores_fetch,(t.data.fetch_scores_limit||0)*a);$(".Tbean_num").text(n),t.checkCountError()}).on("click",".j_plus",function(){var a=parseInt(s.val())||1;a++,a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a);var n=Math.min(PageData.scores.scores_fetch,(t.data.fetch_scores_limit||0)*a);$(".Tbean_num").text(n),t.checkCountError()}),s.on("input propertychange",function(){var a=/^[1-9]\d*$/,n=s.val();(n&&!a.test(n)||a.test(n)&&n>999)&&(n=n.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),n=Math.min(999,n),s.val(n)),$(".t_dou_needed").text(e*n),t.checkCountError()}).on("blur",function(){var a=s.val()&&parseInt(s.val())>0&&parseInt(s.val())||1;a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a),t.checkCountError()})},checkCountError:function(){var e=this,t=e._buyDialog,a=t.element.find(".t_dou_needed"),s=t.element.find(".error_tip"),n=t.element.find(".j_count"),i=n.val(),o=t.element.find(".j_buy_button"),c=PageData.scores,l=parseInt(c.scores_money+c.scores_other),r=Math.min(parseInt(c.scores_fetch),parseInt(e.data.fetch_scores_limit||0)),_=parseInt(l+r);return 999==i?(s.text("\u5355\u6B21\u9650\u5151999\u4E2A"),s.show()):s.hide(),_<parseInt(a.text())?(s.text("T\u8C46\u4F59\u989D\u4E0D\u8DB3"),s.show(),o.addClass("ui_btn_disable ui_btn_m_disable").removeClass("ui_btn ui_btn_sub_m j_confirm_buy"),!1):(s.hide(),o.addClass("ui_btn ui_btn_sub_m j_confirm_buy").removeClass("ui_btn_disable ui_btn_m_disable"),!0)},doBuy:function(){var e,t=this.data,a=this,s="",n="",i=parseInt(t.fetch_scores_limit,10)||0,o=PageData.scores.scores_fetch;n=0===i||0===o?"":['<div class="TbeanCharge_container">','<input id="j_charge_checked" type="checkbox" name="TbeanCharge_check" />','\u53EF\u4F7F\u7528<span class="icon_Tbean_num"></span><span class="Tbean_num">',Math.min(o,i),"</span>\u8C46\u7968\u62B5\u7528T\u8C46","</div>"].join(""),"0"==t.props_type?(PageData.user.setpass&&(a.buy_tpl0=a.buy_tpl0.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(a.buy_tpl0,{price:t.scores,price_unit:t.scores+"T\u8C46/"+a.util.convertToDay(t.time_interval),title:t.name,imgsrc:t.imgsrc,level:t.free_user_level,TbeanCharge:n}),e=480):"1"==t.props_type&&(PageData.user.setpass&&(a.buy_tpl1=a.buy_tpl1.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(a.buy_tpl1,{price:t.scores,price_unit:t.scores+"T\u8C46/1\u4E2A",title:t.name,imgsrc:t.imgsrc,cur_t_dou:PageData.scores.scores_total,level:2,TbeanCharge:n}),e=560);var c=220;PageData.user.setpass&&(c=200),a._buyDialog=new $.dialog({html:s,title:"\u5151\u6362\u9053\u5177",width:e,height:c}),PageData.user.setpass?a._buyDialog.element.find(".buy_tpl_right").append(a.util.getFreeInfo(t)):a._buyDialog.element.find(".buy_tpl_left").append(a.util.getFreeInfo(t)),"1"==t.props_type&&a.bindCountEvent(t.scores),a._buyDialog.element.one("click",".j_confirm_buy",function(){var e={props_id:t.props_id};if("1"==t.props_type&&!a.checkCountError())return a._buyDialog.element.one("click",".j_confirm_buy",arguments.callee),void 0;"1"==t.props_type&&(e.buy_num=a._buyDialog.element.find(".j_count").val()),i>0&&$("#j_charge_checked").length&&$("#j_charge_checked")[0].checked&&(e.use_fetch_scores=$(".Tbean_num").text()),$.stats.track(t.props_id,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u786E\u5B9A\u5151\u6362");var s=function(n){n&&$.extend(e,n),a.netProxy.buyProp(e,function(n){var i="",o="",c=a.use("tbmall/widget/TbeanSafe",{json:n,sucCallback:s,content:a});if(!c.needCheck()){if(0==n.no){switch(t.props_category){case"107":o='\u5728\u8D34\u5427\u8BE6\u60C5\u9875\u70B9\u51FB<img style="vertical-align:middle;" src="/tb/static-tbmall/img/magic_show_icon.png" />\u4F7F\u7528';break;case"108":"1080001"==t.props_id&&(o="\u5728\u7B7E\u5230\u9875\u9762\u4F7F\u7528");break;case"101":o="\u4F60\u53EF\u4EE5\u5728\u8FD9\u91CC\u4F7F\u7528\u4F60\u7684\u53D1\u8D34\u6C14\u6CE1";break;case"104":o="\u5728\u53D1\u8D34\u6846\u4E2D\u4F7F\u7528";break;case"105":o="\u60A8\u5DF2\u6210\u529F\u62E5\u6709\u8BE5\u52CB\u7AE0\u5BF9\u5E94\u7684\u9053\u5177\u7279\u6743\uFF0C\u5FEB\u53BB\u4F7F\u7528\u5427\uFF01";break;case"109":case"110":o="\u5728\u5F53\u524D\u9875\u9762\u4F7F\u7528";break;case"113":o="\u5728\u4E2A\u4EBA\u4E2D\u5FC3\u4F7F\u7528"}i="1"==t.props_type?"\u5151\u6362"+e.buy_num+"\u4E2A<span class='orange_txt'>"+n.data.title+"</span>\u6210\u529F\uFF01<br>"+o:"\u5151\u6362<span class='orange_txt'>"+n.data.title+"</span>\u6210\u529F\uFF01\u6709\u6548\u671F\u81F3<span class='orange_txt'>"+a.util.formatDate(n.data.end_time)+"</span><br>"+o}else switch(n.no){case 2270005:i="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:i="\u9886\u53D6\u6210\u529F`(*\u2229_\u2229*)\u2032";break;case 2270004:i="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u5151\u6362\u672C\u52CB\u7AE0\uFF01";break;case 2270006:i="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u5151\u6362";break;case 360007:case 2150040:var l=a.use("tbmall/component/captcha_payment",{data:n});return l.showCaptcha(s),void 0;case 2270018:case 1990005:case 2190005:n.data=n.data||{};var r=a.use("tbmall/widget/paykey_dialog",{showType:2,errType:n.no,errTime:n.data.wrongtime});return r.showDialog(s,function(){},a),void 0;default:i="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}0==n.no&&($.inArray(t.props_category,["109","110","114"])>-1||"1080002"==t.props_id)?a.dialog.confirm('<div class="tip">'+i+"</div>",{button:[{txt:"\u7ACB\u5373\u4F7F\u7528",extraclass:"j_nameplate_recast1",callback:function(){a.dialog.close(),"1080002"==t.props_id?a.use("tbmall/widget/ContSignCard"):"1140001"==t.props_id?$(".j_nameplate_recast").trigger("click"):a.useController.doUse(parseInt(n.data.props_id))}},{txt:"\u7A0D\u540E\u4F7F\u7528",callback:function(){a.dialog.close(),$.tb.location.reload()}}]}):0==n.no&&$.inArray(t.props_category,["101"])>-1?(a.dialog.info('<div class="tip tip_center">'+i+'</div><div class="tip_bubble_intro"></div><div class="tip_operation"><input type="checkbox" class="tip_check_box"/>\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u6C14\u6CE1</div>',{title:"\u8D2D\u4E70\u6210\u529F",width:475,height:365,button:"\u6211\u77E5\u9053\u4E86"}),a.dialog.bind("onInfoClose",function(){$(".tip_operation .tip_check_box").tbattr("checked")?$.ajax({url:"/tbmall/submit/setBub",type:"post",dataType:"json",data:{props_id:t.props_id,tbs:PageData.tbs||PageData.user.tbs},success:function(){$.tb.location.reload()},error:function(){$.tb.location.reload()}}):$.tb.location.reload()})):(a.dialog.info('<div class="tip">'+i+"</div>"),0==n.no&&a.dialog.bind("onInfoClose",function(){$.tb.location.reload()}))}})};a._buyDialog.close(),s()})}}});_.Module.define({requires:["tbmall/component/BuyController","tbmall/widget/TbeanSafeAjax","common/widget/Tdou/TdouViewPay","tbmall/widget/forumMemberDialog","common/widget/payMember"],path:"encourage/widget/celebrity_expball",sub:{resources:{expballPropsCategoryId:119,expballPropsId:1190001,buyprops:"/tbmall/post/buyprops",voteNpc:"/celebrity/submit/voteNpc"},initial:function(e){this.opt=e,this.parrProps=PageData.user.Parr_props||{},this.forum=PageData.forum||{},this.user=PageData.user||{},this.bindEvent()},bindEvent:function(){var e=$("#celebrity"),t=this;e.on("click","[j-celebrity-vote-btn]",function(){var e=$(this);if(t.checkLogin()){var l=e.tbattr("data-id");t.hasExpBall(t.parrProps)?(t.showVoteConfirmDialog(),t.dialog.element.on("click","[j-celebrity-expball-vote-use-btn]",function(){t.vote(l,1)}).on("click","[j-celebrity-expball-vote-no-use-btn]",function(){t.vote(l,0)})):t.vote(l,0)}}).on("click","[j-celebrity-expball-show]",function(){t.showExpBallDialog()})},hasExpBall:function(e){return e&&e["119"]&&e["119"]["1190001"]&&e["119"]["1190001"].left_num>0?e["119"]["1190001"].left_num:!1},vote:function(e,t){var l={id:e,use_num:t,tbs:PageData.tbs},a=this;$.post(this.resources.voteNpc,l,function(e){if(e)switch(e.no){case 0:t>0&&a.hasExpBall(this.parrProps)&&(a.parrProps["119"]["1190001"].left_num-=t),a.showVoteSuccessDialog(e.data);break;case 952710:a.showAlert("\u60A8\u672A\u5173\u6CE8\u672C\u5427");break;case 11e4:a.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:a.showAlert("\u5427\u7B49\u7EA7\u8FBE\u5230"+(e.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6");break;case 952712:a.showAlert("\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~");break;case 952713:a.showAlert("\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85");break;case 952709:a.showAlert("\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B");break;case 65534:a.showAlert("\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5");break;case 65533:a.showAlert("\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301");break;case 65532:a.showAlert("IP\u4E00\u5929\u8D85\u8FC7500");break;default:a.showAlert("\u64CD\u4F5C\u5931\u8D25,"+e.error)}})},tbmallBuy:function(e){var t={props_id:this.resources.expballPropsId,props_category:this.resources.expballPropsCategoryId,props_type:"1",scores:"1000",name:"\u53CC\u500D\u7403",imgsrc:"http://tb2.bdstatic.com/tb/static-encourage/widget/celebrity_expball/images/expball_buy_icon_552acff.jpg",free_user_level:"0",time_interval:"0",fetch_scores_limit:"0",is_default_usedd:"0"};PageData.scores=PageData.user.Parr_scores,this.requireInstance("tbmall/component/BuyController",[$(e),t])},genOrder:function(){var e=this.requireInstance("tbmall/widget/TbeanSafeAjax"),t=this,l={props_id:this.resources.expballPropsId,buy_num:1,tbs:PageData.tbs};e.post(this.resources.buyprops,l,function(e){if(0==e.no&&e.data){var l=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){e.data&&!e.data.no&&setTimeout(function(){$.tb.location.reload()},1e3)});l.createMain(e.data)}else t.showAlert("\u8BA2\u5355\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5","\u793C\u7269\u8D60\u9001"),setTimeout(function(){$.tb.location.reload()},1e3)})},showExpBallDialog:function(){var e='  <div class="celebrity-expball" >      <div class="celebrity-expball-top">          <div class="celebrity-expball-top-left"></div>          <div class="celebrity-expball-top-right" >              <h3>\u53CC\u500D\u7403\u53EF\u4EE5\u5E2E\u4F60\u7FFB\u500D\u6295\u7968\u7ECF\u9A8C\uFF01</h3>              <button class="celebrity-expball-buy-btn btn-encourage btn-large" j-celebrity-expball-buy-btn >\u53BB\u4E70\u9053\u5177</button>          </div>            </div>      <div class="celebrity-expball-bottom">          <p>\u66F4\u591A\u7FFB\u500D\u7968\u6570\u7279\u6743</p>          <p>\u672C\u5427\u4F1A\u5458\uFF1A\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2; <a href="javascript:;" j-celebrity-expball-local-vip >\u5F00\u901A>> </a><p>          <p>\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\uFF1A\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+3\u3002<a  href="javascript:;" j-celebrity-expball-super-vip >\u5F00\u901A>> </a><p>       </div>        <div>';this.showDialog(e);var t=this;t.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){t.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){var e={scores_money:0,scores_other:0};t.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:t.forum.forum_id,current_forum_name:t.forum.forum_name,scores:t.user.Parr_scores?t.user.Parr_scores:e,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}})}).on("click","[j-celebrity-expball-super-vip]",function(){var e=t.requireInstance("common/widget/payMember"),l={fr:"celebrity"};e.showCashier(l)})},showVoteSuccessDialog:function(e){e.left_vote_times=e.left_vote_times?e.left_vote_times:-1;var t='  <div class="celebrity-expball" >      <div class="celebrity-expball-top">          <div class="celebrity-expball-vote">              <h3><i class="celebrity-expball-vote-icon"></i>\u6295\u7968\u6210\u529F\uFF0C<span class="orange-text">\u540D\u4EBA\u7968\u6570+<%=add_vote_num %></span></h3>              <% if (left_vote_times != -1) { %>              <p class="celebrity-expball-vote-tip" >\u4ECA\u65E5\u8FD8\u5269<a><%=left_vote_times %></a>\u6B21\u6295\u7968\u673A\u4F1A</p>              <% } %>          </div>                </div>      <div class="celebrity-expball-bottom">          <p>\u7FFB\u500D\u7968\u6570\u7279\u6743</p>          <ul class="celebrity-expball-bottom-list">              <li>                  <span>\u53CC\u500D\u7403</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570*2 <a href="javascript:;" j-celebrity-expball-buy-btn >\u53BB\u8D2D\u4E70>> </a></span>              </li>              <li>                  <span>\u672C\u5427\u4F1A\u5458</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2 <a  href="javascript:;" j-celebrity-expball-local-vip >\u5F00\u901A>> </a></span>              </li>              <li>                  <span>\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+3 <a  href="javascript:;" j-celebrity-expball-super-vip >\u5F00\u901A>> </a></span>              </li>                    </ul>      </div>        <div>';this.showDialog(_.template(t)(e));var l=this;l.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){l.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){var e={scores_money:0,scores_other:0};l.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:l.forum.forum_id,current_forum_name:l.forum.forum_name,scores:l.user.Parr_scores?l.user.Parr_scores:e,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}})}).on("click","[j-celebrity-expball-super-vip]",function(){var e=l.requireInstance("common/widget/payMember"),t={fr:"celebrity"};e.showCashier(t)})},showVoteConfirmDialog:function(){var e='<div class="celebrity-expball" >      <div class="celebrity-expball-vote">          <h3>\u53CC\u500D\u7403\u53EF\u4EE5\u5E2E\u4F60\u7FFB\u500D\u7968\u6570\u54E6!</h3>          <div class="celebrity-expball-vote-confirm-btn-wrapper">              <button class="btn-default celebrity-expball-vote-confirm-btn btn-middle" j-celebrity-expball-vote-use-btn>\u4F7F\u7528\u9053\u5177(\u8FD8\u5269<%=left_num %>\u4E2A)</button>              <button class="btn-sub celebrity-expball-vote-confirm-btn btn-middle"  j-celebrity-expball-vote-no-use-btn>\u76F4\u63A5\u6295\u7968</button>          </div>      </div>  <div>';this.showDialog(_.template(e)({left_num:this.hasExpBall(this.parrProps)}))},showAlert:function(e){$.dialog.alert(e,{title:"\u8D34\u5427\u63D0\u793A",acceptValue:"\u77E5\u9053\u5566",onaccept:function(){return!0}})},showDialog:function(e,t){this.dialog&&(this.dialog.close(),this.dialog=null),this.dialog=new $.dialog({title:t,html:e,width:430})},checkLogin:function(){return PageData.user.is_login?!0:(this.requireInstanceAsync("common/widget/LoginDialog"),!1)}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"puser/widget/celebrity",requires:["pcommon/widget/Tdou/TdouViewPay","tbmall/widget/forumMemberDialog","encourage/widget/npc_vote/npc_vote_action","tbmall/widget/exp_package_dialog","puser/widget/celebrity_forum_dialog"],sub:{initial:function(e){this.$root=$("#celebrity"),this.forum=PageData.forum,this.user=PageData.user,this.opt=e,this.isCelebrityForum=e.isCelebrityForum||!1,this.isCurForumMember=e.isCurForumMember||!1,this._bindEvents()},purchaseExp:function(e){var o=this,r={open_id:e.open_id,order_id:e.order_id,timestamp:e.timestamp,scene_id:e.scene_id,pay_type:e.pay_type,from:"\u5355\u5427\u4F1A\u5458\u7ECF\u9A8C\u4E66",goods_name:e.goods_name,goods_image:e.goods_image||"",goods_price:e.goods_price,goods_amount:e.goods_amount,goods_unit:"\u4E2A",goods_duration:e.goods_duration,free_vip_level:e.free_vip_level,tdou_num:e.tdou_num};$.extend(r,{chargeType:"platform"}),o.payment=o.requireInstance("pcommon/widget/Tdou/TdouViewPay",function(e){"encourage_paid"!=e.command||"success"!=$.getPageData("data.error","error",e)}),o.payment.createMain(r)},_bindEvents:function(){var e=this;this.$root.find(".j-gift-buy").on("click",function(){var o={scores_money:0,scores_other:0};e.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:e.forum.forum_id,current_forum_name:e.forum.forum_name,scores:e.user.Parr_scores?e.user.Parr_scores:o,cnt_height:225,is_celebrity_forum:e.isCelebrityForum,isCurForumMember:e.isCurForumMember,callback:function(){$.tb.location.reload()}})}),this.$root.on("click",".open-btn",function(){e.$root.find(".first-show-container").hide(),e.$root.find(".second-show-container").show()}),this.$root.on("click",".close-btn",function(){e.$root.find(".first-show-container").show(),e.$root.find(".second-show-container").hide()}),this.requireInstance("encourage/widget/npc_vote/npc_vote_action",{$root:e.$root}),this.$root.on("click",".celebrity-purchase-exp",function(){if(!$.getPageData("user.is_login",0))return e.requireInstanceAsync("pcommon/widget/LoginDialog",["","userBar"]),void 0;var o={scores_money:0,scores_other:0};e.requireInstance("tbmall/widget/exp_package_dialog",[{is_show_features:!1,is_show_forum:!1,current_forum_id:e.forum.id,current_forum_name:e.forum.name,scores:e.user.Parr_scores?e.user.Parr_scores:o,cnt_height:225,is_celebrity_forum:e.isCelebrityForum,isCurForumMember:e.isCurForumMember,callback:function(){$.tb.location.reload()}}])}),this.requireInstance("puser/widget/celebrity_forum_dialog",{$root:e.$root.find(".j-btn-celebrity"),celebrity:e.opt.celebrity,memberLastDays:e.opt.memberLastDays})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"pcommon/widget/Tdou/TdouViewPay",requires:["pcommon/widget/Tdou/TdouBuilder","pcommon/widget/Tdou/TdouData","pcommon/widget/Tdou/TdouViewUtil","pcommon/widget/Tdou/TdouViewAutoRedirect","pcommon/widget/Tdou/TdouViewOperationBootstrap","pcommon/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("pcommon/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("pcommon/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("pcommon/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("pcommon/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this,o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("pcommon/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("pcommon/widget/payMember"),t={fr:"open_super_member_link"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("pcommon/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"encourage/widget/npc_vote/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7B49\u7EA7\u8FBE\u5230"+(a.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6"});break;case 952712:e._alert({msg:"\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~"});break;case 952713:e._alert({msg:"\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85"});break;case 952709:e._alert({msg:"\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B"});break;case 65534:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5"});break;case 65533:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301"});break;case 65532:e._alert({msg:"IP\u4E00\u5929\u8D85\u8FC7500"});break;default:$.dialog.alert(a.error,{title:"\u63D0\u793A"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529F</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67E5\u770B\u699C\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53D6 \u6D88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786E \u8BA4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63D0\u793A",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672A\u5173\u6CE8\u672C\u5427\u4E0D\u80FD\u6295\u7968\u54E6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53BB\u5173\u6CE8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63D0\u793A",draggable:!1})}}});_.Module.define({path:"pcommon/widget/umoney_query",sub:{url:{queryCredit:"/tbapp/umoney/queryUserInfo",queryQualification:"/tbapp/umoney/queryQualification"},query_umoney_cls:".j-query-umoney",umoneyInfoStatus:{s1:"\u672A\u7533\u8BF7",s2:"\u5BA1\u6838\u4E2D",s3:"\u6B63\u5E38",s4:"\u903E\u671F",s5:"\u51BB\u7ED3",s6:"\u5931\u8D25"},initial:function(){var e=this;e.$element=$(".tdou-umoney-query")},showUmoney:function(e){var n=this,t=$.tb.format('<div class="tdou-umoney-query">          <span class="umoney-user">              #{displayText}:              <a class="j-query-umoney " href="javascript:void(0);"                 title="\u67E5\u770B\u6709\u94B1\u989D\u5EA6"                 locate="userinfo#\u767E\u5EA6\u6709\u94B1">                  \u67E5\u770B              </a>          </span>          <span class="umoney-placeholder">              <a target="_blank" href="/f?ie=utf-8&kw=\u767E\u5EA6\u6709\u94B1\u6D88\u8D39\u91D1\u878D"                 locate="userinfo#\u767E\u5EA6\u6709\u94B1">                  \u767E\u5EA6\u6709\u94B1\u9001T\u8C46              </a>          </span>  </div>',{displayText:e||"\u767E\u5EA6\u6709\u94B1\u989D\u5EA6"});return n.getUmoneyDom(t)},showUmoneyOnGotTdou:function(){var e=this,n='<div class="tdou-umoney-query umoney-query-get-tdou">      <span class="umoney-placeholder">\u63D0\u9192\uFF1A\u60A8\u5728 pc\u53CA\u5B89\u5353\u4E0A\u83B7\u53D6\u7684T\u8C46\u4E0E\u5728ios\u4E0A\u83B7\u53D6\u7684T\u8C46\u4E0D\u901A\u7528\u3002</span>  </div>',t=e.getUmoneyDom(n);return t},showUmoneyMember:function(){var e=this,n='<div class="tdou-umoney-query tshow-tdou-umoney-query">      <a  target="_blank" href="/f?ie=utf-8&kw=\u767E\u5EA6\u6709\u94B1\u6D88\u8D39\u91D1\u878D" locate="tshow-bar#\u767E\u5EA6\u6709\u94B1">          <span class="umoney-logo"></span>\u4F7F\u7528\u767E\u5EA6\u6709\u94B1\u8D2D\u4E70\u8D34\u5427\u4F1A\u5458\u4F18\u60E0          <span class="vip-red vip-discount">5%</span>      </a>  </div>';return e.$element=$(n),e.$element},getUmoneyDom:function(e){var n=this;return this.$element=$(e),n.isUmoneyUser(),n.$element},bindEvents:function(){var e=this;e.$element.on("click",e.query_umoney_cls,function(){e.queryUmoneyCredit()})},queryUmoneyCredit:function(){var e=this;e._queryUmoneyCredit&&e._queryUmoneyCredit.abort(),e._queryUmoneyCredit=$.ajax({type:"GET",url:e.url.queryCredit,data:{},cache:!1,dataType:"json"}).success(function(n){if(e._queryUmoneyCredit=null,0==n.no){var t=n.data&&n.data.data;e.showCredit(t)}})},isUmoneyUser:function(){var e=this;e._isUmoneyUser&&e._isUmoneyUser.abort(),e._isUmoneyUser=$.ajax({type:"GET",url:e.url.queryCredit,data:{},cache:!1,dataType:"json"}).success(function(n){if(e._isUmoneyUser=null,0==n.no){var t=n.data&&n.data.data.status;"1"!=t&&(e.$element.find(".umoney-placeholder").end().find(".umoney-user").show(),e.bindEvents())}else e.$element.find(".umoney-user").hide().end().find(".umoney-placeholder").show()})},showCredit:function(e){if(e){var n=this,t="";if(3===e.status){var o=e.credit||0;t=o+"\u5143 "}else t=n.umoneyInfoStatus["s"+e.status];var a=t+",\u70B9\u51FB\u5237\u65B0";n.$element.find(n.query_umoney_cls).html(t).addClass("umoney-credit").tbattr("title",a)}},track:function(e,n){$.stats.track(e,"umoney-query",PageData.product+"-"+n,"click")}}});_.Module.define({path:"pcommon/widget/qianbaoPurchaseTdou",requires:["pcommon/widget/qianbaoCashierDialog","pcommon/widget/baseUserData","pcommon/widget/baseDialogUserBar"],sub:{$root:null,tryOptions:null,payOptions:null,initial:function(){var a=this;a.cashierDialog=a.requireInstance("pcommon/widget/qianbaoCashierDialog"),a.baseData=a.requireInstance("pcommon/widget/baseUserData"),a.baseDialogUserBar=this.requireInstance("pcommon/widget/baseDialogUserBar"),a.cashierDialog.bind("event_tdou_qianbao_pay_again",a.payAgain,a)},payAgain:function(){var a=this;a._buy_icon_ajax&&a._buy_icon_ajax.abort(),a._buy_icon_ajax=$.ajax({type:"get",url:"/tbmall/getPayUrl",data:a.tryOptions,cache:!1,dataType:"json"}).success(function(o){var i=o.data;a.payOptions.qianbao_params=i.return_url,a.payOptions.iconCount=i.iconCount,a.payOptions.iconId=i.iconId,a.showDialog(a.payOptions,a.tryOptions)})},showDialog:function(a,o){var i=this;i.tryOptions=o,i.payOptions=a,i.product=a.product||"tdou";var n=a.iconId||"suiji",s=a.iconCount||1,t={};i.getIconInfo(function(o){var e=o.data;for(var c in e)e[c].iconId==n&&(t={iconId:n,iconCount:s,iconImg:e[c].picUrl,memeberTdou:parseInt(1.05*s*e[c].non_member_t),tdou:s*e[c].non_member_t,name:e[c].name,qianbao_params:a.qianbao_params},t.pay_tdou=2==i.baseData.getMemberLevel()?t.memeberTdou:t.tdou);i.showIcon(t)},i)},showIcon:function(a){var o=this,i=a.qianbao_params||"",n=$.extend(a,{baseDialogUserBarTpl:o.baseDialogUserBar.getUserBarTemplate()}),s=$.tb.format('<!-- htmlcs-disable -->  <div class="qianbao_cashier_purchase_tdou ">      #{baseDialogUserBarTpl}      <div class="qianbao_cashier_goods">          <div class="order_info clearfix" style="display: block;">              <label class="title order_label">\u5546\u54C1\u8BA2\u5355\uFF1A</label>              <section class="order_desc clearfix">                  \u672C\u6B21\u83B7\u53D6<span class="tdou_num">#{pay_tdou}</span>T\u8C46\uFF0C\u9700\u8981\u8D2D\u4E70\u4EE5\u4E0B\u5370\u8BB0\u6765\u5B8C\u6210              </section>          </div>          <div class="goods_list">              <label class="title goods_title">\u8D2D\u4E70\u5546\u54C1\uFF1A</label>                <div class="icon_item">                  <div class="icon_img_box"><img class="icon_img" src="#{iconImg}">                  </div>                  <div class="icon_desc">                      <div class="icon_info" data-id="#{iconId}" data-price="1000" data-amount="110000">                          <p>#{name}<span id="iconCount">#{iconCount}</span>\u4E2A<span class="expire_date">\uFF08\u6709\u6548\u671F\uFF1A<span class="day">#{iconCount}</span>\u5929\uFF09</span></p>                            <p><span class="tdou_text">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\u83B7\u8D60<span class="mtdnum">#{memeberTdou}</span>T\u8C46</span></p>                            <p><span class="tdou_text">\u975E\u4F1A\u5458\u83B7\u8D60<span class="orange">#{tdou}</span>T\u8C46</span></p>                      </div>                  </div>              </div>          </div>      </div>  </div>  ',n),t={qianbao_params:i,product:o.product};o.cashierDialog.showDialog(t,s,function(a){o.$root=a,o.bindEvents()})},bindEvents:function(){var a=this;a.$root.find(".j_header_close").on("click",function(){a.cashierDialog.closeDialog()})},getIconInfo:function(a,o){var i=this,n={ie:"utf-8"};n.tbs=PageData.tbs,i._get_icon_ajax&&i._get_icon_ajax.abort(),i._get_icon_ajax=$.ajax({type:"get",url:"/tbmall/gettdouiconinfo",data:n,cache:!1,dataType:"json"}).success(function(i){a.call(o,i)})}}});_.Module.define({path:"pcommon/widget/umoney",requires:[],sub:{$root:null,actionType:{closeCashier:"CLOSE_CASHIER",openCashier:"OPEN_CASHIER",closePayment:"CLOSE_PAYMENT",openPayment:"OPEN_PAYMENT"},initial:function(){},getMainUIDom:function(e){if(e){var t=e.isMember;if(!t){var n=e.isGoodsFreeForMember,a=e.isRecharge,o=e.isConsumption,i=this,r="",s=0;switch(e.actionType){case i.actionType.closeCashier:s=i.getCountOneDay(i.actionType.closeCashier),n&&1==s&&(r=i.geTtplWhenClosePay());break;case i.actionType.openCashier:s=i.getCountOneDay(i.actionType.openCashier),n||(a||1!=s)&&(o||2!=s)||(r=i.geTtplWhenOpenCashier());break;case i.actionType.closePayment:s=i.getCountOneDay(i.actionType.closePayment),n&&2==s&&(r=i.geTtplWhenClosePay());break;case i.actionType.openPayment:}return r&&(i.$root=$(r),i.bindEvents(),i.track("show")),i.$root}}},bindEvents:function(){var e=this;e.$root.on("click",".try-use-btn",function(){e.track("try-btn"),e.trigger("closeDialogEvent")}).on("click",".dont-use-btn",function(){e.track("dont-btn"),e.trigger("closeDialogEvent")})},geTtplWhenOpenCashier:function(){var e='<div class="umoney-wrap "><div class="text">\u6B64\u5546\u54C1\u53EF\u901A\u8FC7\u767E\u5EA6\u6709\u94B1\u63D0\u4F9B\u7684<div>\u2014\u2014\u5148\u4F7F\u7528\u540E\u4ED8\u6B3E\uFF01\u670D\u52A1\u83B7\u53D6</div></div><div class="btn-wrap open-cashier-btn-wrap"><button class="btn-default  btn-larger dont-use-btn">\u4E0D\u9700\u8981\u6B64\u670D\u52A1</button><a target="_blank" href="/f?ie=utf-8&kw=\u767E\u5EA6\u6709\u94B1\u6D88\u8D39\u91D1\u878D" class="btn-attention  btn-larger try-use-btn">\u4F53\u9A8C\u5C1D\u8BD5</a></div></div>';return e},geTtplWhenClosePay:function(){var e='<div class="umoney-wrap"><div class="text">\u6B64\u5546\u54C1\u53EF\u901A\u8FC7\u767E\u5EA6\u6709\u94B1\u63D0\u4F9B\u7684<div>\u2014\u2014\u5148\u4F7F\u7528\u540E\u4ED8\u6B3E\uFF01\u670D\u52A1\u83B7\u53D6</div></div><div class="btn-wrap  close-payment-btn-wrap"><a  target="_blank" href="/f?ie=utf-8&kw=\u767E\u5EA6\u6709\u94B1\u6D88\u8D39\u91D1\u878D" class="btn-attention  btn-larger try-use-btn">\u4F53\u9A8C\u5C1D\u8BD5</a></div></div>';return e},getCountOneDay:function(e){if(e){var t="TB-UMONEY-COUNTER-"+e,n=$.tb.Storage.get(t),a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59);return n?(n=parseInt(n),n++):n=1,$.tb.Storage.set(t,n,o),n}},track:function(e){$.stats.track(e,"umoney-payment",PageData.product,"click")}}});_.Module.define({path:"pcommon/widget/Tdou",requires:["pcommon/widget/Tdou/TdouView","pcommon/widget/Tdou/TdouViewAutoRedirect"],sub:{initial:function(){this.view=this.requireInstance("pcommon/widget/Tdou/TdouView"),this.autoDirect=this.requireInstance("pcommon/widget/Tdou/TdouViewAutoRedirect")},factory:function(e,t){var o="",i="",d=0;switch(e){case"get_icon":t&&(o=t.consumption_path,i=t.desc,d=t.current_need_tdou),this.view.createMain(o,i,d);break;case"auto_direct":var u={consumption_path:t.consumption_path,title:t.desc,need_tdou:t.current_need_tdou,goods_cost_tdou:t.goods_cost_tdou||0,pay_type:t.pay_type,tbs:t.tbs,order_id:t.order_id,is_dialog:t.is_iframe};this.autoDirect.createMain(u)}}}});_.Module.define({path:"pcommon/widget/tchargeDialog",requires:["pcommon/widget/Tdou","pcommon/widget/payMember"],sub:{initial:function(e){var t=this;e&&(t.consumption_path=e.consumption_path,t.desc=e.desc,t.desc=e.desc,t.current_need_tdou=e.current_need_tdou,t.is_direct_cashier=e.is_direct_cashier);var i=this.use("pcommon/widget/Tdou");e&&t.is_direct_cashier?i.factory("auto_direct",t.consumption_path,t.desc,t.current_need_tdou):i.factory("get_icon",t.consumption_path)},_tbmallCashier:function(){var e=this.requireInstance("pcommon/widget/payMember"),t={fr:"tcharge_dialog"};e.showCashier(t)}}});_.Module.define({path:"puser/widget/LikeTip",sub:{initial:function(e,s,i){var t=this,a="http://tb2.bdstatic.com/tb/static-puser/widget/like_tip/img/like_back_58420c2.png";if(i&&i.like_no&&i.like_no>=1){var r=$.dialog.alert('<img src="'+a+'" alt="\u6B22\u8FCE\u56DE\u6765" />',{width:320,height:131,acceptValue:"\u77E5\u9053\u4E86"});$(r.element[0]).find(".dialogJcontent").css("padding-bottom","0px"),$(r.element[0]).find(".dialogJanswers").css("padding-top","0px"),r.bind("onaccept",function(){t.reloadAndGotop()}).bind("onclose",function(){t.reloadAndGotop()})}else{var l=this.getTipContent(e,s,i),n={title:"\u6210\u529F\u63D0\u793A",width:418,modal:!e};this.isSuperMember()&&(n.width=535);var r=$.dialog.open(l,n);e&&$(r.element[0]).css("padding","2px"),$(r.element[0]).find(".dialogJcontent").tbattr("id","balv_first_like_dialog"),$(r.element[0]).find(".userlike_tip_span a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=entryimallinpop")}),$(r.element[0]).find(".lvlup_pop_btn").eq(0).bind("click",function(){t.reloadAndGotop()}),$(r.element[0]).on("click",".userlike_supermember_btn",function(){window.open("/tbmall/mall/forumMember"),t.reloadAndGotop()}),r.bind("onclose",function(){t.reloadAndGotop()})}},getTipContent:function(e,s,i){var t=PageData,a=t.user.level_id?t.user:t.user.balv,r="<span>";e&&(r+=e+"\uFF0C"),r+="\u606D\u559C\u4F60\u6210\u4E3A\u672C\u5427\u7B2C</span>",r+="<span class='tip_font_orange'>"+i.index+"</span>",r+="<span>\u4F4D\u4F1A\u5458</span>";var l="";l+='<div class="userlike_tip_join" id="userlike_tip_join">',l+='<div class="userlike_tip_info" id="userlike_tip_info">'+r+"</div>",e?l+='<div class="user_rights_msg"><span class="user_rights_msg_gray">\u83B7\u5F97\u5934\u8854&nbsp;</span><img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+a.level_name+'<span class="user_rights_msg_gray">&nbsp;\u5347\u7EA7\u4EAB\u7279\u6743\uFF0C<span><a class="user_rights_msg_link" target="_blank" href="/f/like/level?kw='+t.forum.name_url+'">\u67E5\u770B\u4F1A\u5458\u6743\u5229</a></div>':1==a.level_id?l+='<div class="user_rights_msg">\u83B7\u5F97\u5934\u8854&nbsp;<img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+a.level_name+'\uFF0C\u5347\u7EA7\u4EAB\u7279\u6743\uFF0C<a target="_blank" href="/f/like/level?kw='+t.forum.name_url+'">\u67E5\u770B\u5347\u7EA7\u79D8\u7C4D</a></div>':(l+='<div class="user_rights_msg">\u6839\u636E\u4F60\u5728\u672C\u5427\u7684\u6D3B\u8DC3\u8868\u73B0\uFF0C\u76F4\u63A5\u6388\u4E88<img src="http://tb2.bdstatic.com/tb/static-member/img/badges/'+a.level_id+'.png">&nbsp;'+a.level_name+"\uFF0C\u7ED9\u529B\uFF01</div>",l+='<div class="userlike_tip_span">\u672C\u5427\u767E\u5B9D\u7BB1\u5BF9\u4F60\u5F00\u653E\u4E86\uFF0C<a target="_blank" href="/imall/mall?kw='+t.forum.name_url+'">\u53BB\u767E\u5B9D\u7BB1\u770B\u770B\u6709\u54EA\u4E9B\u7279\u6743\u548C\u5B9D\u8D1D</a></div>'),this.isSuperMember()&&(l+=this.getSuperMemberHtml()),l+='<div class="lvlup_tip_btnzone">';var n="";return this.isSuperMember()&&(l+='<input class="userlike_supermember_btn userlike_sm_btn_style" type="button" value="\u8BE6\u7EC6\u4E86\u89E3\u7279\u6743"/>',n="userlike_sm_btn_style"),l+='<input class="lvlup_pop_btn '+n+'" type="button" value="\u77E5\u9053\u4E86"/>',e&&(l+='<a class="userlike_tip_cancel" target="_blank" href="/home/forum?id='+t.user.portrait+"&fr="+t.product+'">\u5982\u4F55\u53D6\u6D88\u4F1A\u5458</a>'),l+="</div></div>"},reloadAndGotop:function(){$.tb.location.setHref($.tb.location.getHref().split("#")[0])},getSuperMemberHtml:function(){var e=[],s=PageData.user?PageData.user.Parr_props?PageData.user.Parr_props.level?PageData.user.Parr_props.level:{}:{}:{},i=PageData.forum.name||PageData.forum.forum_name;return e.push('<div class="userlike_supermember">'),e.push('<div class="userlike_sm_up clearfix">'),e.push('<div class="userlike_sm_up_gift"></div>'),e.push('<div class="userlike_sm_up_info">'),e.push('<h3>\u5C0A\u8D35\u7684<span class="userlike_sm_up_icon">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458</span></h3>'),e.push("<h2>\u60A8\u5DF2\u6210\u529F\u83B7\u5F97<b>\u3010"+i+"\u5427\u7279\u6743\u5305\u3011</b></h2>"),e.push("<p>\u6709\u6548\u671F\u81F3"+this.getFormatZhTime(1e3*s.end_time)+"</p>"),e.push("</div>"),e.push("</div>"),e.push('<div class="userlike_sm_down clearfix">'),e.push('<div class="userlike_sm_down_item">'),e.push('<div class="userlike_sm_down_title">\u7EA2\u8272\u6807\u9898</div>'),e.push('<div class="userlike_sm_down_pic userlike_sm_down_pic_1"></div>'),e.push("</div>"),e.push('<div class="userlike_sm_down_item">'),e.push('<div class="userlike_sm_down_title">\u7ECF\u9A8C\u52A0\u901F</div>'),e.push('<div class="userlike_sm_down_pic userlike_sm_down_pic_2"></div>'),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.join("")},isSuperMember:function(){var e=PageUnit.load("like_tip_svip_black_list");if(e)return!1;var s=PageData.user?PageData.user.Parr_props?PageData.user.Parr_props.level?PageData.user.Parr_props.level:{}:{}:{};return 1e3*s.end_time>1*new Date&&2===s.props_id&&!PageData.forum.is_star},getFormatZhTime:function(e){return"number"!=typeof e?"":(e=new Date(e),[e.getFullYear()+"\u5E74",parseInt(e.getMonth()+1)+"\u6708",e.getDate()+"\u65E5"].join(""))}}});_.Module.define({path:"puser/widget/myCurrentForum",requires:["tbmall/widget/forumMemberDialog"],sub:{initial:function(){this.user=PageData.user,this.forum=PageData.forum,this.bindEvents()},bindEvents:function(){$(".user_level .badge, .user_level .badge_block").bind("click",function(){return window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_intro"),!1}),$(".user_level .exp_bar").bind("click",function(){return window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_who"),!1})}}});_.Module.define({path:"puser/widget/tbSpam",requires:[],sub:{initial:function(){$("body").append($("#tb_spam_notice_html").html())}}});_.Module.define({path:"puser/widget/myTieba",requires:["pcommon/widget/wallet_dialog","pcommon/widget/Card","pcommon/widget/tcharge_dialog"],sub:{config:{url:{dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete",closetip:"/f/like/commit/notice/delete"}},initial:function(e){var i=this,t=e||{};i.user=PageData.user,i.forum=PageData.forum,i.balvInfo=t.balvInfo,i.style=t.style||"",i.isBySys=t.isBySys||!0,i.scoreTip=null,i.daysTofree=0,i.block_bubble=null,i.product=t.product||null},init:function(){var e=this;e.user.forbidden?e.daysTofree=e.user.forbidden.days_to_free:e.user.balv&&(e.daysTofree=e.user.balv.days_tofree),-1!=$.inArray(e.product,["frs","pb"])&&(_.Module.use("ueglibs/widget/Ban",[],function(i){e.BanLib=i}),this.user.is_login&&e.showOfflineCard()),this.user.is_login&&(this.bindEvents(),$(".user_profile .sign_highlight").length>0&&this.show_orange_tip(),this.showNewpropsTip()),this.dolikeEvent()},showOfflineCard:function(){var e=this,i=1*new Date;i>1408032e6||$.tb.Storage.get("balv_tdou_update")>i||(this.offline_card=this.use("pcommon/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="http://tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"left",card_css:{width:172,"z-index":1010,left:198,top:9},arrow_pos:{left:-7,top:20},wrap:$(".user_profile"),card_leave_display:!0}),this.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("balv_tdou_update",i+864e5),e.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("balv_tdou_update",i+864e5),e.offline_card._j_card.remove()}),this.offline_card.showCard())},bindEvents:function(){var e=this;$("#user_info").on("click",".j_score_num",function(i){i.preventDefault(),e.getInstance("pcommon/widget/wallet_dialog").show()}),$(".userliked_ban_content").on("click.bawuAppealLink",".j_appealLink",function(){$.stats.track("balvAppealLink","uegCount","bawuAppeal","click")}),$(".userlike_blacked").bind("mouseover",function(){e.show_black_tip($(this))}),$(".userlike_prisoned").bind("mouseover",function(){e.daysTofree>0&&e.daysTofree<360?e.show_shortblock_tip($(this),e.daysTofree,e.isBySys?"\u7CFB\u7EDF":"\u5427\u4E3B",e.isBySys?"system":"bawu"):e.show_block_tip($(this))}),$("body").delegate(".tbmall_tip_close","click",function(){return $("#tbmall_tip_card").remove(),e.tbmallTip=null,$.cookie("close_tbmall_tip","1",{expires:365}),!1}),$("#j_tcharge_dialog").on("click",function(){e.use("pcommon/widget/tcharge_dialog")}),(this.user.balv&&this.user.balv.has_liked||this.user.is_like)&&(PageData.is_ipad?$("a.p_balv_btnmanager").show():$(".balv_mod").hover(function(){$(".p_balv_btnmanager").show()},function(){$(".p_balv_btnmanager").hide()}))},dolikeEvent:function(){var e=this;$(".balv_dolike_comforum,.balv_dolike_star").bind("click",function(){return e.user.is_login?e.user.balv&&e.user.balv.is_block||e.user.forbidden&&e.user.forbidden.isForbid?e.showAlert(e.BanLib.render("balvLike")):e.user.balv&&e.user.balv.is_black||e.user.is_black?e.showAlert("\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u672C\u5427\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C"):e.dolike():_.Module.use("pcommon/widget/LoginDialog",["","ilike"]),!1})},showAlert:function(e){var i='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+e+"</div>";$.dialog.open(i,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},howtojoin:function(){$.dialog.alert("<div style='padding:20px;line-height:30px;padding-bottom:0px;'>\u70B9\u51FB\u53F3\u4FA7\u4E0A\u65B9\u201C<img align='absmiddle' src='"+PageData.staticDomain+"tb/static-member/img/whatlevel.png'></img>\u201D<br/>\u5373\u53EF\u52A0\u5165\u672C\u5427\uFF0C\u70B9\u4EAE\u5934\u8854\uFF0C\u4ECE\u521D\u7EA7\u7C89\u4E1D\u5F00\u59CB\u6210\u957F\uFF01</div>",{title:"\u5982\u4F55\u52A0\u5165",width:325})},dolike:function(){var e=this;if(this.user.is_login&&this.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u5173\u6CE8\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var i={fid:this.forum.forum_id,fname:this.forum.forum_name,uid:this.user.name_url,ie:"gbk",tbs:PageData.tbs};$.post(this.config.url.dolike,i,function(i){if(i&&0==i.no)_.Module.use("puser/widget/LikeTip",["",!1,{index:i.data.ret.index,like_no:i.like_no}]);else{var t="";t=8==i.no||9==i.no?e.BanLib.render("balvLike"):220==i.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==i.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",e.showAlert(t)}},"json")},undolike:function(){var e={fid:this.forum.forum_id,fname:this.forum.name_url,uid:this.user.name_url,ie:"utf-8",tbs:PageData.tbs};$.tb.post(this.config.url.undolike,e,function(e){e&&0==e.no&&$.tb.location.reload(!0)})},show_shortblock_tip:function(e){this.block_render(e,this.BanLib.render("balvAside"))},show_block_tip:function(e){this.block_render(e,this.BanLib.render("balvAside"))},show_black_tip:function(e){var i=new Array;i.push("<div style='width:180px;text-align:left;margin:6px 0px 6px 10px;'>"),i.push("<span>\u4F60\u5DF2\u88AB\u5427\u4E3B\u62C9\u5165\u9ED1\u540D\u5355\uFF0C</span></br><span>\u4F60\u5728\u672C\u5427\u7684\u5934\u8854\u548C\u6743\u9650\u4E5F\u88AB\u6536\u56DE\u3002</span>"),i.push("</div>"),this.block_render(e,i.join(""))},show_lvup_tip:function(e,i){var t=this,o=new Array;if(o.push("<div class='lvup_tip_container'>"),o.push("<div class='lvlup_con_msg'>\u5347\u7EA7\u5566!\u4F60\u5DF2\u62E5\u6709\u672C\u5427"+e+"\u7EA7\u5934\u8854!</div>"),o.push('<div class="lvlup_pop_rights">'+i+"</div>"),"\u52A0\u6CB9~\u7EE7\u7EED\u6512\u7ECF\u9A8C\uFF01"==i)o.push("<a style='float:left;' href='/f/like/level?kw="+this.forum.name_url+"' target='_blank'>\u67E5\u770B\u5347\u7EA7\u79D8\u7B08</a>");else{var s='Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=balvupguide&lv='+e+'")';o.push("<a href='#sub' style='float:left;' onclick='rich_postor.jumpToTry("+e+");"+s+"'>\u73B0\u5728\u53BB\u8BD5\u8BD5~~</a>")}o.push("</div>");var l=o.join(""),n={content:l,arrow_dir:"up",bubble_css:{top:4,right:-5,width:232,"z-index":9999},arrow_pos:{left:209},attr:"lvup_tip_table",wrap:$("#userlike_info_tip"),closeBtn:!0},r=new UiBubbleTipBase(n);r.j_bubble.find(".j_content").css("padding","2px").addClass("lvup_tip_table"),r.showBubble(),r.bind("onclose",function(){t.close_lvup_tip()},!0),this.user.is_block||setTimeout(function(){r.closeBubble(),t.close_lvup_tip()},8e3)},block_render:function(e,i){if(!this.block_bubble){var t=this,o={content:i,arrow_dir:"up",bubble_css:{top:36,right:4,width:232,"z-index":9999},arrow_pos:{left:209},attr:"",wrap:e,closeBtn:!0};this.block_bubble=new UiBubbleTipBase(o),this.block_bubble.j_bubble.find(".j_content").css("padding","2px"),this.block_bubble.showBubble(),this.block_bubble.bind("onclose",function(){t.block_bubble.closeBubble(),t.block_bubble=null});{setTimeout(function(){t.block_bubble&&(t.block_bubble.closeBubble(),t.block_bubble=null)},5e3)}}},close_lvup_tip:function(){var e={fid:this.forum.forum_id,fname:this.forum.name_url,uid:this.user.name_url,ie:"utf-8",tbs:PageData.tbs,type:2};$.tb.post(this.config.url.closetip,e,function(e){e&&0==e.no})},show_orange_tip:function(){if("false"!=$.cookie("close_sign_tip_o")){$.cookie("close_sign_tip_o",!0,{expires:14});var e={content:"\u8FDE\u7EED\u7B7E\u523030\u5929ID\u5373\u53EF\u9AD8\u4EAE\u5C55\u793A\uFF0C\u4E00\u8D77\u95EA\u8000\u5427\uFF01",arrow_dir:"down",bubble_css:{top:3,right:25,width:145,"z-index":9999},arrow_pos:{left:88},attr:" ",wrap:$(".user_profile .user_name"),closeBtn:!0},i=new UiBubbleTipBase(e);i.j_bubble.find(".j_body").css("padding-right","3px"),i.showBubble(),i.bind("onclose",function(){$.cookie("close_sign_tip_o",!1,{expires:14})},!0);{setTimeout(function(){$(".j_wrap .j_close").click()},8e3)}}},showNewpropsTip:function(){var e=$.cookie("NEWS_PROPS_NOTICE"),i=this.user.global&&this.user.global.tbmall_newprops||"";(!e&&i>0||e&&i>e)&&this.buildNewpropsTip()},buildNewpropsTip:function(){var e=this,i={content:'<a class="j_newprops_tip" href="/tbmall/home?sn=1" target="_blank" style="text-align:center;display:block;">\u6709\u65B0\u9053\u5177\u4E0A\u7EBF\u54E6~</a>',arrow_dir:"up",arrow_pos:{left:40},bubble_css:{top:-35,left:100,width:100},wrap:$("#j_profile_pop"),closeBtn:!0},t=new UiBubbleTipBase(i),o="";t.bind("onclose",function(){t.closeBubble(),o=e.user.global&&e.user.global.tbmall_newprops||"",$.cookie("NEWS_PROPS_NOTICE",o,{expires:30,path:"/"})}),t.showBubble(),t.j_bubble.find(".j_newprops_tip").on("click",function(){$.post("/tbmall/post/addpropstoucenter",null,function(){}),t.closeBubble(),o=e.user.global&&e.user.global.tbmall_newprops||"",$.cookie("NEWS_PROPS_NOTICE",o,{expires:30,path:"/"})})},hasLevel:function(){var e=Math.floor((new Date).getTime()/1e3);return this.user.Parr_props&&this.user.Parr_props.level&&this.user.Parr_props.level.end_time>e}}});_.Module.define({path:"pcommon/component/LoginForm",sub:{_formKey:"",_formType:0,_jq_wrapper:null,_loginInstance:null,_pageLoginIndex:0,_userInputTip:{_jq_input:null,_jq_tip:null,_jq_newtip:null,type:"normal",init:function(){}},initial:function(n,e,t){this._formKey=e,this._formType=t?t:this._formType,this._jq_wrapper=n;var o=this,i="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime();$.JsLoadManager.use("http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+Math.floor(i/6e4),function(){o._initLoginApi()})},_initLoginApi:function(){var n=this;passport.use("login",{tangram:!0},function(e){n._loginInstance=new e.passport.login({product:"tb",loginType:1,defaultCss:!1,loginMerge:!0,hasRegUrl:!0,memberPass:!0,autosuggest:!1,hasPlaceholder:!0,sms:!1,u:$.tb.location.getHref(),isPhone:!1,safeFlag:0,staticPage:"http://tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"});var t=n._jq_wrapper.find(".login_form")[0];n._loginInstance.render(t),n._loginInstance.on("loginSuccess",function(e){Stats.sendRequest("fr=tb0_forum&st_mod="+n._formKey+"&st_type=login_succeed"),$.tb.location.reload(),e.returnValue=!1}),n._loginInstance.on("beforeSubmit",function(){Stats.sendRequest("fr=tb0_forum&st_mod="+n._formKey+"&st_type=login_click")})})}}});_.Module.define({path:"pplatform/widget/platformAsideInfo",requires:[],sub:{initial:function(){this.bindEvents()},bindEvents:function(){}}});_.Module.define({path:"puser/widget/myApp",sub:{MY_APP_THEME_KEY:"my_app_theme_cls",initial:function(t){var a=this;a._root=$("#encourage_entry"),$.extend(a,t),a.setTheme(),"1"==a.is_pull_recommendation&&a.pullRecommendation(),a._stats()},_stats:function(){var t=this,a=t._root.find(".list50").length>0;t._root.on("click","a",function(){var e=$(this).data("log"),n=$(this).closest(".j_app_item").find(".j_app_recommend").length>0||"1"!=t.is_pull_recommendation,p={is_recommendation:n,is_50:a};$.stats.track(e,"\u53F3\u4FA7\u5165\u53E3-\u6211\u7684\u5E94\u7528",PageData.product,"click",p)}),t._viewStats(t._root,{is_50:a})},_viewStats:function(t,a){var e=!1,n=null,p=function(){e||($.stats.track("\u5C55\u73B0","\u53F3\u4FA7\u5165\u53E3-\u6211\u7684\u5E94\u7528",PageData.product,"show",a),e=!0)},i=function(){var a=t.offset().top,e=t.offset().top+t.height(),n=$("body").scrollTop(),p=$(window).height()+n,i=!1;return(a>n&&p>=a||e>n&&p>=e)&&(i=!0),i};i()?p():$(window).on("scroll",function(){i()&&(clearTimeout(n),n=setTimeout(p,200))})},setTheme:function(){var t=this,a="list50",e="list60",n=$.tb.Storage.get(t.MY_APP_THEME_KEY);n||(n="1"==t.is_pull_recommendation?t.user_id%2==0?a:e:t.random(0,99)%2==0?a:e,$.tb.Storage.set(t.MY_APP_THEME_KEY,n)),t._root.find(".j_app_list").addClass(n)},random:function(t,a){return null==a&&(a=t,t=0),t+Math.floor(Math.random()*(a-t+1))},pullRecommendation:function(){var t=this,a={ie:"utf-8",tbs:PageData.tbs};t._ajax&&t._ajax.abort(),t._ajax=$.ajax({type:"post",url:"/tbapp/user/getRecommendApp",data:a,dataType:"json"}).success(function(a){a&&0===a.no&&t.renderAppList(a.data)})},renderAppList:function(t){var a=this,e=0;a.wrapper=$("#encourage_entry");for(var n="",p='<li  class="app_item j_app_item"><div class="app_icon_wrap"><a href="/f?ie=utf-8&kw=#{app_name}" data-log="#{app_name}" target="_blank" class="app_icon_link"  title="#{app_name}"><img src="#{app_img}"></a>#{recommend_title}</div><a href="/f?ie=utf-8&kw=#{app_name}" data-log="#{app_name}" target="_blank"  class="app_title"  title="#{app_name}">#{app_name}</a></li>',i=0,o=t.length;o>i&&12>i;i++){var r=t[i],_={app_name:r.forum_name,app_img:r.forum_portrait_image,recommend_title:1==r.type?(e++,'<span  class="j_app_recommend app_recommend">\u8350</span>'):""};n+=$.tb.format(p,_)}var s=a.wrapper.find(".j_add_app_item");12==t.length?s.hide():s.show(),a.wrapper.find(".j_app_list").prepend(n),e==t.length?(a.wrapper.find(".j_encourage_title").html("\u63A8\u8350\u5E94\u7528"),a.wrapper.find(".j_app_recommend").hide()):(a.wrapper.find(".j_encourage_title").html("\u6211\u7684\u5E94\u7528"),a.wrapper.find(".j_app_recommend").show())}}});_.Module.define({path:"encourage/widget/encourageEntry",sub:{initial:function(){this._root=$("#encourage_entry"),this._stats()},_stats:function(){this._root.on("click","a",function(){var t=$(this).data("log");$.stats.track(t,"\u7528\u6237\u6FC0\u52B1\u53F3\u4FA7\u5165\u53E3")})}}});_.Module.define({path:"puser/widget/HistoryGame",sub:{initial:function(){this._bindEvents(),this._showTrack()},_showTrack:function(){var t="";"frs"===PageData.product?t="FRS\u9875":"pb"===PageData.product&&(t="PB\u9875");var a=$(".game_content .game_h .game_link");if(a.length>0){var e=[];a.each(function(){e.push($(this).tbattr("title"))}),$.stats.track(t+"_\u6211\u7684\u6E38\u620F","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u5C55\u73B0",{obj_name:e.join(","),obj_type:"\u6211\u7684\u6E38\u620F"})}var n=$(".game_content .game_s .game_link");if(n.length>0){var i=[];n.each(function(){i.push($(this).tbattr("title"))}),$.stats.track(t+"_\u63A8\u8350\u6E38\u620F","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u5C55\u73B0",{obj_name:i.join(","),obj_type:"\u63A8\u8350\u6E38\u620F"})}},_bindEvents:function(){var t="",a=$(".game_tab"),e=$(".game_content");"frs"===PageData.product?t="FRS\u9875":"pb"===PageData.product&&(t="PB\u9875"),a.on("click","li",function(){var n=$(this).data("game"),i="game_h"==n?"\u6211\u7684\u6E38\u620F":"\u63A8\u8350\u6E38\u620F";a.children("li").removeClass("sel"),$(this).addClass("sel"),e.children("ul").removeClass("sel").end().children("ul."+n).addClass("sel"),$.stats.track(t+"_"+i+"_tab","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_type:i})}),e.on("click",".j_stats",function(){var a=$(this).data("category"),e="h"==a?"\u6211\u7684\u6E38\u620F":"\u63A8\u8350\u6E38\u620F",n=$(this).find("img").tbattr("src"),i=$(this).tbattr("title");"undefined"==typeof n&&(n=""),$.stats.track(t+"_"+e,"PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:n,obj_name:i,obj_type:e})}),$("#game_login_btn").on("click",function(){return PageData.user.is_login||_.Module.use("pcommon/widget/LoginDialog",[],function(){}),!1}),$(".j_privilege_btn").on("click",function(){$.stats.track("\u6E38\u620F\u7279\u6743","\u6E38\u620F\u7279\u6743","","\u70B9\u51FB",{obj_type:"\u6E38\u620F\u7279\u6743",obj_name:"\u6E38\u620F\u7279\u6743",obj_url:"-"})})}}});_.Module.define({requires:["pcommon/widget/LoginDialog","pcommon/widget/payMember"],path:"pcommon/widget/JoinVipDialog",sub:{objGet:function(i,e,o){o=void 0===o?null:o,e=e.split(".");var t,n=i;for(t in e){if(!("object"==typeof n&&e[t]in n))return o;n=n[e[t]]}return n},objSet:function(i,e,o){return i[e]=o,i},initial:function(){},getMemberDialog:function(i,e){var o=this;return this.objGet(window,"PageData.user.is_login",!1)?(this.gotoCashier(i,e),!1):(o.requireInstance("pcommon/widget/LoginDialog"),!1)},gotoCashier:function(i,e){var o=this.requireInstance("pcommon/widget/payMember"),t=this.objSet({},"fr",i||"\u8D2D\u4E70\u4F1A\u5458");t=this.objSet(t,"scene_id",e||0),o.showCashier(t)}}});_.Module.define({path:"puser/widget/scoreGain",requires:["pcommon/widget/Card","puser/widget/scoreOnlineTime","puser/widget/scoreRandEgg","puser/widget/scoreCustomEgg","puser/widget/scoreProvideEgg","puser/widget/scoreMonthIcon"],sub:{NEW_DEAD_LINE:13962816e5,URL:{postHeartBeat:"/tbscore/timebeat",fetchGift:"/tbscore/fetchtg",openGift:"/tbscore/opengift",aquireScore:"/tbmall/eggs/eggslist",findScore:"/tbmall/eggs/searcheggs",provideScore:"/tbmall/eggs/userSendPrivateEgg",myAquireScore:"/tbmall/eggs/mygeteggs",myProvideScore:"/tbmall/eggs/mysendeggs",initEggAndDynamic:"/tbmall/eggs/feedlist",initVIPEgg:"/tbscore/eggsvip",openVIPScore:"/tbmall/eggs/userGetVipEgg",openCustomScore:"/tbmall/eggs/userGetPrivateEgg",followUser:"/home/post/follow"},initial:function(e){this.tbs=PageData.tbs||"0",this.fr=PageData.product||"frs",this.forum_id=PageData.forum.forum_id||0,this.controlCenter=$("#tbmall_score_control_center"),this.opt=$.extend(e,{controlCenter:this.controlCenter}),this.scoreEncWrap=$(".score_encourage"),this.bindEvents(),this.scoreEncourage(),this.randEgg=this.use("puser/widget/scoreRandEgg",this.opt),this.customEgg=this.use("puser/widget/scoreCustomEgg",this.opt),this.provideEgg=this.use("puser/widget/scoreProvideEgg",this.opt),this.animateEgg=this.use("puser/widget/scoreAnimation",this.opt),this.monthIcon=this.use("puser/widget/scoreMonthIcon")},showOfflineCard:function(){var e=this,t=(new Date).getTime();$.tb.Storage.get("score_doupiao_offline")>t-864e5||(this.offline_card=this.use("pcommon/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/tbmall/doudizhu?page=5"><img style="margin: 4px 4px 0;" src="http://tb2.bdstatic.com/tb/static-puser/widget/score_gain/images/offline_6a3513f.png"></a>',clazz:"doupiao_offline",arrow_dir:"down",card_css:{width:170,"z-index":1e3,left:12,top:-35},wrap:$(".online_time"),card_leave_display:!0}),this.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("score_doupiao_offline",t),e.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("score_doupiao_offline",t+1296e6),e.offline_card._j_card.remove()}),this.offline_card.showCard())},scoreEncourage:function(){var e=this;this.scoreEncWrap.on("click",".provide_score_btn a.score_btn",function(){{var t=e.opt.wrapper.find(".score_slide");e.opt.wrapper.find(".score_list")}t.hasClass("score_slide_down")||t.trigger("click"),e.controlCenter.off("score.finishEggAndDynamic").one("score.finishEggAndDynamic",function(){var t=e.opt.wrapper.find(".score_provide .provide_score_btn a.score_btn");t.trigger("click")});var o=e.opt.wrapper.find(".score_provide .provide_score_btn a.score_btn");return o.trigger("click"),!1})},bindEvents:function(){var e=this,t=this.opt.wrapper.find(".score_slide"),o=this.opt.wrapper.find(".score_wrapper");t.on("click",function(){o.slideToggle(),e.scoreEncWrap.slideToggle(),$(this).toggleClass("score_slide_down")}).one("click",function(t,o){o||e.customEgg.initScore("aquireScore"),e.provideEgg.initList()}),e.controlCenter.bind("score.openScore",function(t,o,i){e.openGift(o,i)}).bind("score.openVIPScore",function(t,o,i){e.openVIPScore(o,i)}).bind("score.openCustomScore",function(t,o,i){e.openCustomScore(o,i)}).bind("score.heartBeat",function(t,o){e.heartBeatHandler(o)}).bind("score.fetchScore",function(){e.fetchGift()}).bind("score.aquireScore",function(t,o,i){e.updateScore(o,i)}).bind("score.findScore",function(t,o,i){e.updateScore(o,i)}).bind("score.provideScore",function(t,o){e.provideScore(o)}).bind("score.myAquireScore",function(t,o,i){e.updateScore(o,i)}).bind("score.myProvideScore",function(t,o,i){e.updateScore(o,i)}).bind("score.initEggAndDynamic",function(t,o){e.initEggAndDynamic(o)}).bind("score.initVIPEgg",function(t,o){e.initVIPEgg(o)}).bind("score.followUser",function(t,o,i){e.followUser(o,i)})},heartBeatHandler:function(e){var t,o,i="noGift",r=e.data.gift_info;this.onlineTime.timeBarInit(e.data.time_stat);for(t in r)if(o=r[t],2==o.gift_type){var n=e.data.eggs_style;this.randEgg.initRandGift(o,n)}else 1==o.gift_type&&(i=o);this.onlineTime.timeGiftInit(i,e.data.time_stat)},posterTextInit:function(e){window.repeat_has_score=e.data.time_stat.repeat_has_score},postHeartBeat:function(){var e=this;e.reqCtrl("postHeartBeat",function(t){0==t.no&&e.posterTextInit(t)})},fetchGift:function(){var e=this;e.reqCtrl("fetchGift",function(t){0==t.no&&e.heartBeatHandler(t)})},openGift:function(e,t){var o=this;o.reqCtrl("openGift",e,function(i){0!=i.no&&$.isEmptyObject(i.data.gift_got)?("time"===e.type&&o.onlineTime.showTips("overTime"),o.heartBeatHandler(i)):("time"===e.type?o.onlineTime.addScore(i,e,t):o.animateEgg.startAnimate(i,t),$.cookie("monthicon_tip")||o.monthIcon.showMonthIconTip())})},provideScore:function(e){var t=this;t.reqCtrl("provideScore",e,function(e){t.provideEgg.handleRes(e.no),t.provideEgg.handleTip(e)})},openVIPScore:function(e,t){var o=this;return PageData.user&&PageData.user.Parr_props&&PageData.user.Parr_props.level&&2==PageData.user.Parr_props.level.props_id&&1e3*PageData.user.Parr_props.level.end_time>(new Date).getTime()?(o.reqCtrl("openVIPScore",e,function(i){if("2270012"==i.no)o.randEgg.authError(t);else{var r=new Date;r.setDate(r.getDate()+1),r.setHours(0),r.setMinutes(0),r.setSeconds(0),"vip1"==e.vip_type?$.cookie("has_vip1_egg",1,{expires:r}):$.cookie("has_vip2_egg",1,{expires:r}),o.animateEgg.startAnimate(i,t)}}),void 0):(o.randEgg.authError(t),void 0)},openCustomScore:function(e,t,o){var i=this;$.extend(e,o),i.reqCtrl("openCustomScore",e,function(o){"2270012"==o.no?i.customEgg.authError(t):40==o.no?i._validVCode(o,function(o){i.openCustomScore(e,t,o)},function(){}):(i.animateEgg.startAnimate(o,t),i.customEgg.closeOpened(t))})},_validVCode:function(e,t,o){_.Module.use("pcommon/component/CaptchaDialog",{message:e.data.vcode.str_reason,vCode:e.data.vcode.captcha_vcode_str,vCodeType:e.data.vcode.captcha_code_type,exceptionalAccount:1==e.data.vcode.userstatevcode,forumName:PageData.forum.forum_name,forumId:PageData.forum.forum_id,title:"\u9886\u5F69\u86CB",forumName:PageData.forum.forum_name,forumId:PageData.forum.forum_id,checkUrl:"/tbmall/vcode/checkvcode?tbs="+PageData.tbs,vCodeUrl:"/tbmall/vcode/getvcode",paramsCallback:function(){return{app:"getEgg",tbs:PageData.tbs,forum_id:PageData.forum.forum_id}}},function(e){e.bind("onclose",function(){return e.hide(),o(),!1}),e.bind("onaccept",function(){var o={};o.vcode=e.getInputValue(),o.vcode_md5=e.getVCode(),"function"==typeof t&&t(o)}),e.show()})},updateScore:function(e,t){var o=this;o.reqCtrl(e,t,function(t){0==t.no?o.customEgg.updateList(e,t.data):o.customEgg.handError()})},initEggAndDynamic:function(e){var t=this;t.reqCtrl(e,function(e){0==e.no&&t.provideEgg.initEggAndDynamic(e.data)})},initVIPEgg:function(e){var t=this;t.reqCtrl(e,function(e){0==e.no&&t.randEgg.getVIPEgg(e.data)})},followUser:function(e,t){var o=this;o.reqCtrl(e,t,function(e){o.customEgg.followError(e.no)})},reqCtrl:function(e,t,o){var i,r,n=this,a=n.URL[e],s={tbs:n.tbs,fr:n.fr,forum_id:n.forum_id,ie:"utf8"};arguments.length>2?(r=o,i="provideScore"==e?t+"&tbs="+PageData.tbs+"&forum_id="+PageData.forum.forum_id:$.extend(s,t)):(r=t,i=s),$.post(a,i,function(e){"function"==typeof r&&r(e)})}}});
;_.Module.define({path:"puser/widget/scoreOnlineTime",requires:[],sub:{timeGiftHTML:['<div class="time_keeper">','<a class="time_gift"></a>','<span class="time_wrapper"></span>','<div class="active_len"></div>','<ul class="time_bar clearfix">',"<li>",'<div class="time_edge_first"></div>','<div class="time_point_first">0\'</div>','<div class="time_point">10\'</div>','<div class="time_edge"></div>',"</li>","<li>",'<div class="time_point">30\'</div>','<div class="time_edge"></div>',"</li>","<li>",'<div class="time_point">50\'</div>','<div class="time_edge"></div>',"</li>","<li>",'<div class="time_point">90\'</div>','<div class="time_edge"></div>',"</li>","</ul>","</div>"].join(""),blockRanges:{0:0,1:600,2:1800,3:3e3},currentDomLen:68,tips:["\u70B9\u51FB\u9886\u53D6\u5956\u52B1","\u4FDD\u6301\u5728\u7EBF\u53EF\u83B7\u5F97\u4E00\u888B\u8C46\u7968"],initial:function(t){this.timeGiftWrapper=t.wrapper.find(".online_time"),this.scoreIncre=t.scoreIncre,this.controlCenter=t.controlCenter,this.timeKeeper=$(this.timeGiftHTML).appendTo(this.timeGiftWrapper),this.giftTips=null,this.timeInterval=null,this.criticalLen=0,this.timeRange=0,this.timeStep=0,this.activeRange=0,this.currentLen=null,this.activeLen=this.timeKeeper.find(".active_len"),this.timeGift=this.timeKeeper.find(".time_gift"),this.bindEvents()},bindEvents:function(){var t=this,i={};this.timeKeeper.delegate(".unopen_gift","click",function(){i={type:"time",gift_key:$(this).getData().gift_key},t.controlCenter.trigger("score.openScore",[i,$(this).addClass("bomb_gift")])}),$("body").delegate(".time_gift_tip_close","click",function(){return $("#time_gift_tip_card .all_gift_got").length>0&&$.cookie("all_time_gift_got","close"),$("#time_gift_tip_card").remove(),t.giftTips=null,!1})},timeGiftInit:function(t,i){var e=this,s=i.time_has_score,n=i.interval_type,a=i.time_len;this.timeGift.tbattr({"class":"time_gift",style:""}),s!==!1&&4!=n&&("noGift"==t?(this.activeRange=this.currentDomLen*(i.now_time-i.interval_begin_time)/a,this.currentLen.append(this.timeGift.addClass("next_gift").tbattr("title",this.tips[1])),this.timeEnd-this.timeRange<=this.criticalLen&&(this.activeRange=this.currentDomLen*(a-this.criticalLen)/a),this.activeLen.width(parseInt(this.activeRange)),this.timeInterval=setInterval(function(){return e.timeCounter()},1e3)):(this.activeLen.width(this.currentDomLen),this.currentLen.append(this.timeGift.addClass("unopen_gift").bindData(t).tbattr("title",this.tips[0]))))},timeBarInit:function(t){this.timeKeeper.show();var i=this.timeKeeper.find(".time_bar"),e=this.timeKeeper.find(".time_bar li").removeClass(),s=t.time_len,n=t.now_time-t.interval_begin_time,a=t.time_has_score,r=t.interval_type;if(clearInterval(this.timeInterval),this.timeKeeper.find(".time_keeper_tip").hide(),this.timeInterval=null,4==r)return e.addClass("allpass"),i.addClass("allGiftGot"),this.activeLen.width(0),this.timeKeeper.find(".time_keeper_tip").show(),this.showTips("allGiftGot"),void 0;if(a===!1)return e.addClass("allunpass"),i.addClass("overScore"),this.activeLen.width(0),this.showTips("overScore"),void 0;for(var l=0;4>l;l++)r>l?e.eq(l).addClass("pass_len"):l==r?this.currentLen=e.eq(l).addClass("curren_len").append(this.activeLen):e.eq(l).addClass("unpass_len");this.timeEnd=this.blockRanges[r]+s,this.criticalLen=t.critical_len,this.timeRange=this.blockRanges[r]+n,this.timeRange=this.timeEnd-this.timeRange>this.criticalLen?this.timeRange:this.timeEnd-this.criticalLen,this.timeStep=this.currentDomLen/s},timeCounter:function(){if(this.timeRange>=this.timeEnd)clearInterval(this.timeInterval),this.timeInterval=null,this.controlCenter.trigger("score.fetchScore");else{this.timeRange+=1;var t=this.timeEnd-this.timeRange;t<=this.criticalLen&&this.timeGift.addClass("red_to_grey"),this.activeRange+=this.timeStep,this.activeLen.width(parseInt(this.activeRange))}},addScore:function(t,i,e){var s={type:"time",len:6,pos:["0 30px","0 -90px","0 -120px","0 -150px","0 -180px","0 -210px","0 30px"]};e.bindData(t.data.gift_got),this.burstAnimate(t,s,e,0)},burstAnimate:function(t,i,e,s){var n=this;setTimeout(function(){e.css("backgroundPosition",i.pos[s]),s<i.len?(n.burstAnimate(t,i,e,++s),2==s&&n.scoreAnimate(i,e)):n.controlCenter.trigger("score.heartBeat",[t])},50)},scoreAnimate:function(t,i){var e=i.offset(),s=i.getData().gift_score,n=null;s||(s=0),n=$('<div class="fly_score_online">+'+s+"\u8C46\u7968</div>").css({top:e.top+5,left:e.left}).appendTo("body").animate({top:"-=100",left:"+=50",opacity:.4},2e3,function(){$(this).remove()})},showTips:function(t){var i=this,e={overScore:'<div class="time_gift_tip">\u60A8\u7684\u3010\u8C46\u7968\u3011\u5DF2\u8FBE\u5230\u4E0A\u9650\uFF01<a href="/tbmall/getTdou">\u8C46\u7968\u4E0A\u9650\u8BF4\u660E</a><a class="time_gift_tip_close" onclick="return false;"></a></div>',overTime:'<div class="time_gift_tip">\u793C\u5305\u5DF2\u7ECF\u8FC7\u671F\uFF0C\u4E0B\u6B21\u8BF7\u5C3D\u5FEB\u9886\u53D6\uFF01\uFF08\u793C\u5305\u5F69\u86CB\u5F53\u65E5\u6709\u6548\u3002\uFF09</div>',allGiftGot:'<div class="time_gift_tip all_gift_got">\u4ECA\u65E5\u5728\u7EBF\u6D3B\u8DC3\u5956\u52B1\u5DF2\u7ECF\u9886\u53D6\u5B8C\u6210<a class="time_gift_tip_close" onclick="return false;"></a></div>'};i.giftTips&&(i.giftTips.closeCard(),i.giftTips=null),"allGiftGot"!=t&&(i.giftTips=i.use("pcommon/widget/Card",{wrap:i.timeKeeper,content:e[t],card_css:{width:180,height:50,top:-28,left:6,zIndex:9999},card_leave_display:/^(overScore|allGiftGot)$/.test(t)?!0:!1,attr:"id = 'time_gift_tip_card'"}),i.giftTips.showCard())}}});
;_.Module.define({path:"puser/widget/scoreRandEgg",requires:["puser/widget/scoreAnimation","pcommon/widget/JoinVipDialog"],sub:{randGiftHTML:['<a class="score_egg" title="\u6253\u5F00\u5F69\u86CB\u6709\u673A\u4F1A\u83B7\u5F97T\u8C46\u54E6" onclick="return false;">','<img src="">',"</a>"].join(""),giftGuide:!1,initial:function(i){this.fr=PageData.product,this.wrapperDom=i.wrapper,this.slideDom=i.wrapper.find(".score_slide"),this.eggDom=i.wrapper.find(".score_show"),this.controlCenter=i.controlCenter,this.randGift=$(this.randGiftHTML),this.initEggBlock(),this.initVIPEgg(),this.bindEvents()},initEggBlock:function(){var i=['<p>\u6709<span class="score_total_left"></span>\u679A\u798F\u5229\u5F69\u86CB <a class="j_score_open" href="javascript:;">\u3010\u5FEB\u6765\u62A2\u3011</a></p>',"</div>"].join("");this.eggDom.append(i)},bindEvents:function(){var i=this,e={};i.randGift.one("click",function(){e={type:"rand",gift_key:$(this).getData().gift_key},i.controlCenter.trigger("score.openScore",[e,$(this)]),i.slideDom.trigger("click")}),i.wrapperDom.on("click",".j_VIP_score",function(){return i.slideDom.hasClass("score_slide_down")||i.slideDom.trigger("click"),e=$(this).getData(),e.vip_type=$(this).data("vip"),i.controlCenter.trigger("score.openVIPScore",[e,$(this)]),!1}).on("mouseleave",".j_VIP_score",function(){return i.vip_card&&i.vip_card.closeCard({type:"delayClose",time:200}),i.vip_card=null,!1}).on("click",".j_score_open",function(){i.slideDom.hasClass("score_slide_down")||i.slideDom.trigger("click")})},initRandGift:function(i,e){if(null!=this.randGift){var t=this.eggDom.find(".block_middle"),n=$.extend({},i,e);this.randGift.find("img").tbattr("src",n.image),this.randGift.bindData(n).appendTo(t)}},initVIPEgg:function(){this.controlCenter.trigger("score.initVIPEgg",["initVIPEgg"])},getVIPEgg:function(i){var e=0,t="",n=null,r=this.eggDom.find(".score_total_left");delete i.vip1;for(t in i)if(n=i[t])if("left_number"!=t){if(e>1)return;++e}else r.html(n)},authError:function(i){var e=i.data("vip");if(e&&"vip2"===e){var t=new Date;t.setDate(t.getDate()+1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),$.cookie("has_vip2_egg",1,{expires:t})}_.Module.use("puser/widget/scoreAnimation",[{wrapperDom:this.wrapperDom,controlCenter:this.controlCenter}],function(e){e.startAnimate({},i)}),_.Module.use("pcommon/widget/JoinVipDialog",[],function(i){i.getMemberDialog()})}}});
;_.Module.define({path:"puser/widget/scoreCustomEgg",requires:["pcommon/component/JsPager"],sub:{initial:function(e){this.fr=PageData.product,this.scoreWrapper=e.wrapper.find(".score_wrapper"),this.slideDom=e.wrapper.find(".score_slide"),this.scoreTab=e.wrapper.find(".score_tab"),this.scoreList=e.wrapper.find(".score_list"),this.scorePager=e.wrapper.find(".score_pager"),this.scoreProvide=e.wrapper.find(".score_provide"),this.guideDom=e.wrapper.find(".score_guide"),this.eggBlockDom=e.wrapper.find(".score_show .egg_block"),this.controlCenter=e.controlCenter,this.pager=null,this.bindEvents()},bindEvents:function(){var e=this;$("#tbmall_score_region").on("click",".tbmall_score_op, .tip_to_find",function(){e.slideDom.hasClass("score_slide_down")||e.slideDom.trigger("click",[!0]),e.eggBlockDom.slideUp(),e.initScore("findScore",!0)}),this.scoreTab.on("click",".find_score_tab .tab_btn",function(){e.initScore("findScore")}).on("click",".find_score_tab .tab_close",function(){e.eggBlockDom.slideDown(),e.initScore("aquireScore")}).on("click",".my_score_tab li",function(){var i=$(this).tbattr("data-type"),t=$(this).closest(".my_score_tab").find("li");t.removeClass("sel"),$(this).addClass("sel"),e.initScore(i)}),this.scoreList.on("click",".aquire_score_item .info_btn",function(){if(!$(this).hasClass("info_btn_disable")){e.scoreList.find(".item_info").slideUp();var i=$(this).closest(".aquire_score_item"),t=i.find(".item_info"),r=i.find(".item_detail");e.scoreList.find(".item_detail").not(r).slideUp(),t.slideUp(),r.slideDown(),e.scoreProvide.slideUp()}return!1}).on("click",".aquire_score_item .detail_close",function(){var i=$(this).closest(".aquire_score_item"),t=i.find(".item_info"),r=i.find(".item_detail");e.scoreList.find(".item_info").not(t).slideDown(),t.slideDown(),r.slideUp(),e.scoreProvide.slideDown()}).on("click",".my_provide_item .info_btn",function(){e.scoreList.find(".item_info").slideDown();var i=$(this).closest(".my_provide_item"),t=i.find(".item_detail");t.slideDown(),e.scoreList.find(".item_detail").not(t).slideUp()}).on("click",".j_custom_score",function(){return opt=$(this).getData(),e.controlCenter.trigger("score.openCustomScore",[opt,$(this)]),!1}).on("click",".j_user_attention",function(){e.followUser($(this))}),this.guideDom.on("click",".j_my_score",function(){return e.initScore("myProvideScore"),e.scoreProvide.find(".provide_score_btn").tbattr("class","aquire_score_btn"),!1}),this.scoreProvide.on("click",".aquire_score_btn a",function(){e.eggBlockDom.slideDown(),e.initScore("aquireScore"),$(this).parent(".aquire_score_btn").tbattr("class","provide_score_btn")})},initScore:function(e,i){var t=1;return this.scorePager.empty(),this.pager=null,this.initTab(e),i?(this.scoreList.empty(),void 0):(this.getList(e,{pn:t}),void 0)},initTab:function(e){var i={aquireScore:"",findScore:['<div class="find_score_tab">','<p class="tab_title">\u6D88\u8017 50 T\u8C46\u5728\u5168\u5427\u627E\u798F\u5229\u5F69\u86CB</p>','<p><a class="tab_btn" href="#" onclick="return false;"></a></p>','<a class="tab_close" href="#" onclick="return false;"></a>',"</div>"].join(""),myProvideScore:['<div class="my_score_tab provide_tab">','<ul class="clearfix">','<li class="sel tab_left" data-type="myProvideScore">\u6211\u53D1\u7684\u5F69\u86CB</li>','<li class="tab_right" data-type="myAquireScore">\u6211\u9886\u53D6\u7684\u5F69\u86CB</li>',"</ul>","<p>\u5F69\u86CB\u989D\u5EA6","<span></span>\u9886\u53D6\u6B21\u6570","<span></span>\u9886\u53D6\u4EBA","</p>","</div>"].join(""),myAquireScore:['<div class="my_score_tab aquire_tab">','<ul class="clearfix">','<li class="tab_left" data-type="myProvideScore">\u6211\u53D1\u7684\u5F69\u86CB</li>','<li class="sel tab_right" data-type="myAquireScore">\u6211\u9886\u53D6\u7684\u5F69\u86CB</li>',"</ul>","<p>\u53D1\u798F\u5229\u7684\u4EBA","<span></span>\u9886\u53D6\u7684\u5427","<span></span>\u9886\u53D6\u989D\u5EA6","</p>","</div>"].join("")};"aquireScore"==e?this.scoreTab.slideUp().html(i[e]):this.scoreTab.html(i[e]).slideDown()},aquireScore:function(e){for(var i=0,t=e.length,r=null,a="",s={},n=['<div class="aquire_score_item" #{data}>','<div class="item_info clearfix">','<div class="info_block">','<p><a class="" title="#{user_name_enty}" href="#{user_link}" target="_blank" #{user_data}>',"#{user_name}</a>\u7684\u798F\u5229</p>",'<p class="info_num">\u798F\u5229\u603B\u989D#{total_score}T\u8C46</p>',"</div>",'<a class="info_btn #{info_disable}" href="#" onclick="return false;"></a>',"</div>",'<div class="item_detail">','<div class="detail_head clearfix">','<a class="detail_user" href="#{user_link}" target="_blank" ${user_data}>','<img src="#{user_portrait}" alt="\u7528\u6237\u5934\u50CF"/>',"</a>",'<div class="detail_block">','<p><a class="" title="#{user_name_enty}" href="#{user_link}" target="_blank" #{user_data}>',"#{user_name}</a>\u7684\u798F\u5229</p>",'<p class="detail_attention">','<a class="j_user_attention" href="#" onclick="return false;" #{user_data}>\u5173\u6CE8Ta</a>',"</p>","</div>","</div>",'<div class="detail_area">','<a class="j_custom_score score_egg" href="#" onclick="return false;" #{score_data}>','<img src="#{image}" />',"</a>","</div>",'<div class="detail_condition">','<p class="j_limit_error" #{forum_data}>\u9886\u53D6\u6761\u4EF6\uFF1A','<a href="#{forum_link}" title="#{forum_name_enty}" target="_blank">',"#{forum_name}</a>\u5427 LV#{level}\u4EE5\u4E0A</p>",'<p class="j_limit_total">\u798F\u5229\u603B\u989D\uFF1A<b>#{total_score}</b>&nbsp;T\u8C46</p>',"</div>",'<a class="detail_close" href="#" onclick="return false;"></a>',"</div>","</div>"].join("");t>i&&5!==i;i++)r=e[i],s={data:$.tb.dataField(r),image:r.image,user_data:$.tb.dataField({un:r.user_name}),user_name:$.tb.subByte(r.user_name,12),user_name_enty:r.user_name,user_link:"/home/main/?ie=utf8&un="+r.user_name+"&fr="+this.fr,user_portrait:r.portrait,left_num:r.left_number,forum_data:$.tb.dataField({forum_name:r.cond_forum_name,forum_link:"/f?kw="+r.cond_forum_name,level:r.cond_user_level}),forum_name:$.tb.subByte(r.cond_forum_name,12),forum_name_enty:r.cond_forum_name,forum_link:"/f?kw="+r.cond_forum_name,level:r.cond_user_level,score_data:$.tb.dataField(r),score_image:r.image,info_disable:r.get_status?"info_btn_disable":"",total_score:r.score},a+=$.tb.format(n,s);return a},findScore:function(e){for(var i=0,t=e.length,r=null,a="",s={},n=['<div class="find_score_item">','<div class="item_info clearfix">','<img src="#{image}" alt="\u5427\u5934\u50CF"/>','<div class="info_block">','<p><a href="#{forum_link}" title="#{forum_name_enty}" target="_blank">',"#{forum_name}</a>\u5427</p>",'<p class="info_num">\u8FD8\u5269\u4E2A#{left_num}</p>',"</div>",'<a class="info_btn" target="_blank" href="#{forum_link}"></a>',"</div>","</div>"].join("");t>i&&5!==i;++i)r=e[i],s={image:r.portrait,forum_name:$.tb.subByte(r.forum_name,14),forum_name_enty:r.forum_name,forum_link:"/f?kw="+r.forum_name,left_num:r.left_num},a+=$.tb.format(n,s);return a},myProvideScore:function(e){for(var i=0,t=e.length,r=null,a="",s={},n=['<div class="my_provide_item">','<div class="item_info clearfix">','<span class="info_val" title="#{info_val_enty}">#{info_val}</span>','<span class="info_num">#{info_num}\u6B21</span>','<a class="info_btn" href="#" onclick="return false;"></a>',"</div>",'<div class="item_detail">',"#{details}","</div>","</div>"].join("");t>i&&5!==i;i++)r=e[i],s={image:r.image,info_val:$.tb.subByte(r.score,6),info_val_enty:r.score,info_num:r.number,details:this.initInfo(r.user_list)},a+=$.tb.format(n,s);return a},initInfo:function(e){var i="",t=0,r=0,a=null,s={},n=['<p><span title="#{user_name_enty}">#{user_name}</span>\u9886\u53D6\u4E86<span>#{get_score}</span>T\u8C46</p>'].join("");if($.isArray(e))for(r=e.length;r>t;++t)a=e[t],s={user_name:$.tb.subByte(a.user_name,12),user_name_enty:a.user_name,get_score:a.get_score},i+=$.tb.format(n,s);return i},myAquireScore:function(e){for(var i=0,t=e.length,r=null,a="",s={},n=['<div class="my_aquire_item">','<span title="#{from_user_name}">#{from_user_name}</span>','<span title="#{forum_name}\u5427">#{forum_name}\u5427</span>',"<span>#{get_score}T\u8C46</span>","</div>"].join("");t>i&&10!==i;i++)r=e[i],s={forum_name:r.forum_name,from_user_name:r.from_user_name,get_score:r.get_score},a+=$.tb.format(n,s);return a},updateList:function(e,i){if(!i.list||0===i.list.length)return this.handError("emptyData"),void 0;var t=this;null==this.pager&&parseInt(i.count)>0&&(this.pager=t.use("pcommon/component/JsPager",{container:t.scorePager,current:1,amount:10,total:Math.ceil(i.count/5)||0,template:{head:"",tail:""},classname:{wrapper:"tbui_js_pager",current:"current grey_border",normal:"",prev:"prev",next:"next",head:"head",tail:"tail",status:"status",prev_disable:"prev_disable",next_disable:"next_disable",head_disable:"head_disable",tail_disable:"tail_disable"}}),this.pager.bind("pageChange",function(i,r){t.getList(e,{pn:r}),t.pager.initial({current:r}),t.scoreProvide.slideDown()}));var r=this[e](i.list);this.scoreList.empty().html(r)},getList:function(e,i){var t=this;t.controlCenter.trigger("score."+e,[e,i])},closeOpened:function(e){var i=e.closest(".aquire_score_item"),t=i.find(".item_info"),r=i.find(".item_detail");r.slideUp(),t.slideDown().find(".info_btn").addClass("info_btn_disable")},followUser:function(e){var i=this,t=e.getData();i.controlCenter.trigger("score.followUser",["followUser",t])},followError:function(e){var i={0:"\u5173\u6CE8\u6210\u529F",1130036:"\u6B64\u7528\u6237\u7981\u6B62\u88AB\u5173\u6CE8","else":"\u670D\u52A1\u5668\u6253\u4E86\u4E2A\u76F9\uFF0C\u5237\u65B0\u4E00\u4E0B\u5427"},t=e in i?i[e]:i["else"],r=new $.dialog({html:'<p style="text-align:center">'+t+"<p>",width:300,height:30});r.bind("onclose",function(){})},handError:function(e){var i={emptyData:'\u672C\u5427\u6CA1\u6709\u798F\u5229\u5F69\u86CB<br />\u5F00\u59CB<a class="tip_to_find" href="#" onclick="return false;">\u5BFB\u627E\u5F69\u86CB</a>\uFF01',"else":"\u670D\u52A1\u5668\u6253\u4E86\u4E2A\u76F9\uFF0C\u5237\u65B0\u4E00\u4E0B\u5427\uFF01"},t=e in i?i[e]:i["else"];this.scoreList.html('<p class="score_list_tip">'+t+"</p>")},authError:function(e){var i=e.closest(".item_detail").find(".detail_condition"),t=i.find(".j_limit_error"),r=i.find(".j_limit_total"),a=0,s=(t.html(),t.getData()),n='\u9700\u8981\u5728<a href="'+s.forum_link+'" target="_blank">'+s.forum_name+"\u5427</a>\u8FBE\u5230"+s.level+"\u7EA7\u4EE5\u4E0A";t.html(n).addClass("limit_center"),r.remove();var o=setInterval(function(){4==a?(t.addClass("limit_error"),clearInterval(o),o=null):(t.toggleClass("limit_error"),++a)},200)}}});
;_.Module.define({path:"puser/widget/scoreProvideEgg",requires:[],sub:{initial:function(e){this.fr=e.fr,this.visibleNum=3,this.scoreNum=0,this.wrapperDom=e.wrapper,this.provideDom=e.wrapper.find(".score_provide"),this.dynamicDom=e.wrapper.find(".score_dynamic"),this.guideDom=e.wrapper.find(".score_guide"),this.eggBlockDom=e.wrapper.find(".egg_block"),this.scoreWrapper=e.wrapper.find(".score_wrapper"),this.controlCenter=e.controlCenter,this.scoreStyles="",this.scoreForums="",this.provideFlag=!0,this.tipDom=null,this.selEgg=null,this.initGuide()},bindEvents:function(){var e=this,i=this.provideDom,o=i.find(".provide_score_btn"),s=i.find(".provide_score_item"),r=this.scoreWrapper.find(".score_list"),t=this.scoreWrapper.find(".score_pager");this.tipDom=s.find(".provide_tip"),i.on("click",".provide_score_btn a.score_btn",function(){return o.slideUp(),s.slideDown(),r.slideUp(),t.slideUp(),e.eggBlockDom.slideUp(),e.dynamicDom.slideUp(),e.initCarouse(),!1}).on("click",".provide_close",function(){s.slideUp(),o.slideDown(),r.slideDown(),t.slideDown(),e.eggBlockDom.slideDown(),e.dynamicDom.slideDown()}).on("submit","form.score_form",function(i){return i.preventDefault(),e.provideScore($(this)),!1}).on("keyup",".score_total",function(){e.checkProvide($(this))}).on("focus",".score_total, .egg_total",function(){var i=$(this);$(this).hasClass("score_total")||(i=$(this).closest(".score_form").find(".score_total")),e.checkProvide(i)}).on("click",".score_to_charge",function(){_.Module.use("pcommon/widget/TchargeDialog")})},initList:function(){var e=this;e.controlCenter.trigger("score.initEggAndDynamic",["initEggAndDynamic"])},initEggAndDynamic:function(e){var i=this;$.isArray(e.feed_list)&&this.initDynamic(e.feed_list),$.isArray(e.egg_list)&&this.initScore(e.egg_list),$.isArray(e.forum_list)&&this.initForum(e.forum_list),this.initProvide(),this.bindEvents(),i.controlCenter.trigger("score.finishEggAndDynamic")},initProvide:function(){var e="",i={},o=['<div class="provide_score_btn">','<a class="score_btn" href="#" onclick="return false;"></a>','<a class="score_egg_user" href="/tbmall/zt/eggtop#user" target="_blank">\u5F69\u86CB\u8FBE\u4EBA</a>','<a class="score_egg_forum" href="/tbmall/zt/eggtop#forum" target="_blank">\u798F\u5229\u7EA2\u5427</a>',"</div>",'<div class="provide_score_item">','<div class="score_title">\u5728<a href="#{forum_link}" target="_blank">#{forum_name}</a>\u5427\u53D1\u798F\u5229</div>','<div class="score_info">#{score_info}</div>','<form class="score_form" action="#" method="post">','<p><span>T\u8C46\u603B\u91CF\uFF1A</span><input class="score_total" name="score" type="text" value="20000"/>T\u8C46</p>','<p><span>\u5F69\u86CB\u6570\uFF1A</span><input class="egg_total" name="number" type="text" value="150"/>\u4E2A</p>',"<p>","<span>\u9886\u53D6\u6761\u4EF6\uFF1A</span>",'<input class="score_id" name="style_id" type="text" value=""/>','<select class="forum_name" name="cond_forum_id">#{forum_info}</select>','<select class="level" name="cond_user_level" class="cond_user_level">','<option value="1">Lv1\u4EE5\u4E0A</option>','<option value="2">Lv2\u4EE5\u4E0A</option>','<option value="3" selected="selected">Lv3\u4EE5\u4E0A</option>','<option value="4">Lv4\u4EE5\u4E0A</option>','<option value="5">Lv5\u4EE5\u4E0A</option>','<option value="6">Lv6\u4EE5\u4E0A</option>','<option value="7">Lv7\u4EE5\u4E0A</option>',"</select>","</p>",'<p class="provide_tip">\u5C06\u6D88\u801721000T\u8C46<br /><span>\uFF08\u6BCF\u65E5\u6263\u96641000T\u8C46\u798F\u5229\u4F59\u989D\uFF09</span></p>','<p class="provide_submit"><button type="submit"></button></p>',"</form>",'<a class="provide_close" href="#" onclick="return false;"></a>',"</div>"].join("");i={forum_id:PageData.forum.forum_id,forum_name:PageData.forum.forum_name,forum_link:"/f?kw="+PageData.forum.forum_name,forum_info:this.scoreForums||"",score_info:this.scoreStyles||""},e+=$.tb.format(o,i),this.provideDom.append(e)},initForum:function(e){var i=0,o=e.length,s=[];if(o>0)for(;o>i;++i)s.push('<option value="'+e[i].forum_id+'">'+$.tb.subByte(e[i].forum_name,13)+"\u5427</option>");else s.push('<option value="'+PageData.forum.forum_id+'">'+$.tb.subByte(PageData.forum.forum_name,13)+"\u5427</option>");this.scoreForums=s.join("")},initScore:function(e){var i=0,o=e.length,s=null,r="",t="";for(this.scoreNum=o;o>i;++i)s=e[i],r+=["<li "+$.tb.dataField({sid:s.id})+">",'<a href="#" onclick="return false;">','<img src="'+s.image+'" alt="">',"</a>","</li>"].join("");t=['<div class="info_carousel clearfix">',"<ul>",r,"</ul>","</div>",'<a href="#" onclick="return false;" class="info_prev">','<span class="caro_arrow"></span><span class="caro_block"></span>',"</a>",'<a href="#" onclick="return false;" class="info_next">','<span class="caro_arrow"></span><span class="caro_block"></span>',"</a>",'<div class="info_sel"><span></span></div>'].join(""),this.scoreStyles=t},initCarouse:function(){this.selEgg=null;var e=this,i=this.provideDom.find(".score_info");i.find(".info_carousel").jCarouselLite({btnNext:i.find(".info_next"),btnPrev:i.find(".info_prev"),visible:this.visibleNum,circular:!0,afterEnd:function(i){e.selEgg=$(i[1])}}),_.Module.use("pcommon/widget/Placeholder",["#tbmall_score_control_center .score_provide .score_total","20000"],function(){}),_.Module.use("pcommon/widget/Placeholder",["#tbmall_score_control_center .score_provide .egg_total","150"],function(){})},initDynamic:function(e){for(var i=0,o="",s=e.length,r=null,t=null,a=['<p class="dynamic_item">','<a class="j_user_card" href="#{user_link}" target="_blank" #{user_data}>','<img src="#{user_portrait}" />',"</a>","\u62A2\u4E86",'<a class="j_user_card" href="#{from_user_link}" target="_blank" #{from_user_data}>','<img src="#{from_user_portrait}" />',"</a>","\u7684\u5F69\u86CB\u83B7\u5F97","<span>#{get_score}</span>","T\u8C46","</p>"].join("");s>i&&!(i>10);++i)r=e[i],t={user_link:"/home/main/?ie=utf8&un="+r.user_name,user_name:r.user_name,user_portrait:r.portrait,user_data:$.tb.dataField({un:r.user_name}),from_user_link:"/home/main/?ie=utf8&un="+r.from_user_name,from_user_name:r.from_user_name,from_user_portrait:r.from_portrait,from_user_data:$.tb.dataField({un:r.from_user_name}),get_score:r.get_score},o+=$.tb.format(a,t);this.dynamicDom.append('<div class="dynamic_wrapper">'+o+"</div>"),1>s&&this.dynamicDom.hide();{var n=this.dynamicDom.find(".dynamic_wrapper");setInterval(function(){n.find(".dynamic_item").first().slideUp(function(){$(this).appendTo(n).show()})},3e3)}},initGuide:function(){},provideScore:function(e){if(this.provideFlag&&this.formValid()){var i="";if(this.selEgg)i=this.selEgg.getData().sid;else{var o=this.provideDom.find(".info_carousel li"),s=this.scoreNum-this.visibleNum+1;i=o.eq(s).getData().sid}e.find("input.score_id").val(i),this.controlCenter.trigger("score.provideScore",[e.serialize()]),self.provideFlag=!1}},formValid:function(){var e=this.provideDom.find(".provide_score_item"),i=e.find(".score_total").val(),o=e.find(".egg_total").val();return this.scoreValid(i)&&this.eggValid(o,i)},scoreValid:function(e){var i=PageData.user.Parr_scores?PageData.user.Parr_scores.scores_money+PageData.user.Parr_scores.scores_other:0;return/^\d+$/.test(e)?1e4>e?(this.handleRes(111e4),!1):e>i?(this.handleRes(2270005),!1):!0:(this.handleRes(1001),!1)},eggValid:function(e,i){var o=parseInt(i/100-50);return/^\d+$/.test(e)?10>e?(this.handleRes(1110002),!1):e>o?(this.handleRes(1110003,o),!1):!0:(this.handleRes(1001),!1)},checkProvide:function(e){var i=e.val(),o=parseInt(i)+1e3;this.tipDom&&(/^\d+$/.test(i)?this.tipDom.html("\u5C06\u6D88\u8017"+o+"T\u8C46<br /><span>\uFF08\u6BCF\u65E5\u6263\u96641000T\u8C46\u798F\u5229\u4F59\u989D\uFF09</span>"):this.tipDom.html(""))},handleRes:function(e,i){this.provideFlag=!0;var i=i&&!isNaN(parseInt(i))?parseInt(i):0,o={0:"\u63D0\u4EA4\u6210\u529F\uFF01",1001:"\u8BF7\u8F93\u5165\u6570\u5B57",1110000:"T\u8C46\u6570\u4E0D\u80FD\u5C0F\u4E8E10000",1110001:"\u60A8\u5728\u5427\u5185\u7B49\u7EA7\u4E0D\u80FD\u5C0F\u4E8E1\u6216\u5927\u4E8E7",1110002:"\u5F69\u86CB\u6570\u4E0D\u80FD\u5C0F\u4E8E10",1110003:"\u6240\u53D1T\u8C46\u7684\u5F69\u86CB\u6570\u4E0D\u80FD\u591A\u4E8E"+i,2270005:'\u60A8\u7684T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C<a class="score_to_charge" href="#" onclick="return false;">\u53BB\u5145\u503C>></a>',2251009:"\u53D1\u653E\u7684\u5427\u4E0D\u5B58\u5728","else":"\u670D\u52A1\u5668\u6253\u4E86\u4E2A\u76F9\uFF0C\u5237\u65B0\u8BD5\u8BD5\u5427"},s=e in o?o[e]:o["else"];this.tipDom&&this.tipDom.html(s)},handleTip:function(e){if(0==e.no&&e.data&&e.data.get_icon){var i=$('<div class="score_alert"><p class="tt">\u606D\u559C\u4F60\u83B7\u5F97\u4E86</p><div class="score_alert_img"></div><span class="score_alert_foot">\u3010\u798F\u5229\u5370\u8BB0\u3011</span><a class="score_alert_close" href="#"></a></div>');$("body").append(i),i.on("click",".score_alert_close",function(){return i.remove(),$.tb.location.reload(),!1})}else if(0==e.no){setTimeout(function(){$.tb.location.reload()},1e3)}}}});
;_.Module.define({path:"puser/widget/scoreAnimation",requires:[],sub:{initial:function(e){this.wrapperDom=e.wrapper,this.controlCenter=e.controlCenter,this.bindEvents()},bindEvents:function(){$("body").on("click",".score_close_gif",function(){$(this).closest(".score_open_gif").remove()})},startAnimate:function(e,t){var o="custom",n=null;if(e.data){var s=e.data.gift_got;s?(n={props_num:s.gift_score,props_name:""},o="rand"):n=e.data}else n={props_num:"0",props_name:""};n=$.extend(t.getData(),n||{props_num:"0",props_name:""},!0),t.bindData(n),t.fadeOut(),this._addScore(o,t,e)},_addScore:function(e,t,o){var n={len:5,pos:["0 -66px","0 -132px","0 -198px","0 -264px","0 0"]};this._showGif(t),this._burstAnimate(e,n,t,0,o)},_burstAnimate:function(e,t,o,n,s){var r=this;setTimeout(function(){o.css("backgroundPosition",t.pos[n]),n<t.len?(r._burstAnimate(e,t,o,++n,s),2==n&&r._scoreAnimate(o,e)):"rand"==e&&r.controlCenter.trigger("score.heartBeat",[s])},50)},_showGif:function(e){var t="",o=e.getData(),n=e.offset(),s=o.gif||"",r=o.link||"/tbmall/home";if(""!==$.trim(s)){var a=['<div class="score_open_gif">','<a href="#{link}" target="_blank">','<img src="#{gif}"/>',"</a>",'<a class="score_close_gif" href="#" onclick="return false;"></a>',"</div>"].join(""),i={link:r,gif:s};t=$.tb.format(a,i),$(t).css({top:n.top-48,left:n.left-48}).appendTo("body").fadeIn(2e3)}},_scoreAnimate:function(e,t){var o=e.getData().props_name||"",n=e.getData().props_num||0,s="",r=o?"prop":"egg",a=t||"",i=['<div class="fly_score_#{scoreStyle} fly_score_#{scoreType}">#{scoreShow}<span></span></div>'].join(""),c=e.offset();s="prop"==r?o+"×"+n:"+"+n+("rand"==a?"\u8C46\u7968":""),s={scoreShow:s,scoreStyle:r,scoreType:a},fly_dom=$($.tb.format(i,s)),fly_dom.css({top:c.top+26,left:c.left+20}).appendTo("body"),fly_dom.animate({top:"-=100",left:"+=50",opacity:.4},3e3,function(){$(this).remove(),e.remove(),e=null})}}});
;_.Module.define({path:"puser/widget/scoreBuy",requires:[],sub:{URL:{provideScore:"/tbmall/eggs/userSendPrivateEgg",checkScore:"/tbmall/checkorder"},callBack:null,initial:function(){this._dialog=null,this._bindEvents()},buyScore:function(e,a){"function"==typeof a&&(this.callBack=a),this._getOrderId(e),this._chargingDialog()},_bindEvents:function(){$("body").delegate(".j_charge_success_btn","click",function(){self._closeDialog(self._dialog),self._confirmChargeState()}).delegate(".j_charge_fail_btn","click",function(){self._closeDialog(self._dialog),$.tb.location.setHref(h)})},_getOrderId:function(e){var a=this,s=e+"&tbs="+PageData.tbs+"&forum_id="+PageData.forum.forum_id;$.ajax({type:"POST",url:a.URL.provideScore,dataType:"json",data:s,success:function(e){switch(e.no){case 0:"88888888"==e.data.order_id?(a._closeDialog(a._dialog),a._closeBubble(a._bubble),a._bubble=a._showBubble("<span class='charge_btns success_bubble_icon' ></span><span class='small_bubble_content'>\u5DF2\u6210\u529F\u5145\u503C <span class='orange_tip'>"+e.data.scores+"</span>T\u8C46",1500,"canClose"),windowOpen&&windowOpen.close()):(a._order_id=e.data.order_id,window.open(e.data.dubi_url))}}})},_confirmChargeState:function(){var e=this,a=6;this._bubble=this._showBubble("\u6B63\u5728\u9A8C\u8BC1\u652F\u4ED8\u4E2D\uFF0C\u8BF7\u7A0D\u5019"+a+"\u79D2...");var s=setInterval(function(){if(a--,e._bubble.html("\u6B63\u5728\u9A8C\u8BC1\u652F\u4ED8\u4E2D\uFF0C\u8BF7\u7A0D\u5019"+a+"\u79D2..."),a%2==0){var l={ie:"utf-8",tbs:PageData.tbs,order_id:e._order_id};$.ajax({type:"POST",url:e.URL.checkScore,dataType:"json",dataType:"json",data:l,success:function(l){switch(l.no){case 0:1e4==l.data.result_code&&(e._closeBubble(e._bubble),e._bubble=e._showBubble("<span class='charge_btns success_bubble_icon' ></span><span class='small_bubble_content'>\u5DF2\u6210\u529F\u5145\u503C <span class='orange_tip'>"+l.data.scores+"</span>T\u8C46",1500,"canClose",function(){$.tb.location.setHref($.tb.location.getHref().replace("&showsend=1","").replace("&showmask=1",""))}),clearInterval(s)),0>=a&&(e._closeBubble(e._bubble),e._bubble=e._showBubble("<span class='charge_btns fail_bubble_icon' ></span><span class='small_bubble_content'>\u62B1\u6B49,T\u8C46\u6CA1\u6709\u5145\u503C\u6210\u529F</span>",1500,"canClose"),clearInterval(s));break;case 1:case 2:default:0>=a&&(e._closeBubble(e._bubble),e._bubble=e._showBubble("<span class='charge_btns fail_bubble_icon' ></span><span class='small_bubble_content'>\u62B1\u6B49,T\u8C46\u6CA1\u6709\u5145\u503C\u6210\u529F</span>",1500,"canClose"),clearInterval(s))}},error:function(){e._bubble.html("<p>\u672A\u77E5\u9519\u8BEF</p>"),clearInterval(s)}})}0>=a&&clearInterval(s)},1e3)},_showBubble:function(e,a,s,l){var n=$("<div class='small_bubble_block'  ></div>");return n.append(e),$("body").append(n),n.css({left:$(window).width()/2-n.width()/2,top:$(window).height()/2}),$(window).resize(function(){n.css({left:$(window).width()/2-n.width()/2,top:$(window).height()/2})}),"function"==typeof l&&l(),s&&n.click(function(){$(this).remove()}),a?(this._closeBubble(n,a),void 0):n},_closeBubble:function(e,a){a&&a>0?setTimeout(function(){e&&e.fadeOut("normal",function(){e.remove()})},a):e&&e.fadeOut("normal",function(){e.remove()})},_chargingDialog:function(){var e="<p class='dialog_content'>\u8BF7\u5728\u65B0\u6253\u5F00\u7684\u9875\u9762\u4E0A\u5B8C\u6210\u652F\u4ED8</p><p class='dialog_second_content'>\u652F\u4ED8\u5B8C\u6210\u524D&nbsp;&nbsp;&nbsp;&nbsp;\u8BF7\u52FF\u5173\u95ED\u7A97\u53E3</p><div class='dialog_btn_wrap'><a class='charge_btns j_charge_success_btn'>\u652F\u4ED8\u6210\u529F</a><a class='charge_btns j_charge_fail_btn'>\u652F\u4ED8\u5931\u8D25</a></div>";this._showDialog("\u5145\u503CT\u8C46",e,500)},_showDialog:function(e,a,s){this._dialog=new $.dialog({html:a,title:e,width:s,draggable:!1,closeable:!0})},_closeDialog:function(e){e&&e.close(),e=null}}});
;_.Module.define({path:"puser/widget/scoreMonthIcon",requires:[],sub:{initial:function(){},showMonthIconTip:function(){function t(t){return t>9?t:"0"+t.toString()}var n=PageUnit.load("score_gain_txt"),e=PageUnit.load("score_gain_button"),i=PageUnit.load("score_gain_title"),o=PageUnit.load("score_gain_link"),a=PageUnit.load("score_gain_constellation");if(n){var l=new Date(Env.server_time),r=l.getFullYear(),_=t(l.getMonth()+2),s=new $.dialog({html:'<p style="text-align:center;margin-top:20px;">'+n+'<br><br><a id="month_icon_tip" style="margin-bottom: 20px;" target="_blank" href="'+o+'" class="ui_btn ui_btn_m"><span><em>'+e+'</em></span></a><a style="margin-left: 15px;margin-bottom: 20px;" href="#" class="j_dont_remind ui_btn ui_btn_sub_m"><span><em>\u4E0D\u518D\u63D0\u9192</em></span></a></p>',title:i,width:400,show:!1});"1"!=a&&PageData.user.tbmall_month_icon&&PageData.user.tbmall_month_icon[r+""+_]||s.show(),$.cookie("monthicon_tip","1",{path:"/",expires:1/6}),$(s.getElement()).on("click","#month_icon_tip",function(){s.close()}).on("click",".j_dont_remind",function(t){t.preventDefault(),$.cookie("monthicon_tip","1",{path:"/",expires:1}),s.close()})}}}});_.Module.define({path:"pplatform/widget/PlatformAsideIknow",sub:{initial:function(){this.bindTracks(),this.bindEvents()},bindTracks:function(){$(".platform_aside_iknow").on("click",".platform_iknow_search_btn",function(){$.stats.track("ModuleSearchBtnClcik","coopwithiknow")}).on("click",".platform_iknow_question",function(){$.stats.track("ModuleQuestionClick","coopwithiknow")}).on("click",".platform_iknow_askofficial",function(){$.stats.track("ModuleAskBtnClick","coopwithiknow")}).on("click",".platform_inkow_seemore",function(){$.stats.track("ModuleMoreBtnClcik","coopwithiknow")})},bindEvents:function(){1!=$.cookie("piabc")&&$("#j_pibubble").on("click",".j_piclose",function(i){i&&i.preventDefault(),$.cookie("piabc",1,{expires:365,domian:"/"}),$("#j_pibubble").remove()}).show()}}});_.Module.define({path:"pplatform/widget/PlatformAsideSwitch",sub:{_positions:null,_tpl:["<div>","</div>"].join(""),initial:function(i){this._positions=i.positions,this.is_star_official=i.is_star_official,$("#aside").on("click",".j_aside_switch_op",$.proxy(this.showDialog,this))},showDialog:function(i){var t=this;i&&i.preventDefault();{var s=baidu.template("platform_aside_switch_tpl",{list:t._positions}),o=$(s);new $.dialog({html:o,title:"\u6A21\u5757\u987A\u5E8F\u8C03\u6574",draggable:!0,width:418})}o.on("click",".j_paside_switch_down",t.turnDown).on("click",".j_paside_switch_up",t.turnUp).on("click",".j_paside_switch_submit",{is_star_official:t.is_star_official},t.submit)},turnDown:function(){var i=$(this).closest("tr"),t=i.find(".j_paside_switch_mod"),s=t.html(),o=i.next().find(".j_paside_switch_mod");t.html(o.html()),o.html(s)},turnUp:function(){var i=$(this).closest("tr"),t=i.find(".j_paside_switch_mod"),s=t.html(),o=i.prev().find(".j_paside_switch_mod");t.html(o.html()),o.html(s)},submit:function(i){i&&i.preventDefault();var t,s,o,t=$(this).closest("tbody").find(".j_paside_switch_mod"),s={forum_id:PageData.forum.forum_id,tbs:PageData.tbs},o=[];t.each(function(){o.push($(this).find("span").tbattr("mod_id"))}),s.msort=o.join(","),$.tb.post("/official/commit/setOrder?ie=utf-8",$.tb.xssEncode(s),function(i){0==i.no?($.dialog.close(),$.tb.location.reload()):$tip.html("\u8C03\u6574\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")},"json")}}});_.Module.define({path:"pcommon/component/SlideShow",sub:{defaultOptions:{delayLoadPic:!1,effect:"slide",activeClass:"tbui_slideshow_active",baseZIndex:0,interval:5e3,slide:{speed:500},fade:{speed:500},triggerHandler:"click"},initial:function(t){t=$.extend({},this.defaultOptions,t);var i=this;this.options=t,this.animating=!1,this.current=0,this.vendorPrefix=!1,this.$nav=$(t.nav),this.$navItem=this.$nav.children(),this.total=this.$navItem.size()||t.total,this.$container=$(t.target),this.$list=this.$container.children(".tbui_slideshow_list"),this.$tokens=this.$list.children(),t.width||(t.width=this.$container.width()),t.height||(t.height=this.$container.height()),this.$container.add(this.$list).css({width:t.width,height:t.height}),this.interval=t.interval||5e3,this.picLoadedIndex={},this.$navItem.first().addClass(t.activeClass),this.$tokens.first().show(),this.showOriPic(0),"click"==t.triggerHandler?this.$navItem.click(function(){var e=this;t.auto&&i.stop(),this.delayHandler=setTimeout(function(){i.delayHandler=null,i.setActive($(e).index())},10)}).bind("mouseout",function(){t.auto&&i.play(),this.delayHandler&&clearTimeout(this.delayHandler)}):"hover"==t.triggerHandler&&this.$navItem.hover(function(){var e=this;t.auto&&i.stop(),this.delayHandler=setTimeout(function(){i.delayHandler=null,i.setActive($(e).index())},200)},function(){t.auto&&i.play(),this.delayHandler&&clearTimeout(this.delayHandler)}),this.effectHandler=this["_"+t.effect],t.auto&&(this.play(),this.$list.hover(function(){i.stop()},function(){i.play()})),t.next&&$(t.next).click(function(t){t.preventDefault(),t.stopPropagation(),i.next()}),t.prev&&$(t.prev).click(function(t){t.preventDefault(),t.stopPropagation(),i.prev()})},setActive:function(t){return this.animating||t===this.current?!1:(this.$navItem.removeClass(this.options.activeClass).eq(t).addClass(this.options.activeClass),this.effectHandler(t),this.showOriPic(t),!0)},next:function(){var t=this.current+1;t==this.total&&(t=0),this.setActive(t)},prev:function(){var t=this.current-1;-1==t&&(t=this.total-1),this.setActive(t)},play:function(){var t=this;null==this.autoHandler&&(this.autoHandler=setInterval(function(){t.next()},this.options.interval))},showOriPic:function(t){if(this.options.delayLoadPic&&!this.picLoadedIndex["_"+t]){for(var i,e=this.$tokens.eq(t).find("img"),n=e.length,s=0;n>s;s++){i=$(e[s]);var o=i.tbattr("orisrc");o&&i.tbattr("src",o)}this.picLoadedIndex["_"+t]=1}},stop:function(){clearInterval(this.autoHandler),this.autoHandler=null},_slide:function(t){var i,e,n,s,o,a,r,h=this;this.animating=!0,i=this.current,r=t>i?1:-1,e=t>i?-this.options.width:this.options.width,s=t,this.$tokens.eq(i).siblings().css({display:"none",left:0,zIndex:0+this.options.baseZIndex}),this.$tokens.eq(s).css({display:"block",left:r*this.options.width,zIndex:10+this.options.baseZIndex}),this.vendorPrefix?(o=this.vendorPrefix,a=o+"Transform",n=o+"TransitionDuration",this.$list[0].style[a]="translateX("+e+"px)",this.$list[0].style[n]=this.options.slide.speed+"ms",this.$list.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){h.$list[0].style[a]="",h.$list[0].style[n]="",h.$tokens.eq(s).css({left:0}),h.$tokens.eq(i).css({display:"none",left:0,zIndex:0}),h.animating=!1,h.current=s,h.$list.unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd"),h.trigger("animateEnd")})):h.$list.stop().animate({left:e},this.options.slide.speed,function(){h.$list.css({left:0}),h.$tokens.eq(s).css({left:0}),h.$tokens.eq(i).css({display:"none",left:0,zIndex:0}),h.current=s,h.animating=!1,h.trigger("animateEnd")})},_fade:function(t){var i,e,n=this;this.animating=!0,i=this.current,e=t,this.$tokens.eq(e).css({display:"none",left:0,zIndex:10+this.options.baseZIndex}),this.$tokens.eq(i).stop().fadeOut(this.options.fade.speed),this.$tokens.eq(e).stop().fadeIn(this.options.fade.speed,function(){n.$tokens.eq(e).css({zIndex:0+n.options.baseZIndex}),n.animating=!1,n.current=e})},_getVendorPrefix:function(){var t,i,e,n,s;for(t=document.body||document.documentElement,e=t.style,n="Transition",s=["Moz","Webkit","Khtml","O","ms"],i=0;i<s.length;){if("string"==typeof e[s[i]+n])return s[i];i++}return!1}}});_.Module.define({path:"pcommon/widget/asidead",sub:{initial:function(t,s){if(t.length>0&&t.getData()){var a=t.getData(),i=this;t.find(".aside_ad_pic").on("click",function(){i._stats(s,"\u53F3\u4FA7","\u5546\u4E1A\u63A8\u5E7F\u4F4D\u7EDF\u8BA1",a,"\u70B9\u51FB"),i._stats(s,"frs\u9875_\u53F3\u4FA7\u63A8\u5E7F_\u56FE","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",a,"\u70B9\u51FB")}),i._stats(s,"\u53F3\u4FA7","\u5546\u4E1A\u63A8\u5E7F\u4F4D\u7EDF\u8BA1",a,"\u5C55\u73B0"),i._stats(s,"frs\u9875_\u53F3\u4FA7\u63A8\u5E7F_\u56FE","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",a,"\u5C55\u73B0")}},_stats:function(t,s,a,i,_){$.stats.track(s,a,t,_,{obj_id:i.id||"",obj_name:i.title||"",obj_url:i.pic||"",obj_type:"\u6E38\u620F",obj_subtype:i.subtype||""})}}});
;_.Module.define({path:"pcommon/widget/asidead/asidead_slide",requires:["pcommon/component/SlideShow"],sub:{_slideConfig:{target:"#aside_ad .asidead_slidewrap",nav:"#aside_ad .asidead_navs",activeClass:"active",interval:5e3,auto:!0,prev:"#aside_ad .asidead_control_left",next:"#aside_ad .asidead_control_right",delayLoadPic:!0,slide:{speed:400}},initial:function(){console.log(9),this.use("pcommon/component/SlideShow",this._slideConfig)}}});_.Module.define({path:"ppb/widget/u9Aside",requires:[],sub:{initial:function(e){this.gameName=e.game_name||"",this.gameType=e.game_type||"",this.viewData=e.view_data||[],this.bindEvents()},bindEvents:function(){if(this.gameType){var e=this,a=0,i=this.viewData.length,t=[],s=1==this.gameType?"U9\u5B9A\u5236\u7248":"U9\u901A\u7528\u7248";if(i>0)for(this.gameName=this.viewData[0].summary,a;i>a;a++)t.push(this.viewData[a].summary);$.stats.track("\u53F3\u4FA7",s,"","view",{obj_type:"U9",obj_name:e.gameName,obj_game:t}),$(".u9_aside").on("click",".u9_aside_list a",function(){$.stats.track("\u793C\u5305","U9\u901A\u7528\u7248","","click",{obj_type:"U9",obj_name:$(this).data("code")})})}}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});