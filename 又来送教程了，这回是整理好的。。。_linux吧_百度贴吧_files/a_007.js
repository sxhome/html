_.Module.define({path:"common/widget/cashierDialog",requires:["common/widget/messenger"],sub:{sub_iframe_name:"cashier_dialog_iframe",windowId:"window_iframe_app_"+(new Date).getMilliseconds(),_iframe_dialog:null,initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon()},getTpl:function(){var e='<div class="cashier_dialog base_user_data"><div class="cashier_dialog_header"><div class="header_title"><span class="header_icon"></span>#{title}</div><div class="user_info"><span class="title_acc">\u8D26\u53F7\uFF1A<span class="#{member} j_member_icon"></span><a class="title_acc_name j_member_red">#{user_name}</a></span><span class="title_remain">T\u8C46\u4F59\u989D\uFF1A<span class="title_remain_num"><span class="user_tdou_icon"></span><span  class="j_tdou">#{tdou_num}<span></span></span></span></div><a class="header_close j_header_close"></a></div><div class="tdou_cashier_wrap" id="tdou_cashier_wrap"><iframe id="cashier_dialog_iframe" class="cashier_dialog_iframe" src="#{cashier_url}" frameborder="0" style="border: 0"></iframe></div></div>';return e},buildCashierIframe:function(e){return $.tb.format(this.getTpl(),e)},showDialog:function(e){var a=this;a._iframe_dialog&&$(".tdou_member_cashier_iframe_dialog").remove(),this.options=e||{},PageData.pay_fr=e.fr,PageData.pay_track=e.track;var i=e.cashier_url,s=this.member.action_title,t={user_name:this.dataProxy.getUserName(),tdou_num:0,member:this.member.icon,cashier_url:i,title:s||"\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"},r=a.buildCashierIframe(t),n={modal:!0,showTitle:!1,fixed:!0,width:726,height:564,hideOnclose:!1,holderClassName:"tdou_member_cashier_iframe_dialog",draggable:!0,html:r};a._iframe_dialog=new $.dialog(n),a._iframe_dialog.show(),a._setBody(),("ordinary_member_icon"==$.trim(this.member.icon)||"super_member_icon"==$.trim(this.member.icon))&&a._iframe_dialog.element.find(".j_member_red").addClass("member_red"),a.updateTdou(),a.wrap=a._iframe_dialog.element,PageData.tdou_dianquan_iframe_dialog=a._iframe_dialog,a.track("show"),a.bindEvent(),a.initMessager()},_setBody:function(){$("body").css({height:$(window).outerHeight(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},bindEvent:function(){var e=this;e.wrap.find(".j_header_close").on("click",function(){e.closeMain()})},closeMain:function(){var e=PageData.tdou_dianquan_iframe_dialog;e&&e.close(),this._hideBody(),delete PageData.tdou_dianquan_iframe_dialog,this.track("\u5173\u95ED\u7A97\u53E3")},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},initMessager:function(){var e=this;if(!e.MessageInstance){e.MessageInstance=e.requireInstance("common/widget/messenger",[e.windowId,"tdou_pay"]);var a=window.document.getElementById(e.sub_iframe_name);e.MessageInstance.addTarget(a.contentWindow,e.sub_iframe_name);var i=["http://db.baidu.com","http://pay.baidu.com"];e.MessageInstance.registerOrigin(i),e.MessageInstance.registerCommand({encourage_dianquan_readystatechange:$.proxy(e.onReadyStateChange,this),encourage_dianquan_close:$.proxy(e.onClose,this)})}},sendMessage:function(e){var a=this;if(a.MessageInstance){var i="";"object"==typeof e&&(i=JSON.stringify(e)),a.MessageInstance.targets[a.sub_iframe_name].send(i)}},onReadyStateChange:function(e){if(e)switch(e.status){case 2e3:this.updateMember(e.data),this.track("\u652F\u4ED8\u6210\u529F");break;case 3e3:this.onClose();break;case 3001:this.onClose(),this.track("\u518D\u6B21\u8D2D\u4E70")}},onClose:function(){this.closeMain()},updateTdou:function(){var e=this;e.dataProxy.getTdou(function(e){if(e&&0===e.no){var a=e.data.Parr_scores,i=a?a.scores_money+a.scores_other:0;$(".tdou_member_cashier_iframe_dialog .j_tdou").html(i)}},this)},updateMember:function(e){var a=this,i=a.dataProxy.getMemberIconByLevel(e.user_level);$(".tdou_member_cashier_iframe_dialog .j_member_icon").addClass(i.icon);var s=e.user_level;s&&(s=parseInt(s),s>0&&$(".tdou_member_cashier_iframe_dialog .j_member_red").addClass("member_red"))},track:function(e){$.stats.track(PageData.pay_track||"memberpay","cashierDialog-"+PageData.pay_fr,PageData.product,e||"click")}}});_.Module.define({path:"common/widget/qianbaoCashierDialog",requires:["common/widget/baseUserData"],sub:{iframeContainerId:"qianbao_cashier_payment_channel_wrap",qianbaoLbscashierUrl:"http://zhifu.baidu.com/static/js/pc/iframe/lbscashier-iframe.js?t="+(new Date).getTime(),services:{createOrder:"/tbmall/getPayUrl",getOrder:"/tbmall/getorder"},initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData")},createMain:function(a,e){var t=this;PageData.qianbao_cashier=t,t.setLoading(),$.isFunction(e)&&e(t.$root),t.changeoPayAmount(a),t.qianbao_params_json=t.getParams(a)},buildCashier:function(a){var e=this;e.cashier?e.cashier.updateOrder(a):(e.cashier=new window.lbscashier({onmessage:e.onMessage,containerId:e.iframeContainerId,data:a,height:360}),$("#cashier-iframe").css({border:"none"}))},onMessage:function(a){var e=PageData.qianbao_cashier;if(!a)return console.log("onmessage null"),void 0;var t=a.type,i=a.data,o=a.option,n=o&&o.channel,s=!1;if("updateOrder"===t)e.clearPayLoading();else if("pay"===t)switch(i){case"submit":if("wechat"===n||"alipayqr"===n||"gameyeepay"===n||"mobileyeepay"===n)return;e.showPaymentTip(),e.track("pay-submit");break;case"addcard":break;case"success":e.track("pay-success");var r="wechat"===n||"alipayqr"===n||"gameyeepay"===n||"mobileyeepay"===n?!0:!1;r?(s=!0,e.checkQrcodePaymentResult()):e.showPaymentTip(r)}else if("qrcodeAlipay"===t)switch(i){case"success":e.showPaymentTip(),e.track("alipay-qrcode-success")}else if("qrcodeWechat"===t)switch(i){case"success":e.showPaymentTip(),e.track("wechat-qrcode-success")}s||e.clearLoading()},getSmallUser:function(){var a=PageData.user.id,e=a%2;return!e},showDialog:function(a,e,t){var i=this,o=a.qianbao_params;i.product=a.product,$.JsLoadManager.loadUrl(i.qianbaoLbscashierUrl,function(){i.buildDialog(e),i.createMain(o,t)})},buildDialog:function(a){var e=this;if(e._iframe_dialog){if(!$(".qianbao_cashier_iframe_dialog").is(":hidden"))return;$(".qianbao_cashier_iframe_dialog").remove()}var t=e.getDialogTpl(a),i={modal:!0,showTitle:!1,fixed:!0,width:717,height:564,hideOnclose:!1,holderClassName:"qianbao_cashier_iframe_dialog",draggable:!0,html:t};e._iframe_dialog=new $.dialog(i),e._iframe_dialog.show(),e._setBody(),e.$root=e._iframe_dialog.element,e.track("show")},_setBody:function(){$("body").css({height:$(window).outerHeight(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},getDialogTpl:function(a){var e=this,t='<div class="qianbao_cashier_dialog j_qianbao_cashier_dialog"><div class="loading j_qianbao_cashier_loading">      <table height="100%" width="100%">          <tbody><tr>              <td valign="middle" align="center">                  <img src="http://pay.baidu.com/resource/common/images/charging.gif">                  <p class="j_loading_text">\u52A0\u8F7D\u4E2D...</p>              </td>          </tr>          </tbody></table>  </div><div class="qiaobao_pay_loading j_pay_loading">      <table height="100%" width="100%">          <tbody>          <tr>              <td valign="middle" align="center">                  <img src="http://pay.baidu.com/resource/common/images/charging.gif">                    <p class="j_loading_text">\u52A0\u8F7D\u652F\u4ED8\u9875\u9762...</p>              </td>          </tr>          </tbody>      </table>  </div><div class="qianbao_cashier_payment_goods_wrap">#{goodsShowTpl}</div><div class="qianbao_cashier_payment_channel_wrap" id="'+e.iframeContainerId+'"></div></div>',i={goodsShowTpl:a};return t=$.tb.format(t,i)},changeoPayAmount:function(a){var e=this,t=a;e.qianbao_params_json=e.getParams(a),e.buildCashier(t)},closeDialog:function(){var a=this,e=a._iframe_dialog;e&&e.close(),this._hideBody(),delete PageData.qianbao_cashier,clearTimeout(a.timerId),clearTimeout(a.checkPaymentId),a.track("\u5173\u95ED\u7A97\u53E3")},getParams:function(a){var e={};if(!a)return e;var t=/orderId=[^&]*/,i=t.exec(a);if(1==i.length){var o=i[0].split("=");e.orderId=o[1]||""}return e},getPageUrl:function(){var a=$.tb.location.getHref();return a=a.replace(/&customerId=.*|\?customerId=.*/g,"")},checkPaymentResult:function(){var a=this;a.getPaymentResult("ok",function(e){a.showPaymentSuccess(e)},function(e){a.showPaymentFailure(e)})},checkQrcodePaymentResult:function(){this.setLoading("check"),this.checkPaymentResult()},getPaymentResult:function(a,e,t){var i=this;i.setLoading();var o={order_id:i.qianbao_params_json.orderId},n={product:i.product,userName:i.dataProxy.getUserName()};i._checkPaymentResult&&i._checkPaymentResult.abort();var s=5,r=function(){s--,clearTimeout(i.checkPaymentId),i._checkPaymentResult=$.ajax({type:"GET",url:i.services.getOrder,data:o,dataType:"json"}).success(function(o){var c=o.data.db_money||0;c/=100;var l=o.data.scores_total;if(!l){var d=o.data.given_scores||0;l=1e3*c+d+i.dataProxy.getUserTdou()}n=$.extend(n,{payAmount:c.toFixed(2),totalScores:l});var _=o.data.member_info;if(_){var p="yyyy-MM-dd",u=1e3*parseInt(_.create_time),m=1e3*parseInt(_.end_time);n=$.extend(n,{create_time:$.dateFormat(new Date(u),p),end_time:$.dateFormat(new Date(m),p)})}0==o.no?(i.clearLoading(),clearTimeout(i.checkPaymentId),e&&e(n),s=5):s>0&&"ok"===a?i.checkPaymentId=setTimeout(r,1e3):(i.clearLoading(),t&&t(n))})};i.checkPaymentId=setTimeout(r,1e3)},setLoading:function(a){var e=this,t=e.$root.find(".j_qianbao_cashier_loading");if(!t.is(":visible")){var i={loading:"\u52A0\u8F7D\u4E2D...",paying:"\u5F88\u52AA\u529B\u7684\u5145\u503C\u4E2D...",check:"\u67E5\u8BE2\u5145\u503C\u7ED3\u679C\u4E2D..."};t.show(),t.find(".j_loading_text").html(i[a]||i.loading)}},clearLoading:function(){var a=this,e=a.$root.find(".j_qianbao_cashier_loading");1==e.length&&e.hide()},showPaymentTip:function(a){var e=this,t=e.$root.find(".j_qianbao_payment_tip");1==t.length&&t.remove(),e.$root.find(".j_qianbao_cashier_dialog").append(baidu.template('<section class="qianbao_payment_tip j_qianbao_payment_tip ">      <div class="tip_dialog">          <div class="tip_dialog_content">              <%if(isQuickPay){%>              <p class="description">\u60A8\u5DF2\u6210\u529F\u652F\u4ED8\uFF0C\u4ED8\u6B3E\u5B8C\u6210\u524D\u8BF7\u4E0D\u8981\u5173\u95ED\u6216\u5237\u65B0\u6B64\u7A97\u53E3</p>              <%} else {%>              <p class="description">\u8BF7\u5728\u65B0\u6253\u5F00\u9875\u9762\u4E0A\u5B8C\u6210\u5145\u503C\uFF0C\u4ED8\u6B3E\u5B8C\u6210\u524D\u8BF7\u4E0D\u8981\u5173\u95ED\u6216\u5237\u65B0\u6B64\u7A97\u53E3</p>              <%}%>              <div class="center">                  <a class="btn_default btn_sub btn_larger j_close qianbao_pay_tip_btn j_try_pay_again" style="margin-right: 20px;">\u5931\u8D25\uFF0C\u91CD\u65B0\u652F\u4ED8</a>                  <a class="btn_default btn_larger btn_attention j_pay_ok qianbao_pay_tip_btn">\u652F\u4ED8\u6210\u529F</a>              </div>          </div>          <span class="tip_dialog_close j_close"></span>      </div>      <span class="middle-helper"></span>  </section>',{isQuickPay:a})),t=e.$root.find(".j_qianbao_payment_tip"),t.find(".j_close").on("click",function(){e.hidePaymentTip(),e.getPaymentResult("fail",function(a){e.showPaymentSuccess(a)},function(){e.trigger("event_tdou_qianbao_pay_again")})}),t.find(".j_pay_ok").on("click",function(){e.checkPaymentResult(),e.hidePaymentTip()})},hidePaymentTip:function(){var a=this,e=a.$root.find(".j_qianbao_payment_tip");e&&e.remove()},showPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");e.show(),e.find(".j_loading_text").html("\u52A0\u8F7D\u4E2D...")},clearPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");1==e.length&&e.hide()},showPaymentSuccess:function(a){var e=this,t=baidu.template('<div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic success_pic"></span>          <span class="result_txt">\u5145\u503C\u6210\u529F\uFF01</span>      </div>        <%if(product == \'tdou\'){%>      <p><label>\u8D26\u53F7\uFF1A<%=userName%></label></p>        <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A<span class="pay_amount"><%=payAmount%></span></label>\u5143</p>      <%}else if(product == \'member\'){%>      <p><label>\u4F1A\u5458\u8D77\u59CB\u65E5\u671F\uFF1A<span class="member_date"><%=create_time%></span></label></p>        <p><label>\u4F1A\u5458\u7ED3\u675F\u65E5\u671F\uFF1A<span class="member_date"><%=end_time%></span></label></p>      <%}%>        <p><label><span class=" second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3</label></p>        <div class="button_container">          <a class="btn_default btn_sub btn_larger qianbao_pay_result_btn j_continue_pay "             style="margin-right: 30px;display: none">\u7EE7\u7EED\u8D2D\u4E70</a>          <a class="btn_default btn_larger btn_attention qianbao_pay_result_btn j_close ">\u5173\u95ED\u7A97\u53E3</a>      </div>  </div>',a);e.updateUserInfo(a.totalScores),e.showPaymentResult(t)},showPaymentFailure:function(a){var e=this,t=baidu.template('<div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic fialed_pic"></span>          <span class="result_txt">\u5145\u503C\u5931\u8D25\uFF01</span>      </div>          <p><label>\u8D26\u53F7\uFF1A<%=userName%></label></p>        <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A<span class="pay_amount"><%=payAmount%></span></label>\u5143</p>        <%if(product == \'tdou\'){%>      <p> <a href="http://tieba.baidu.com/hermes/feedback?category=pay">\u8FDB\u884C\u53CD\u9988</a> </p>      <%}else if(product == \'member\'){%>      <p> <a href="http://tieba.baidu.com/hermes/feedback?category=member">\u8FDB\u884C\u53CD\u9988</a> </p>      <%}%>          <p><label><span class="second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3</label></p>        <div class="button_container">          <a class="btn_default btn_sub btn_larger qianbao_pay_result_btn j_close " style="margin-right: 30px">\u5173\u95ED\u7A97\u53E3</a>          <a class="btn_default btn_larger btn_attention qianbao_pay_result_btn j_repay ">\u91CD\u65B0\u652F\u4ED8</a>      </div>  </div>',a);e.showPaymentResult(t)},updateUserInfo:function(a){PageData.user.Parr_scores.scores_total=a,this.$root.find(".j_tdou").html(a)},showPaymentResult:function(a){var e=this;e.$root.find(".j_qianbao_cashier_dialog").append($(a));var t=e.$root.find(".j_qiaobao_pay_result_dialog .j_second"),i=5,o=function(){return i--,0==i?(e.closeDialog(),void 0):(t.html(i),e.timerId=setTimeout(o,1e3),void 0)};e.timerId=setTimeout(o,1e3),e.$root.on("click",".j_qiaobao_pay_result_dialog .j_close",function(){e.closeDialog()}).on("click",".j_qiaobao_pay_result_dialog .j_repay",function(){clearTimeout(e.timerId),e.$root.find(".qiaobao_pay_result_dialog").remove(),e.trigger("event_tdou_qianbao_pay_again")})},track:function(a,e,t){var i=this;$.stats.track(a,e||"qianbaoCashierDialog-"+i.product,PageData.product+"-"+(t||"qianbao-cashier-"+i.product),"click")}}});_.Module.define({path:"user/widget/userApi",requires:[],sub:{initial:function(){},checkUniversalMembershipOf:function(e){return $.getPageData("mParr_props.level.props_id",0,e)>0&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkOverdueSuperMembershipOf:function(e){return 2==$.getPageData("mParr_props.level.props_id")&&1e3*$.getPageData("mParr_props.level.end_time",0,e)<1*new Date},checkSuperMemberShipOf:function(e){return 2===this.getUniversalMemberLevelOf(e)&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkSingleForumMembershipOf:function(e,r){var t=$.getPageData("mParr_props.forum_member",0,e);return t?t[r]&&1e3*t[r].end_time>1*new Date:!1},getUniversalMemberLevelOf:function(e){return this.checkUniversalMembershipOf(e)?$.getPageData("mParr_props.level.props_id",0,e):0}}});_.Module.define({path:"user/widget/Icons",requires:["IconCard","IconsBookView","IconsBookTip","IconsBookControl","IconsBookCommon"],sub:{iconClassList:{0:"",1:"icon-crown-vip",2:["icon-crown-super-vip","icon-crown-super-v1","icon-crown-super-v2","icon-crown-super-v3","icon-crown-super-v4","icon-crown-super-v5"],3:["icon-crown-year-vip","icon-crown-year-v1","icon-crown-year-v2","icon-crown-year-v3","icon-crown-year-v4","icon-crown-year-v5"]},overdueSuperIconList:["icon-crown-super-non","icon-crown-super-non1","icon-crown-super-non2","icon-crown-super-non3","icon-crown-super-non4","icon-crown-super-non5"],initial:function(){this._buySlot=$(".j_icon_slot_buy"),this._icon_book_wrap=$(".j_book_icon"),this.common=this.use("IconsBookCommon"),PageUnit.load("icons_category"),this.userApi=this.requireInstance("user/widget/userApi",[])},getCrownIconClass:function(e,i){var n=$.getPageData("vipInfo.v_level",0,e),r=this.userApi.getUniversalMemberLevelOf(e),t=$.getPageData("vipInfo.v_status",0,e);t=parseInt(t,10),r=3===t?3:r;var a="";if(i){if(this.userApi.checkOverdueSuperMembershipOf(e))return this.overdueSuperIconList[n];if(0===r)return a="icon-crown-super-non"}switch(r){case 0:a=this.iconClassList[r];break;case 1:a=this.iconClassList[r];break;case 2:case 3:a=this.iconClassList[r][n]}return a},getPreIconHtml:function(e,i,n){var r={};r.mParr_props=e,i=i||r;var t,a=["\u8D34\u5427\u4F1A\u5458","\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"],o="",s=Math.round((new Date).getTime()/1e3),c=$.getPageData("forum.forum_id",0);this.userApi.checkSingleForumMembershipOf(i,c)&&(o='<div class="pre_icon_wrap pre_icon_wrap_theme"><a class="icon_tbworld icon-vip3-16" title="\u672C\u5427\u4F1A\u5458" href="/tbmall/tshow" onclick="return false" target="_blank"></a></div>');var l="";return e&&e.level&&e.level.end_time>s?(l=this.getCrownIconClass(i),o='<div class="pre_icon_wrap pre_icon_wrap_theme1">',t=e.level.props_id,o+='<a class="icon_tbworld '+l+'" href="/tbmall/tshow" target="_blank" title="'+a[t-1]+'"></a>',o+="</div>"):n&&(l=this.getCrownIconClass(i,!0),o='<span class="pre_icon_wrap pre_icon_wrap_theme1">',t=$.getPageData("level.props_id",0,e),o+='<a class="icon_tbworld '+l+'" href="/tbmall/tshow" target="_blank" title="'+a[t-1]+'"></a>',o+="</span>"),o},getIconsHtml:function(e,i,n){var n=n?n:5,r=e.new_iconinfo,t=0;for(var a in r)t++;var o='<span class="icon_wrap  icon_wrap_theme1">',s=0;if(!r){var c=e.iconinfo;if(c){var l=c[0];o+=this._getOldHtml(l,1)}}for(var _ in r){var u=r[_];if(s==n)break;if($.isEmptyObject(u)){if("1"==_){var c=e.iconinfo;if(!$.isEmptyObject(c)){var l=this._getReplaceIcon(c,r);if(!l)continue;o+=this._getOldHtml(l,1),s++}}}else this.common.isShowDurationIcon(u)&&(o+=this._getIconHtml(u,1),s++)}return o+="</span>"},_getReplaceIcon:function(e,i){if($.isEmptyObject(i))return e[0];for(var n=0;n<e.length;n++){var r=e[n];if(!this._judgeIconInNewiconinfo(i,r))return r}return null},_judgeIconInNewiconinfo:function(e,i){if($.isEmptyObject(e))return!1;if($.isEmptyObject(i))return!1;for(var n in e){var r=e[n];if(r&&r.name==i.name)return!0}return!1},_imgSize:{1:14,2:18},_oldIconTitle:{is_lottery_1:"\u94C1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_2:"\u94DC\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_3:"\u94F6\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_4:"\u91D1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_coreuser_1:"\u8D34\u5427\u6838\u5FC3\u7528\u6237",is_verify_1:"\u767E\u5EA6\u8D34\u5427\u4F01\u4E1A\u5E73\u53F0\u8BA4\u8BC1",user_type_1:"\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1",is_battle_1:"\u8D34\u5427\u62F3\u738B",is_welfare_1:"\u798F\u5229\u5370\u8BB0"},_getOldHtml:function(e,i){var n="",r=e.sprite[e.value];if(!r)for(var t in e.sprite){if(e.sprite[t]&&(0!=e.value||"meizhi_level"==e.name)){r=e.sprite[t];break}return n}var a=e.icon+"?stamp="+r.split(",")[0];switch(background='style="background: url('+a+") no-repeat center center; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+a+',sizingMethod=scale); background-size: 14px 14px"',e.name){case"meizhi_level":var o=e.value;o=o?o:0,o>=2&&(o-=2,n+='<a class="old_icon_size" '+background+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+o+'"></span></a>');break;case"is_member":n+='<a class="old_icon_size" '+background+' target="_blank"  class=" icon_fanclub"  title="\u7C89\u4E1D\u4F1A\u5458"></a>';break;default:n+=e.title_url?'<a class="old_icon_size" '+background+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>':'<span class="old_icon_size" '+background+' title="'+this._oldIconTitle[e.name+"_"+e.value]+'"  locate="'+e.name+"_"+e.value+'"></span>'}return n},_getIconHtml:function(e,i){var n,r,t,a,o,i=i||1,s=50,c="",l="http://tb1.bdstatic.com/tb/cms/com/icon/";if(n=e.sprite[e.value],!n)for(var _ in e.sprite){if(e.sprite[_]&&(0!=e.value||"meizhi_level"==e.name)){n=e.sprite[_];break}return c}r=n.split(","),t=r[0],a=r[1];var u=l+e.category_id+"_"+this._imgSize[i]+".png?stamp="+t;switch(o='style="background: url('+u+") no-repeat -"+a*s+"px  -"+(i-1)*s+'px;"',e.name){case"meizhi_level":var p=e.value;p=p?p:0,p>=2&&(p-=2,c+="<a "+o+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+p+'"></span></a>');break;case"is_member":c+="<a "+o+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(e.title_url)c+="<a "+o+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>';else{{e.title}c+="<span "+o+' title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"></span>'}}return c}}});
;_.Module.define({path:"user/widget/Icons/IconsBookControl",requires:["IconsBookView","IconsBookTip","IconCard","IconsBookMessagebox","IconsBookGetIcon"],sub:{_icon_book:null,_icon_book_ajax:null,_icon_user_action:"",_icon_tab_loaded:{},_tip:null,_messagebox:null,tabLen:0,_slot_no:0,_icon_info:{},_current_tab_index:0,_selected_icon_name:"",_target_ele:null,_option:{width:655},_slot_buy_price:[0,0,100,1e4,3e4,5e4,1e4,2e4,1e5],initial:function(){var o=this;o._wrap=$("body"),o._view=o.use("user/widget/Icons/IconsBookView");var e=PageData.category_info,t=e.category_list||[{category_id:"101",category_name:"\u8DB3\u7403"},{category_id:"102",category_name:"\u661F\u5EA7"},{category_id:"104",category_name:"\u5176\u4ED6"}];o.defaultCategoryId=o._getDefaultCategoryId(e.default_category),o.bindIconBookHookEvents(t)},bindIconBookHookEvents:function(o){var e=this;e._wrap.delegate(".j_icon_slot_buy","mouseenter",function(){e.__timeoutId&&clearTimeout(e.__timeoutId),e.closeAllCard(),e._icon_user_action="buy_slot",e._target_ele=$(this),e._selected_icon_name="";var o=$(".j_icon_slot").length;return e._slot_no=1,e.buySlot({add_slot_no:o+1,price:e._slot_buy_price[o+1],action:"buy_slot"},$(this)),!1}),e._wrap.delegate(".j_icon_slot_buy","mouseleave",function(){return e.__timeoutId&&clearTimeout(e.__timeoutId),e.__timeoutId=setTimeout(function(){e._messagebox&&e._messagebox.hideBox()},200),!1}),e._wrap.delegate(".j_icon_slot","click",function(t){e.closeAllCard(),e._setIconRefresh($(this)),e._icon_user_action="replace_icon",e._target_ele=$(this);var _=$(this).tbattr("data-slot"),a=$(this).tbattr("data-name");e._selected_icon_name=a,e._slot_no=_;var i="",n={};for(var c in n)n[c].name==a&&(i=n[c].category_id);e.initIconBook({slot_no:_,category_info:o,icon_id:a,action:"replace_icon",category_id:i},$(this)),t.preventDefault()}),e._wrap.delegate(".j_slot_null_icon","click",function(t){t.preventDefault(),e.closeAllCard(),e._selected_icon_name="",e._setIconRefresh($(this)),e._icon_user_action="buy_icon",e._target_ele=$(this);var _=$(this).tbattr("data-slot");e._slot_no=_;e.initIconBook({slot_no:_,category_info:o,icon_id:"",action:"buy_icon"},$(this))}),e._wrap.delegate(".j_icon_slot","hover",function(o){var e=$(this);if(!e.hasClass("j_slot_null_icon")){var t=$(this).tbattr("data-name"),_=($(this).tbattr("data-slot"),{});if(_){var a=null;for(var i in _)if(_[i].name==t){a=_[i];break}if(a&&a["level_"+a.value]){var n=a["level_"+a.value],c="url("+n.icon_1+") no-repeat",r=o||event;if("mouseenter"==r.type){var s={background:c},l=e.css("background");l||(l=e[0].style.background),e.data({bg:l}),e.css(s),e.addClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").addClass("icon_slot_refresh_hover")}else{var l=e.data("bg"),s={background:l};e.css(s),e.removeClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").removeClass("icon_slot_refresh_hover")}}}}})},buySlot:function(o,e){var t=this;t._messagebox||(t._messagebox=t.use("user/widget/Icons/IconsBookMessagebox")),t._messagebox.is_leave_close=!0,t._messagebox.showBox(o,e)},initIconBook:function(o,e){var t=this,_=o.category_info;t.closeIconBook();var a=t._view.getTabItem(_),i={content:a,card_css:{width:t._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:e,attr:"id='icon_book_tab'",wrap:$("body")};if(t._icon_book=t.use("user/widget/Icons/IconCard",i),t._icon_book.showCard({type:"delayShow",time:200}),t.initTab(),o.icon_id){var n=t._getTabIdByCategory(o.category_id);t._selected_icon_name=o.icon_id,t._showTab(n,o.icon_id)}else t._showTab(t._getDefaultIndex(t.defaultCategoryId));$.stats.track("\u5370\u8BB0\u4E2D\u5FC3\u6D6E\u5C42","icon_system")},closeIconBook:function(){var o=this;o._tip&&o._tip.closeTip(),o._icon_book&&(o._icon_book.closeCard(),o._icon_book=null)},initTab:function(){var o=this;o.tabLen=$(".icon_book_tab_head li").length,o._bindHeadEvents()},_bindHeadEvents:function(){var o=this;$(".icon_book_tab_head").delegate("li","click",function(){var e=$(this).index();o._showTab(e),o._tip&&o._tip.hideTip()}),$(".icon_book_close").click(function(){return $("#icon_book_tab").remove(),o._tip&&(o._tip.hideTip(),o._tip=null),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),!1}),$(".icon_book_close").hover(function(){$(this).addClass("icon_book_close_hover")},function(){$(this).removeClass("icon_book_close_hover")})},_showTab:function(o,e){var t=this;$(".icon_book_tab_head .head_inner").each(function(){!$(this).hasClass("space")&&$(this).parent().index()<t.tabLen-1&&$(this).addClass("space")}),0>o?"0":$("#tab_head_"+(o-1)+" div.space").removeClass("space"),$(".icon_book_tab_head li.tab_active").removeClass("tab_active").addClass("tab_deactive"),$("#tab_head_"+o).removeClass("tab_deactive").addClass("tab_active"),$(".icon_book_tab_body div.tab_body_item_active").removeClass("tab_body_item_active"),$("#tab_content_"+o).addClass("tab_body_item_active"),e=e||t._selected_icon_name,t._loadTabContent(o,e),t._current_tab_index=e},_loadTabContent:function(o,e){var t=this,_='<div class="icon_book_error">\u6B63\u5728\u52AA\u529B\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>';$("#tab_content_"+o).html(_);var a={ie:"utf-8"},i=$("#tab_head_"+o).tbattr("data-categoryId");a.tbs=PageData.tbs,a.category_id=i,t._icon_book_ajax&&t._icon_book_ajax.abort(),t._icon_book_ajax=$.ajax({type:"post",url:"/icon/submit/icon",data:a,dataType:"json"}).success(function(_){if(_&&0===_.no){var a=_.data,n=a.icon_info,c=t._view.getTabContent(n,e,i);$("#tab_content_"+o).html(c),t._bindTabContenEvent(o),t.initScroll(o),t._icon_tab_loaded[o]=!0,t._icon_info["category_"+o]=a.icon_info}else{var c='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$("#tab_content_"+o).html(c),$("#icon_book_reload").on("click",function(){return t._loadTabContent(o),!1})}})},_bindTabContenEvent:function(){var o=this;o._tip||(o._tip=o.use("user/widget/Icons/IconsBookTip",[o]));var e=$("#icon_book_wrap");e.on("mouseenter",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").addClass("icon_border_hover")}).on("mouseleave",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").removeClass("icon_border_hover")}),e.delegate(".icon_wrap .icon_box_place","mouseenter",function(){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),_=$(this).tbattr("data-level"),a=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.normal||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!a,slot_no:o._slot_no,value:_,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}),e.delegate(".icon_view","mouseleave",function(){setTimeout(function(){o._tip&&o._tip.hideTip&&o._tip.hideTip()},1500)}),e.delegate(".collect_icon_wrap .icon_box_place","mouseenter",function(){if(!($(this).children(".icon_locked").length>0)){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),_=$(this).tbattr("data-level"),a=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.advanced||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!a,slot_no:o._slot_no,value:_,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}}),e.delegate(".collect_icon_wrap .icon_box_place","mouseleave",function(){setTimeout(function(){o._tip.hideTip()},6e3)})},_getTabIdByCategory:function(o){for(var e=this,t=$(".icon_book_tab_head li"),_=0;_<t.length;_++)if($(t[_]).tbattr("data-categoryId")==o)return _;return e._getDefaultIndex(e.defaultCategoryId)},_getDefaultCategoryId:function(o){var e="";for(var t in o)e=t;return e},_getDefaultIndex:function(o){for(var e=$(".icon_book_tab_head li"),t=0;t<e.length;t++)if($(e[t]).tbattr("data-categoryId")==o)return t},initScroll:function(o){var e=this,t=$("#tab_content_"+o+" .icon_wrap");t&&t.length>0&&e.bindArrowScrollEvent("icon_wrap");var _=$("#tab_content_"+o+" .collect_icon_wrap");_&&_.length>0&&e.bindArrowScrollEvent("collect_icon_wrap")},bindArrowScrollEvent:function(o){var e=this;$("."+o).delegate(".icon_wrap_scroll_arrow","hover",function(){$(this).hasClass("arrow_disable")||$(this).toggleClass("arrow_hover")}),$("."+o).delegate(".right_arrow","click",function(){e._move("left",o),e._tip&&e._tip.hideTip()}),$("."+o).delegate(".left_arrow","click",function(){e._move("right",o),e._tip&&e._tip.hideTip()})},_move:function(o,e){var t=this,_=0,a=$($(".tab_body_item_active ."+e+" .icon_view")[0]).tbattr("total-col");switch(a=parseInt(a),o){case"left":_=t._moveLeft(a,e);break;case"right":_=t._moveRight(a,e)}_&&$(".tab_body_item_active .icon_wrap .icon_list").animate({left:_},300);var i=55*a;_&&(_=Math.abs(parseInt(_)),_+550>=i?($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").addClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")):($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")),0==_&&($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").addClass("arrow_disable")))},_moveLeft:function(o,e){var t=0,_=o;if(!(10>=_)){var a=55*_,i=$(".tab_body_item_active ."+e+" .icon_list").css("left"),n=Math.abs(parseInt(i));n%55!=0&&(n=n%55*55);var c=a-n;if(c>550)return t=n+165,"-"+t+"px"}},_moveRight:function(o,e){var t=0,_=o;if(!(10>=_)){var a=$(".tab_body_item_active ."+e+" .icon_list").css("left"),i=parseInt(a);if(!(i>=0))return t=Math.abs(i)-165,0>t&&(t=0),"-"+t+"px"}},closeAllCard:function(){var o=this;o._tip&&o._tip.closeTip(),o._messagebox&&o._messagebox.hideBox(),o.closeIconBook(),o._removeIconRefresh()},_setIconRefresh:function(o){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),o.children(".j_icon_slot_refresh").addClass("icon_slot_refresh")},_removeIconRefresh:function(){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}}});
;_.Module.define({path:"user/widget/Icons/IconsBookGetIcon",requires:["IconsBookCommon"],sub:{_dialog:null,initial:function(){this.common=this.use("IconsBookCommon")},get:function(){return this._dialog},show:function(){this._dialog.show()},hide:function(){this._dialog.hide()},close:function(){this._dialog.close()},_init:function(o){var i={modal:!0,showTitle:!1,fixed:!0,width:290,height:180},n=this;i.html='<div class="icon_book_dialog_wrap">'+o+"</div>",this._dialog=new $.dialog(i),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").click(function(o){o.preventDefault(),n._dialog.close()}),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},getOneIcon:function(o){var i=this;if(!o)return i._handleError(),void 0;var n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;if(!n.icon_info)return i._handleError(),void 0;i.showOneIcon(n.icon_info)}else o&&2380009===o.no?$.dialog.alert("\u540C\u540Dicon\u53EA\u80FD\u4F69\u6234\u4E00\u4E2A\uFF01"):i._handleError()})},_handleError:function(){var o=this,i=o._getErrorTpl();o._init(i),o.show(),this._dialog.element.find(".icon_book_dialog_wrap .ui_btn").click(function(){$.tb.location.reload()})},showOneIcon:function(o){var i=this,n=i._getOneIconTpl(o);i._init(n),i.show()},_getOneIconTpl:function(o){if(o){var i=this._getIconStyle(o),n={styleBg:i,iconTitle:o.title},s=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86#{iconTitle}</div>','<div class="icon_msgbox_get_icon">','<div class="msg_icon_get_one" style="left:110px;background: #{styleBg}"></div>','<div class="msg_icon_get_two"></div>','<div class="msg_icon_get_three"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return $.tb.format(s,n)}},showDurationIcon:function(o,i){var n=[];n.push(o),this.showIconList(n,i,"duration")},showIconList:function(o,i,n){var s=this,t={hide_btn:!1,close_callback:function(){},close_time:0};t=$.extend(t,i);var c=s._getIconListTpl(o,t.hide_btn,n);s._init(c),s.show(),t.close_time&&parseInt(t.close_time)>0&&setTimeout(function(){s._dialog.close()},parseInt(t.close_time)),t.close_callback&&"function"==typeof t.close_callback&&s._dialog.onclose(function(){t.close_callback()})},_getIconListTpl:function(o,i,n){var s=this,t=PageData.user.portrait;if(o||$.isArray(o)){for(var c=[],a=[],e="",_=i?"":['<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>"].join(""),l=0;l<o.length;l++){var d=s._getIconFormatInfo(o[l],o.length);c.push(d.iconTitle),a.push(d.iconTpl)}if(c=c.join(","),a=a.join(""),n&&"duration"==n){var r=this.common.getIconExpired(o[0]);r>-1&&(e="<span>\u6709\u6548\u5929\u6570\uFF1A"+r+"</span><br>")}var g=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86'+c+"</div>",'<div class="icon_msgbox_get_icon clearfix">',a,"</div>",_,'<p class="icon_book_go_home">',e,'<a href="/home/main?id='+t+'&fr=icon" target="_blank">\u53BB\u6211\u7684\u4E2A\u4EBA\u4E2D\u5FC3\u67E5\u770B>></a>',"</p>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return g}},_getIconFormatInfo:function(o,i){var n=this._getIconStyle(o),s={iconTpl:'<div class="msg_icon_get msg_icon_get_'+parseInt(i)+'" style="left:110px;'+n+'"></div>',styleBg:n,iconTitle:o.title};return s},_getIconStyle:function(o){var i=0,n=0,s="http://tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png",t=o.sprite[o.value].split(","),c=50,a=t[0],e=t[1];i=2*c,n=e*c;var _="background: url("+s+"?stamp="+a+") no-repeat -"+n+"px -"+i+"px;";return _},_getErrorTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u672A\u77E5\u9519\u8BEF</div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;">',"<span><em>\u5237\u65B0</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return o}}});
;_.Module.define({path:"user/widget/Icons/IconsBookTip",requires:["IconCard","IconsBookMessagebox","IconsBookCommon"],sub:{_icon_book_tip:null,_icon_data:null,_ajax:null,_control:null,_msgbox:null,_option:{width:"535px"},_is_show:!1,spriteImgSize:36,initial:function(o){var i=this;i.common=this.use("IconsBookCommon"),i._control=o[0]},getControl:function(){return this._control},showTip:function(o,i){if(o){var n=this,e=$("#icon_book_tip");0==e.length&&$(".icon_card_wrap").append(this._getWrapTpl()),e=$("#icon_book_tip"),n._setContent(o);var t=$(".j_icon_book_tip .j_tip_up_arrow"),s=i.position(),a=s.top,c=s.left-5,r=i.parents(".icon_view"),p=r.position(),l=parseInt(p.left)+15,d=a+106;i.parents(".collect_wrap").length>0&&(d+=146),e.css({display:"block",visibility:"visible",top:d+"px",left:l+"px","z-index":2e4});var u=parseInt(c)+25;t.css({left:u+"px"}),n._bindEvents(),$(".icon_book_tip .j_tip_icon_price").html("\u6D88\u8017"+o.icon_info.price+"T\u8C46"),n._icon_data=o,$("#j_icon_book_action_btn").one("click",function(){var i=!0,e=0,t=PageData.user.Parr_scores;t&&(e=t.scores_other+t.scores_money);var s=-1;if(s=n._icon_data.price?n._icon_data.price:n._icon_data.icon_info.price,s>0&&0>e-s&&(i=!1,$(".icon_book_tip .icon_action_wrap").html(n._getNoRemainTip()),$("#j_icon_book_recharge_btn").click(function(){_.Module.use("common/widget/TchargeDialog")})),o.in_use)1==parseInt(o.slot_no)?n._replaceIcon4FirstSlot(o):n._replaceIcon4OtherSlot(o);else if(i){var a=$("#j_icon_book_action_btn em");a.length>0&&a.html("\u8D2D\u4E70\u4E2D"),n._buyIconRequest(o)}})}},hideTip:function(){var o=this;o._is_show||o.closeTip()},closeTip:function(){tip=$("#icon_book_tip"),(tip||0!=tip.length)&&tip.remove()},_bindEvents:function(){var o=$("#icon_book_tip"),i=this;o.bind("mouseenter",function(){i._is_show=!0}).bind("mouseleave",function(){i._is_show=!1,i.hideTip()})},_replaceIcon4FirstSlot:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showReplaceFirstSlotBox(o,n,i._replaceIcon4OtherSlot,i)},_replaceIcon4OtherSlot:function(o){var i=this,n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o.icon_id,n.slot_no=o.slot_no,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;i._refreshAfterReplace(n.icon_info)}else o&&2270028===o.no?(i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou()):o&&2380009===o.no?$.dialog.alert("\u540C\u540Dicon\u53EA\u80FD\u4F69\u6234\u4E00\u4E2A\uFF01"):$.dialog.alert("\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01")})},_refreshAfterReplace:function(){var o=this;setTimeout(function(){o.closeTip()},0),o._msgbox||(o._msgbox=o.use("user/widget/Icons/IconsBookMessagebox")),o._msgbox.replaceIconSuccess(o)},_buyIcon:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showBuyIconBox(o,n,i._buyIconRequest,i)},_buyIconRequest:function(o){var i=this,n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o.icon_id,n.level=o.value,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;parr=PageData.user.Parr_scores,parr.scores_fetch=n.scores_fetch||0,parr.scores_money=n.scores_money||0,parr.scores_other=n.scores_other||0,parr.scores_total=n.scores_total,$(".j_userinfo_scores_num").html(parr.scores_money+parr.scores_other);for(var e=$(".tab_body_item_active .icon_view .icon_box_place"),t=0;t<e.length;t++){var s=$(e[t]);if(s.tbattr("data-id")==n.icon_name){s.removeClass("icon_not_use"),s.find(".j_icon_subscript").removeClass("icon_locked"),i.closeTip();break}}}else if(o&&2270028===o.no)i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou();else;})},_refreshAfterBuy:function(o){this._refreshAfterReplace(o)},_setContent:function(o){var i=this._getTpl(o);$("#icon_book_tip").html(i)},_getWrapTpl:function(){var o=['<div id="icon_book_tip" class="icon_tip_card_wrap">',"</div>"].join("");return o},_getNoRemainTip:function(){var o=['<div class="icon_action" style="padding-top: 10px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: block">T\u8C46\u4E0D\u8DB3</div>','<a href="javascript:void(0)" id="j_icon_book_recharge_btn" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5145\u503C</em></span></a>',"</div>"].join("");return o},_getTpl:function(o){var i=this,n=o.icon_info,e=n.sprite[n.value].split(","),t=50,s=e[0],_=e[1],a=0,c=_*t,r="http://tb1.bdstatic.com/tb/cms/com/icon/"+n.category_id+"_"+i.spriteImgSize+".png",p=" background:url("+r+"?stamp="+s+") no-repeat -"+c+"px -"+a+"px;",l="",d=i.common.getIconExpired(n);d>-1&&(l='<span style="margin-left: 20px;">\u5269\u4F59\u65F6\u95F4\uFF1A'+d+"\u5929</span>");var u=n.title,b=n.intro,g=n.intro_url,m={background_img:p,desc_title:u+l||"\u5370\u8BB0",desc_detail:b||"",desc_link:g||"http://tieba.baidu.com/",btn_value:o.in_use?"\u66FF\u6362":"\u8D2D\u4E70",price_info_display:1==o.in_use?"none":"block",padding_top:o.in_use?"20":"10",in_use_display:"none",in_use_text:"",button_display:0==o.in_use&&0==n.price?"none":"block"};i._judgeCommIconInSlot(o.icon_id)&&(m.button_display="none"),"none"==m.button_display&&(m.in_use_display="display",m.in_use_text="\u4F7F\u7528\u4E2D",m.price_info_display="none"),0==o.in_use&&0==n.price&&(m.in_use_text="\u6D3B\u52A8\u83B7\u53D6");var v=['<div class="icon_book_tip j_icon_book_tip">','<div class="tip_up_arrow j_tip_up_arrow"></div>','<div class="tip_body">','<div class="tip_icon">','<div class="tip_icon_img" style="#{background_img}}"></div>',"</div>",'<div class="icon_desc">','<div class="icon_desc_title"><span>#{desc_title}</span></div>','<div class="icon_desc_detail"><span>#{desc_detail}</span><a href="#{desc_link}"  target="_blank"><span style="padding-left:5px;">\u8BE6\u60C5 >></span></a></div>',"</div>",'<div class="icon_action_wrap">','<div class="icon_action" style="padding-top:#{padding_top}px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: #{price_info_display}"></div>','<div class="j_tip_icon_use tip_icon_use" style=" margin-bottom:5px;display: #{in_use_display}">#{in_use_text}</div>','<a href="javascript:void(0)" id="j_icon_book_action_btn" class="ui_btn ui_btn_m icon_book_action_btn" style="height: 27px; border-radius: 3px;display: #{button_display}"><span><em>#{btn_value}</em></span></a>',"</div>","</div>","</div>","</div>"].join("");return $.tb.format(v,m)},_judgeCommIconInSlot:function(o){var i={};for(var n in i){var e=this.common.isShowDurationIcon(i[n]);if(i[n].name==o&&e)return!0}return!1}}});
;_.Module.define({path:"user/widget/Icons/IconsBookView",requires:["IconsBookTip","IconsBookCommon"],sub:{tabIconsContentCongfig:{},_collect_icon_title:{101:"\u96C6\u9F5032\u4E2A\u56FD\u65D7\u5370\u8BB0\u5956\u52B1\u3010\u8D34\u5427\u4E16\u754C\u676F\u3011\u5370\u8BB0",102:"\u96C6\u9F5012\u4E2A\u661F\u5EA7\u5370\u8BB0\u53EF\u4EE5\u83B7\u5F9712\u4E2A\u9EC4\u91D1\u7248\u661F\u5EA7\u5370\u8BB0",103:"",104:""},spriteImgSize:36,initial:function(){},_getTabPanelTpl:function(){var o=['<div id="icon_book_wrap" class="_j_icon_book_wrap">','<div  class="icon_book">','<div class="icon_book_tab">','<ul  class="icon_book_tab_head">',"#{tabHead}","</ul>",'<div id="tab_body"  class="icon_book_tab_body">',"#{tabContent}","</div>","</div>","</div>",'<div class="icon_book_close"></div>',"</div>"].join("");return o},getTabItem:function(o){var i=this,t=['<li id="tab_head_#{index}" data-categoryId="#{category_id}" class="tab_deactive">','<div class="head_inner #{separator_cls}">','<button type="button" class="tab_button" hidefocus="true"  > ','<a href="javascript:void(0)">#{title}</a></button></div></li>'].join(""),n=['<div id="tab_content_#{index}" class=" tab_body_item ">',"</div>"].join(""),a="",c="",l=0;for(var e in o)l++;var r=0;for(var e in o){var s={index:r,category_id:e,title:o[e].name,separator_cls:r==l-1?"":"space"};r++,a+=$.tb.format(t,s),c+=$.tb.format(n,s)}var _={tabHead:a,tabContent:c},d=i._getTabPanelTpl();return $.tb.format(d,_)},getTabContent:function(o,i,t){var n="",a="",c=this,l=0,e=0;if(o=o||{},o.normal&&!o.advanced){var r=o.normal||[],s=r.length;return l=5,e=1>=s/50?10:s%l==0?Math.floor(s/l):Math.floor(s/l)+1,n+=c._getPositionIconListHtml(r,e,i,t),a=c._getCommIconWrap(null,l,e,n),c.tabIconsContentCongfig.comm={row:l,col:10,total_col:e},a}if(o.advanced&&o.advanced){var r=o.normal||[],_=o.advanced||[],s=r.length,d=_.length,v="";return l=2,e=1>=s/20?10:s%l==0?Math.floor(s/l):Math.floor(s/l)+1,n+=c._getPositionIconListHtml(r,e,i,t),a=c._getCommIconWrap(null,l,e,n),c.tabIconsContentCongfig.comm={row:l,col:10,total_col:e},a+=c._getDownArrowHtml(),e=1>=d/20?10:s%2==0?Math.floor(d/2):Math.floor(d/2)+1,v+=c._getPositionIconListHtml(_,e,null,t),a+=c._getAdvancedIconWrap(null,l,e,v,t),c.tabIconsContentCongfig.adv={row:l,col:10,total_col:e},a}return a},_getCommIconWrap:function(o,i,t,n){var a={arrow_top:5==i?100:45,arrow_visiblity:t>10?"visible":"hidden",height_cls:5==i?"icon_wrap_5":"",icon_list:n,total_col:t},c=['<div class="icon_wrap #{height_cls}">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="left_arrow arrow_block" style=" top:#{arrow_top}px;"></div></div>','<div class="icon_view"  total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:#{arrow_top}px;"></div></div>',"</div>"].join("");return $.tb.format(c,a)},_getAdvancedIconWrap:function(o,i,t,n,a){var c=this,l={title:c._collect_icon_title[a],arrow_visiblity:t>10?"visible":"hidden",icon_list:n,total_col:t},e=['<div class="collect_icon_wrap">','<div class="collect_icon_title"><span>#{title}</span></div>','<div class="collect_wrap">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="  left_arrow arrow_block" style="top:45px;"></div></div>','<div class="icon_view" total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow  " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:45px;"></div></div>',"</div>","</div>"].join("");return $.tb.format(e,l)},_getDownArrowHtml:function(){return'<div class="wrap_donw_arrow"></div>'},_getPositionIconListHtml:function(o,i,t,n){for(var a="",c=this,l=!1,e=o.length,r=0,s=0,_=0;e>_;_++){r=Math.floor(_/i),s=_%i;var d=55*r,v=55*s;l=t&&t==o[_].name?!0:!1;var b="";b=0==o[_].is_advanced?c._getCommonIconTpl(o[_],d,v,n,l):c._getAdvIconTpl(o[_],d,v,n),a+=b}return a},_getCommonIconTpl:function(o,i,t,n,a){var c=this,l=o.sprite[o.value].split(","),e="http://tb1.bdstatic.com/tb/cms/com/icon/"+n+"_"+c.spriteImgSize+".png",r=50,s=l[0],_=l[1],d=0,v=_*r,b="background: url("+e+"?stamp="+s+") no-repeat -"+v+"px -"+d+"px;",p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,in_use_cls:1==o.in_use?"":" icon_not_use",selected_cls:a?" icon_selected":"",level:o.value,background:b,locked_cls:0==o.in_use?" icon_locked":""};c._judgeCommIconInSlot(o)&&(p.selected_cls="icon_selected");var u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place #{in_use_cls}" style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="j_icon_subscript icon_subscript #{selected_cls} #{locked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeCommIconInSlot:function(o){var i=this,t=o.name,n={};for(var a in n){if("1"==a&&$.isEmptyObject(n[a])){var c=this._getOldIconinfoInSlot();if(t==c)return!0}if(n[a].name==t){i.common=this.use("IconsBookCommon");var l=i.common.isShowDurationIcon(o);return l?!0:!1}}return!1},_getOldIconinfoInSlot:function(){var o=$(".j_icon_slot").first();if(o){var i=o.tbattr("data-slot");return i}return null},_getAdvIconTpl:function(o,i,t,n){var a=this,c=o.sprite[o.value].split(","),l=50,e=c[0],r=c[1],s=2*l,s=0,_=r*l,d="http://tb1.bdstatic.com/tb/cms/com/icon/"+n+"_"+a.spriteImgSize+".png",v="background: url("+d+"?stamp="+e+") no-repeat -"+_+"px -"+s+"px;",b=o.is_collected,p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,clocked_cls:1==b?" ":" icon_locked",level:o.value,background:v},u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place " style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{clocked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeAdvIconLocked:function(o,i){var t=!1;switch(i=parseInt(i)){case 101:break;case 102:if(o){for(var n=0;n<o.length;n++)if(!o[n].in_use){t=!0;break}t=12==n&&0==t?!1:!0}else t=!0;break;case 103:break;case 104:}return t}}});
;_.Module.define({path:"user/widget/Icons/IconsBookMessagebox",requires:["IconCard","IconsBookCommon"],sub:{_icon_book_message_box:null,_icon_data:null,_is_show:!1,_option:{width:290},is_leave_close:!1,spriteImgSize:36,setLeaveClose:function(o){this.is_leave_close=o},initial:function(){this.common=this.use("IconsBookCommon")},showBox:function(o,i){var s=this;s._showBox(i),s.generatorBuySlot(o),s._bindEvents()},hideBox:function(){var o=this;o._is_show||o._icon_book_message_box&&(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null)},_bindEvents:function(){var o=this,i=$(".icon_card_wrap");i.bind("mouseenter",function(){o.is_leave_close&&(o._is_show=!0)}),i.bind("mouseleave",function(){o.is_leave_close&&(o._is_show=!1,o.hideBox())})},generatorBuySlot:function(o){var i=this,s=i._getBuySlotTpl(o);$(".icon_book_msgbox_body").html(s),$(".icon_book_msgbox .ui_btn").one("click",function(){i.buySlot(o)})},showReplaceFirstSlotBox:function(o,i,s,n){var _=this;setTimeout(function(){n.closeTip()},0),_._showBox(i);var c=_._getReplaceFirstSlotTipTpl(o);$(".icon_book_msgbox_body").html(c),$(".icon_book_msgbox .ui_btn").click(function(){s.call(n,o)})},showBuyIconBox:function(o,i,s,n){var c=this;setTimeout(function(){n.closeTip()},0),c._showBox(i);var e=c._getBuyIconTpl(o);$(".icon_book_msgbox_body").html(e),$(".icon_book_msgbox .ui_btn").click(function(){var i=0,e=PageData.user.Parr_scores;if(e&&(i=e.scores_other+e.scores_money),i-o.icon_info.price<0){var t=c._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(t),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}s.call(n,o.icon_info,function(){var o=c._buyIconSuccess();$(".icon_book_msgbox_body").html(o)})})},buySlot:function(o){var i=this,s=0,n=PageData.user.Parr_scores;n&&(s=n.scores_other+n.scores_money+n.scores_fetch);var c=-1;if(c=o.price?o.price:o.icon_info.price,c>0&&0>s-c){var e=i._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(e),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}var t={ie:"utf-8",slot_no:o.add_slot_no||1};t.tbs=PageData.tbs,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/addslot",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no){var s=o.data,n=i._addSuccess();$(".icon_book_msgbox_body").html(n),i._refreshSlotList();{s.scores_other||0,s.scores_money||0}i._updateTdouAccount(s.scores_other,s.scores_money,s.scores_fetch)}else if(o&&2270028===o.no)i.hasNotEnoughTdou();else{var _='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$(".icon_book_msgbox_body").html(_),$("#icon_book_reload").on("click",function(){return $.tb.location.reload(),!1})}})},_updateTdouAccount:function(o,i,s){var n=PageData.user.Parr_scores;n&&(n.scores_other=o,n.scores_money=i,n.scores_fetch=s,$(".j_userinfo_scores_num").html(o+i))},_showBox:function(o){var i=this;i.hideBox();var s=i._getTpl(),n={content:s,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:o,attr:"id='icon_book_message_box'",wrap:$("body")};i._icon_book_message_box=i.use("user/widget/Icons/IconCard",n),i._icon_book_message_box.showCard({type:"delayShow",time:200}),i._bindCloseEvent()},_bindCloseEvent:function(){var o=this;$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){o._icon_book_message_box?(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null):$("#icon_book_message_box").length>0&&$("#icon_book_message_box").remove(),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}),$(".icon_book_msgbox .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},_getTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">',"</div>",'<div class="icon_book_msgbox_close"></div>',"</div>",'<div class="icon_book_down_arrow"></div>',"</div>"].join("");return o},_refreshSlotList:function(){var o=$(".j_icon_slot").length,i=28*o,s='<a href="javascript:void(0)" data-slot="'+(o+1)+'" data-name="" title="\u70B9\u51FB\u6DFB\u52A0\u5370\u8BB0" class="j_slot_null_icon j_icon_slot icon_slot_null_icon" style="top:0px;left:'+i+'px"><div class=" j_icon_slot_refresh"></div></a>';$(".icon_slot_wrap .icon_add_solt").css({left:28*(o+1)}),$(".icon_slot_wrap .icon_add_solt").before(s),8==$(".j_icon_slot").length&&$(".icon_add_solt").remove()},_addSuccess:function(){var o=['<div class="icon_msgbox_title"></div>','<div class="icon_msgbox_detail">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u5370\u8BB0\u63D2\u69FD</div>'].join("");return o},_buyIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u65B0\u5370\u8BB0</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u5FEB\u53BB\u56FE\u9274\u770B\u770B\u5427</em></span></a>',"</div>"].join("");return o},_replaceIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u5370\u8BB0\u66FF\u6362\u6210\u529F</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a  href="javascript:void(0)" class="ui_btn ui_btn_m j_replace_ok" style="height: 27px; border-radius: 3px;"><span><em>\u786E\u5B9A</em></span></a>',"</div>"].join("");return o},_hasNotEnoughTdou:function(){var o=['<div class="icon_msgbox_title">T\u8C46\u4E0D\u8DB3</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u7ACB\u5373\u5145\u503C</em></span></a>',"</div>"].join("");return o},_getBuySlotTpl:function(o){var i={price:o.price},s=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u8017#{price}T\u8C46\u5F00\u542F\u5370\u8BB0\u63D2\u69FD</div>','<div class="icon_msgbox_detail" style="padding-top:15px;">(\u5F00\u542F\u540E\u514D\u8D39\u66F4\u6362\u5370\u8BB0)</div>','<div class="icon_msgbox_action" style="padding-top: 25px;">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5F00\u542F</em></span></a>',"</div>"].join("");return $.tb.format(s,i)},_getReplaceFirstSlotTipTpl:function(o){var i=this,s=o.old_icon_info,n=o.icon_info,_=this.common.isShowDurationIcon(s),c=_?i._getIconBackground(s):"",e=i._getIconBackground(n),t={old_background:c,background:e},a=['<div class="icon_msgbox_title">\u70B9\u51FB\u66FF\u6362\u5F53\u524D\u5370\u8BB0</div>','<div class="icon_msgbox_icon_replace_detail">','<div class="msg_icon_replace_current" style="#{old_background}"></div>','<div class="msg_icon_replace_arrow"></div>','<div class="msg_icon_replace_new" style="#{background}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px"><span><em>\u66FF\u6362</em></span></a>',"</div>"].join("");return $.tb.format(a,t)},_getIconBackground:function(o){var i=0,s=0,n="http://tb1.bdstatic.com/tb/cms/com/icon/"+o.category_id+"_"+this.spriteImgSize+".png";if(o){var _=o.sprite[o.value].split(","),c=50,e=_[0],t=_[1];i=0,s=t*c;var a="background: url("+n+"?stamp="+e+") no-repeat -"+s+"px -"+i+"px;";return a}return""},_getBuyIconTpl:function(o){var i=this,s=i._getIconBackground(o.icon_info),n={price:o.icon_info.price,background:s},_=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u801710000T\u8C46\u8D2D\u4E70\u8BE5\u5370\u8BB0</div>','<div class="icon_msgbox_icon_buy">','<div class="msg_icon_buy_icon" style="#{background}}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u8D2D\u4E70</em></span>","</a>","</div>"].join("");return $.tb.format(_,n)},hasNotEnoughTdou:function(o){var i=this;o||(o=$(".icon_wrap .j_icon_slot_refresh")),i._showBox(o);var s=i._hasNotEnoughTdou();$(".icon_book_msgbox_body").html(s),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})},replaceIconSuccess:function(o){var i=this,s=$(".icon_wrap .icon_slot_refresh");s&&(s=s.parent()),i._showBox(s);var n=i._replaceIconSuccess();if($(".icon_book_msgbox_body").html(n),$(".icon_book_msgbox_body .j_replace_ok").on("click",function(){$.tb.location.reload()}),$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){$.tb.location.reload()}),o){var _=o.getControl();_&&_.closeIconBook()}}}});
;_.Module.define({path:"user/widget/Icons/IconsBookCommon",requires:[],sub:{initial:function(){},isDurationIcon:function(e){return e?4==e.type?!0:!1:!1},getIconExpired:function(e){var n=-1;if(!e)return n;var r=e.type,t=e.end_time,i=Env.server_time/1e3;return 4==r&&t>=i&&(n=((t-i)/86400).toFixed(1)),n},isShowDurationIcon:function(e){if(!e)return!1;var n=e.type,r=e.end_time,t=Env.server_time/1e3;return 4!=n?!0:r>=t?!0:!1}}});
;_.Module.define({path:"user/widget/Icons/IconCard",sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("icon_white_down").removeClass("icon_white_up").addClass("icon_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="icon_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content icon_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow icon_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show,this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/widget/baseDialogUserBar",requires:["common/widget/baseUserData","common/widget/Icons"],sub:{tpl:'<div class="base_dialog_user_bar base_user_data">      <div class="header_title">          <span class="header_icon"></span>          <span><%=title%></span>      </div>      <div class="user_info">              <span class="title_acc">\u8D26\u53F7\uFF1A                  <%= userIcon %>                  <a class="title_acc_name <%=member_red%> "><%=user_name%></a>              </span>              <%if(is_tdou_info_display){%>              <span class="tdou_remain">T\u8C46\u4F59\u989D\uFF1A                  <span class="tdou_remain_num">                      <span class="user_tdou_icon"></span>                      <span class="j_tdou"><%=tdou_num%></span>                  </span>                  </span>          <%}%>      </div>      <a class="header_close j_header_close"></a>  </div>',initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon(),this.icon=this.requireInstance("user/widget/Icons")},getUserBarTemplate:function(e){var a=this,s="",r=!0;e&&"getmember"==e?(s=a.member.action_title,r=!1):s="\u83B7\u53D6T\u8C46";var t="";("ordinary_member_icon"==$.trim(a.member.icon)||"super_member_icon"==$.trim(a.member.icon))&&(t=" member_red ");var i=this.icon.getPreIconHtml($.getPageData("user.mParr_props"),$.getPageData("user"),!0),n={user_name:a.dataProxy.getUserName(),tdou_num:a.dataProxy.getUserTdou(),member:a.member.icon,member_red:t,title:s,is_tdou_info_display:r,userIcon:i},o=window._.template(a.tpl,n);return o}}});_.Module.define({path:"common/widget/qianbaoPurchaseMember",requires:["common/widget/qianbaoCashierDialog","common/widget/baseUserData","common/widget/baseDialogUserBar"],sub:{$root:null,memberOptions:null,initial:function(){var e=this;e.cashierDialog=e.requireInstance("common/widget/qianbaoCashierDialog"),e.baseData=e.requireInstance("common/widget/baseUserData"),e.baseDialogUserBar=this.requireInstance("common/widget/baseDialogUserBar"),e.vip3Src="http://tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-vip3_ce04181.png",e.vip4Src="http://tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-vip4_d9b7cf1.png",e.return_url=e.cashierDialog.getPageUrl(),e.cashierDialog.bind("event_tdou_qianbao_pay_again",e.payAgain,e)},payAgain:function(){var e=this;e.showDialog(e.memberOptions)},showDialog:function(e){var t=this;t.product=e.product||"member",t.memberOptions=e,t.member=t.baseData.getMemberIcon(),1==t.member.level||-1==t.member.level?(t.initMemberId="1050001",t.initMemberCount="3"):(t.initMemberId="1050002",t.initMemberCount="3"),t.getPayMemberOrder(t.initMemberId,t.initMemberCount,function(e){var a={qianbao_params:e};t.showMember(a);var i=t.cashierDialog.getParams(e);t.orderId=i.orderId})},showMember:function(e){var t=this,a=e.qianbao_params||"",i=$.extend(e,{baseDialogUserBarTpl:t.baseDialogUserBar.getUserBarTemplate("getmember"),vip3Src:t.vip3Src,vip4Src:t.vip4Src,type_1050001:2==t.member.level||-2==t.member.level?" hide_type_1050001":""}),r=$.tb.format('<div class="qianbao_cashier_purchase_member base_user_data">      #{baseDialogUserBarTpl}      <div class="member_cashier_wrap j_member_cashier_wrap" id="member_cashier_wrap">          <div class="member_wrap">              <label class="goods_title">\u9009\u62E9\u4F1A\u5458\uFF1A</label>              <ul class="member_list j_member_list">                  <li class="member_item j_order_update j_type_1050001 #{type_1050001}">                      <label class="member-type" id="ptype-1050001" data-name="\u8D34\u5427\u4F1A\u5458" data-value="1050001">                            <img src="#{vip3Src}">                          \u8D34\u5427\u4F1A\u5458                      </label>                  </li>                  <li class="member_item recommend j_order_update  j_type_1050002">                      <label class="member-type" id="ptype-1050002" data-name="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458" data-value="1050002">                          <img src="#{vip4Src}">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458                      </label>                  </li>                  <li class="member-tips #{type_1050001}">                      <p>\u8BF7\u9009\u62E9\u8D2D\u4E70\u5546\u54C1</p>                  </li>              </ul>              <div class="form-explain default" style="display: none;"></div>              <div class="form-explain priority" style="display: none;">\u5F00\u901A\u4F1A\u5458\u540E\uFF0C\u60A8\u5C06\u4F18\u5148\u4EAB\u53D7\u8D85\u7EA7\u4F1A\u5458\u7279\u6743\uFF0C\u8D85\u7EA7\u4F1A\u5458\u8FC7\u671F\u540E\u7EE7\u7EED\u4EAB\u53D7\u539F\u666E\u901A\u4F1A\u5458\u7279\u6743</div>          </div>          <div class="member_time_wrap">              <label class="goods_title time-title">\u9009\u62E9\u65F6\u957F\uFF1A</label>              <ul class="time_list j_time_list">                  <li class="time_item  j_order_update j_time_item" style="display: list-item;">                      <label class="time-type" for="vip_month_1" id="vip_month_1" data-value="1">                          1\u4E2A\u6708                      </label>                  </li>                  <li class="time_item j_order_update j_time_item" style="display: list-item;">                      <label  class="time-type" for="vip_month_3" id="vip_month_3" data-value="3">                          3\u4E2A\u6708                      </label>                  </li>                  <li class="time_item j_order_update j_time_item" style="display: list-item;">                      <label  class="time-type" for="vip_month_6" id="vip_month_6" data-value="6">                          6\u4E2A\u6708                      </label>                  </li>                  <li class="time_item j_order_update j_time_item j_vip_month_12" style="display: list-item;">                      <label  class="time-type" for="vip_month_12" id="vip_month_12" data-value="12">                          12\u4E2A\u6708                      </label>                  </li>                  <li class="custum_time j_custum_time">                      <label for="month-custum" class="month_custum">                          <input type="text" class="ui-input "                                 name="month-custum" id="month-custum"                                 placeholder="\u5176\u4ED6">\u4E2A\u6708                      </label>                  </li>                  <li class="member-tips">                      <p>\u8BF7\u9009\u62E9\u65F6\u957F</p>                  </li>              </ul>              <div class="form-error"></div>          </div>      </div>      </div>',i),l={qianbao_params:a,product:"member"};t.cashierDialog.showDialog(l,r,function(e){t.$root=e,t.initUI(t.initMemberId,t.initMemberCount),t.bindEvents()})},initUI:function(e,t){var a=this;a.selectedUI(e,t)},selectedUI:function(e,t){var a=this;a.$root.find(".j_member_list li").removeClass("selected"),a.$root.find(".j_type_"+e).addClass("selected"),a.$root.find(".j_time_list li").removeClass("selected");var i=a.$root.find("#vip_month_"+t);i.length?(i.parents("li.j_time_item").addClass("selected"),a.$root.find("#month-custum").val("")):a.$root.find(".j_custum_time").addClass("selected")},updatePayUI:function(e,t){var a=this;a.cashierDialog.showPayLoading(),e&&t&&a.getPayMemberOrder(e,t,function(e){a.cashierDialog.changeoPayAmount(e)})},bindEvents:function(){var e=this,t=120;e.$root.find(".j_order_update").on("click",function(t){t.stopPropagation(),t.preventDefault();var a=$(t.target),i="",r="";a.hasClass("member-type")?(i=a.data("value"),r=e.$root.find(".j_time_list li.selected .time-type").data("value"),r||(r=e.$root.find("#month-custum").val())):a.hasClass("time-type")&&(e.$root.find("#month-custum").val(""),r=a.data("value"),i=e.$root.find(".j_member_list li.selected .member-type").data("value")),e.selectedUI(i,r),e.updatePayUI(i,r)}),e.$root.find("#month-custum").on("input propertychange",function(){var a=/^[1-9]\d*$/,i=$(this),r=i.val();(r&&!a.test(r)||a.test(r)&&r>t)&&(r=r.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),r=Math.min(t,r),0==r&&(r=1),i.val(r),e.showCustomMonthBubble());var l=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(l,r)}).on("focus",function(a){var i=$(a.target);e.$root.find(".j_time_list li").removeClass("selected"),e.$root.find(".j_custum_time").addClass("selected"),e.cashierDialog.showPayLoading();var r=i.val(),l=/^[1-9]\d*$/;(r&&!l.test(r)||l.test(r)&&r>t)&&(r=r.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),r=Math.min(t,r),0==r&&(r=1),i.val(r),e.showCustomMonthBubble());var o=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(o,r)}),e.$root.find(".j_header_close").on("click",function(){e.cashierDialog.closeDialog()}),e.$root.find(".j_vip_month_12").hover(function(){e.showMonth12Bubble()},function(){e.hideMonth12Bubble()})},getPayMemberOrder:function(e,t,a){var i=this,r={terminal:"pc",pay_type:1,channel:2,memberId:e,memberCount:t,pageUrl:i.return_url};i._getPayMemberAjax&&i._getPayMemberAjax.abort(),i._getPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/getPayUrl",data:r,cache:!1,dataType:"json"}).success(function(e){0==e.no&&a&&a(e.data.return_url)})},updatePayMemberOrder:function(e,t,a,i){var r=this,l={terminal:"pc",pay_type:1,channel:2,order_id:a,memberId:e,memberCount:t,pageUrl:r.return_url};r._upPayMemberAjax&&r._upPayMemberAjax.abort(),r._upPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/upOrder",data:l,cache:!1,dataType:"json"}).success(function(e){0==e.no&&i&&i(e.data)})},createBubble:function(e){var t=$.extend(e,{arrow_dir:"down",arrow_pos:{left:30},closeBtn:!1,level:1,arrowReq:!0});return new UiBubbleTipBase(t)},showMonth12Bubble:function(){var e=this;e.hideCustomMonthBubble();var t=e.$root.find(".j_vip_month_12");if(!e.bubble_month_12){var a={content:"\u4E00\u6B21\u6027\u5F00\u901A12\u4E2A\u6708\u4EE5\u4E0A\u4F1A\u5458\uFF0C\u8D60\u9001\u8FDE\u7EED\u7B7E\u5230\u53613\u5F20",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_month_12=e.createBubble(a)}e.bubble_month_12.showBubble()},hideMonth12Bubble:function(){var e=this;e.bubble_month_12&&e.bubble_month_12.hideBubble()},showCustomMonthBubble:function(){var e=this,t=e.$root.find(".j_custum_time");if(!e.bubble_custom_month){var a={content:"\u4E00\u6B21\u6027\u53EA\u80FD\u5F00\u901A120\u4E2A\u6708\u8D34\u5427\u4F1A\u5458",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_custom_month=e.createBubble(a)}e.bubble_custom_month.showBubble()},hideCustomMonthBubble:function(){var e=this;e.bubble_custom_month&&e.bubble_custom_month.hideBubble()}}});_.Module.define({path:"common/widget/payMember",requires:["common/widget/qianbaoPurchaseMember","common/widget/Tdou/TdouOpenType"],sub:{pay_member_url:"/tbmfall/getPayUrl",PayMemberUrl:"/tbmall/getMyPayType",CASHIER:1,QIANBAO:2,initial:function(){var e=this;e.cashierDialog=e.requireInstance("common/widget/cashierDialog"),e.qianbaoPayMember=e.requireInstance("common/widget/qianbaoPurchaseMember"),e.openTypeList=e.requireInstance("common/widget/Tdou/TdouOpenType",{type:"member"})},showCashier:function(e){var a=this,i=e||{};$.extend(i,{fr:i.fr||"",track:"memberpay"}),this.opt=i,a._openCtrl("dialog"),a.payType=a.QIANBAO,a.payTypeCtrl()},_openCtrl:function(e){var a=this,i=a.openTypeList.getOpenType(a.opt.scene_id);switch(e="win"===e||"dialog"===e?e:i){case"win":a.openNewWindow();break;case"dialog":}},openNewWindow:function(){this.win=window.open("")},openDialog:function(){var e=this.opt;1==this.payType?this.cashierDialog.showDialog(e):this.qianbaoPayMember.showDialog(e)},_getPayType:function(e){var a=this,i=this.opt.scene_id;e?(a.payType=e,a.payTypeCtrl()):(e=1,$.ajax({type:"GET",dataType:"json",url:a.PayMemberUrl,data:{terminal:"pc",pay_type:"member",id:i},success:function(i){0==i.no&&(e=Number(i.data.pay_type_id)||1),a.payType=e,a.payTypeCtrl()}}))},payTypeCtrl:function(){var e=this;e.openDialog()}}});_.Module.define({path:"common/widget/tchargeDialog",requires:[],sub:{initial:function(e){var t=this;t.requireInstanceAsync("common/widget/Tdou",[],function(c){e&&e.chargeType&&"platform"==e.chargeType?c.factory("payment",e):(e&&(t.consumption_path=e.consumption_path,t.desc=e.desc,t.current_need_tdou=e.current_need_tdou,t.is_direct_cashier=e.is_direct_cashier),e&&t.is_direct_cashier?c.factory("auto_direct",e):c.factory("get_icon",e))})}}});_.Module.define({requires:["common/widget/LoginDialog","common/widget/payMember"],path:"common/widget/JoinVipDialog",sub:{objGet:function(i,e,o){o=void 0===o?null:o,e=e.split(".");var t,n=i;for(t in e){if(!("object"==typeof n&&e[t]in n))return o;n=n[e[t]]}return n},objSet:function(i,e,o){return i[e]=o,i},initial:function(){},getMemberDialog:function(i,e){var o=this;return this.objGet(window,"PageData.user.is_login",!1)?(this.gotoCashier(i,e),!1):(o.requireInstance("common/widget/LoginDialog"),!1)},gotoCashier:function(i,e){var o=this.requireInstance("common/widget/payMember"),t=this.objSet({},"fr",i||"\u8D2D\u4E70\u4F1A\u5458");t=this.objSet(t,"scene_id",e||0),o.showCashier(t)}}});_.Module.define({path:"tbmall/widget/forumMemberDialog",requires:["tbmall/widget/tbean_safe_ajax","common/widget/cashierDialog","common/widget/messenger","common/widget/baseUserData","common/widget/payMember","common/widget/tcharge_dialog"],sub:{opts:{},tpl_data:{forums:null,bd_rp_time:[1,3,6,12]},tpl:{hd:'<p class="title"><i class="forum-member-dialog-title-icon"></i>#{title}</p>'},initial:function(e){if(!$.getPageData("user.is_login",0))return this.requireInstanceAsync("common/widget/LoginDialog",["","userBar"]),void 0;var i=this,t={is_show_features:!0,is_show_forum:!0,current_time_order:1,current_option:null,current_time_unit:3,current_forum_id:"",current_forum_name:"",isCurForumMember:!1};this.opts=$.extend({},t,e),this.tpl_data.forums=this.opts.forums,this.opts.scores=this.opts.scores||PageData.scores,this.tdouInUser=i.opts.scores.scores_money+i.opts.scores.scores_other,this.FORUM_MEMBER_TITLE="\u5355\u5427\u4F1A\u5458",this.safeAjax=this.requireInstance("tbmall/widget/tbean_safe_ajax"),this.showDialog({showTitle:!1,width:710,html:i.buildInitHtml()}),i.bindEvents(),this.JoinVipDialog=this.requireInstance("common/widget/JoinVipDialog"),i.setDefaultContent()},setDefaultContent:function(){this._dialog.element.find(".j_pertime_unit:eq("+this.opts.current_time_order+")").click()},checkTdouEnough:function(){var e=this,i=e.getTimeValue(),t=parseInt(5e3*i);e.tdouInUser<t?(e._dialog.element.find(".not-enough-tbean-alert").css("display","inline-block"),e._dialog.element.find(".get-tdou-text").show(),e._dialog.element.find(".j_charge_tdou").addClass("btn-disabled")):(e._dialog.element.find(".not-enough-tbean-alert").hide(),e._dialog.element.find(".get-tdou-text").hide(),e._dialog.element.find(".j_charge_tdou").removeClass("btn-disabled"))},bindEvents:function(){var e=this;this._dialog.element.on("click",".j_charge_tdou",function(){if(!$(this).hasClass("btn-disabled")){var i=$("#customTime").val();return $.trim(i).length>0&&!e.util._isPositiveDigital(i)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(i),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),void 0):(e.initBuyMember(),void 0)}}),this._dialog.element.on("click",".j_close_excharge",function(i){i.preventDefault(),e.closeDialog()}),this._dialog.element.on("click",".j_pertime_unit",function(i){i.preventDefault(),e.changeCurrentOpt($(this),"current_time_unit"),e._close_tip_bubble(),e.changeTdouNum(),e.checkTdouEnough(),$("#customTime").val("")}),this._dialog.element.on("focus","#customTime",function(){e.changeCurrentOpt($(this).closest(".j_customTime_unit"),"current_time_unit"),e.changeTdouNum()}),this._dialog.element.on("keyup","#customTime",function(){var i=$(this).val();return $.trim(i).length>0&&!e.util._isPositiveDigital(i)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(i),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),e.changeTdouNum(),void 0):(e._close_tip_bubble(),e.checkTdouEnough(),e.changeTdouNum(),void 0)}),this._dialog.element.on("click",".select-forum-input",function(){e.showSelectForumContainer()}),this._dialog.element.on("mouseleave",".sel_forum",function(){e._dialog.element.find(".select-forum-list-container").hide()}),this._dialog.element.on("click",".open-super-member",function(){e.closeDialog(),e.JoinVipDialog.getMemberDialog("forumMembersDisalog",1005001e3)}),this._dialog.element.on("click",".get-tdou-text",function(i){i.preventDefault(),e.closeDialog(),e.requireInstance("common/widget/tcharge_dialog")})},initTdouNotEnough:function(e,i){var t=this,s=t.getTimeValue(),o={month:s,baidu_charge:i,tdou_num:e};t.closeDialog(),t.chargeFailFn($.extend({},o,{f_name:t.opts.current_forum_name}))},purchaseMember:function(e){var i=this,t={open_id:e.open_id,order_id:e.order_id,timestamp:e.timestamp,scene_id:e.scene_id,pay_type:e.pay_type,from:"\u5355\u5427\u4F1A\u5458\u4E2D\u5FC3",goods_name:e.goods_name,goods_image:e.goods_image||"",goods_price:e.goods_price,goods_amount:e.goods_amount,goods_unit:"\u4E2A",goods_duration:e.goods_duration,free_vip_level:e.free_vip_level,tdou_num:e.tdou_num};$.extend(t,{chargeType:"platform"}),i.payment=i.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"==e.command&&"success"==$.getPageData("data.error","error",e)&&(i.closeDialog(),i.chargeSuccessFn(e.data))}),i.payment.createMain(t)},initBuyMember:function(){var e=this,i=e.getTimeValue(),t=function(){var t={from:"pc",tbs:PageData.tbs};t.props_id=e.opts.current_forum_id,t.forum_id=e.opts.current_forum_id,t.props_num=i,$.post("/celebrity/submit/genOrder",t,function(i){return 0===i.no?(e.purchaseMember(i.data),void 0):(e.closeDialog(),e.chargeFailFn(i),void 0)})};t()},changeCurrentOpt:function(e,i){var t=this;t.opts.current_option&&t.opts.current_option.removeClass(i),t.opts.current_option=e,t.opts.current_option.addClass(i)},changeTdouNum:function(){var e=this;this._dialog.element.find(".sel_tdou .tdou_num").text(5e3*e.getTimeValue())},getTimeValue:function(){var e=$.trim($("#customTime").val());return this.opts.current_option&&this.opts.current_option.data("value")?this.opts.current_option.data("value"):0===e.length&&""===e?0:e},chargeFailFn:function(e){var i,t=this,s="auto";if(2270046===e.no)i=_.template('<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro">\u60A8\u5DF2\u5F00\u901A25\u4E2A\u5427\u7684\u7279\u6743\u5305\uFF0C\u8FBE\u5230\u7279\u6743\u5305\u6570\u91CF\u4E0A\u9650</p>     <p class="sub_intro">\u7ACB\u5373\u5F00\u901A\u8D34\u5427\u4F1A\u5458\uFF0C\u5C3D\u4EAB\u8D34\u5427\u7279\u6743\u65E0\u4E0A\u9650</p>     <a class="j_charge_confirm charge_tdou btn_default btn_small" href="#">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a> </div>')(),s=216;else if(2270074===e.no)i=_.template('<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>')({mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u7528\u6237\u6700\u591A\u4E00\u6B21\u53EA\u80FD\u8D2D\u4E70120\u4E2A\u6708"}),s=216;else if(170003===e.no)i=_.template('<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>')({mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u60A8\u8FD8\u672A\u5173\u6CE8\u8BE5\u5427"}),s=216;else{if(1990018===e.no){var o=$.dialog.confirm("T\u8C46\u4E0D\u8DB3\uFF0C\u8BF7\u5151\u6362T\u8C46");return o.bind("onaccept",function(){t.requireInstance("common/widget/tcharge_dialog"),t.dialog.close()}),void 0}i=_.template('<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>')({mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u5F88\u9057\u61BE\uFF0C\u8D2D\u4E70\u5931\u8D25\u4E86..."}),s=216}t.showDialog({width:537,height:s,showTitle:!1,html:i}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),t.closeDialog(),$.tb.location.reload()})},chargeSuccessFn:function(e){var i,t=this,s="auto";0==e.no&&(i=t.buildSuccessHtml(e.data),t.opts.scores=$.extend(t.opts.scores,e.data.left_scores),t.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other),t.showDialog({width:537,height:s,showTitle:!1,html:i}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),t.closeDialog(),$.tb.location.reload()}),this._dialog.element.on("click",".get-exp-gift",function(){t.requireInstanceAsync("tbmall/widget/exp_package_dialog",[{is_show_features:!1,is_show_forum:!1,current_forum_id:t.opts.current_forum_id,current_forum_name:t.opts.current_forum_name,scores:t.opts.scores,cnt_height:225,is_celebrity_forum:t.isCelebrityForum,isCurForumMember:t.opts.isCurForumMember,user:t.opts.user}])})},getUserName:function(){var e=this.requireInstance("user/widget/userApi",[]),i="",t=PageData.user,s=$.getPageData("forum.id");return i=e.checkSuperMemberShipOf(t)?'<i class="icon-vip2-16"></i><a class="vip-red">'+$.getPageData("user.user_name")+"</a>":e.checkSingleForumMembershipOf(t,s)?'<i class="icon-vip3-16"></i><a class="vip-red">'+$.getPageData("user.user_name")+"</a>":$.getPageData("user.user_name")},buildInitHtml:function(){var e=this,i="";i=e.opts.is_show_forum?"\u5151\u6362"+e.FORUM_MEMBER_TITLE:"\u5151\u6362["+e.opts.current_forum_name+"\u5427]"+e.FORUM_MEMBER_TITLE;var t=this.getUserName(),s=_.template('<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_hd">     <p class="title">         <i class="forum-member-dialog-title-icon"></i><%= title %>         <span class="user-info">             <span class="user-name">\u5E10\u53F7\uFF1A<%= username %></span>             <span class="tdou-in-user">T\u8C46\u4F59\u989D\uFF1A<span class="tdou-in-user-num"><%= tdouInUser %></span></span>         </span>     </p> </div> <div class="excharge_bd">     <div class="sel_member">         <span class="sel_label">\u9009\u62E9\u4F1A\u5458:</span>         <div class="single-forum-member">             <i class="single-forum-icon"></i>             <p class="member-label-title">\u5355\u5427\u4F1A\u5458</p>             <p>                 <span class="member-label-orange">5000</span>                 <span class="member-label-text">T\u8C46/\u6708</span>             </p>             <span class="decorate_icon"></span>         </div>         <span class="member-label-text">\u60F3\u76F4\u63A5\u5347\u7EA7\u4E3A800\u4E07\u4E2A\u5427\u7684\u5355\u5427\u4F1A\u5458\uFF1F</span>         <span class="open-super-member">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</span>     </div>     <div class="sel_forum">         <span class="sel_label">\u9009\u62E9\u5427:</span>         <input class="select-forum-input" placeholder="\u9009\u62E9\u9700\u8981\u5F00\u901A\u4F1A\u5458\u7684\u5427" />         <div class="select-forum-list-container"></div>     </div>     <div class="sel_time">         <span class="sel_label">\u9009\u62E9\u65F6\u957F:</span>         <span class="sel_cnt">             <%for(var i = 0; i< bd_rp_time.length; i++){%>             <a class="j_pertime_unit per_time_unit" data-value="<%=bd_rp_time[i]%>">                 <strong><%=bd_rp_time[i]%></strong>\u4E2A\u6708                 <span class="decorate_icon"></span>             </a>             <%}%>             <a class="j_customTime_unit per_time_unit custom_time">                 <input id="customTime" type="text" value="" placeholder="\u5176\u4ED6" /><span>\u4E2A\u6708</span>                 <span class="decorate_icon"></span>             </a>         </span>     </div>     <p class="long_time_warning" <%= p_style %>>\u7279\u6743\u5305\u65F6\u957F(\u7D2F\u8BA1\u8D85\u7EA7\u4F1A\u5458)\u6700\u591A\u8FDE\u7EED24\u4E2A\u6708\uFF0C\u8D85\u51FA\u90E8\u5206\u53EA\u8D60\u9001\u7ECF\u9A8C\u548C\u9053\u5177\u3002</p>     <div class="sel_tdou">         <span class="sel_label">\u8FD8\u9700\u652F\u4ED8:</span>         <span class="tdou_num"><%= tdou_num %></span>         <div class="not-enough-tbean-alert">             \u60A8\u7684T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u8BF7\u5148\u83B7\u53D6T\u8C46         </div>     </div>     <a class="j_charge_tdou btn-encourage btn-larger charge_tdou" onclick="return false;" href="#">\u7ACB\u5373\u5151\u6362</a>     <span class="get-tdou-text">\u83B7\u53D6T\u8C46</span> </div>')({title:i,tdou_num:5e3*e.opts.current_time_unit,bd_rp_time:e.tpl_data.bd_rp_time,p_style:e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",tip:e.opts.is_celebrity_forum?"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u62E5\u6709":"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u4F7F\u7528\u7279\u6743",tdouInUser:this.tdouInUser,username:t});return s},buildSuccessHtml:function(e){var i,t=this,s="",o=$.getPageData("forum.first_class");return i=t.opts.is_celebrity_forum?1:-1==$.inArray(o,["\u6587\u5B66","\u52A8\u6F2B","\u6E38\u620F"])?-1:0,s=_.template('<div class="forum-member-success-dialog">     <a class="outpage_close j_close_excharge" href="#"></a>     <h4 class="title">         <% if (isCurForumMember) { %>             \u60A8\u7684[<%= forunName %>\u5427]\u4F1A\u5458\u7EED\u8D39\u6210\u529F         <% } else { %>             \u606D\u559C\u60A8\u6210\u4E3A[<%= forunName %>\u5427]\u4F1A\u5458         <% } %>     </h4>     <div class="privilege-area">         <p class="line-style-title">             <span class="line-style-title-content">\u60A8\u5DF2\u4EAB\u6709\u4EE5\u4E0B\u7279\u6743</span>         </p>         <ul class="privilege-list">             <li>                 <i class="privilege-crown privilege-icon"></i>                 <br/>                 \u7687\u51A0\u8EAB\u4EFD             </li>             <li>                 <i class="privilege-red-name privilege-icon"></i>                 <br/>                 \u663E\u793A\u7EA2\u540D             </li>             <li>                 <i class="privilege-sign privilege-icon"></i>                 <br/>                 \u7B7E\u52306\u500D\u7ECF\u9A8C             </li>             <li>                 <i class="privilege-red-title privilege-icon"></i>                 <br/>                 \u7EA2\u8272\u6807\u9898             </li>             <% if (celebrity_type == 1) { %>             <li>                 <i class="privilege-mark privilege-icon"></i>                 <br/>                 \u672C\u5427\u4E13\u5C5E\u5370\u8BB0             </li>             <li>                 <i class="privilege-card-bg privilege-icon"></i>                 <br/>                 \u5B9A\u5236\u540D\u7247\u80CC\u666F             </li>             <li>                 <i class="privilege-top-thread privilege-icon"></i>                 <br/>                 \u540D\u4EBA\u9876\u8D34             </li>             <li>                 <i class="privilege-head-border privilege-icon"></i>                 <br/>                 \u5B9A\u5236\u5934\u50CF\u8FB9\u6846             </li>             <% } %>         </ul>         <% if (celebrity_type == 0) { %>         <p class="gray-text">\u5427\u4E3B<a href="http://tieba.baidu.com/celebrity/rankHome#npc_vote" target="_blank">\u7533\u8BF7\u540D\u4EBA\u5802\u540E</a>\uFF0C\u624D\u80FD\u89E3\u9501\u4EE5\u4E0B\u7279\u6743\uFF1A</p>         <ul class="privilege-unactivated-list">             <li>                 <i class="privilege-mark privilege-unactivated-icon"></i>                 \u672C\u5427\u4E13\u5C5E\u5370\u8BB0             </li>             <li>                 <i class="privilege-card-bg privilege-unactivated-icon"></i>                 \u5B9A\u5236\u540D\u7247\u80CC\u666F             </li>             <li>                 <i class="privilege-top-thread privilege-unactivated-icon"></i>                 \u540D\u4EBA\u9876\u8D34             </li>             <li>                 <i class="privilege-head-border privilege-unactivated-icon"></i>                 \u5B9A\u5236\u5934\u50CF\u8FB9\u6846             </li>         </ul>         <% } %>     </div>     <div class="privilege-area">         <p class="line-style-title">             <span class="line-style-title-content">\u83B7\u5F97\u793C\u7269</span>         </p>         <ul class="gift-list">             <li>                 <i class="gift-resign gift-icon"></i>                 <br/>                 \u8865\u7B7E\u5361x1             </li>             <li>                 <i class="gift-exp-privilege gift-icon"></i>                 <br/>                 \u672C\u5427\u7ECF\u9A8C\u4E66\u8D2D\u4E70\u6743             </li>         </ul>     </div>     <div class="success-footer">         <button class="btn-sub btn-middle j_close_excharge" >\u786E\u5B9A</button>         <button class="btn-encourage btn-middle get-exp-gift" >\u8D2D\u4E70\u7ECF\u9A8C\u4E66</button>     </div> </div>')($.extend(e,{celebrity_type:i,isCurForumMember:t.opts.isCurForumMember,forunName:t.opts.current_forum_name}))},showErrorForum:function(e){},hideErrorForum:function(){"pass"},checkHasForum:function(e,i){var t=this;$.post("../get/checkForum",{forum_name:encodeURIComponent(e),tbs:PageData.tbs}).done(function(e){0===e.no&&(0===e.data.forum_id&&null===e.data.forum_name?t.showErrorForum("hasNot"):(t.hideErrorForum(),$.isFunction(i)&&i(e)))})},showDialog:function(e){this._dialog=new $.dialog(e)},closeDialog:function(){this._dialog&&this._dialog.close()},_build_tip_bubble:function(e){var i=this,t={content:e,arrow_dir:"up",bubble_css:{top:i.opts.is_show_forum?124:52,right:45,width:130,"z-index":9999},arrow_pos:{left:10},attr:"",wrap:$(".sel_time"),closeBtn:!0};this.opts.tip_bubble=new UiBubbleTipBase(t);var s=this.opts.tip_bubble;s.showBubble(),s.bind("onclose",function(){i._close_tip_bubble()})},_close_tip_bubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.hideBubble()},_show_tip_bubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.showBubble()},_printTimeErrorInfo:function(e){this.opts.tip_bubble?this._show_tip_bubble():this._build_tip_bubble(e)},util:{_isEmpty:function(e){return 0===$.trim(e).length},_isPositiveDigital:function(e){return/^[1-9]+[0-9]*]*$/.test(e)},_getDate:function(e){var i=new Date(1e3*e),t=i.getFullYear(),s=i.getMonth()+1,o=i.getDate();return t+"\u5E74"+s+"\u6708"+o+"\u65E5"}}}});_.Module.define({requires:["tbmall/widget/forumMemberDialog","common/widget/JoinVipDialog"],path:"pfrs/widget/FanspartyAside",sub:{initial:function(t){this.bindEvents(),this.fid=t.fid,this.options=t},bindEvents:function(){var t=this;$("#btn_cheer").on("click",function(){return t.options.isEnrollEnd?!1:PageData.user.is_login?($.post("/star/submit/go",{forum_id:t.fid,tbs:PageData.tbs},function(e){e&&t.showDialog(e.no)}),!1):(TbCom.process("User","buildLoginFrame"),!1)}),$("#link_cheer").on("click",function(){var t=new $.dialog({html:'<div class="cheer-dialog"><p class="cheerdialog-title">\u4EB2\u7231\u7684\u7C89\u4E1D\uFF0C\u4F60\u6BCF\u5929\u4F1A\u83B7\u5F973\u4E2A\u52A9\u5A01\u503C\uFF0C\u6BCF\u4E2A\u5427\u6BCF\u5929\u53EF\u4F7F\u7528\u4E00\u6B21\u3002\u622A\u6B628\u670829\u65E523\uFF1A59\u7C89\u4E1D\u8282\u5427\u699C\u5355\u6392\u540D\u524D70\u7684\u5427\u5C06\u83B7\u9080\u53C2\u5C55\u7C89\u4E1D\u8282\u5609\u5E74\u534E\uFF0C\u540C\u65F6\u5F00\u901A\u672C\u5427\u5F62\u8C61\u529F\u80FD\u3002</p><button class="btn-sub btn-middle cheerdialog-btn" id="btn_cheerdialog">\u77E5\u9053\u4E86</button></div>',title:"\u52A9\u5A01\u8BF4\u660E",width:383,height:140});return $("#btn_cheerdialog").on("click",function(){return t.close(),!1}),!1}),$(".fansparty-wrap2 .task-item").eq(1).hover(function(){$(this).css("cursor","pointer").tbattr("title","\u70B9\u51FB\u67E5\u770B\u8BE6\u60C5")}),$(".fansparty-wrap2 .task-item").eq(1).on("click",function(){window.open("/p/3981276334")})},showDialog:function(t){var e={1:{title:"\u4ECA\u65E5\u52A9\u5A01\u6210\u529F\uFF01",content:["<span style='margin-right:10px;'>\u52A9\u5A01+1</span>\u4F1A\u5458\u7279\u6743\uFF1A\u52A9\u5A01+2"],linkText:"\u5151\u6362\u672C\u5427\u4F1A\u5458",linkValue:""},2:{title:"\u4ECA\u65E5\u52A9\u5A01\u6210\u529F\uFF01",content:["<span style='margin-right:10px;'>\u52A9\u5A01+2</span>\u8D85\u7EA7\u4F1A\u5458\uFF1A\u52A9\u5A01+3"],linkText:"\u5151\u6362\u8D85\u7EA7\u4F1A\u5458",linkValue:""},3:{title:"\u4ECA\u65E5\u52A9\u5A01\u6210\u529F\uFF01",content:["\u52A9\u5A01+3"],linkText:"",linkValue:""},14:{title:"\u4EB2\uFF0C\u4E00\u5929\u4E00\u4E2A\u5427\u53EA\u80FD\u6295\u4E00\u7968\u54DF\uFF0C\u660E\u5929\u518D\u4E3A\u672C\u5427\u6295\u7968\u5427\uFF01",content:[""],linkText:"",linkValue:""},22:{title:"\u5DF2\u8FC7PK\u65F6\u95F4\uFF0C\u8BF7\u5173\u6CE8\u540E\u7EED\u7C89\u4E1D\u8282\u6D3B\u52A8\u5427\uFF01",content:[],linkText:"",linkValue:""},23:{title:"\u4EB2\uFF0C\u4F60\u6240\u4F7F\u7528\u7684IP\u4ECA\u5929\u6295\u7968\u592A\u591A\u5566\uFF0C\u660E\u5929\u518D\u8BD5\u5427\uFF01",content:[],linkText:"",linkValue:""},24:{title:"\u4EB2\uFF0C\u4E00\u5929\u6700\u591A\u6295\u4E09\u7968\u54DF\uFF0C\u660E\u5929\u518D\u6765\u5427\uFF01",content:[],linkText:"",linkValue:""}},n=e[t];n||(n={title:"\u51FA\u9519\u4E86\uFF0C\u8BF7\u518D\u8BD5\u4E00\u6B21",content:["\u9519\u8BEF\u7801\uFF1A["+t+"]"],linkText:"",linkValue:""});var i='<div class="cheer-tip">';i+='<p class="cheertip-title">'+n.title+"</p>";for(var l=0;l<n.content.length;l++)i+='<p class="cheertip-item">'+n.content[l]+"</p>";i+='<p class="cheertip-btns"><button class="btn-sub btn-middle" id="btn_cheertip">\u77E5\u9053\u4E86</button>',""!==n.linkText&&(i+='<a class="btn-default btn-middle btn_link" target="_blank" href="'+n.linkValue+'">'+n.linkText+"</a>"),i+="</p>",i+="</div>";var r=new $.dialog({html:i,title:"",width:415,height:125}),a=this;1==t&&($("#j_cheer_val").text(parseInt($("#j_cheer_val").text())+1),r.element.find(".btn_link").on("click",function(){return a.buyMember(),r.close(),!1})),2==t&&($("#j_cheer_val").text(parseInt($("#j_cheer_val").text())+2),r.element.find(".btn_link").on("click",function(){return a.buySuperMember(),r.close(),!1})),3==t&&$("#j_cheer_val").text(parseInt($("#j_cheer_val").text())+3),$("#btn_cheertip").on("click",function(){return r.close(),!1})},buyMember:function(){var t={scores_money:0,scores_other:0};this.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:PageData.forum.forum_id,current_forum_name:PageData.forum.forum_name,scores:PageData.user.Parr_scores?PageData.user.Parr_scores:t,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}})},buySuperMember:function(){var t=this.requireInstance("common/widget/JoinVipDialog");t.getMemberDialog()},playMotion:function(){var t=0,e=$("#cheer_effect"),n=function(){t++;var i=0;i=50>t?5*Math.sin(t/50*2*Math.PI):t-50,e.css({top:50-t+"px",left:150+i+"px",width:t/90*10+18,height:t/90*10+18}),90>t?(e.show(),setTimeout(n,20)):e.hide()};n()}}});_.Module.define({path:"frs/widget/stockAsideConcepts",requires:[],sub:{initial:function(t){try{this.concepts=t.concepts,this.numMap={0:"&#xe60f;",1:"&#xe601;",2:"&#xe602;",3:"&#xe603;",4:"&#xe604;",5:"&#xe605;",6:"&#xe606;",7:"&#xe607;",8:"&#xe608;",9:"&#xe609;",".":"&#xe60b;","-":"&#xe60c;","+":"&#xe60d;",up:"&#xe60e;",down:"&#xe600;",equal:"",bg:"&#xe60a;"},this.conceptsTml="#{conceptsItems}",this.initConcepts()}catch(c){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:c.message||c.description,path:"frs:widget/stock_aside_concepts/stock_aside_concepts.js",method:"",ln:35}),c}},initConcepts:function(){for(var t,c,e="",o=0;o<this.concepts.length;o++){var s,n,i,a;this.concepts[o]&&(this.concepts[o].change_ratio?(this.concepts[o].change_ratio=this.changeTwoDecimal_f(this.concepts[o].change_ratio),this.concepts[o].change_ratio>0?(s="color_01",n="up"):this.concepts[o].change_ratio<0&&(s="color_02",n="down"),this.concepts[o].change_ratio=this.concepts[o].change_ratio+"%"):0==this.concepts[o].change_ratio&&""!=this.concepts[o].change_ratio?(this.concepts[o].change_ratio="0.00%",s="color_03",n="equal"):(this.concepts[o].change_ratio="&#xe60c;&#xe60c;",s="color_03 iconfont no_data",n="equal")),this.concepts[o+1]?(this.concepts[o+1].change_ratio?(this.concepts[o+1].change_ratio=this.changeTwoDecimal_f(this.concepts[o+1].change_ratio),this.concepts[o+1].change_ratio>0?(i="color_01",a="up"):this.concepts[o+1].change_ratio<0&&(i="color_02",a="down"),this.concepts[o+1].change_ratio=this.concepts[o+1].change_ratio+"%"):0==this.concepts[o+1].change_ratio?(this.concepts[o+1].change_ratio="0.00%",i="color_03",a="equal"):(this.concepts[o+1].change_ratio="&#xe60c;&#xe60c;",i="color_03 iconfont no_data",a="equal"),e+="<dl><dt>"+this.concepts[o].concept_name.substr(0,4)+"</dt><i class='iconfont "+s+"'>"+this.numMap[n]+"</i><dd class='"+s+"'>"+this.concepts[o].change_ratio+"</dd><dt>"+(this.concepts[o+1]&&this.concepts[o+1].concept_name.substr(0,4))+"</dt><i class='iconfont "+i+"'>"+this.numMap[a]+"</i><dd class='"+i+"'>"+(this.concepts[o+1]&&this.concepts[o+1].change_ratio)+"</dd></dl>"):e+="<dl><dt>"+this.concepts[o].concept_name.substr(0,4)+"</dt><i class='iconfont "+s+"'>"+this.numMap[n]+"</i><dd class='"+s+"'>"+this.concepts[o].change_ratio+"</dd></dl>",o++}c={conceptsItems:e},t=$.tb.format(this.conceptsTml,c),$(".stock_aside_concepts_wrap .concepts_content").html(t)},changeTwoDecimal_f:function(t){var c=parseFloat(t);if(isNaN(c))return!1;c=Math.round(100*t)/100;var e=c.toString(),o=e.indexOf(".");for(0>o&&(o=e.length,e+=".");e.length<=o+2;)e+="0";return e}}});_.Module.define({path:"frs/widget/stockAsideIndexs",requires:[],sub:{initial:function(e){try{this.indexs=e.indexs,this.initIndexs()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/stock_aside_indexs/stock_aside_indexs.js",method:"",ln:13}),i}},initIndexs:function(){for(var e,i,t=0;this.indexs&&t<this.indexs.length;t++){var n=this.indexs[t];n.change=this.changeTwoDecimal_f(n.change),n.change_ratio=this.changeTwoDecimal_f(n.change_ratio),n.close=this.changeTwoDecimal_f(n.close)}e={indexs:this.indexs},i=baidu.template("stock_aside_index_template",e),$(".stock_aside_indexs .indexs_content").html(i)},changeTwoDecimal_f:function(e){var i=parseFloat(e);if(isNaN(i))return alert("function:changeTwoDecimal->parameter error"),!1;i=Math.round(100*e)/100;var t=i.toString(),n=t.indexOf(".");for(0>n&&(n=t.length,t+=".");t.length<=n+2;)t+="0";return t}}});_.Module.define({path:"frs/widget/stockAsideIndustry",requires:[],sub:{initial:function(t){try{this.industry=t.industry,this.tml="<dl><dt class='textCenter'>\u9886\u6DA8\u884C\u4E1A</dt><dd class='dd_w1 textCenter'>\u6DA8\u5E45</dd><dt class='textCenter'>\u9886\u8DCC\u884C\u4E1A</dt><dd class='dd_w2 textCenter'>\u8DCC\u5E45</dd></dl>",this.initIndustry()}catch(d){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:d.message||d.description,path:"frs:widget/stock_aside_industry/stock_aside_industry.js",method:"",ln:20}),d}},initIndustry:function(){var t,d,i,s,n,e=this.tml,r=this.industry&&this.industry.leading&&this.industry.leading.length,a=this.industry&&this.industry.leading_by&&this.industry.leading_by.length;t=a>r?r:a;for(var l=0;t>l;l++)d=this.changeTwoDecimal_f(this.industry.leading[l].change_ratio),i=this.changeTwoDecimal_f(this.industry.leading_by[l].change_ratio),s=d>0?"color_01":0==d?"color_03":"color_02",n=i>0?"color_01":0==i?"color_03":"color_02",e+="<dl><dt>"+(this.industry.leading[l]?this.industry.leading[l].industry_name.substr(0,4):"--")+"</dt><dd class='dd_w1 "+s+"'>"+d+"%</dd><dt>"+(this.industry.leading_by[l]?this.industry.leading_by[l].industry_name.substr(0,4):"--")+"</dt><dd class='dd_w2 "+n+"'>"+i+"%</dd></dl>";$(".stock_aside_industry .industry_content").html(e)},changeTwoDecimal_f:function(t){var d=parseFloat(t);if(isNaN(d))return alert("function:changeTwoDecimal->parameter error"),!1;d=Math.round(100*t)/100;var i=d.toString(),s=i.indexOf(".");for(0>s&&(s=i.length,i+=".");i.length<=s+2;)i+="0";return i}}});_.Module.define({path:"frs/widget/stockAsideFocusForum",requires:[],sub:{initial:function(){try{this.bindEvents()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/stock_aside_focus_forum/stock_aside_focus_forum.js",method:"",ln:12}),e}},bindEvents:function(){}}});_.Module.define({path:"tbmall/widget/exp_package_dialog",requires:["tbmall/widget/tbean_safe_ajax","user/widget/userApi","common/widget/Tdou/TdouViewPay","common/widget/tcharge_dialog","tbmall/widget/forumMemberDialog"],sub:{opts:{},initial:function(e){var t=this,a={is_show_features:!0,is_show_forum:!0,current_time_order:1,current_option:null,current_time_unit:3,current_forum_id:"",current_forum_name:"",isCurForumMember:!1};this.opts=$.extend({},a,e),this.opts.scores=this.opts.scores||PageData.scores,this.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,this.FORUM_MEMBER_TITLE=this.opts.is_celebrity_forum?"\u5355\u5427\u4F1A\u5458":"\u5427\u7279\u6743\u5305",this.safeAjax=this.requireInstance("tbmall/widget/tbean_safe_ajax"),this.showDialog(),this.bindEvents()},getUserName:function(){var e=this.requireInstance("user/widget/userApi",[]),t="",a=window.PageData.user,s=$.getPageData("forum.forum_id");return t=e.checkSuperMemberShipOf(a)?'<i class="icon-vip2-16"></i><a class="vip-red">'+$.getPageData("user.user_name")+"</a>":e.checkSingleForumMembershipOf(a,s)?'<i class="icon-vip3-16"></i><a class="vip-red">'+$.getPageData("user.user_name")+"</a>":$.getPageData("user.user_name")},showDialog:function(){var e=this,t=this.getUserName(),a=_.template('<div class="exp-pageckage-dialog">     <a class="outpage-close j-close-excharge" href="#"></a>     <p class="title">         <i class="forum-member-dialog-title-icon"></i>\u5151\u6362[<%= forumName %>\u5427]\u7ECF\u9A8C\u4E66         <span class="user-info">             <span class="user-name">\u5E10\u53F7\uFF1A<%= username %></span>             <span class="tdou-in-user">T\u8C46\u4F59\u989D\uFF1A<span class="tdou-in-user-num"><%= tdouInUser %></span></span>         </span>     </p>     <div class="exp-package-dialog-body">         <div class="exp-package-intro">             <i class="icon-exp-package-logo"></i>             <p>                 <i class="icon-tbean"></i>                 <span class="exp-orange-text">5000</span>/\u4E2A             </p>             <p>\uFF08\u6BCF\u4E2A\u7ECF\u9A8C\u4E66<span class="exp-orange-text">+50</span>\uFF0C\u8D2D\u4E70\u7ACB\u5373\u751F\u6548\uFF09</p>         </div>         <div class="exp-package-parchase-container">             <p class="input-container">                 <label>\u9009\u62E9\u65F6\u957F\uFF1A</label>                 <span class="controller-input-container">                     <button class="cut-btn">-</button>                     <input class="exp-num-input" type="text" value="3"/>                     <button class="add-btn">+</button>                 </span>             </p>             <p class="input-container">                 <label>\u8FD8\u9700\u652F\u4ED8\uFF1A</label>                 <i class="icon-tbean"></i>                 <span class="exp-orange-text exp-tbean-num">15000</span>             </p>             <%             if (!isCurForumMember) {             %>             <p class="open-member-text">\u5F00\u901A                 <i class="icon-vip3-16"></i>                 <span class="orange-text j-open-single-member">\u672C\u5427\u4F1A\u5458</span>                 \u4E4B\u540E\u624D\u80FD\u5151\u6362\u7ECF\u9A8C\u4E66             </p>             <button class="btn-middle btn-encourage single-member-btn j-open-single-member">\u5F00\u901A\u5355\u5427\u4F1A\u5458</button>             <% } else { %>             <button class="btn-middle btn-encourage exp-btn">\u7ACB\u5373\u5151\u6362</button>             <% } %>         </div>     </div> </div>')({tdou_num:5e3*e.opts.current_time_unit,p_style:e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",tip:e.opts.is_celebrity_forum?"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u62E5\u6709":"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u4F7F\u7528\u7279\u6743",tdouInUser:this.tdouInUser,forumName:$.getPageData("forum.forum_name"),username:t,isCurForumMember:e.opts.isCurForumMember});this.dialog=new $.dialog({showTitle:!1,width:700,html:a})},_changeExpInputValue:function(e){e=e||0;var t=this.getExpInputValue();t+=e,t=0>t?0:t,this.$expInput.val(t)},getExpInputValue:function(){var e=parseInt(this.$expInput.val(),10)||0;return e},_updateView:function(e){this.dialog.element.find(".exp-tbean-num").html(e)},purchaseExp:function(e){var t=this,a={open_id:e.open_id,order_id:e.order_id,timestamp:e.timestamp,scene_id:e.scene_id,pay_type:e.pay_type,from:"\u5355\u5427\u4F1A\u5458\u7ECF\u9A8C\u4E66",goods_name:e.goods_name,goods_image:e.goods_image||"",goods_price:e.goods_price,goods_amount:e.goods_amount,goods_unit:"\u4E2A",goods_duration:e.goods_duration,free_vip_level:e.free_vip_level,tdou_num:e.tdou_num};$.extend(a,{chargeType:"platform"}),t.payment=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&$.tb.location.reload()}),t.payment.createMain(a)},bindEvents:function(){var e=this;this.$expInput=this.dialog.element.find(".exp-num-input"),this.dialog.element.on("click",".add-btn",function(){e._changeExpInputValue(1);var t=e.getExpInputValue();e._updateView(5e3*t)}),this.dialog.element.on("click",".cut-btn",function(){e._changeExpInputValue(-1);var t=e.getExpInputValue();e._updateView(5e3*t)}),this.dialog.element.on("click",".exp-btn",function(){var t=e.getExpInputValue();if(t>200)return $.dialog.alert("\u6700\u591A\u53EA\u80FD\u8D2D\u4E70200\u4E2A\u7ECF\u9A8C\u4E66"),void 0;var a={from:"pc",tbs:PageData.tbs};a.props_id=2000163,a.forum_id=$.getPageData("forum.forum_id"),a.props_num=e.getExpInputValue(),$.post("/celebrity/submit/genOrder",a,function(t){if(1990043===t.no)$.dialog.alert("\u60A8\u4E0D\u662F\u6B64\u5427\u7684\u4F1A\u5458");else if(170003===t.no)$.dialog.alert("\u60A8\u8FD8\u672A\u5173\u6CE8\u6B64\u5427");else if(1990018===t.no){var a=$.dialog.confirm("T\u8C46\u4E0D\u8DB3\uFF0C\u8BF7\u5151\u6362T\u8C46");a.bind("onaccept",function(){e.requireInstance("common/widget/tcharge_dialog"),e.dialog.close()})}else 0===t.no&&e.purchaseExp(t.data)})}),this.dialog.element.on("click",".j-open-single-member",function(){e.dialog.close();var t=PageData.forum;e.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:t.id,current_forum_name:t.forum_name,scores:e.opts.scores,cnt_height:225,isCurForumMember:e.opts.isCurForumMember,callback:function(){$.tb.location.reload()}})}),this.dialog.element.on("click",".j-close-excharge",function(){e.dialog.close()}),this.$expInput.keyup(function(){e._changeExpInputValue(0);var t=e.getExpInputValue();e._updateView(5e3*t)})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"puser/widget/celebrity_forum_dialog",requires:["tbmall/widget/forumMemberDialog"],sub:{initial:function(i){this._params=i,this._user=PageData.user,this._bindEvents()},_bindEvents:function(){var i=this._params.$root,s=this;i.on("click",function(){if(!s._user.is_login)return s.requireInstanceAsync("pcommon/widget/LoginDialog"),void 0;var i=$(this).data("forumid")||s._params.forumId||PageData.forum.id;$.post("/celebrity/submit/getForumSupport",{forum_id:i,tbs:PageData.tbs},function(i){if(i.data&&i.data.length>0){var e=s.formatForumSupportData(i.data[0]);s._showDialog(e)}})})},formatForumSupportData:function(i){var s,e=i.npc_info.level_id;return s=3>=e?"1":e>3&&5>=e?"2":e>5&&7>=e?"2_1":e>7&&9>=e?"2_2":e>9&&11>=e?"3":e>11&&13>=e?"3_1":e>13&&15>=e?"3_2":"4",i.npc_info.lvStyle=s,i},_showDialog:function(i){var s='<!-- htmlcs-disable --> <div class="celebrity_forum_dialog_wrap">  <div class="dialog_content">   <div class="dialog_left">    <div class="npc_info">     <a href="/celebrity/rankHome" target="_blank">     <img src="http://himg.baidu.com/sys/portraitm/item/<%=npc_info.npc_avatar%>" width="140" height="140" />     </a>     <div class="user_level">      <p class="uname">       <i class="icon-vip2-18"></i>       <a href="/celebrity/rankHome" target="_blank"><%=npc_info.npc_name%></a>       <i class="icon_red"></i>      </p>      <a href="/f/like/level?kw=<%=encodeURIComponent(npc_info.npc_forum_name)%>&ie=utf-8" target="_blank" title="\u672C\u5427\u5934\u8854<%=npc_info.level_id%>\u7EA7\uFF0C\u7ECF\u9A8C\u503C<%=npc_info.cur_score%>\uFF0C\u70B9\u51FB\u8FDB\u5165\u672C\u5427\u5934\u8854\u8BF4\u660E\u9875" class="badge_f badge badge_lv<%=npc_info.lvStyle%>">       <div class="badge_name"><%=npc_info.level_name%></div>       <div class="badge_index"><%=npc_info.level_id%></div>      </a>      <div class="exp">       <div class="exp_lable">\u7ECF\u9A8C\uFF1A</div>       <a class="exp_bar exp_bar_f" href="/f/like/level?kw=<%=encodeURIComponent(npc_info.npc_forum_name)%>&ie=utf-8" target="_blank">        <div class="exp_bar_current exp_bar_current_f" style="width:<%=(npc_info.cur_score * 100) / (npc_info.cur_score + npc_info.score_left)%>%;"></div>        <div class="exp_num">         <span class="exp_current_num"><%=npc_info.cur_score%></span>         <span>/<%=npc_info.cur_score + npc_info.score_left%></span>        </div>       </a>      </div>      <p>\u540D\u4EBA\u699C\u6392\u540D\uFF1A<span class="red_text"><%=npc_info.npc_rank%></span></p>      <p><a href="/celebrity/rankHome" target="_blank">\u67E5\u770B\u540D\u4EBA\u699C>></a></p>     </div>    </div>    <div class="npc_sign_info">     <div class="info_top">      \u52A9\u653B\u8BE6\u60C5     </div>     <div class="info_content">      <p class="today">\u4ECA\u65E5\u52A9\u653B\u4EBA\u6570\uFF1A<b><%=npc_info.total_person%></b></p>      <div class="detail">       <div class="col2_left">        <p class="my-orange-text"><%=user.my_continue_days%></p>        <p>\u6211\u8FDE\u7EED\u52A9\u653B</p>       </div>       <div class="col2_right">        <p class="my-orange-text"><%=user.my_total_days%></p>        <p>\u6211\u7D2F\u79EF\u52A9\u653B</p>       </div>      </div>     </div>    </div>    <div class="npc_sign">     <a href="javascript:;" data-forumid="<%=npc_info.npc_forum_id%>" data-npcid="<%=npc_info.npc_id%>" class="sign_btn j_sign_btn <% if (user.is_signed) { %> disable <% } %>"><% if (user.is_signed) { %>\u4ECA\u65E5\u5DF2\u52A9\u653B<% } else { %>\u70B9\u6211\u52A9\u653B<% } %></a>    </div>   </div>   <div class="dialog_right">    <div class="scroll_wrapper">    <ul>     <% for (var i = 0, l = props.length; i < l; i++) { %>     <li class="npc_prop_item">      <div class="item_pic">       <img src="<%=props[i].logo_picurl%>" width="70" height="70" />       <% if (props[i].is_unlock == 0) { %>        <div class="lock" style="height: <%=100 - props[i].lock_npc_percent %>%"></div>        <div class="lock_num">        <% if (props[i].lock_npc_percent == 0) { %>         <i class="icon_lock"></i>        <% } else { %>         <%= props[i].lock_npc_percent %>%        <% } %>        </div>       <% } %>      </div>      <div class="item_intro">        <h4><%=props[i].title%></h4>        <p class="title-sub-text">\u89E3\u9501\u6761\u4EF6\uFF1A         <%=npc_info[\'npc_name\']%>\u8D26\u53F7\u8FBE\u5230<b><%=props[i].lock_npc_level%></b>\u7EA7</p>        <p class="title-sub-text">\u9886\u53D6\u6761\u4EF6\uFF1A        <% if (props[i].props_category == 300) { %>         \u6BCF\u5929\u53EF\u4F7F\u75281\u6B21\uFF0C\u672C\u5427\u4F1A\u5458\u4F7F\u7528\u6B21\u6570\u4E0D\u9650        <% } else { %>         <% if (props[i].limit_sign_level == 0 && props[i].lock_need_vip == 0) { %>          \u65E0         <% }         if (props[i].limit_sign_level > 0) { %>          <%=npc_info[\'npc_fans_name\']%>\u8FDE\u7EED\u52A9\u653B<b><%=props[i].limit_sign_level%></b>\u6B21         <% }          if ( props[i].lock_need_vip == 1 ) {            if (props[i].limit_sign_level > 0) {%>\uFF0C<% } %>          <span class="red_text">\u672C\u5427\u4F1A\u5458\u4E13\u5C5E</span>         <% }         }        %>       </p>      </div>      <div class="item_action">       <% if (props[i].is_unlock == 0) { %>        <button class="btn_sub btn_middle btn_disable">\u5F85\u89E3\u9501</button>       <% } else if (props[i].can_get == 0) { %>        <button class="btn_sub btn_middle btn_disable">\u5F85\u9886\u53D6</button>       <% } else if (props[i].is_used == 0) { %>        <button class="btn_default btn_middle j_btn_get" data-propsid="<%=props[i].props_id%>">&nbsp;\u9886&nbsp;&nbsp;\u53D6&nbsp;</button>       <% } else if (props[i].props_category == 200 || props[i].props_category == 113 || props[i].props_category == 300) { %>        <button class="btn_sub btn_middle btn_disable" data-propsid="<%=props[i].props_id%>">\u5DF2\u83B7\u5F97</button>       <% } else { %>        <button class="btn_sub btn_middle j_btn_unuse" data-propsid="<%=props[i].props_id%>">\u53D6\u6D88\u4F7F\u7528</button>       <% } %>       </div>     </li>     <% } %>    </ul>    </div>    <div class="privilege-wrapper">     <p class="title-sub-text">\u5151\u6362\u672C\u5427\u4F1A\u5458\uFF0C\u4EAB\u53D7\u66F4\u591A\u7279\u6743</p>     <div class="privilege-container">      <div class="privilege-item">       <i class="privilege-crown privilege-icon"></i>       <br>       <span>\u7687\u51A0\u8EAB\u4EFD</span>      </div>      <div class="privilege-item">       <i class="privilege-red-name privilege-icon"></i>       <br>       <span>\u663E\u793A\u7EA2\u540D</span>      </div>      <div class="privilege-item">       <i class="privilege-sign privilege-icon"></i>       <br>       <span>\u7B7E\u5230\u516D\u500D\u7ECF\u9A8C</span>      </div>      <div class="privilege-item">       <i class="privilege-red-title privilege-icon"></i>       <br>       <span>\u53D1\u8D34\u7EA2\u8272\u6807\u9898</span>      </div>      <div class="privilege-item">       <i class="privilege-mark privilege-icon"></i>       <br>       <span>\u672C\u5427\u4E13\u5C5E\u5370\u8BB0</span>      </div>      <div class="privilege-item">       <i class="privilege-card-bg privilege-icon"></i>       <br>       <span>\u5236\u5B9A\u540D\u7247\u80CC\u666F</span>      </div>      <div class="privilege-item">       <i class="privilege-top-thread privilege-icon"></i>       <br>       <span>\u9E23\u4EBA\u81EA\u52A8\u9876\u8D34</span>      </div>      <div class="privilege-item">       <i class="privilege-head-border privilege-icon"></i>       <br>       <span>\u5236\u5B9A\u5934\u50CF\u8FB9\u6846</span>      </div>     </div>    </div>   </div>  </div>  <div class="dialog_footer">   <p>    \u666E\u901A\u7B7E\u5230,\u672C\u5427\u7ECF\u9A8C<span class="my-orange-text">+1</span>,    <%=npc_info[\'npc_name\']%>\u7ECF\u9A8C<span class="my-orange-text">+0.1</span>    &nbsp;&nbsp;    <%=npc_info[\'npc_fans_name\']%>\u4F1A\u5458\u52A9\u653B,\u672C\u5427\u7ECF\u9A8C<span class="my-orange-text">+2</span>,    <%=npc_info[\'npc_name\']%>\u7ECF\u9A8C<span class="my-orange-text">+1</span>    &nbsp;&nbsp;    <a class="btn_default btn_small j_buy_npc_member" data-fid="<%=npc_info[\'npc_forum_id\']%>" data-fname="<%=npc_info[\'npc_forum_name\']%>" href="javascript:;">\u5151\u6362\u672C\u5427\u4F1A\u5458</a>    <button class="btn-sub btn-small hide-privilege">\u6536\u8D77\u4F1A\u5458\u529F\u80FD<i class="triangle-down"></i></button>    <button class="btn-sub btn-small show-privilege">\u67E5\u770B\u4F1A\u5458\u529F\u80FD<i class="triangle-up"></i></button>   </p>  </div> </div>',e=baidu.template(s,i),a=i.npc_info||{};this._dialog=new $.dialog({holderClassName:"celebrity_forum_dialog",html:e,width:745,height:526,title:"\u52A0\u5165"+a.npc_fans_name+",\u53C2\u52A0"+a.npc_forum_name+'\u517B\u6210\u8BA1\u5212<span class="title-sub-text">\uFF08\u60A8\u7684\u5355\u5427\u4F1A\u5458\u8FD8\u6709<span class="red-text">'+this._params.memberLastDays+"</span>\u5929\u5230\u671F\uFF09</span>",draggable:!1}),this._bindDialogEvents(this._dialog)},_bindDialogEvents:function(i){var s=this,e=$(i.element);e.find(".j_sign_btn").on("click",function(){if(!$(this).hasClass("disable")){var i=$(this).data("npcid"),e=$(this).data("forumid");$.post("/celebrity/submit/support",{forum_id:e,npc_id:i,tbs:PageData.tbs},function(i){switch(i.no){case 0:s._dialog.close();var e=s.formatForumSupportData(i.data);s._showDialog(e);break;case 340027:$.dialog.alert("\u5F88\u62B1\u6B49\uFF0C\u5C01\u7981\u7528\u6237\u65E0\u6CD5\u52A9\u653B",{title:"\u63D0\u793A"});break;default:$.dialog.alert("\u62BD\u98CE\u4E86~",{title:"\u63D0\u793A"})}})}}),e.find(".j_buy_npc_member").on("click",function(){var i=$(this).data("fid"),e=$(this).data("fname"),a={scores_money:0,scores_other:0};s.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:i,current_forum_name:e,scores:s._user.Parr_scores?s._user.Parr_scores:a,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}}),s._dialog.close()}),e.on("click",".j_btn_get",function(){var i=this,s=$(this).data("propsid");$.post("/celebrity/submit/getNpcProps",{props_id:s,tbs:PageData.tbs},function(s){0==s.no?200==s.data.props_category||300==s.data.props_category||113==s.data.props_category?$(i).text("\u5DF2\u83B7\u5F97").tbattr("class","btn_sub btn_middle btn_disable"):$(i).text("\u53D6\u6D88\u4F7F\u7528").tbattr("class","btn_sub btn_middle j_btn_unuse"):$.dialog.alert("\u62BD\u98CE\u4E86")})}),e.on("click",".j_btn_unuse",function(){var i=this,s=$(this).data("propsid");$.post("/tbmall/post/closeProps",{props_id:s,tbs:PageData.tbs},function(s){0==s.no?$(i).html("&nbsp;\u9886&nbsp;&nbsp;\u53D6&nbsp;").tbattr("class","btn_default btn_middle j_btn_get"):$.dialog.alert("\u62BD\u98CE\u4E86")})});var a=e.find(".hide-privilege"),n=e.find(".show-privilege"),t=e.find(".privilege-wrapper");e.on("click",".hide-privilege",function(){a.hide(),n.show(),t.hide()}),e.on("click",".show-privilege",function(){a.show(),n.hide(),t.show()})}}});_.Module.define({path:"tbmall/component/NetProxy",requires:["tbmall/widget/TbeanSafeAjax"],sub:{_buyPropUrl:"/tbmall/post/buyprops",_mBuyPropUrl:"/tbmall/post/mbuyprops",_usePropUrl:"/tbmall/post/openProps",_mUsePropUrl:"/tbmall/post/mopenProps",_cancelPropUrl:"/tbmall/post/closeProps",initial:function(){},buyProp:function(t,o){var r=this;t.tbs=PageData.tbs;var s=this.requireInstance("tbmall/widget/TbeanSafeAjax");s.post(r._buyPropUrl,t,o)},mBuyProp:function(t,o){var r=this;t.tbs=PageData.tbs,$.tb.post(r._mBuyPropUrl,t,o)},useProp:function(t,o){var r=this;$.tb.post(r._usePropUrl,{props_id:t,tbs:PageData.tbs},o)},mUseProp:function(t,o){var r=this;t.tbs=PageData.tbs,$.tb.post(r._mUsePropUrl,t,o)},cancelProp:function(t,o){var r=this;$.tb.post(r._cancelPropUrl,{props_id:t,tbs:PageData.tbs},o)}}});_.Module.define({path:"tbmall/component/Dialog",sub:{initial:function(){},dialog:function(n){var t=this;t.customDialog=new $.dialog({html:'<div class="dialog_ctn_wrapper"> '+n+"</div>",title:"\u63D0\u793A",width:430}),t.customDialog.bind("onclose",function(){t.trigger("onInfoClose")}),$(".charge_bean_interaction_j_charge_btn").click(function(){t.customDialog.close()}),$(".charge_bean_interaction_j_close_dialog").click(function(n){n.preventDefault(),t.customDialog.close()})},info:function(n,t){var i=this;t=t||{};var o=t.button||"\u786E \u5B9A";i.infoDialog=new $.dialog({html:'<div class="dialog_ctn_wrapper"> '+n+'<div class="confirm_wrapper theme_info"><a class="ui_btn ui_btn_m yes"><span><em>'+o+"</em></span></a></div></div>",title:t.title||"\u63D0\u793A",width:t.width||430}),i.infoDialog.element.one("click",".yes",function(n){n.preventDefault(),i.infoDialog.close(),i.trigger("onInfoYes")}),i.infoDialog.bind("onclose",function(){i.trigger("onInfoClose")})},confirm:function(n,t){var i=this,o={button:[{txt:"\u786E \u5B9A",extraclass:""},{txt:"\u53D6 \u6D88"}]};t=$.extend(o,t);var e='<a class="ui_btn ui_btn_m yes '+t.button[0].extraclass+'"><span><em>'+t.button[0].txt+'</em></span></a><a class="ui_btn ui_btn_sub_m no"><span><em>'+t.button[1].txt+"</em></span></a>";i.confirmDialog=new $.dialog({html:'<div class="dialog_ctn_wrapper"> '+n+'<div class="confirm_wrapper">'+e+"</div></div>",title:"\u63D0\u793A",width:t.width||430}),$(i.confirmDialog.getElement()).one("click",".yes",function(n){n.preventDefault(),"function"==typeof t.button[0].callback?t.button[0].callback():i.trigger("yes")}).one("click",".no",function(n){n.preventDefault(),"function"==typeof t.button[1].callback?t.button[1].callback():i.trigger("no")})},getConfirmDialog:function(){return this.confirmDialog},enableYesBtn:function(){this.confirmDialog.element.find(".yes").data("clicked",!1)},close:function(){this.confirmDialog&&this.confirmDialog.close()}}});_.Module.define({path:"tbmall/component/util",sub:{_propCategoryMap:{101:"\u53D1\u8D34\u6C14\u6CE1",102:"",103:"\u4E2A\u6027\u6C34\u5370",104:"\u70AB\u5F69\u5B57\u4F53",105:"",106:"",107:"\u9B54\u6CD5\u5F39",108:"\u8865\u7B7E\u795E\u5668",109:"\u52A8\u6001\u5934\u50CF",110:"\u5934\u50CF\u8FB9\u6846",111:"",112:"\u4E2A\u6027\u94ED\u724C",113:"\u540D\u7247\u80CC\u666F",114:"\u94ED\u724C\u91CD\u94F8\u5361",115:"",116:"\u8D34\u6761\u5361",117:"\u633D\u5C0A\u5361"},_freeUseMap:{1070001:12,1070002:12,1080001:8},_badgeMap:{1:"\u8D34\u5427\u4F1A\u5458",2:"\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"},initial:function(){},badgeNameMap:function(e){var a=parseInt(e);return a>105e4&&(a-=105e4),this._badgeMap[a]},getFreeUseCount:function(e){return this._freeUseMap[e]},getMaxLevel:function(e){var a=0,t=(new Date).getTime(),n=e||PageData.user.Parr_props;if(!n||!n.level)return 0;var r=n.level;return 1e3*r.end_time>t&&parseInt(r.props_id,10)>a&&(a=parseInt(r.props_id,10)),a},convertNumber:function(e){return e>99999999?Math.round(e/1e8,2)+"\u4EBF":e>99999?Math.round(e/1e4,2)+"\u4E07":e},formatDate:function(e){function a(e){return e>9?e:"0"+e.toString()}var t=new Date(1e3*e);return t.getFullYear()+"\u5E74"+(t.getMonth()+1)+"\u6708"+t.getDate()+"\u65E5 "+a(t.getHours())+":"+a(t.getMinutes())},hasOwnProp:function(e,a){return PageData.props[e]&&PageData.props[e][a]&&1e3*PageData.props[e][a].end_time>Env.server_time},convertToDay:function(e){return Math.ceil(e/86400)+"\u5929"},getCategoryName:function(e){return this._propCategoryMap[e]},getFreeInfo:function(e){var a=this,t='<div class="free_info">';return"1080002"==e.props_id?(t+='<span  title="'+a.badgeNameMap(2)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u4E00\u6B21\u5145\u503C12\u4E2A\u6708\uFF0C</a>\u9001\u4E09\u5F20</span>'):1==e.props_type&&a.getFreeUseCount(e.props_id)?(t+='<span  title="'+a.badgeNameMap(2)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a>\u514D\u8D39\u4F7F\u7528',t+='<span class="free_use_count">'+a.getFreeUseCount(e.props_id)+"</span>\u4E2A</span>"):1!=e.props_type&&(t+='<span  title="'+a.badgeNameMap(e.free_user_level)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level'+e.free_user_level+'"><span class="icon"></span>\u5F00\u901A'+(2==e.free_user_level?"\u8D85\u7EA7":"")+"\u4F1A\u5458</a>\u514D\u8D39\u4F7F\u7528</span>"),t+="</div>"},hasUsedProp:function(e,a){return PageData.props[e]&&!!PageData.props[e][a]&&!!parseInt(PageData.props[e][a].open_status,10)},hasBadge:function(){return PageData.props.level&&PageData.props.level.prop_id&&1e3*PageData.props.level.end_time>Env.server_time},shouldHaveProp:function(e){return e>0&&this.hasBadge()&&PageData.props.level.prop_id>=e},getBuyInfo:function(e){var a,t,n=this,r="",s=e.props_category,p=e.props_id,o=e.free_user_level,_=n.hasOwnProp(s,p),i=n.hasUsedProp(s,p),u=n.shouldHaveProp(o);return _?"1"===e.is_default_used&&(i?(t="\u53D6\u6D88\u4F7F\u7528",a="j_cancle_use"):(t="\u4F7F\u7528",a="j_use"),r+=['<a href="#" class="ui_btn ui_btn_sub_s '+a+'">',"<span><em>"+t+"</em></span>","</a>"].join("")):(u?(a="j_get_button1",t="\u9886\u53D6"):(a="j_buy_button1",t="\u5151&nbsp;&nbsp;\u6362"),r+=['<a class="ui_btn ui_btn_sub_s '+a+'">',"<span><em>"+t+"</em></span>","</a>"].join("")),r}}});_.Module.define({path:"tbmall/widget/ContSignCard",requires:["tbmall/component/util","tbmall/component/Dialog","common/widget/JoinVipDialog"],sub:{_card_count:0,_tpl:'<div class="header">\u70B9\u51FB\u6211\u5173\u6CE8\u7684\u5427\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361\uFF08<span class="condition">\u6CE8\uFF1A\u4F7F\u7528\u6761\u4EF6\u4E3A\u7D2F\u8BA1\u7B7E\u5230\u5929\u6570\u2265100\u5929\uFF0C\u4EC5\u4F1A\u5458\u53EF\u4EE5\u4F7F\u7528</span>\uFF09\uFF1A</div><div id="j_signable_list" class="signable_list"><img class="loading" src="http://tb1.bdstatic.com/tb/static-tbmall/img/loading.gif"></div><div class="bottom_info"><div class="my_cont_card">\u6211\u6709<span class="j_card_count orange_txt">0</span>\u5F20<span class="orange_txt">\u8FDE\u7EED\u7B7E\u5230\u5361</span></div><p class="">\u8FDE\u7EED\u7B7E\u5230\u5361\u5C06\u628A\u9009\u4E2D\u5427\u6240\u6709\u7684\u7B7E\u5230\u5929\u6570\u8FDE\u7EED\u5728\u4E00\u8D77\uFF01</p> </div> <div class="free_info"><span title="\u8D85\u7EA7\u8D34\u5427\u4F1A\u5458"><a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u4E00\u6B21\u5145\u503C12\u4E2A\u6708\uFF0C</a>\u9001\u4E09\u5F20</span> </div>',initial:function(){var t=this;return t.util=t.use("tbmall/component/util"),t.mdialog=t.use("tbmall/component/Dialog"),t.vip=t.use("common/widget/JoinVipDialog"),PageData.user.is_login?(t.build(),t.loadSignableList(),t.bindEvent(),void 0):(_.Module.use("common/widget/LoginDialog"),void 0)},showMemberOnly:function(){var t=this,e=['<div id="sign_tip_forNoMember" class="sign_tip_forNoMember">',"<p><span>\u8FDE\u7EED\u7B7E\u5230\u5361</span>\u662F\u4F1A\u5458\u4E13\u5C5E\u9053\u5177,\u6210\u4E3A\u4F1A\u5458\u5373\u53EF\u4F7F\u7528!</p>",'<a class="ui_btn ui_btn_m j_openMember" href="#"><span><em>\u9A6C\u4E0A\u5F00\u901A</em></span></a>','<p><a class="j_tbmall_join_vip_btn level2_icon" href="#">\u5145\u6EE112\u4E2A\u6708\u8D85\u7EA7\u4F1A\u5458</a>\u9001\u4E09\u5F20</p>',"</div>"].join(""),i=new $.dialog({html:e,title:"\u63D0\u793A",width:430,height:100});$("#sign_tip_forNoMember").delegate(".j_openMember","click",function(e){e.preventDefault(),i.close(),t.vip.getMemberDialog()}),$("#sign_tip_forNoMember").delegate(".j_tbmall_join_vip_btn","click",function(e){e.preventDefault(),i.close(),t.vip.getMemberDialog()})},build:function(){var t=this;this._dialog=new $.dialog({title:"\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361",html:t._tpl,width:662,holderClassName:"cont_sign_dialog",fixed:!1}),this._listdom=this._dialog.element.find("#j_signable_list")},loadSignableList:function(){var t=this,e="";$.tb.get("/tbmall/get/getContSignableList",function(i){if(i&&0==i.no){var a=i.data.list;if(a.length){for(var n=0,l=a.length;l>n;n++)e+='<a href="/f?kw='+encodeURIComponent(a[n].forum_name)+'&ie=utf-8" target="_blank" data-fid="'+a[n].forum_id+'" class="signable_ba j_signable_ba">'+$.tb.subByte(a[n].forum_name,11)+'<span class="forum_level lv'+a[n].level_id+'"></span></a> ';t._listdom.html(""),_.Module.use("common/widget/ScrollPanel",[{content:e,container:t._listdom,height:210}])}else e='<div class="no_signable_tip gray_txt">\u6CA1\u6709\u68C0\u6D4B\u5230\u4F60\u6709\u7D2F\u8BA1\u7B7E\u5230\u2265100\u5929\uFF0C\u6216\u8005\u65AD\u7B7E\u7684\u5427\uFF0C\u8BF7\u6838\u5B9E\u540E\u5237\u65B0\u9875\u9762\u3002</div>',t._dialog.element.find("#j_signable_list").height(280).html(e);t._card_count=i.data.card_count,t._dialog.element.find(".j_card_count").text(i.data.card_count)}else e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u8BF7\u5173\u95ED\u7A97\u53E3\u91CD\u65B0\u52A0\u8F7D",t._dialog.element.find("#j_signable_list").html(e)})},bindEvent:function(){var t=this;this._dialog.element.on("click",".j_signable_ba",function(e){return t.util.getMaxLevel()?($(this).hasClass("signed")||(e.preventDefault(),t.showBubble($(this))),void 0):(e.preventDefault(),t._dialog.close(),t.showMemberOnly(),void 0)}),this._dialog.bind("onclose",function(){t._bubble&&t._bubble.closeBubble()})},showBubble:function(t){var e=this;if(!e._isAjaxing){var i=t.data("fid"),a=t.offset(),n={arrow_dir:"up",bubble_css:{top:a.top+37,left:a.left-39,width:172,height:69,zIndex:6e4},arrow_pos:{left:87},wrap:$("body"),closeBtn:!0},l='<div class="card_bubble_content"><span>\u6CA1\u6709<span class="blue_txt">\u8FDE\u7EED\u7B7E\u5230\u5361</span></span><div><a href="/tbmall/propslist?category=108" target="_blank" class="ui_btn ui_btn_sub_s j_buy_card"><span><em>\u7ACB\u5373\u8D2D\u4E70</em></span></a> </div></div>',s='<div class="card_bubble_content"><span>\u9700\u8981\u6D88\u8017<span class="blue_txt">1\u5F20\u8FDE\u7EED\u7B7E\u5230\u5361</span></span><div><a class="ui_btn ui_btn_sub_s j_use_card"><span><em>\u786E \u5B9A</em></span></a> </div></div>',o='<div class="card_bubble_content"><span class="blue_txt">\u5DF2\u7ECF\u6210\u529F\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361,\u70B9\u51FB\u5427\u540D\u67E5\u770B</span></div>',_='<div class="card_bubble_content"><span>\u8FDE\u7EED\u7B7E\u5230\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5~</span></div>';e._bubble&&e._bubble.closeBubble(),n.content=e._card_count<1?l:s,e._bubble=new UiBubbleTipBase(n),e._bubble.j_bubble.one("click",".j_buy_card",function(){e._bubble.closeBubble()}).one("click",".j_use_card",function(a){a.preventDefault(),e._isAjaxing=!0,e._bubble.setContent('<div class="card_bubble_content"><img src="http://tb1.bdstatic.com/tb/static-tbmall/img/loading.gif">\u6B63\u5728\u8FDE\u7EED\u7B7E\u5230...</div>'),$.tb.post("/tbmall/post/useContSignCard",{forum_id:i,tbs:PageData.tbs},function(i){e._isAjaxing=!1,i&&0==i.no?(e._card_count--,e._card_count=Math.max(0,e._card_count),e._dialog.element.find(".j_card_count").text(e._card_count),e._bubble.setContent(o),t.addClass("signed")):e._bubble.setContent(_)})}),e._bubble.showBubble()}}}});_.Module.define({path:"common/widget/UserHead",sub:{initial:function(){this.initOptions()},initOptions:function(){this.options={gif:["1100001","1100002","1100003","1100013","1100015","1100016","1100017","1100019","1100133","1100135"],filter:[]}},getImgFormat:function(t){var r="png";return-1!=$.inArray(t,this.options.gif)&&(r="gif"),r},getHeadUrl:function(t){var r=t.mParr_props&&t.mParr_props.portrait||"",i="";return i=r.end_time>Env.server_time/1e3?r.url:"http://tb.himg.baidu.com/sys/portrait/item/"+t.portrait},getHeadFrameStyle:function(t,r){var i=t.mParr_props&&t.mParr_props.avatarframe||"",e="",n=null,o={hasFrame:!1,stylestr:""};return i.end_time>Env.server_time/1e3&&(e=i.props_id,n=["width:"+r+"px","height:"+r+"px","padding:10px","background:url(/tb/static-common/img/props/"+r+"/"+e+"."+this.getImgFormat(e)+") no-repeat","border:none","left:-6px","top:-6px"],o={hasFrame:!0,stylestr:n.join(";")}),o}}});_.Module.define({path:"props/component/Guide",sub:{initial:function(){},initMagicGuide:function(){var i=$.cookie("PROPS_MAGIC_GUIDE");i||($.cookie("PROPS_MAGIC_GUIDE","true",{expires:30}),this.showMagicGuide())},showMagicGuide:function(i){this.propsId=i,this.builGuideUI(),this.buildGuideEvents(),this.initGuideFlash()},initPreviewUI:function(){this.builGuideUI(),this.buildGuideEvents()},builGuideUI:function(){this.$mask=new $.modal({show:!0});var i=$('<div class="guide_wrap"></div>'),e=$('<div class="guide_content"></div>'),s=$('<a href="#" class="guide_close"></a>');i.append(e).append(s),$("body").append(i),i.css({"z-index":$.getzIndex()}),this.$guideWrap=i,this.$guideContent=e,this.$guideClose=s},buildGuideEvents:function(){var i=this;this.$mask.bind("click",function(){i.closeGuide()}),this.$guideClose.bind("click",function(){return i.closeGuide(),!1})},closeGuide:function(){this.$guideWrap.remove(),this.$mask.remove()},initGuideFlash:function(){this.buildFlashUI(),this.buildFlashEvents()},buildFlashUI:function(){this.$guideWrap.addClass("guide_wrap_magic")},buildFlashEvents:function(){var i=this,e={};e.finishPlay=function(){i.closeGuide()},window.MagicProps=e}}});_.Module.define({path:"tbmall/component/UseController",requires:["tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/component/util"],sub:{buy_number:0,initial:function(){this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util")},doUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u70B9\u51FB\u4F7F\u7528"),o.netProxy.useProp(t,function(a){var e="";if(0==a.no)e="\u4F7F\u7528\u6210\u529F\uFF01";else switch(a.no){case 2270005:e="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:e="\u5DF2\u7ECF\u4E70\u8FC7\u5566";break;case 2270004:e="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u8D2D\u4E70\u672C\u52CB\u7AE0\uFF01";break;case 2270006:e="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u8D2D\u4E70";break;default:e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}o.wrap&&o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})},cancelUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u53D6\u6D88\u4F7F\u7528"),o.netProxy.cancelProp(t,function(a){var e="";if(0==a.no)e="\u53D6\u6D88\u4F7F\u7528\u6210\u529F\uFF01";else switch(a.no){case 2270005:e="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:e="\u5DF2\u7ECF\u4E70\u8FC7\u5566";break;case 2270004:e="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u8D2D\u4E70\u672C\u52CB\u7AE0\uFF01";break;case 2270006:e="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u8D2D\u4E70";break;default:e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})}}});_.Module.define({path:"ihome/widget/Interaction",sub:{initial:function(n){n?(this.dataObj=n,this._bindEvents()):this._bindFloatEvents()},_resetDataObj:function(n){this.dataObj=n},_follow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,0);$.tb.post("/home/post/follow",{un:t.un,tbs:t.tbs},function(t){t?0==t.no?o._clearLoading(n,e,0):1130036==t.no?o._showError("\u8BE5\u7528\u6237\u4E0D\u5E0C\u671B\u88AB\u4ED6\u4EBA\u5173\u6CE8",n,0):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0)})},_showError:function(n,t,o){var e=new $.dialog({html:'<p style="text-align:center">'+n+"<p>",width:300,height:30});e.bind("onclose",function(){var n=1==o?"btn-sub btn-middle btn_concern_done":"btn_concern btn-attention btn-middle",e=1==o?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8";t.text(e).removeClass().addClass(n)})},_addLoading:function(n,t){var o=$("<span></span>"),e="",r=0,a=[".","..","..."],i=["\u5173\u6CE8\u4E2D","\u53D6\u6D88\u4E2D"],s=setInterval(function(){e=a[r++%3],o.text(e)},400);return n.text(i[t]).append(o),s},_clearLoading:function(n,t,o){var e=1==o?"btn_concern btn-attention btn-small":"btn_concern_done btn-sub btn-small",r=1==o?"\u5173\u6CE8":"\u53D6\u6D88\u5173\u6CE8";n.text(r).removeClass().addClass(e),clearInterval(t)},_unfollow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,1);$.tb.post("/home/post/unfollow",{un:t.un,tbs:t.tbs},function(t){t&&0==t.no?o._clearLoading(n,e,1):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u53D6\u6D88\u5173\u6CE8\u5931\u8D25",n,1)})},_bindEvents:function(){var n=this;$("#userinfo_wrap").delegate(".btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("#userinfo_wrap").delegate(".btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})},_bindFloatEvents:function(){var n=this;$("body").delegate(".card_headinfo_wrap .btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("body").delegate(".card_headinfo_wrap .btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})}}});_.Module.define({requires:["user/widget/userApi"],path:"common/widget/MemberApi",sub:{initial:function(){},getMemberNameClass:function(e,r){var i="";if(Env.server_time>13962816e5&&Env.server_time<1396368e6&&4!=r)return i=" vip_red ";var t=this.requireInstance("user/widget/userApi",[]),n=$.getPageData("forum.forum_id",0),s={mParr_props:e};return t.checkSingleForumMembershipOf(s,n)&&(i=" vip_red "),e&&e.level&&e.level.end_time>Env.server_time/1e3&&(i=" vip_red "),i}}});_.Module.define({path:"ihome/widget/MonthIcon",sub:{iconTitle:{"01":"\u6469\u7FAF\u5EA7","02":"\u6C34\u74F6\u5EA7","03":"\u53CC\u9C7C\u5EA7","04":"\u767D\u7F8A\u5EA7","05":"\u91D1\u725B\u5EA7","06":"\u53CC\u5B50\u5EA7","07":"\u5DE8\u87F9\u5EA7","08":"\u72EE\u5B50\u5EA7","09":"\u5904\u5973\u5EA7",10:"\u5929\u79E4\u5EA7",11:"\u5929\u874E\u5EA7",12:"\u5C04\u624B\u5EA7"},initial:function(){},getMonthIcon:function(i,n){i=i||{},n=n||1;var t='<div class="month_icon_theme_'+n+'">',o="",e={};for(var a in i){var c=a.length;if(6==c){var h=a.substr(c-2,2);e[h]=i[a]}else 2==c&&(e[a]=i[a])}for(var l in this.iconTitle)o=e&&e[l]?" month_icon_"+l:" month_icon_gray_"+l,t+='<a href="/tbmall/monthicon" target="_blank" title="'+this.iconTitle[l]+'" class="'+o+'"></a>';return t+="</div>"}}});_.Module.define({path:"props/widget/Residual",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions()},initOptions:function(){this.options={1070001:"worship",1070002:"egg"}},getResidualKey:function(i){for(var e=i.props||{},s=null,n="",t=["1070002","1070001"],a=0;a<t.length;a++)if(s=e[t[a]],s&&s.num>0&&s.end_time>Env.server_time/1e3){n=this.options[t[a]];break}return n},showUI:function(i){var e=i.wrap,s="",n=null,t=i.key||this.getResidualKey(i);t&&(s="residual_wrap residual_wrap_"+t,n=e.find(".residual_wrap"),n[0]?n.removeClass().addClass(s):(n=$('<div class="'+s+'"></div>'),e.append(n)))}}});_.Module.define({path:"ihome/widget/UserVisitCard",requires:["common/widget/Card","UserVisitCardBase","ihome/widget/Interaction","props/widget/Residual","common/widget/JoinVipDialog"],sub:{_visit_card:null,_visit_card_ajax:null,_option:{width:370},initial:function(i,a){window.Page&&Page.checkLoadedModules("UserVisitCard")||(this.dataObj=i,this._wrap=$("body"),this._util=this.use("userVisitCardBase"),this._interaction=this.use("ihome/widget/Interaction"),this._residual=this.use("props/widget/Residual"),a||this.bindEvents())},bindEvents:function(){var i=this;this._wrap.delegate(".j_user_card","mouseenter",function(){return i.buildCard($(this)),!1}),this._wrap.delegate(".j_user_card","mouseleave",function(){return i._visit_card_ajax&&i._visit_card_ajax.abort(),i._visit_card&&i._visit_card.closeCard({type:"delayClose",time:200}),i._visit_card=null,!1}),this._wrap.on("click","[j-user-visit-card-marriage-propose]",function(){var a=$(this);i.marryDialog={},i.marryDialog.hide=i.marryDialog.show=function(){};var t=a.tbattr("data-username");i.requireInstanceAsync("encourage/widget/post_marry",{type:"float",propose_name:t},function(a){i.marryDialog=a})}),this._wrap.delegate(".card_userinfo_close","click",function(){return $("#user_visit_card").remove(),!1})},buildCard:function(i){var a=this;a._visit_card&&(a._visit_card.closeCard(),a._visit_card=null);var t='<div class="user_card_loading"><img src="http://tb2.bdstatic.com/tb/static-ihome/img/loading2.gif"/>\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>',e={content:t,card_css:{width:a._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:i,attr:"id='user_visit_card'",wrap:$("body")};a._visit_card=a.use("common/widget/Card",e),a._visit_card.showCard({type:"delayShow",time:200}),a.buildVisitCard(i)},getVisitCardContent:function(i){var a=this,t={ie:"utf-8"};i.un?t.un=i.un:t.id=i.id,$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data;e.bg_id=i.bg_id;var r=a._util.getVisitCardTpl(1,e,!0);i.wrap.html(r)}else{var r='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';i.wrap.html(r)}i.callBack&&$.isFunction(i.callBack)&&i.callBack()})},buildVisitCard:function(i){var a=this,t={ie:"utf-8"};i.getData().un?t.un=i.getData().un:t.id=i.getData().id,a._visit_card_ajax&&a._visit_card_ajax.abort(),a._visit_card_ajax=$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data,r=e.name==a.dataObj.uname,s=a._util.getVisitCardTpl(r,e,!0);a._visit_card.setContent(s),a._visit_card._j_card.bindData({un:e.name}),a._visit_card.showCard(),a._interaction._resetDataObj({is_login:PageData.user.is_login,un:e.name,tbs:PageData.tbs}),a._residual.showUI({wrap:$("#user_visit_card .userinfo_head_wrap"),props:e.appraise||{}}),a._visit_card._j_card.find(".j_user_visit_card_joinvip").on("click",function(){_.Module.use("common/widget/JoinVipDialog",[],function(i){i.getMemberDialog()})}),$.stats.track("cardinfo","ihome_v1")}else{var s='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';a._visit_card.setContent(s),$("#user_card_reload").on("click",function(){return a.buildCard(i),!1})}})},bindVisitCardEvent:function(){var i=this;i._visit_card.showCard({type:"delayShow",time:200}),$.stats.track("cardinfo","ihome_v1")}}});
;_.Module.define({path:"ihome/widget/UserVisitCard/UserVisitCardBase",requires:["user/widget/Icons","common/widget/UserHead","common/widget/MemberApi","ihome/widget/MonthIcon"],sub:{countLen:0,initial:function(){},getVisitCardTpl:function(e,a,r){var i=PageData.product||"",t=this.use("user/widget/Icons"),n=this.use("common/widget/UserHead"),s=this.use("ihome/widget/MonthIcon"),o=this.use("common/widget/MemberApi"),_=n.getHeadFrameStyle(a,"105"),c={head_img:"/tb/static-ihome/img/panel_"+a.bg_id+".jpg",concernClass:"0"==a.can_followed?"btn_concern_done btn-sub":"btn_concern btn-attention",concernText:"0"==a.can_followed?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8",un:encodeURIComponent(a.name),btn_group:r?this.getBtnGroup(a):"",frameClass:_.hasFrame?"card_userinfo_left_frame":"",frameStyle:_.stylestr,portrait:n.getHeadUrl(a),fr:i,icon_pre:t.getPreIconHtml(a.mParr_props,a),member_class:o.getMemberNameClass(a.mParr_props,a.free_flag),name:a.profession_manager_nick_name||a.name_show,icon:t.getIconsHtml(a),sex:a.sex,tb_age:"-"==a.tb_age?a.tb_age:a.tb_age+"\u5E74",post_num:a.post_num,good_num:a.good_num,honor:s.getMonthIcon(a.tbmall_month_icon,2),honor_margin:this.getHonorMargin(),vip_tips:this.getVipTips(a),userId:a.id};a.is_verify&&"0"!==a.is_verify&&(c.verify_info=this.getVerifyHTML(a.identify_info));var l="",m="",d="";!a.marriage||1!=a.marriage.status&&3!=a.marriage.status&&4!=a.marriage.status?a.marriage&&0!=a.marriage.length&&2!=a.marriage.status||(d='<a class="btn-attention btn-small  user-visit-card-marriage-propose" data-username="'+a.name+'" j-user-visit-card-marriage-propose ><i></i>\u5411TA\u6C42\u5A5A</a>'):(c.marriage_date=$.dateFormat(new Date(1e3*a.marriage.time),"yyyy-MM-dd"),c.marriage_user_name=a.marriage.user_name,l=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_lover">\u7231\u4EBA:#{marriage_user_name}</span>',"</div>"].join(""),m=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_date">\u7ED3\u5A5A\u7EAA\u5FF5\u65E5: #{marriage_date}</span>',"</div>"].join(""));var f="";e||(f='<div class="interaction_wrap interaction_wrap_theme2">'+d+'<a class="btn-small #{concernClass}" target="_blank" href="#" onclick="return false">#{concernText}</a><a class="btn-small btn-default" target="sixin" href="/im/pcmsg?from=#{userId}">\u79C1\u4FE1</a></div>');var u=['<div class="card_headinfo_wrap" id="card_headinfo_wrap">','<img class="card_userinfo_img" src="#{head_img}"/>','<a class="card_userinfo_guide" target="_blank" href="/tbmall/propslist?category=113"></a>',f,"</div>",'<div class="card_userinfo_wrap clearfix">','<div class="card_userinfo_left #{frameClass}">','<div class="userinfo_head_wrap">','<div class="userinfo_head" style="#{frameStyle}"></div>','<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" class="j_avatar" target="_blank"><img src="#{portrait}"/></a>',"</div>","</div>",'<div class="card_userinfo_middle">','<div class="card_userinfo_title clearfix">','#{icon_pre}<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" target="_blank" class="userinfo_username #{member_class}">#{name}</a>#{icon}',"</div>",l,'<div class="card_userinfo_num clearfix">','<span class="userinfo_sex userinfo_sex_#{sex}"></span>',"<span>\u5427\u9F84:#{tb_age}</span>",'<span class="userinfo_split"></span>',"<span>\u53D1\u8D34:#{post_num}</span>","</div>",m,'<div class="card_userinfo_honor honor_margin_#{honor_margin} clearfix">',"#{honor}","</div>","#{vip_tips}","</div>","</div>","#{verify_info}"].join("");return $.tb.format(u,c)},getBtnGroup:function(e){var a="";if(e.id!==PageData.user.id){var r=e.can_begcard,i="";0==r?i='<a class="btn_begcard j_begcard" href="#"></a>':1==r?i='<a class="btn_begcard btn_forbidden">\u5DF2\u7533\u8BF7</a>':2==r&&(i='<a class="btn_begcard btn_forbidden">\u5DF2\u4EA4\u6362</a>');var t={private_msg:"http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un="+encodeURIComponent(e.name),btn_begcard:i};a=['<div class="card_btn_grounps">','<a class="btn_privatemsg" target="_blank" href="#{private_msg}"></a>',"#{btn_begcard}","</div>"].join(""),a=$.tb.format(a,t)}return a},getIcon:function(e){var a="";return e.identity&&(a+='<span title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" class="card_userinfo_icon card_icon_verify"></span>'),e.meizhi_level>0&&(a+='<a href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1" class="card_userinfo_icon meizhi_vip card_icon_meizhi_vip'+e.meizhi_level+'"></a>'),a},getHonor:function(e){if(e.novice)return'<div class="grade_level grade_level_novice" title="\u8D34\u5427\u83DC\u9E1F">\u8D34\u5427\u83DC\u9E1F</div>';var a={manager:{title:"\u5427\u4E3B",level:19},assist:{title:"\u5C0F\u5427\u4E3B",level:20},picadmin:{title:"\u56FE\u7247\u5C0F\u7F16",level:21},videoadmin:{title:"\u89C6\u9891\u5C0F\u7F16",level:22},novice:{title:"\u83DC\u9E1F",level:23}},r=e.manager,i=null,t="",n="";this.countLen=0;for(var s in r){i=r[s];var o=i.forum_list.join("\u3001"),_=a[s];o=i.count>2?o+"\u7B49\u5427"+_.title:o+"\u5427"+_.title,t+=this.getHonorItem(_.level,i.count,o),this.countLen+=String(i.count).length}var c=e.grade,l=[];for(var m in c)l.push(m);l.sort(function(e,a){return a-e});for(var d=0,f=l.length;f>d;d++){i=c[l[d]];var o=i.forum_list.join("\u3001");i.count>2&&(o+="\u5427\u7B49"),n+=this.getHonorItem(l[d],i.count,o),this.countLen+=String(i.count).length}return t+n},getHonorMargin:function(){var e={2:"8px",3:"6px",4:"4px"},a=this.countLen-4;return e[a]||""},getHonorItem:function(e,a,r){var i={level:e,title:r,count:a},t=['<div class="grade_level grade_level_#{level}" title="#{title}">',"<span>#{count}</span>","</div>"].join("");return $.tb.format(t,i)},getVerifyHTML:function(e){for(var a={verify_reason:e[0]&&e[0].v_reason,verify_forums:""},r=['<div class="verify_wrap">','<div class="verify_content">','<div class="verify_desc">',"<span>\u5B98\u65B9\u8BA4\u8BC1\uFF1A</span>","<span>#{verify_reason}</span>","</div>",'<div class="verify_forum">','<a class="verify_home" href="http://v.tieba.baidu.com/" target="_blank">\u7533\u8BF7\u4F01\u4E1A\u5B98\u65B9\u5427</a>',"<span>\u5165\u9A7B\u5427\uFF1A</span>","#{verify_forums}","<span>\u5B98\u65B9\u5427\u4E3B</span>","</div>","</div>","</div>"].join(""),i=0;i<e.length;i++)a.verify_forums+=this.getVForumItem(i,e[i].forum_name);return $.tb.format(r,a)},getVForumItem:function(e,a){var r="",i={},t=[];return a.length>5?(r=a.substring(0,5),r+="..."):r=a,i={index:e,verify_forum_name:r,origin_forum_name:encodeURIComponent(a)},t=['<span class="verify_forum_info">','<a target="_blank" class="verify_forum_name_#{index}" href="/f?ie=utf-8&kw=#{origin_forum_name}">#{verify_forum_name}</a>','<a target="_blank" href="http://v.tieba.baidu.com/">','<img class="verify_forum_icon" src="http://tb2.bdstatic.com/tb/static-ihome/img/platform_blue_icon14.gif" alt="\u5B98\u65B9\u8BA4\u8BC1\u56FE\u6807" title="\u767E\u5EA6\u8D34\u5427\u5B98\u65B9\u5E73\u53F0\u8BA4\u8BC1">',"</a>","</span>"].join(""),$.tb.format(t,i)},getVipTips:function(e){var a="",r=(new Date).getTime()/1e3;return e.mParr_props&&e.mParr_props.level&&e.mParr_props.level.end_time>r&&(a='<p class="user_card_vip_tips"><a href="javascript:;" class="j_user_visit_card_joinvip" target="_blank">\u5F00\u901A\u4F1A\u5458</a>\u5C0A\u4EAB\u6635\u79F0\u7EA2\u540D\u7279\u6743 <a href="/tbmall/tshow?tab=detail&c=15" target="_blank">\u4E86\u89E3\u7279\u6743</a> </p>'),a}}});